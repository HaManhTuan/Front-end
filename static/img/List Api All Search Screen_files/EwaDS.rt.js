(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[24],{1316:function(u,E,b){function a(){c.a.ti(".ewa-excelLive-meetingPill-container{height:24px;transition:height 400ms cubic-bezier(.8,0,.2,1) 0s;position:absolute;width:100%;bottom:0;pointer-events:none;z-index:992}.ewa-excelLive-meetingPill-container-hidden{height:0 !important;overflow:hidden;transition:height 400ms cubic-bezier(.8,0,.2,1) 0s}.ewa-excelLive-meetingBoundary-container{position:fixed;z-index:992}")}b.d(E,"a",
function(){return a});var c=b(559)},1343:function(u,E,b){function a(){J.a.Fa(function(ab){c.ka(ab);O.ka(ab)})}function c(ab){var ya=Cb.call(this)||this;ya.kn=null;ya.Xv=null;ya.qOa=function(){ya.kn.gIb(ya.qOa);Q.ULS.sendTraceTag(537162849,0,50,"ExcelLiveManager::OnRealTimeChannelInitialized");var ma=Object(Ob.a)(ya.$.da,473,function(){return new f(ya.$,ya.kn,ya.Xv)});ya.pb(ma)};ya.$=ab;ya.Eb();return ya}function d(ab){var ya=ec.call(this)||this;ya.Dv=null;ya.LIa=null;ya.KIa=null;ya.lAb=!1;ya.Tjc=
"ExcelLiveController::";ya.$=ab;ya.lAb=N.h(ya.$);ya.V9h();ya.GDa=qa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ExcelLiveSurvey",!1);ya.GDa&&(ya.xng=new e(ab,ya));return ya}function e(ab,ya){this.MIa=this.Oob=null;this.$pd=this.Pyb=this.mfc=this.lfc=!1;this.$=ab;this.controller=ya;this.Pyb=qa.EwaSettings.isChangeGateEnabled("OfficeVSO:6454130_ExcelLiveExplorerBasedSurveyTriggerEnabled");(this.lfc=qa.EwaSettings.isChangeGateEnabled("OfficeVSO:6603003_ExcelLiveBufferBasedSurveyTriggerEnabled"))?
this.G4f(this.$.ya.ExcelLiveBufferBasedSurveyTriggerBufferTimeInMs):this.Pyb&&this.G4f(this.$.ya.ExcelLiveMeetingBufferTimeInMs)}function k(ab,ya){ya=void 0===ya?null:ya;this.container=null;this.Jl=0;this.iPa=null;this.Of=!1;ya&&(this.$=ab,this.initialize(ya),this.Of=vb.AFrameworkApplication.ta.Qa.Of)}function l(ab,ya){var ma=this;ya=void 0===ya?null:ya;this.koa=null;this.OVd=this.JSe=!0;this.container=null;this.Jl=0;this.iPa=this.Xya=null;this.lastUpdateTime=0;this.$=null;this.L3h=function(){ma.OVd||
(ma.iQf(),ma.OVd=!0,ma.container.classList.remove("ewa-excelLive-meetingPill-container-hidden"))};ya&&this.initialize(ab,ya);this.$=ab}function n(ab){this.Sce=this.Rce=this.Qce=null;this.jce=void 0;this.$=ab}function f(ab,ya,ma){this.Kpa=this.Shb=this.xkb=this.iib=null;this.$=ab;this.wde=ya;this.Nn=new v(this.$,ma);this.K1=Object(ka.a)(17,this.kn.rj);N.h(this.$)&&(this.Fc=this.Fc.bind(this),this.Gnc=this.Gnc.bind(this),this.K1.Dga(this.Gnc),this.$.Bk(this.Fc));this.Kpa=ma;this.G8h()}function v(ab,
ya){this.Oud=this.yTf=0;this.did=!1;this.Oud=oa.HelperMethods.Qb();this.$=ab;this.Xv=ya;this.iLd=new Map;this.cJb=new Map;this.Mtc=new Map;this.GTf=this.o_j;this.MBb(300)}function r(ab,ya,ma){this.controller=this.q_=null;this.eCi=1E4;this.BCb=0;this.$=ab;this.gridView=wa.g(this.$);this.Nn=new y(this.$);this.realtimeChannel=ya;this.controller=ma;this.Bob();this.Eoj();qa.EwaSettings.isChangeGateEnabled("OfficeVSO:6471382_ExcelLive_IgnoreActionsIfRtcNotConnected")?2==this.realtimeChannel.connectionState?
this.NSd():this.realtimeChannel.Dga(this.o6):this.NSd()}function y(ab){this.rrb=this.RQa=this.pHf=0;this.N$c=Number.MAX_SAFE_INTEGER;this.JAb=Number.MIN_SAFE_INTEGER;this.BCb=0;this.$=ab;this.pHf=oa.HelperMethods.Qb();this.FUd=new G;this.MBb(300)}function m(ab,ya,ma){this.Tjc="ExcelLiveParticipantV0";this.viewBlockContainerHelpers=this.NOb=this.A6=null;this.$md=this.eMa=!1;this.l2a=0;this.oRe=10;this.pRe=500;this.qRe=3E4;this.Mka=0;this.Xv=ma;this.realtimeChannel=ya;this.$=ab;this.gridView=wa.g(ab);
this.Xcc=this.Xcc.bind(this);this.Tla=this.Tla.bind(this);this.oRe=this.$.ya.FetchPresenterNavigationStateMaxRetries;this.pRe=this.$.ya.FetchPresenterNavigationStateRetryBaseInMs;this.qRe=this.$.ya.FetchPresenterNavigationStateRetryMaxDelayInMs;this.initialize()}function w(ab,ya,ma){this.statusBarManager=null;this.faa=new A;this.trd=this.vGb=null;this.cZ=this.wGb=0;this.kRe=10;this.lRe=1E3;this.mRe=3E4;this.lZd=.98;this.gwa=this.x5a=this.Sfc=this.Gyb=this.Jmd=this.Hyb=this.rMa=this.Zmd=!1;this.Rrd=
null;this.rwa=this.mod=!1;var ha=oa.HelperMethods.Qb();this.controller=ma;this.realtimeChannel=ya;this.$=ab;this.gridView=wa.g(ab);this.Nn=new D(this.$,ha,3);this.statusBarManager=new z(this.$,this.faa);this.lZd=this.$.ya.ExcelLiveViewportRoundOffFactor;this.kRe=this.$.ya.FetchPresenterNavigationStateMaxRetries;this.lRe=this.$.ya.FetchPresenterNavigationStateRetryBaseInMs;this.mRe=this.$.ya.FetchPresenterNavigationStateRetryMaxDelayInMs;this.rwa=qa.EwaSettings.isChangeGateEnabled("OfficeVSO:6175128_ExcelLiveExploreTransitionsFix");
this.Bob();this.zLg();qa.EwaSettings.isChangeGateEnabled("OfficeVSO:6471382_ExcelLive_IgnoreActionsIfRtcNotConnected")?2==this.realtimeChannel.connectionState?this.Kdb():this.realtimeChannel.Dga(this.o6):this.Kdb()}function B(ab){ab=ab.endsWith("_Vacs")?ab.split("_",1)[0]:ab;return!sa.has(ab)}function A(){return ia.call(this)||this}function z(ab,ya){var ma=na.call(this)||this;ma.statusBarManager=null;ma.n5b=2;ma.Tpc=null;ma.jDf=function(ha,Z){ma.n5b=Z.n5b;ma.Tpc=Z.Tpc;ma.qz()};ma.$=ab;ma.$.da.Za(29,
function(ha){ma.statusBarManager=ha;ha.gJ(ma)});ma.faa=ya;ma.faa.WGg(ma.jDf);return ma}function x(ab,ya){var ma=xa.call(this)||this;ma.n5b=ab;ma.Tpc=ya;return ma}function D(ab,ya,ma){this.JQe=this.xrf=this.wrf=this.rad=this.xTe=this.Zeg=this.oCc=this.G9c=this.IQe=this.FFb=0;this.Yic=void 0;this.eqc=this.Mic=this.Aif=this.I9b=this.Q$c=this.nGb=this.Nkc=this.a_d=this.TTd=0;this.$=ab;this.FFb=ya;this.Ctc=new Map;this.Ctc[Ga[ma]]=1;this.MHa=ma;this.eqc=ya;this.aLd=new Map;this.Dtc=new Map;this.Yof=new G;
this.MBb(300)}function I(ab,ya,ma){return Xa.a.instance.create(ya,1E3*ab,ma,void 0,!0)}function F(ab,ya){Q.ULS.sendTraceTag(523015437,0,50,ya+" = "+ab)}function G(){this.average=0;this.max=Number.MIN_SAFE_INTEGER;this.min=Number.MAX_SAFE_INTEGER;this.Wqc=this.last=0}function T(ab,ya){ab=document.getElementById(ab.yb+va.a.M0a);return{ROb:ab.clientWidth/ya,OOb:ab.clientHeight/ya}}function O(ab){return C.call(this,ab)||this}function U(ab,ya){this.$=ab;this.excelLiveManager=ya}var J=b(10);u=b(0);var H=
b(905),K=b(37),N=b(163),M=b(186);U.prototype.Lc=function(){return!1};U.prototype.zc=function(ab,ya){switch(ya.command){case 1491932557:return N.h(this.$)&&2===this.excelLiveManager.ROa.Jl;case -440259636:return N.g(this.$)&&2===this.excelLiveManager.ROa.Jl;default:return!1}};U.prototype.executeCommand=function(ab,ya){ab=K.TaskExtensions.jk();var ma=ya.command;switch(ya.command){case -440259636:this.excelLiveManager.Fgd();break;case 1491932557:this.excelLiveManager.VTd();break;default:ab=M.a(ma)}return ab};
U.prototype.Qc=function(){return!1};Object(u.a)(U,"ExcelLiveCommandHandler",null,[429]);var C=H.a;Rk(O,C);O.prototype.Ad=function(){var ab=this;this.$.da.Za(473,function(ya){ab.jd([new U(ab.$,ya)])})};O.ka=function(ab){H.a.Qd(469,new O(ab))};Object(u.a)(O,"ExcelLiveCommandHandlerFactory",H.a,[]);var Q=b(14),P=b(232),ka=b(85),R=b(8),fa=b(48),ca=b(24),ea=b(45),wa=b(21),X=b(215),ja=b(33),va=b(5),ua=b(129),Xa=b(47),aa=b(280),ba=b(699),oa=b(11),ra;(function(ab){ab[ab.complete=0]="complete";ab[ab.nonComplete=
1]="nonComplete";ab[ab.unknown=2]="unknown"})(ra||(ra={}));Object(u.b)("FollowerViewState",ra);var db;(function(ab){ab[ab.none=0]="none";ab[ab.selection=1]="selection";ab[ab.scroll=2]="scroll";ab[ab.zoom=4]="zoom";ab[ab.default=0]="default"})(db||(db={}));Object(u.b)("UpdateType",db);var Ka=b(54),Ga;(function(ab){ab[ab.presenter=0]="presenter";ab[ab.follower=1]="follower";ab[ab.explorer=2]="explorer";ab[ab.unknown=3]="unknown"})(Ga||(Ga={}));Object(u.b)("ParticipantRole",Ga);G.prototype.u2=function(ab){this.min=
ab<this.min?ab:this.min;this.max=ab>this.max?ab:this.max;++this.Wqc;this.average=(ab+this.average*(this.Wqc-1))/this.Wqc;this.last=ab};G.prototype.toString=function(){return"{average: "+this.average+", min: "+this.min+", max: "+this.max+", last: "+this.last+", recordsCount: "+this.Wqc+"}"};Object(u.a)(G,"Aggregates",null,[]);D.prototype.dispose=function(){this.$=null};D.prototype.R7a=function(){var ab=oa.HelperMethods.Qb(),ya={};ya.FollowerViewState=0<this.rad?"Hybrid":ra[this.Yic];ya.FollowerViewStateTransitions=
this.rad;ya.FollowerZoomInOppositeDirectionCount=this.xTe;ya.ExplorerConsumptionTrends=0<this.JQe?"WorkbookEdited":"WorkbookViewed";ya.ExplorerNSVModeTrends=this.wrf;ya.ExplorerNSVSwitchTrends=this.xrf;ya.ViewportChangesInNonCompleteViewCount=this.Zeg;ya.ParticipantSessionInitTimestamp=this.FFb;ya.FirstMessageIdReceived=this.Q$c;ya.LastMessageIdReceived=this.Aif;ya.FirstMessageReceivedTimestamp=this.I9b;ya.LastMessageReceivedTimestamp=this.Mic;ya.TimeSinceLastMessageReceivedInMs=ab-this.Mic;ya.TotalMessagesReceived=
this.Nkc;ya.MessagesReceptionLatencyAggregates=this.Yof;ya.PresenterIdentifiedTimestamp=this.nGb;ya.PresenterID=this.oHf;ya.TimeToIdentifyPresenterFromCreationInMs=this.nGb-this.FFb;ya.CurrentRole=this.MHa;ya.TimeInCurrentRole=ab-this.eqc;ya.PreviousRole=this.P_i;ya.RoleSwitchCounts=this.Ctc;ya.RoleSwitchDurationsInMs=this.aLd;ya.RoleSwitchDurationsTrackerAggregates=this.Dtc;ab=Ka.a.xc(ya);this.$.sendBeaconTraceTag(523015447,50,!1,"ExcelLiveFollowerOrExplorer.logSessionTelemetry: "+ab)};D.prototype.qtd=
function(){2E3>oa.HelperMethods.Qb()-this.oCc&&(++this.Zeg,F(oa.HelperMethods.Qb()-this.oCc,"ExcelLiveFollowerOrExplorer.logNonCompleteViewStateTelemetry: TimeElapsedSinceLastViewportChange"),this.oCc=0)};D.prototype.zKj=function(ab,ya){this.Yic&&ab!==this.Yic&&++this.rad;this.Yic=ab;F(oa.HelperMethods.Qb()-ya,"ExcelLiveFollowerOrExplorer.trackAndLogFollowerViewStateTransitions: TimeTakenToSyncFollowerViewport")};D.prototype.EKj=function(ab){ab=oa.HelperMethods.Qb()-ab;Q.ULS.sendTraceTag(523015446,
0,50,"ExcelLiveFollowerOrExplorer.trackAndLogTimeToProcessReceivedMessage: Total time to process received message: ["+ab+"]ms with current role: ["+this.MHa+"]")};D.prototype.FKj=function(ab){Q.ULS.sendTraceTag(523015445,0,50,"ExcelLiveFollowerOrExplorer.trackAndLogTotalTimeToSyncFollowerViewport: Total time to sync: ["+(Date.now()-ab)+"]ms with current role: ["+this.MHa+"]")};D.prototype.yKj=function(ab){this.G9c=oa.HelperMethods.Qb();++this.IQe;1===this.IQe&&F(oa.HelperMethods.Qb()-this.FFb,"ExcelLiveFollowerOrExplorer.trackAndLogExplorerTransitions: TimeToFirstExplorerTransition");
Q.ULS.sendTraceTag(523015444,0,50,"ExcelLiveFollowerOrExplorer.trackAndLogExplorerTransitions: Last Update Type from Presenter Was = {0}. Current View State = {1}",db[ab],wa.g(this.$).Nub().aB(!0))};D.prototype.AKj=function(){ja.a(this.$);var ab=oa.HelperMethods.Qb()-this.a_d;1E4>ab&&(F(ab,"ExcelLiveFollowerOrExplorer.trackAndLogFollowerZoomTrends: TimeToZoomChangeInOppositeDirection"),this.a_d=0);this.HKj()};D.prototype.HKj=function(){oa.HelperMethods.Qb()<this.FFb+12E4&&++this.xTe};D.prototype.Pvi=
function(){var ab=oa.HelperMethods.Qb()-this.G9c;5E3>ab&&F(ab,"ExcelLiveFollowerOrExplorer.logSyncBackToPresenterTelemetry: TimeElapsedToSyncBackSinceBecomingExplorer");this.G9c=0};D.prototype.Ovi=function(ab,ya,ma){ab=void 0===ab?!1:ab;F(oa.HelperMethods.Qb()-this.TTd,"ExcelLiveFollowerOrExplorer.logSyncBackToPresenterTelemetry: Synced via Presence Notification = "+ab+", IsSyncBack = "+ya+", Retries = "+ma+" TimeElapsedInSyncingExplorerBackToPresenter");this.TTd=0};D.prototype.IKj=function(ab){typeof ab===
typeof ba.a?++this.wrf:++this.xrf};D.prototype.LKj=function(){this.TTd=oa.HelperMethods.Qb()};D.prototype.MKj=function(){this.oCc=oa.HelperMethods.Qb()};D.prototype.NKj=function(){this.a_d=oa.HelperMethods.Qb()};D.prototype.GKj=function(){++this.JQe};D.prototype.CKj=function(ab,ya){var ma,ha=oa.HelperMethods.Qb(),Z=Date.now();0===this.Q$c&&(this.Q$c=ab,this.I9b=ha);this.Aif=ab;++this.Nkc;ya=Z-ya;1<this.Nkc&&this.Yof.u2(ya);Z=ha-(null!==(ma=this.Mic)&&void 0!==ma?ma:this.I9b);this.Mic=ha;Q.ULS.sendTraceTag(523015443,
0,50,"ExcelLiveFollowerOrExplorer.trackAndLogMessageReceived: Received message number ["+this.Nkc+"] MessageID: ["+ab+"] Time since last message: ["+Z+"]ms with reception latency: ["+ya+"]ms")};D.prototype.fvi=function(ab){this.nGb=oa.HelperMethods.Qb();this.oHf=ab;Q.ULS.sendTraceTag(523015442,0,50,"ExcelLiveFollowerOrExplorer.logPresenterIdentified: Presenter identified at ["+this.nGb+"] after ["+(this.nGb-this.I9b)+"]ms since first valid message with clientId=["+this.oHf+"]")};D.prototype.KKj=function(ab){var ya,
ma;if(this.MHa!==ab){3===ab&&this.R7a();var ha=oa.HelperMethods.Qb(),Z=Ga[this.MHa],Na=Ga[ab];this.Ctc[Na]=1+(null!==(ya=this.Ctc[Na])&&void 0!==ya?ya:0);ya=ha-this.eqc;this.aLd[Z]=ya+(null!==(ma=this.aLd[Z])&&void 0!==ma?ma:0);this.Dtc.has(Z)||(this.Dtc[Z]=new G);this.Dtc[Z].u2(ya);this.eqc=ha;this.P_i=this.MHa;this.MHa=ab}};D.prototype.MBb=function(ab){function ya(){ma.R7a();I(ab,ya,"ExcelLiveFollowerOrExplorer.logSessionTelemetryAtSpecifiedInterval")}var ma=this;ya.call(this)};Object(u.a)(D,"ExcelLiveFollowerOrExplorerTelemetryHelper",
null,[3]);var xa=Sys.EventArgs;Rk(x,xa);Object(u.a)(x,"ExcelLiveViewStateChangedArgs",Sys.EventArgs,[]);var da=b(38),qa=b(1),na=da.a;Rk(z,na);z.prototype.gq=function(ab){this.addHandler("followerViewStateInfoChanged",ab)};z.prototype.Eq=function(ab){this.removeHandler("followerViewStateInfoChanged",ab)};z.prototype.qz=function(){this.an("QueryExcelLiveViewState")&&this.raiseEvent("followerViewStateInfoChanged")};z.prototype.Ir=function(ab,ya){return"QueryExcelLiveViewState"!==ab?!1:this.T2h(ya)};
z.prototype.an=function(){return Object(N.h)(this.$)&&qa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShowExcelLiveViewStateInStatusBar",!1)};z.prototype.dispose=function(){this.statusBarManager&&(this.statusBarManager.wF(this),this.statusBarManager=null);this.faa.Acj(this.jDf);this.$=this.faa=null;na.prototype.dispose.call(this)};z.prototype.T2h=function(ab){if(!this.$)return!1;ab.Value=String.format("View State: {0} | Presenter Visible Range: {1}",ra[this.n5b],this.Tpc);return!0};Object(u.a)(z,
"ExcelLiveStatusBarManager",da.a,[3,472,303]);var ia=da.a;Rk(A,ia);A.prototype.WGg=function(ab){this.addHandler("FollowerViewStateChanged",ab)};A.prototype.Acj=function(ab){this.removeHandler("FollowerViewStateChanged",ab)};A.prototype.Q2i=function(ab){this.raiseEvent("FollowerViewStateChanged",ab)};Object(u.a)(A,"ExcelLiveFollowerOrExplorerEventManager",da.a,[]);var ta=b(76),za=b(95),sa=new Set([za.a.jgg,za.a.oqe,za.a.Z6f,za.a.$6f,za.a.G3e,za.a.Qgd]);w.prototype.dispose=function(){this.zdh();2!==
this.controller.Jl&&(this.sGe(),this.Yrb());this.gridView=this.$=this.controller=this.realtimeChannel=this.trd=this.Vrd=this.E7a=this.Rrd=this.vGb=null;qa.EwaSettings.isChangeGateEnabled("OfficeVSO:6471382_ExcelLive_IgnoreActionsIfRtcNotConnected")&&this.realtimeChannel.Gma(this.o6)};w.prototype.VTd=function(){this.Nn.LKj();this.Kdb(!0)};w.prototype.Kdb=function(ab,ya){var ma=this;ab=void 0===ab?!1:ab;ya=void 0===ya?null:ya;var ha;ab&&this.Nn.Pvi();if(ya)this.FMb(ya)||this.gwa?this.Ikd(ab):Q.ULS.sendTraceTag(527496925,
0,15,"ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry: Could not sync to presenter from presence update"),this.cZ=0;else if(++this.cZ,this.cZ>this.kRe)Q.ULS.sendTraceTag(527496924,0,10,"ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry: Presenter Nav State not available after "+(this.cZ-1)+" retries."),this.Zmd=!0,this.cZ=0;else{if(1===this.cZ){var Z=null!==(ha=this.trd)&&void 0!==ha?ha:this.vGb;if(null!==Z&&(this.FMb(Z,!0)||this.gwa)){this.Ikd(ab,!0,this.cZ);this.cZ=0;return}}(ha=
this.c$c())&&(this.FMb(ha)||this.gwa)?(this.Ikd(ab,!0,this.cZ),this.cZ=0):1!==this.controller.Jl&&(this.U7(3,"ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry"),Q.ULS.sendTraceTag(527496923,0,15,"ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry: Retry\n           "+this.cZ+" - Presenter Nav State not available."),Xa.a.instance.create(function(){ma.Kdb(ab,ya)},aa.a.jva(this.cZ,this.lRe,this.mRe,!0),"ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry",void 0,!0))}};
w.prototype.Ikd=function(ab,ya,ma){ab=void 0===ab?!1:ab;ya=void 0===ya?!1:ya;ma=void 0===ma?0:ma;this.U7(1,"ExcelLiveFollowerOrExplorer::initializeFollower");this.yLg();this.X_b();this.Zmd=!1;ab&&this.Nn.Ovi(ya,ab,ma);this.controller.lgf&&this.controller.XPe.YVd()};w.prototype.Bob=function(){this.Tla=this.Tla.bind(this);this.$x=this.$x.bind(this);this.RC=this.RC.bind(this);this.Qf=this.Qf.bind(this);this.BOa=this.BOa.bind(this);this.Dh=this.Dh.bind(this);this.fmc=this.fmc.bind(this);this.Oi=this.Oi.bind(this);
this.boc=this.boc.bind(this);this.enc=this.enc.bind(this);this.fOa=this.fOa.bind(this);this.qoc=this.qoc.bind(this);this.onScroll=this.onScroll.bind(this);this.P9a=this.P9a.bind(this);this.Fc=this.Fc.bind(this);this.A9a=this.A9a.bind(this);this.k9a=this.k9a.bind(this);this.oe=this.oe.bind(this);this.joc=this.joc.bind(this);this.o6=this.o6.bind(this)};w.prototype.jRe=function(){var ab=this.c$c();return this.FMb(ab)};w.prototype.c$c=function(ab){ab=void 0===ab?null:ab;if(ab=null!==ab&&void 0!==ab?ab:
this.realtimeChannel.Qbd())for(var ya in ab){var ma=ya,ha=ab[ya];if(!ha)break;if(ha.NavigationState&&ha.MeetingInfo&&(ha.MeetingInfo.MeetingId===this.$.ya.MeetingId||N.e()))return this.Nn.CKj(ha.MeetingInfo.MessageId,ha.NavigationState.MessageBroadcastTime),this.controller.aD&&this.controller.aD===ma||this.controller.leg(ma,"ExcelLiveFollowerOrExplorer:extractNavigationStateFromMeetingPresence")&&this.Nn.fvi(ma),ha.NavigationState}return null};w.prototype.U7=function(ab,ya){this.Nn.KKj(ab);this.controller.U7(ab,
ya)};w.prototype.FMb=function(ab,ya){ya=void 0===ya?!1:ya;var ma=oa.HelperMethods.Qb(),ha=this.m0g(ab,this.vGb,ya);if(0===ha)return this.xUf(ha,ab),!0;if(!this.SMj(ab.SheetID))return!1;ha&4&&this.setZoom(this.vGb,ab);ya=this.h0g(ab);this.vGj(ab,ha,ya);this.xUf(ha,ab);ab=ea.D(ab.VisibleAreaRange);this.faa.Q2i(new x(ya,ab.toString()));this.Nn.zKj(ya,ma);return!0};w.prototype.vGj=function(ab,ya,ma){this.Hyb=!0;0===ma?this.Y6f(ya,ab):this.wGj(ya,ab)};w.prototype.xUf=function(ab,ya){this.vGb=ya;this.wGb=
ab};w.prototype.SMj=function(ab){ab=this.$.va.getItemByName(ab);var ya=this.$.va.pa;this.Rrd=ab;if(!ab)return this.gwa=!0,!1;if(ab!==ya){if(!ab.visible)return!1;this.rMa=!0;ab.activate();ya=ab}if(qa.EwaSettings.isChangeGateEnabled("OfficeVSO:6146876_ExcelLiveSkipNSVPrompts")){if(!ya.Md.bK&&!ya.Md.Qx)return!0;ab={};this.$.Fd(1690118309,ta.a.Cb,0,(ab[N.b]=!0,ab)).continueWith(function(){return!0})}return!0};w.prototype.setZoom=function(ab,ya){ab&&ab.SheetID===ya.SheetID&&(ab=(ya.ZoomLevel-ab.ZoomLevel)/
ab.ZoomLevel*100,ya=ja.a(this.$).zoom,ab=ya+ya*ab/100,ja.a(this.$).pgg(ab),this.Nn.NKj())};w.prototype.Y6f=function(ab,ya){ab&2&&(ab=ea.D(ya.VisibleAreaRange),this.E7a=ca.Range.Tc(ab.top,ab.left),this.Vrd=new fa.a(ya.TopLeftCellOffsets.X,ya.TopLeftCellOffsets.Y),ya=X.a(this.E7a,this.Vrd,this.gridView.ys,this.gridView.eb,0,0,this.$,this.gridView.pZ()),this.gridView.SZb(ya,this.E7a,60,this.E7a,za.a.Z6f))};w.prototype.wGj=function(ab,ya){var ma=ea.D(ya.SelectedRanges[ya.IndexOfActiveRange]),ha=ab!==
this.wGb,Z=ea.D(ya.VisibleAreaRange);ab&1?(this.ifg=this.gridView.Nub(),this.gridView.fr(ma,64,za.a.$6f,!0),ab=this.gridView.wja(),this.E7a=ab.gL,this.Vrd=ab.nB,ha&&(this.rwa?this.mod=!0:this.gridView.gZb(this.k9a))):ab&2&&(!Z.xd(ma)||this.wGb&2||this.wGb&4)&&(this.Y6f(ab,ya),ha&&this.Nn.qtd());this.Nn.MKj()};w.prototype.e6e=function(ab){var ya=this.gridView.Nub();return ya.xd(ab)&&ab.xd(ya)?!0:!1};w.prototype.m0g=function(ab,ya,ma){ma=void 0===ma?!1:ma;if(!ab)return 0;if(!ya&&ab||ma)return 7;var ha=
ea.D(ab.SelectedRanges[ab.IndexOfActiveRange]),Z=ea.D(ya.SelectedRanges[ya.IndexOfActiveRange]),Na=ea.D(ab.VisibleAreaRange),eb=ea.D(ya.VisibleAreaRange);if(ya.SheetID===ab.SheetID&&(ya.SheetID!==ab.SheetID||ya.ZoomLevel===ab.ZoomLevel&&ha.equals(Z)&&Na.equals(eb)&&ya.TopLeftCellOffsets.X===ab.TopLeftCellOffsets.X&&ya.TopLeftCellOffsets.Y===ab.TopLeftCellOffsets.Y))return ma?7:0;ha=ea.D(ab.VisibleAreaRange);ma=ea.D(ab.SelectedRanges[ab.IndexOfActiveRange]);ha=ca.Range.Tc(ha.top,ha.left);Z=new fa.a(ab.TopLeftCellOffsets.X,
ab.TopLeftCellOffsets.Y);eb=ea.D(ya.VisibleAreaRange);Na=ea.D(ya.SelectedRanges[ya.IndexOfActiveRange]);eb=ca.Range.Tc(eb.top,eb.left);var cb=new fa.a(ya.TopLeftCellOffsets.X,ya.TopLeftCellOffsets.Y),Ua=0;ab.SheetID!==ya.SheetID?Ua|=3:(Na.equals(ma)||(Ua|=1),ab.ZoomLevel!==ya.ZoomLevel&&(Ua|=4),Z.equals(cb)&&ha.equals(eb)||(Ua|=2));return Ua};w.prototype.h0g=function(ab){var ya=T(this.$,ja.a(this.$).zoom),ma=ya.OOb;return ya.ROb<ab.ViewportWidth*this.lZd||ma<ab.ViewportHeight*this.lZd?1:0};w.prototype.yLg=
function(){var ab=this;this.$.ea.RD(this.$x);this.$.ea.nYa(this.RC);this.$.da.Za(419,function(ya){ya.yne(ab.P9a);ya.zne(ab.P9a)})};w.prototype.sGe=function(){var ab=this;this.$&&(this.$.ea.hD(this.$x),this.$.ea.Sab(this.RC),this.$.da.Za(419,function(ya){ya.YPf(ab.P9a);ya.ZPf(ab.P9a)}))};w.prototype.P9a=function(){this.Nn.AKj()};w.prototype.$x=function(){this.$.ea.Ue!==R.a.Ee&&this.$.ea.dc&&(this.gwa&&this.$.ea.zu(this.Qf),this.x5a=!0)};w.prototype.Qf=function(){(this.x5a||this.gwa)&&this.jRe()&&(this.$.ea.Bw(this.Qf),
this.gwa=this.x5a=!1)};w.prototype.o6=function(ab,ya){if(2==ya.newState||2==this.realtimeChannel.connectionState)this.Kdb(),this.realtimeChannel.Gma(this.o6)};w.prototype.RC=function(){this.rMa?this.rMa=!1:this.x5a&&this.jRe()&&(this.x5a=!1)};w.prototype.X_b=function(){var ab=this;this.rwa?(this.gridView.view.UGg(this.joc),this.gridView.gZb(this.k9a)):(this.gridView.vYa(this.BOa),this.$.Ple(this.fmc),this.$.sA(this.Oi),this.$.da.Za(419,function(ya){ya.bHg(ab.qoc)}),this.gridView.ame(this.fOa));this.gridView.Wb.Ak(this.Dh);
this.$.da.Za(65,function(ya){ya.uFg(ab.boc)})};w.prototype.Yrb=function(){this.gridView&&(this.rwa?(this.gridView.view.ycj(this.joc),this.gridView.dsc(this.k9a)):(this.gridView.$ab(this.BOa),this.gridView.bPf(this.fOa)),this.gridView.Wb.vk(this.Dh));if(!this.rwa){this.$&&(this.$.OOf(this.fmc),this.$.gD(this.Oi));var ab=this.$.da.za(419);ab&&ab.Dcj(this.qoc)}(ab=this.$.da.za(65))&&ab.pbj(this.boc)};w.prototype.BOa=function(){this.Gyb?this.Gyb=!1:this.Sfc||this.rMa||this.Hyb||this.doi()||(this.Jmd?
this.Jmd=!1:this.Jla())};w.prototype.joc=function(){this.Jla()};w.prototype.k9a=function(ab,ya){1!==this.controller.Jl||B(ya.gotoCaller)||Q.ULS.sendTraceTag(523015448,0,50,"ExcelLiveFollowerOrExplorer.onGoToEnded: Function called for viewport sync action");this.rwa?B(ya.gotoCaller)?this.Jla():this.mod&&this.e6e(this.ifg)&&(this.Nn.qtd(),this.mod=!1):(this.gridView.dsc(this.k9a),this.e6e(this.ifg)&&this.Nn.qtd())};w.prototype.doi=function(){var ab=this.gridView.wja().gL;return this.Rrd===this.$.pa&&
ab.equals(this.E7a)?!0:!1};w.prototype.Dh=function(){this.Jla()};w.prototype.fmc=function(){this.Gyb=!0};w.prototype.Oi=function(){this.Gyb=!0};w.prototype.qoc=function(){this.Sfc=!0};w.prototype.fOa=function(){this.Sfc=!1};w.prototype.onScroll=function(ab){this.Hyb&&1===this.controller.Jl&&(this.Hyb=!1,this.Jmd=!0);ab.stopPropagation()};w.prototype.boc=function(){this.Jla()};w.prototype.Jla=function(){this.Ffj();this.Nn.yKj(this.wGb);this.U7(2,"ExcelLiveFollowerOrExplorer::onExploreActionsObserved");
this.sGe();this.Yrb();this.controller.lgf&&this.controller.XPe.YVd()};w.prototype.zLg=function(){this.realtimeChannel.CFa(this.Tla);this.$.ea.Fme(this.enc);this.rwa||ua.a.instance.Sd(this.gridView.domElement).ka("scroll",this.onScroll);this.$.Bk(this.Fc);this.$.pa.Md.zFa(this.A9a);this.$.pa.Md.nZb(this.A9a);this.$.va.If(this.oe)};w.prototype.zdh=function(){this.realtimeChannel&&this.realtimeChannel.Cza(this.Tla);null!==this.$&&(this.$.ea.abj(this.enc),this.$.Ol(this.Fc),this.$.pa.Md.Xab(this.A9a),
this.$.pa.Md.sId(this.A9a),this.$.va.vg(this.oe))};w.prototype.Tla=function(ab,ya){ab=oa.HelperMethods.Qb();this.wEd(ya.p3);this.DEd(ya.yO);this.Nn.EKj(ab)};w.prototype.wEd=function(ab){var ya=this;!ab||1>ab.length||2===this.controller.Jl||ab.forEach(function(ma){ma===ya.controller.aD&&(ya.controller.Lrc(),ya.U7(3,"ExcelLiveFollowerOrExplorer:processDisconnectedClients"))})};w.prototype.DEd=function(ab){!ab||1>ab.length||(ab=this.c$c(ab),null!==ab&&(this.trd=ab,2!==this.controller.Jl&&(3===this.controller.Jl?
this.Kdb(this.Zmd,ab):(this.FMb(ab),this.Nn.FKj(ab.MessageOriginTime)))))};w.prototype.Ffj=function(){this.gwa=this.Hyb=this.rMa=this.Gyb=this.Sfc=!1};w.prototype.enc=function(){1!==this.controller.Jl||this.rMa?this.Nn.GKj():this.Jla()};w.prototype.A9a=function(ab,ya){this.Nn.IKj(ya)};w.prototype.oe=function(){this.rMa||this.rwa&&this.x5a||this.Jla()};w.prototype.Fc=function(ab,ya){ya.jg||this.Nn.R7a()};Object(u.a)(w,"ExcelLiveFollowerOrExplorer",null,[]);var V=b(29),Ia=b(51),Ha=b(105),ob=b(394),
ib=b(15);m.prototype.dispose=function(){this.Yrb();this.Cdh();this.$=this.gridView=this.viewBlockContainerHelpers=this.NOb=this.realtimeChannel=this.jPa=this.Xv=null};m.prototype.Fgd=function(){Q.ULS.sendTraceTag(537162846,0,50,"ExcelLiveParticipantV0.GoToPresenter - UI action performed");this.jPa&&this.jPa.uq&&ob.a.qA.notificationBar.removeEntry(this.jPa);if(this.$md)this.Y2f(),Q.ULS.sendTraceTag(537162845,0,50,"ExcelLiveParticipantV0.GoToPresenter - UI action ignored due to floating object selection.");
else{var ab=!0;this.eMa||(ab=this.f0h());ab?this.O4f():this.Y2f()}};m.prototype.Tla=function(ab,ya){this.wEd(ya.p3);this.DEd(ya.yO)};m.prototype.Xcc=function(){var ab=this;if(0===this.Xv.Jl)Q.ULS.sendTraceTag(529064851,0,50,"ExcelLiveParticipantV0::HandleViewportChanged: Viewport changed for presenter.");else if(!this.NOb||this.NOb&&!this.NOb.Lp)this.NOb=Xa.a.instance.create(function(){ab.Jla()},500,"ExcelLiveParticipantV0.HandleViewportChanged",void 0,!0)};m.prototype.Jla=function(){Q.ULS.sendTraceTag(529064849,
0,50,"ExcelLiveParticipantV0::onExploreActionsObserved: Explore action observed.");this.nLe();this.eMa||this.M4f("ExcelLiveParticipantV0::onExploreActionsObserved")};m.prototype.Y2f=function(){this.jPa||(this.jPa=ob.a.qA.notificationBar.J$(ib.a.instance.ga(2242),!1),this.jPa.image=0);ob.a.qA.notificationBar.OD(this.jPa);Q.ULS.sendTraceTag(528786756,0,50,"ExcelLiveParticipantV0.GoToPresenter - Action not performed. Location not available.")};m.prototype.initialize=function(){N.f(this.$)?(this.H8h(),
this.X_b()):(this.OLg(),this.Y8e())};m.prototype.H8h=function(){this.Xv.U7(0,this.Tjc+"initExcelLivePresenter")};m.prototype.Y8e=function(){var ab=this;++this.l2a;if(this.l2a>this.oRe)Q.ULS.sendTraceTag(527766151,0,10,"ExcelLiveParticipantV0::initFollowerOrExplorerRetryable: Presenter data not available after "+(this.l2a-1)+" retries.");else{var ya=this.nRe();ya?this.W8e(ya):(Q.ULS.sendTraceTag(527766150,0,15,"ExcelLiveParticipantV0::initFollowerOrExplorerRetryable: Retry "+this.l2a+" - Presenter data not available."),
Xa.a.instance.create(function(){ab.Y8e()},aa.a.jva(this.l2a,this.pRe,this.qRe,!0),"ExcelLiveParticipantV0::initFollowerOrExplorerRetryable",void 0,!0))}};m.prototype.W8e=function(ab){ab?(this.l2a=0,Q.ULS.sendTraceTag(537162844,0,50,"ExcelLiveParticipantV0::InitExcelLiveFollowerOrExplorer: Update received from presenter with CID: "+this.Xv.aD+" and messageId:"+this.Mka),this.A6=ab,this.nLe(),this.eMa&&3===this.Xv.Jl?this.O4f():this.eMa||this.M4f("ExcelLiveParticipantV0::InitExcelLiveFollowerOrExplorer")):
Q.ULS.sendTraceTag(527766149,0,50,"ExcelLiveParticipantV0::InitExcelLiveFollowerOrExplorer: Update not from presenter.")};m.prototype.O4f=function(){this.Xv.U7(1,"ExcelLiveParticipantV0::startFollowing");this.X_b()};m.prototype.M4f=function(ab){this.Xv.U7(2,ab);this.Yrb()};m.prototype.OLg=function(){this.realtimeChannel.CFa(this.Tla)};m.prototype.Cdh=function(){this.realtimeChannel.Cza(this.Tla)};m.prototype.X_b=function(){this.gridView.vYa(this.Xcc)};m.prototype.Yrb=function(){this.gridView.$ab(this.Xcc)};
m.prototype.wEd=function(ab){var ya=this;!ab||1>ab.length||ab.forEach(function(ma){ma===ya.Xv.aD&&(ya.A6=void 0,ya.Xv.Lrc(),ya.Xv.U7(3,"ExcelLiveParticipantV0::onMeetingPresenceUpdated"))})};m.prototype.DEd=function(ab){!ab||1>ab.length||(ab=this.nRe(ab),this.W8e(ab))};m.prototype.nRe=function(ab){ab=(void 0===ab?null:ab)||this.realtimeChannel.Qbd();if(!ab)return null;this.Xv.aD||this.k7h(ab);if(this.Xv.aD&&(ab=ab[this.Xv.aD])){var ya=ab.MeetingInfo.MessageId;if(this.Mka+1<ya)Q.ULS.sendTraceTag(524940886,
0,15,"ExcelLiveParticipantV0::fetchPresenterSelectionFromPresenceData: Presenter message lost. LastMessageId: "+this.Mka+", CurrentMessageId: "+ya);else{if(this.Mka>ya)return Q.ULS.sendTraceTag(524940885,0,15,"ExcelLiveParticipantV0::fetchPresenterSelectionFromPresenceData: Older Presenter message received. LastMessageId: "+this.Mka+", CurrentMessageId: "+ya),null;if(this.Mka===ya)return Q.ULS.sendTraceTag(524940884,0,50,"ExcelLiveParticipantV0::fetchPresenterSelectionFromPresenceData: Duplicate Presenter message received. LastMessageId: "+
this.Mka+", CurrentMessageId: "+ya),null}this.Mka=ya;return ab.SelectedRange}return null};m.prototype.k7h=function(ab){for(var ya in ab){var ma=ya,ha=ab[ya];if((null===ha||void 0===ha?0:ha.MeetingInfo)&&ha.MeetingInfo.IsPresenter&&ha.MeetingInfo.MeetingId===this.$.ya.MeetingId){this.Mka=ha.MeetingInfo.MessageId-1;this.Xv.leg(ma,"ExcelLiveParticipantV0:identifyPresenterFromPresenceData");break}}};m.prototype.nLe=function(){if(this.A6){for(var ab=this.A6.length,ya=0;ya<ab;ya++){var ma=this.A6[ya].NamedObjectName;
if(V.a.p_c(ma)){if(Q.ULS.sendTraceTag(537162837,0,50,"ExcelLiveParticipantV0::EvaluateIfPresenterRangeIntersectingWithCurrentViewport: Floating object selection evaluated to false"),this.$md=!1,this.A6[ya].SheetName===this.$.va.pa.sheetName&&this.gridView.e5(ea.D(this.A6[ya]))){Q.ULS.sendTraceTag(537162836,0,50,"ExcelLiveParticipantV0::EvaluateIfPresenterRangeIntersectingWithCurrentViewport: Presenter selection intersection evaluated to true");this.eMa=!0;return}}else if(Q.ULS.sendTraceTag(537162839,
0,50,"ExcelLiveParticipantV0::EvaluateIfPresenterRangeIntersectingWithCurrentViewport: Floating object selection evaluated to true"),this.$md=!0,this.A6[ya].SheetName===this.$.va.pa.sheetName&&this.ehi(ma)){Q.ULS.sendTraceTag(537162838,0,50,"ExcelLiveParticipantV0::EvaluateIfPresenterRangeIntersectingWithCurrentViewport: Presenter selection intersection evaluated to true");this.eMa=!0;return}}Q.ULS.sendTraceTag(537162835,0,50,"ExcelLiveParticipantV0::EvaluateIfPresenterRangeIntersectingWithCurrentViewport: Presenter selection intersection evaluated to false")}this.eMa=
!1};m.prototype.ehi=function(ab){var ya=this;ab=Ha.a(this.$).oq(ab);if(!ab||!ab.floatingObject||!ab.domElement)return!1;this.viewBlockContainerHelpers||K.TaskExtensions.Aa(Ia.GetServiceTaskFactory.Ra(this.$.da,103,104,0),function(ha){ya.viewBlockContainerHelpers=ha.result},this.$.la,8);if(!this.viewBlockContainerHelpers)return!1;var ma=this.viewBlockContainerHelpers.mZ(ab.ag,ab.domElement);return ab.ag.fn.xd(ma)?!0:!1};m.prototype.f0h=function(){Q.ULS.sendTraceTag(537162834,0,50,"ExcelLiveParticipantV0.GoToPresenterLocation - Update participant viewport");
var ab=this.A6&&0<this.A6.length?this.A6[0]:null;if(!ab||!ab.SheetName)return!1;var ya=this.$.va.getItemByName(ab.SheetName);if(!ya||ya!==this.$.pa&&!ya.visible)return Q.ULS.sendTraceTag(529109851,0,15,"ExcelLiveParticipantV0.GoToPresenterLocation - sheet not available"),!1;ya!==this.$.pa&&ya.activate();this.gridView.fr(ea.D(ab),3,"ExcelLiveParticipantV0.GoToPresenterLocation");return!0};Object(u.a)(m,"ExcelLiveParticipantV0",null,[]);y.prototype.dispose=function(){this.FUd=this.$=null};y.prototype.DKj=
function(ab){var ya=wa.g(this.$).ha.sa.activeRange;ab=ab.xd(ya)?!0:!1;ya=oa.HelperMethods.Qb();if(!ab&&0===this.RQa)this.RQa=ya;else if(0<this.RQa){var ma=ya-this.RQa;this.rrb+=ma;this.RQa=ya;ab&&F(ma,"ExcelLivePresenter.trackAndLogSelectionVisibility: Selection was outside presenter Viewport. TimeSpentWithoutSelectionVisible")}};y.prototype.R7a=function(){var ab=oa.HelperMethods.Qb(),ya=ab-this.pHf,ma=0;0<this.RQa&&(ma=ab-this.RQa,this.rrb+=ma);var ha={};ha.PercentageTimeSelectionVisible=(ya-this.rrb)/
ya*100;ha.TimeSpentWithoutSelectionVisibleSinceLastBroadcast=ma;ha.FirstMessageBroadcastTimestamp=this.N$c;ha.LastMessageBroadcastTimestamp=this.JAb;ha.TotalMessagesBroadcasted=this.BCb;ha.TimeSinceLastBroadcastInMs=ab-this.JAb;ha.TimeToCreateNavigationStateAggregatesInMs=this.FUd;ab=Ka.a.xc(ha);this.$.sendBeaconTraceTag(523015439,50,!1,"ExcelLivePresenter.logSessionTelemetry: "+ab)};y.prototype.BKj=function(ab){++this.BCb;var ya=oa.HelperMethods.Qb();this.N$c=Math.min(this.N$c,ya);var ma=ya-this.JAb;
this.JAb=Math.max(this.JAb,ya);Q.ULS.sendTraceTag(523015438,0,50,"ExcelLivePresenter.trackAndLogMessageBroadcasted: Sent message number ["+ab+"] after ["+(ya-this.tqf)+"]ms of viewport change by presenter and after ["+ma+"]ms of sending previous message")};y.prototype.JKj=function(){this.tqf=oa.HelperMethods.Qb()};y.prototype.Qui=function(){var ab=oa.HelperMethods.Qb()-this.tqf;F(ab,"ExcelLivePresenter.getCurrentViewportNavigationState: TimeToCreateNavigationState");this.FUd.u2(ab)};y.prototype.MBb=
function(){function ab(){ya.R7a();I(10,ab,"ExcelLivePresenter.logSessionTelemetryAtSpecifiedInterval")}var ya=this;ab.call(this)};Object(u.a)(y,"ExcelLivePresenterTelemetryHelper",null,[3]);r.prototype.dispose=function(){this.Edh();this.gridView=this.$=this.realtimeChannel=this.controller=null;qa.EwaSettings.isChangeGateEnabled("OfficeVSO:6471382_ExcelLive_IgnoreActionsIfRtcNotConnected")&&this.realtimeChannel.Gma(this.o6)};r.prototype.Bob=function(){this.Qmc=this.Qmc.bind(this);this.zva=this.zva.bind(this);
this.Icc=this.Icc.bind(this);this.Fc=this.Fc.bind(this);this.o6=this.o6.bind(this)};r.prototype.NSd=function(){this.Fpc(!0);this.ZLg()};r.prototype.o6=function(ab,ya){if(2==ya.newState||2==this.realtimeChannel.connectionState)this.NSd(),this.realtimeChannel.Gma(this.o6)};r.prototype.ZLg=function(){this.$.va.iJ(this.Icc);this.gridView.vYa(this.zva);this.gridView.ha.UD(this.zva);this.$.Bk(this.Fc)};r.prototype.Edh=function(){this.$&&(this.$.va.DK(this.Icc),this.$.Ol(this.Fc));this.gridView&&(this.gridView.$ab(this.zva),
this.gridView.ha.ZH(this.zva))};r.prototype.Icc=function(){this.gridView.$ab(this.zva);this.gridView.iP(this.Qmc)};r.prototype.Qmc=function(){this.Fpc();this.gridView.EK(this.Qmc);this.gridView.vYa(this.zva)};r.prototype.zva=function(){this.$.va&&this.$.va.Y$e||this.Fpc()};r.prototype.Fc=function(ab,ya){ya.jg||this.Nn.R7a()};r.prototype.tLh=function(){var ab=Date.now();this.Nn.JKj();var ya=this.gridView.Nub();if(null===ya)return null;var ma=this.gridView.wja().nB;ab={MessageOriginTime:ab};ab.SheetID=
this.$.pa?this.$.pa.sheetName:null;ab.ZoomLevel=ja.a(this.$).zoom;ab.SelectedRanges=ea.k(this.gridView.ha.sa.selectedRanges,this.$);ab.IndexOfActiveRange=this.gridView.ha.sa.Vs;ab.VisibleAreaRange=ea.v(ya,this.$);ab.TopLeftCellOffsets={};ab.TopLeftCellOffsets.X=ma.x;ab.TopLeftCellOffsets.Y=ma.y;ma=T(this.$,ab.ZoomLevel);var ha=ma.ROb;ab.ViewportHeight=ma.OOb;ab.ViewportWidth=ha;this.Nn.DKj(ya);this.Nn.Qui();return ab};r.prototype.Eoj=function(){this.q_={};this.q_.MeetingId=this.$.ya.MeetingId;this.q_.IsPresenter=
!0};r.prototype.Fpc=function(ab){var ya=this;(ab=void 0===ab?!1:ab)&&qa.EwaSettings.isChangeGateEnabled("OfficeVSO:6085564_ExcelLive_ResendViewportStateAfterInterval")&&Xa.a.instance.create(function(){ya.Fpc(ab)},this.eCi+this.i0g(),"ExcelLivePresenter::postViewportUpdatesToMeetingParticipants",void 0,!0);if(2!=this.realtimeChannel.connectionState&&qa.EwaSettings.isChangeGateEnabled("OfficeVSO:6471382_ExcelLive_IgnoreActionsIfRtcNotConnected"))Q.ULS.sendTraceTag(521195807,0,15,"ExcelLivePresenter:postViewportUpdatesToMeetingParticipants RTC connection state is not connected. Current state:[{0}]",
this.realtimeChannel.connectionState);else{var ma=this.tLh();if(null===ma)Q.ULS.sendTraceTag(527962826,0,15,"ExcelLivePresenter:postViewportUpdatesToMeetingParticipants CurrentViewportNavigationState is null");else{var ha={};ha.MeetingInfo=this.q_;ha.MeetingInfo.MessageId=++this.BCb;ha.NavigationState=ma;ha.NavigationState.MessageBroadcastTime=Date.now();this.realtimeChannel.GWf(ha);this.Nn.BKj(this.BCb)}}};r.prototype.i0g=function(){var ab=void 0===ab?-3E3:ab;return Math.random()*(3E3-ab+1)+ab};
Object(u.a)(r,"ExcelLivePresenter",null,[]);var La=b(1189);v.prototype.dispose=function(){this.Xv=this.$=null};v.prototype.xKj=function(ab,ya){var ma,ha,Z=oa.HelperMethods.Qb(),Na=Z-this.GTf;this.did=this.did||2==ya;2!==ya&&this.did&&++this.yTf;Q.ULS.sendTraceTag(523015441,0,50,"ExcelLiveManagerTelemetryHelper::trackAndLogConnectionStateChanged: Recorded ConnectionState change from ["+ab+"] to ["+ya+"] after ["+Na+"]ms with current participant role ["+this.Xv.Jl+"]");ab=La.a[ab];ya=La.a[ya];this.cJb.has(ab)||
(this.cJb[ab]=1);this.cJb[ya]=1+(null!==(ma=this.cJb[ya])&&void 0!==ma?ma:0);this.iLd[ab]=Na+(null!==(ha=this.iLd[ab])&&void 0!==ha?ha:0);this.Mtc.has(ab)||(this.Mtc[ab]=new G);this.Mtc[ab].u2(Na);this.GTf=Z;this.Btd()};v.prototype.Btd=function(){var ab={};ab.RTCDisconnects=this.yTf;ab.RTCConnectionStateCounts=this.cJb;ab.RTCConnectionStateDurationsInMs=this.iLd;ab.RTCConnectionStateDurationsAggregatesInMs=this.Mtc;ab.MeetingID=this.$.ya.MeetingId;ab.AmIPresenter=this.$.ya.IsMeetingPresenter;ab.MeetingManagerCreated=
this.Oud;ab.SessionDurationInMs=oa.HelperMethods.Qb()-this.Oud;ab=Ka.a.xc(ab);this.$.sendBeaconTraceTag(523015440,50,!1,"ExcelLiveManagerTelemetryHelper.logSessionTelemetry: "+ab)};v.prototype.MBb=function(ab){function ya(){ma.Btd();I(ab,ya,"ExcelLiveManagerTelemetryHelper.logSessionTelemetryAtSpecifiedInterval")}var ma=this;ya.call(this)};Object(u.a)(v,"ExcelLiveManagerTelemetryHelper",null,[]);f.prototype.dispose=function(){this.xkb&&(this.xkb.dispose(),this.xkb=null);this.iib&&(this.iib.dispose(),
this.iib=null);this.Shb&&(this.Shb.dispose(),this.Shb=null);N.h(this.$)&&(this.K1.Gma(this.Gnc),this.$.Ol(this.Fc));this.$=this.K1=this.wde=this.Kpa=null};f.prototype.VTd=function(){this.yTe?this.yTe.VTd():Q.ULS.sendTraceTag(537162880,0,10,"ExcelLiveManager::SyncToPresenter - FollowerOrExplorer object is not available to complete the action")};f.prototype.Fgd=function(){this.WPe?this.WPe.Fgd():Q.ULS.sendTraceTag(537162851,0,10,"ExcelLiveManager::GoToPresenter - ExcelLiveParticipantV0 object is not available to complete the action")};
f.prototype.xZb=function(ab){this.Kpa.xZb(ab)};f.prototype.CId=function(ab){this.Kpa.CId(ab)};f.prototype.G8h=function(){N.h(this.$)?N.f(this.$)?this.xkb=new r(this.$,this.K1,this.Kpa):this.iib=new w(this.$,this.K1,this.Kpa):N.g(this.$)&&(this.Shb=new m(this.$,this.K1,this.Kpa))};f.prototype.Gnc=function(ab,ya){ya.oldState!==ya.newState&&this.Nn.xKj(ya.oldState,ya.newState)};f.prototype.Fc=function(ab,ya){ya.jg||this.Nn.Btd()};Mf.Object.defineProperties(f.prototype,{kn:{configurable:!0,enumerable:!0,
get:function(){return this.wde}},ROa:{configurable:!0,enumerable:!0,get:function(){return this.Kpa.ROa}},yTe:{configurable:!0,enumerable:!0,get:function(){return this.iib}},presenter:{configurable:!0,enumerable:!0,get:function(){return this.xkb}},WPe:{configurable:!0,enumerable:!0,get:function(){return this.Shb}}});Object(u.a)(f,"ExcelLiveManager",null,[645,3]);n.prototype.dispose=function(){this.$=null};n.prototype.$ij=function(ab,ya,ma){Q.ULS.sendTraceTag(527171654,0,50,"ExcelLiveFollowerOrExplorer:"+
ma+" Setting presenter information to CID: "+ab+" from CID: "+this.aD);this.aD=ab;this.Xya=ya.User.UserName;this.Spc=ya.UserColor};n.prototype.Lrc=function(){this.Spc=this.Xya=this.aD=void 0};Mf.Object.defineProperties(n.prototype,{Jl:{configurable:!0,enumerable:!0,get:function(){return this.jce},set:function(ab){this.jce=ab}},aD:{configurable:!0,enumerable:!0,get:function(){return this.Qce},set:function(ab){this.Qce=ab}},Xya:{configurable:!0,enumerable:!0,get:function(){return this.Rce},set:function(ab){this.Rce=
ab}},Spc:{configurable:!0,enumerable:!0,get:function(){return this.Sce},set:function(ab){this.Sce=ab}}});Object(u.a)(n,"ExcelLiveParticipantModel",null,[3]);var zb=b(253),Fb=b(12),Yb=b(272),kb=b(22);l.prototype.ZId=function(ab,ya,ma,ha){ma=void 0===ma?null:ma;ha=void 0===ha?null:ha;this.sxa(ab,ya);this.Jl=ya;this.Xya=ma;this.iPa=ha;this.JSe?(this.JSe=!1,this.iQf()):(this.OVd=!1,this.container.classList.add("ewa-excelLive-meetingPill-container-hidden"))};l.prototype.dispose=function(){$removeHandler(this.container,
"transitionend",this.koa);$removeHandler(this.container,"transitioncancel",this.koa);this.container=null};l.prototype.Sf=function(ab,ya){if(ya)return!1;ab=this.container.querySelectorAll(Fb.DOMElementExtensions.er);var ma;for(ya=0;ya<ab.length;ya++){var ha=ab[ya];Fb.DOMElementExtensions.canReceiveFocus(ha)&&(ma=ha)}if(!ma)return Q.ULS.sendTraceTag(529109852,0,10,"ExcelLiveMeetingPillUtility.SetFocusOnSection: Could not find focusable element in live meeting pill"),!1;ma.focus();return!0};l.prototype.$g=
function(ab){return Fb.DOMElementExtensions.nf(this.ic,ab)};l.prototype.ej=function(){};l.prototype.Aj=function(){};l.prototype.initialize=function(ab,ya){this.container=document.createElement("div");this.container.id="excelLiveMeetingPillContainer";this.container.classList.add("ewa-excelLive-meetingPill-container");ya.appendChild(this.container);N.d(ab)&&(this.container.style.height="32px",Q.ULS.sendTraceTag(529073433,0,50,"ExcelLiveMeetingPillUtility.initialize:Changed the height of meeting pill container for mobile"));
this.koa=this.L3h;$addHandler(this.container,"transitionend",this.koa);$addHandler(this.container,"transitioncancel",this.koa);Yb.a(ab).Lh(this)};l.prototype.iQf=function(){var ab={};ab.participantRole=this.Jl;qa.EwaSettings.isChangeGateEnabled("OfficeVSO:5931413_ShortenMeetingPillDisplayNameForMobile")&&this.$.IC?(Q.ULS.sendTraceTag(527991135,0,50,"ExcelLiveMeetingPillUtility.renderMeetingPillInternal: Getting shortened user name for mobile meeting pill"),ab.presenterName=this.VWh(this.Xya)):ab.presenterName=
this.Xya;ab.presenterColor=this.iPa;appChrome.renderLiveMeetingPill(this.container,ab)};l.prototype.VWh=function(ab){if(kb.a.fh(ab))return Q.ULS.sendTraceTag(527991134,0,15,"ExcelLiveMeetingPillUtility.getShortenedUserName: Username is null or empty"),ab;var ya=ab.split(" "),ma=ya.length;return 2>ma||kb.a.fh(ya[ma-1])?ab:ya[0]+" "+ya[ma-1].substring(0,1)};l.prototype.sxa=function(ab,ya){ya=Ga[ya];if(0===this.lastUpdateTime)Q.ULS.sendTraceTag(527766152,0,50,ab+"::FirstRole - ["+ya+"]"),this.lastUpdateTime=
oa.HelperMethods.Qb();else{var ma=Ga[this.Jl];if(ma===ya)Q.ULS.sendTraceTag(523548820,0,15,"{0}:RoleTransition: Received transition to participant role which is same as current role: [{1}]",ab,ma);else{var ha=oa.HelperMethods.Qb()-this.lastUpdateTime;Q.ULS.sendTraceTag(528786757,0,50,"{0}:RoleTransition: Transition participant role from [{1}] to [{2}] after {3}s",ab,ma,ya,(ha/1E3).toFixed(2));this.lastUpdateTime=oa.HelperMethods.Qb()}}};Mf.Object.defineProperties(l.prototype,{ic:{configurable:!0,
enumerable:!0,get:function(){return this.container}},canReceiveFocus:{configurable:!0,enumerable:!0,get:function(){return!!this.container&&2===this.Jl}},Yd:{configurable:!0,enumerable:!0,get:function(){return zb.a.Gjf}}});Object(u.a)(l,"ExcelLiveMeetingPillUtility",null,[448,3]);var vb=b(4);k.prototype.oIb=function(ab,ya){this.Jl=ab;this.iPa=void 0===ya?null:ya;appChrome.renderLiveMeetingBoundary(this.container,this.zOg)};k.prototype.dispose=function(){this.container=null;this.$.gD(this.iab);this.$.Ybj(this.iab)};
k.prototype.initialize=function(ab){this.Bob();this.container=document.createElement("div");this.container.id="excelLiveMeetingBoundaryContainer";this.container.classList.add("ewa-excelLive-meetingBoundary-container");ab.append(this.container);this.oIb(this.Jl,this.iPa);this.$.sA(this.iab);this.$.mGg(this.iab)};k.prototype.Bob=function(){this.iab=this.iab.bind(this)};k.prototype.iab=function(){this.oIb(this.Jl,this.iPa)};Mf.Object.defineProperties(k.prototype,{SCh:{configurable:!0,enumerable:!0,get:function(){var ab;
return(ab=this.Of?document.getElementById("AdditionalBarsRegion"):document.getElementById(this.$.yb+va.a.Nrb))?ab.clientHeight:0}},JRg:{configurable:!0,enumerable:!0,get:function(){var ab;return(ab=this.Of?document.getElementById("BusinessBar"):document.getElementById(this.$.yb+va.a.Xte))?ab.clientHeight:0}},Sxh:{configurable:!0,enumerable:!0,get:function(){var ab=null;this.Of&&(ab=document.getElementById("FarPaneRegion"));return ab?ab.clientWidth:0}},dJg:{configurable:!0,enumerable:!0,get:function(){var ab=
N.d(this.$)?(ab=document.getElementById(this.$.yb+va.a.WGa))?ab.clientHeight:0:this.$.Bka?0:this.$.RSg();return ab}},Auj:{configurable:!0,enumerable:!0,get:function(){var ab;return(ab=this.Of?document.getElementById("Header"):document.getElementById(va.a.$Fa))?ab.clientHeight:0}},U_c:{configurable:!0,enumerable:!0,get:function(){return this.Of?document.getElementById("EditorContainer"):this.$.hE}},ete:{configurable:!0,enumerable:!0,get:function(){return this.Auj+this.dJg+this.JRg+this.SCh}},yOg:{configurable:!0,
enumerable:!0,get:function(){return this.U_c.clientLeft}},AOg:{configurable:!0,enumerable:!0,get:function(){return this.U_c.clientWidth+this.Sxh-3}},xOg:{configurable:!0,enumerable:!0,get:function(){if(this.Of){var ab=document.getElementById("StatusBar");return ab.offsetTop+ab.clientHeight-this.ete}return this.U_c.clientHeight}},zOg:{configurable:!0,enumerable:!0,get:function(){var ab={};ab.participantRole=this.Jl;ab.presenterColor=this.iPa;ab.top=this.ete;ab.left=this.yOg;ab.width=this.AOg;ab.height=
this.xOg;ab.size=3;return ab}}});Object(u.a)(k,"ExcelLiveMeetingBoundaryUtility",null,[3]);var Wa=b(179),qb=b(44),yb=b(89);e.prototype.dispose=function(){this.controller=this.$=null;this.MIa&&(yb.a.Ia(this.MIa),this.MIa=null);this.Oob&&(yb.a.Ia(this.Oob),this.Oob=null)};e.prototype.G4f=function(ab){var ya=this;this.Oob=Wa.AsyncMethodContext.Ms(function(){ya.mfc=!0;ya.YVd()},ab,qb.a.dPg,this.Oob)};e.prototype.YVd=function(){this.$pd||(this.lfc&&this.mfc?this.yNb(0):1===this.controller.Jl?this.Pyb?
this.mfc&&this.Gxe():this.yNb(this.$.ya.ExcelLiveSurveyTriggerThresholdTimeInMs):2===this.controller.Jl&&(this.Pyb?this.mfc&&this.yNb(this.$.ya.ExcelLiveSurveyChangedTriggerThresholdTimeInMs):this.Gxe()))};e.prototype.yNb=function(ab){var ya=this;this.MIa=Wa.AsyncMethodContext.Ms(function(){ya.$pd||(ya.$.Fd(-1404915046,-1,0,null),ya.$pd=!0,Q.ULS.sendTraceTag(520495937,0,50,"ExcelLiveController.TriggerExcelLiveSurvey: ExcelLive survey shown using Buffer based trigger = "+ya.lfc+", using Explorer based trigger = "+
ya.Pyb+" with trigger threshold = "+ab))},ab,qb.a.yNb,this.MIa)};e.prototype.Gxe=function(){this.MIa&&this.MIa.cancel()};Object(u.a)(e,"ExcelLiveSurveyManager",null,[]);var ec=da.a;Rk(d,ec);d.prototype.dispose=function(){this.$=null;this.Dv&&(this.Dv.dispose(),this.Dv=null);this.LIa&&(this.LIa.dispose(),this.LIa=null);this.KIa&&(this.KIa.dispose(),this.KIa=null)};d.prototype.U7=function(ab,ya){this.Dv.Jl&&this.Dv.Jl===ab||(this.Dv.Jl=ab,this.mQf(ya))};d.prototype.leg=function(ab,ya){if(!ab)return Q.ULS.sendTraceTag(528086352,
0,10,"ExcelLiveController:savePresenterDetails Presenter CID is undefined"),!1;var ma=this.$.ea.kgd(ab);if(!ma)return Q.ULS.sendTraceTag(528086351,0,10,"ExcelLiveController:savePresenterDetails Failed to get presenter information from sessionStateManager"),!1;this.Dv.$ij(ab,ma,ya);this.mQf(String.format("{0};{1}",ya,this.Tjc+"savePresenterDetails"));this.raiseEvent(d.GDd);return!0};d.prototype.Lrc=function(){this.Dv.Lrc()};d.prototype.xZb=function(ab){this.addHandler(d.GDd,ab)};d.prototype.CId=function(ab){this.removeHandler(d.GDd,
ab)};d.prototype.V9h=function(){this.Dv=new n(this.$);var ab=this.$.hE;vb.AFrameworkApplication.ta.Qa.Of&&(ab=document.getElementById("StatusBarRegion"));this.LIa=new l(this.$,ab);ab=this.$.Tq;vb.AFrameworkApplication.ta.Qa.Of&&(ab=document.getElementById("regionComposerRoot"));this.lAb&&(this.KIa=new k(this.$,ab));ab=N.f(this.$)?0:3;this.U7(ab,this.Tjc+"initializeController")};d.prototype.mQf=function(ab){switch(this.Dv.Jl){case 2:this.LIa.ZId(ab,this.Dv.Jl,this.Dv.Xya);this.lAb&&this.KIa.oIb(this.Dv.Jl);
break;case 1:this.LIa.ZId(ab,this.Dv.Jl,this.Dv.Xya,this.Dv.Spc);this.lAb&&this.KIa.oIb(this.Dv.Jl,this.Dv.Spc);break;case 3:case 0:this.LIa.ZId(ab,this.Dv.Jl),this.lAb&&this.KIa.oIb(this.Dv.Jl)}};Mf.Object.defineProperties(d.prototype,{ROa:{configurable:!0,enumerable:!0,get:function(){return this.Dv}},Jl:{configurable:!0,enumerable:!0,get:function(){return this.Dv.Jl}},aD:{configurable:!0,enumerable:!0,get:function(){return this.Dv.aD}},XPe:{configurable:!0,enumerable:!0,get:function(){return this.xng}},
lgf:{configurable:!0,enumerable:!0,get:function(){return this.GDa}}});d.GDd="PDS";Object(u.a)(d,"ExcelLiveController",da.a,[3]);var Ob=b(911),Cb=P.a;Rk(c,Cb);c.prototype.create=function(){this.F8h()};c.prototype.dispose=function(){this.kn&&this.kn.gIb(this.qOa);this.kn=null;this.Xv&&(this.Xv.dispose(),this.Xv=null);Cb.prototype.dispose.call(this)};c.prototype.F8h=function(){var ab=this;this.Xv=new d(this.$);this.$.da.Za(26,function(ya){ab.kn=ya;ab.R0g()})};c.prototype.R0g=function(){Q.ULS.sendTraceTag(537162850,
0,50,"ExcelLiveCommandHandlerFactory::ConnectToRealTimeChannel - attach RealTimeChannelInitialized handler");this.kn.GUc(this.qOa);this.kn.q_a()};c.ka=function(ab){Q.ULS.sendTraceTag(537162848,0,50,"ExcelLiveManagerFactory::Attach: Begin service registration");ab.da.Ga(474,new c(ab));Q.ULS.sendTraceTag(537162847,0,50,"ExcelLiveManagerFactory::Attach: Complete service registration")};Object(u.a)(c,"ExcelLiveManagerFactory",P.a,[]);b.d(E,"a",function(){return a})},1642:function(u,E,b){function a(){this.fb=
null}function c(fa){this.pvg=fa}function d(fa){this.Qpg=fa}function e(){}function k(){}function l(){}function n(){}function f(fa,ca,ea,wa){wa=void 0===wa?null:wa;this.Wl=new Q.a;this.Vsg=fa;this.Org=ca;this.ib=ea;this.qib=wa}function v(){}function r(){}function y(){}function m(fa,ca){this.La=fa;this.jWa=ca}function w(){this.Sw=this.nm=!1}function B(fa,ca,ea,wa,X,ja,va,ua,Xa){var aa=this;this.nm=!1;this.iWb=this.LWa=this.gP=this.Pfa=null;this.zlb=B.tDc;this.$a=new U.a;this.gra=new A(0);this.gra.inb(Object(I.a)(this,
this.URi,"onStateMachineChanged"));this.Uug=fa;this.QVb=ca;this.Tug=ea;this.tPc=wa;this.ae=X;this.gT=ja;va.execute(function(ba){aa.nm||(aa.LWa=ba,aa.LWa.tYa(Object(I.a)(aa,aa.wca,"onUpdateNotificationReceived")),aa.start())});ua.execute(function(ba){aa.nm||(aa.iWb=ba,ba.qZb(Object(I.a)(aa,aa.LCf,"onTokenRefreshed")))});this.ghe=Xa}function A(fa){this.$a=new U.a;this.hge=new Date;this.mhb=fa;this.pHc=0}function z(fa,ca,ea,wa,X){var ja=O.call(this)||this;ja.eEd=fa;ja.newState=ca;ja.Q_i=ea;ja.R_i=wa;
ja.i0j=X;return ja}function x(fa,ca){var ea=F.call(this)||this;ea.F_j=fa;ea.w_j=ca;return ea}b.r(E);u=b(1316);E=b(0);var D=b(14),I=b(84),F=Sys.EventArgs;Rk(x,F);Object(E.a)(x,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var G;(function(fa){fa[fa.notYetStarted=0]="notYetStarted";fa[fa.polling=1]="polling";fa[fa.subscribed=2]="subscribed";fa[fa.blocked=3]="blocked";fa[fa.permanentlyStopped=4]="permanentlyStopped"})(G||(G={}));Object(E.b)("RtcHostNotificationSubscriptionState",G);var T=b(108),O=
Sys.EventArgs;Rk(z,O);Object(E.a)(z,"StateChangedEventArgs",Sys.EventArgs,[]);var U=b(97);A.prototype.event=function(fa,ca){this.currentState!==fa&&(this.IAh(this.currentState,fa,this.oLe,void 0===ca?null:ca),this.pHc=0,this.hge=new Date);this.mhb=fa;this.pHc=this.oLe+1};A.prototype.IAh=function(fa,ca,ea,wa){fa=new z(fa,ca,ea,this.hge,wa);this.$a.raiseEvent("c",fa)};A.prototype.inb=function(fa){this.$a.addHandler("c",fa)};A.prototype.vsc=function(fa){this.$a.removeHandler("c",fa)};Mf.Object.defineProperties(A.prototype,
{currentState:{configurable:!0,enumerable:!0,get:function(){return this.mhb}},oLe:{configurable:!0,enumerable:!0,get:function(){return this.pHc}}});Object(E.a)(A,"StateMachine",null,[284]);B.prototype.start=function(){0!==this.Edb?D.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",G[this.Edb]):(this.gra.event(1),this.MMd(null))};B.prototype.MMd=function(){this.Pfa=null;if(this.Kff){D.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",
G[this.Edb]);var fa=null;this.tPc&&this.tPc.length&&(fa={},fa.etts=this.tPc);this.LWa.zda(14,fa,!0);this.kVf(this.Uug)}else this.gra.event(3)};B.prototype.kVf=function(fa){this.Pfa=T.a.w4b(1E3*fa,Object(I.a)(this,this.MMd,"sendSubscribeEvent"),this.QVb,192,"RtcHostNotificationSubscribe");this.ae.Dg(this.Pfa)};B.prototype.Sjj=function(fa){fa=1E3*(fa+this.Tug);var ca=this.ghe().getTime()+fa;this.zlb=new Date(ca);fa-=this.QVb;this.gP?this.ae.Pma(this.gP,fa):(this.gP=T.a.w4b(fa,Object(I.a)(this,this.VKj,
"transitionToPollingEvent"),this.QVb/2,194,"RtcHostNotificationTransitionToPolling"),this.ae.Dg(this.gP))};B.prototype.VKj=function(){this.gP=null;2===this.Edb&&(this.gra.event(1),D.ULS.shipAssertTag(573100185,502,!!this.Pfa,"Missing task to ensure that we re-subscribe."))};B.prototype.LCf=function(){this.f1h()};B.prototype.f1h=function(){3===this.Edb&&this.Kff&&(this.gra.event(this.n5?2:1),this.MMd(null))};B.prototype.wca=function(fa,ca){if(13===ca.type&&(fa=ca.T7,ca={},D.ULS.sendTraceTag(573100183,
502,50,"HostNotifications: Subscription status: {0}",(ca.SerializableHostNotificationSubscription=fa,ca.DurationBeforeExpirationToResubscribeInSec=this.QVb,ca)),ca=fa.cts,!this.XMj(ca))){if(fa.sb){var ea=2;this.Sjj(fa.cts)}else ea=1,this.zlb=B.tDc,this.gP&&(this.ae.Dp(this.gP),this.gP=null);this.gra.event(ea);this.Pfa?this.ae.Pma(this.Pfa,1E3*ca):this.kVf(ca)}};B.prototype.XMj=function(fa){if(!isNaN(fa)&&isFinite(fa)&&0<fa)return!1;this.F5f(!1);return!0};B.prototype.F5f=function(fa){this.Pfa&&(this.ae.Dp(this.Pfa),
this.Pfa=null);this.gP&&(this.ae.Dp(this.gP),this.gP=null);this.LWa&&(this.LWa.lIb(Object(I.a)(this,this.wca,"onUpdateNotificationReceived")),this.LWa=null);this.iWb&&(this.iWb.wId(Object(I.a)(this,this.LCf,"onTokenRefreshed")),this.iWb=null);fa||this.gra.event(4)};B.prototype.URi=function(fa,ca){fa=ca.newState;var ea=ca.eEd,wa={};wa.NewState=G[fa];wa.PreviousState=G[ea];wa.PreviousStateHits=ca.Q_i;wa.PreviousStateTransitionTime=ca.R_i.toISOString();wa.IsSubscribed=this.n5;this.zlb!==B.tDc&&(wa.SubscriptionExpiringTime=
this.zlb.toISOString());D.ULS.sendTraceTag(572346515,502,4===fa?15:50,"HostNotificationChanged: {0}",wa);this.$a.raiseEvent("HN",new x(ea,fa))};B.prototype.dispose=function(){this.nm||(this.nm=!0,this.F5f(!0),this.gP&&(this.ae.Dp(this.gP),this.gP=null))};Mf.Object.defineProperties(B.prototype,{Edb:{configurable:!0,enumerable:!0,get:function(){return this.gra.currentState}},Kff:{configurable:!0,enumerable:!0,get:function(){return!this.gT||this.gT.bhf}},n5:{configurable:!0,enumerable:!0,get:function(){return 2===
this.Edb&&this.ghe()<this.zlb}}});B.tDc=new Date(0);Object(E.a)(B,"RtcHostNotificationSubscriptionManager",null,[980,3]);var J=b(4),H=b(254),K=b(739),N=b(83);w.prototype.Ph=function(fa){var ca=this;fa.register(B,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").tc().Cc(function(){var ea=J.AFrameworkApplication.fa;return new B(ea.kd("RtcHostNotificationRetryIntervalIdeallyInSeconds",
1800),ea.kd("RtcHostNotificationRetryIntervalBufferInSeconds",120),ea.kd("RtcHostNotificationSubscriptionLostBufferInSeconds",60),ca.SVh(ea),J.AFrameworkApplication.yi,K.SessionStatusManager.instance,fa.Tb("Common.IRealtimeChannelBasic"),fa.Tb("Common.ISessionExpirationManager"),function(){return new Date})})};w.prototype.init=function(){var fa=this;J.AFrameworkApplication.fa.Su(function(){!fa.nm&&J.AFrameworkApplication.fa.qa("RtcHostNotificationEnabled")&&(fa.Sw=!0,N.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})};
w.prototype.dispose=function(){this.nm||(this.nm=!0,this.Sw&&N.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())};w.prototype.SVh=function(fa){return fa.Zn("RtcEventTypesToSubscribe")?fa.dw("RtcEventTypesToSubscribe"):null};w.main=function(){H.a.instance.Qi(new w)};Mf.Object.defineProperties(w.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"RtcHostNotificationSubscription"}}});Object(E.a)(w,"RtcHostNotificationSubscriptionPackage",
null,[10,11]);var M=b(107),C=b(25);m.prototype.Bg=function(){this.La.Mb(C.a.Hjf,M.a.frame,Object(I.a)(this,this.Ijf,"livePersonaCardActionHandler"))};m.prototype.MNb=function(){this.La.fD(C.a.Hjf,M.a.frame,Object(I.a)(this,this.Ijf,"livePersonaCardActionHandler"))};m.prototype.Ijf=function(fa,ca,ea,wa,X){if(!X||3===ea)return 2;if(1===ea)return this.MXa(this.jWa.ove(X.upn||X.aadObjectId));if(!this.Xkh(X))return 8;switch(X.action){case 0:return this.MXa(this.jWa.$zg(X));case 1:return this.MXa(this.jWa.Zzg(X));
case 2:return this.MXa(this.jWa.aAg(X));case 3:return this.MXa(this.jWa.openCard(X));case 4:return this.MXa(this.jWa.o9i(X));default:return 2}};m.prototype.Xkh=function(fa){var ca=fa.upn||fa.aadObjectId;return fa.targetElement&&(4===fa.action||ca&&""!==ca)?!0:!1};m.prototype.MXa=function(fa){return fa?32:8};Object(E.a)(m,"LivePersonaCardActor",null,[]);var Q=b(162),P=b(85);Object(E.a)(y,"BootstrapperConfig",null,[]);Object(E.a)(r,"LivePersonaCardInitializerResult",null,[]);v.ate=null;Object(E.a)(v,
"LivePersonaCardModule",null,[]);var ka=b(619);f.prototype.init=function(){this.xdf()?this.Vsg.ssi().continueWith(Object(I.a)(this,this.QOi,"onPackageLoaded")):this.Wl.setResult(Object.assign(new r,{isInitialized:!1,isEnabled:!1,failureMessage:"LivePersonaCard is not enabled."}));return this.Wl.task};f.prototype.QOi=function(){var fa=this,ca=v.ate;if(ca){var ea=this.AIh();try{ca.initializeLivePersonaCardAsync(ea).then(function(){fa.Wl.setResult(Object.assign(new r,{isInitialized:!0,isEnabled:!0}))}).catch(function(wa){var X=
Object(P.a)(String,wa);X?fa.Wl.setException(Error.create(X)):fa.Wl.setException(Error.create(JSON.stringify(wa)))})}catch(wa){this.Wl.setException(wa)}}else this.Wl.setResult(Object.assign(new r,{isInitialized:!1,isEnabled:!0,failureMessage:"LivePersonaCardBootstrapper package is not loaded."}))};f.prototype.AIh=function(){var fa=ka.a.aH(J.AFrameworkApplication.lcid);return Object.assign(new y,{culture:fa?fa.name.toLocaleLowerCase():"en-us",clientType:this.ib.Wa("LivePersonaCardClientType"),clientContextType:"Generic",
clientCorrelationId:J.AFrameworkApplication.userSessionId,complianceEnvironment:this.zKh(),logMessage:Object(I.a)(this,this.logMessage,"logMessage"),getAuthToken:Object(I.a)(this,this.getAuthToken,"getAuthToken")})};f.prototype.xdf=function(){if(!this.ib.qa("LivePersonaCardIsEnabled")||!this.$Ig())return!1;var fa=this.ib.Wa("SovereignEnvironmentName");return fa&&""!==fa?fa.toLocaleLowerCase()==="USGov".toLocaleLowerCase()||fa.toLocaleLowerCase()==="Blackforest".toLocaleLowerCase()?!0:!1:!0};f.prototype.$Ig=
function(){return this.ib.qa("CoauthorGalleryLivePersonaCardIsEnabled")||!!J.AFrameworkApplication.ta&&J.AFrameworkApplication.ta.Qa.BRa};f.prototype.zKh=function(){return this.ib.Wa("LivePersonaCardComplianceEnvironment")};f.prototype.logMessage=function(fa,ca,ea){var wa={};fa=JSON.stringify((wa["Log Type"]=fa,wa["Log Result Type"]=ca,wa.Message=ea,wa));D.ULS.sendTraceTag(50431106,3006,50,fa)};f.prototype.getAuthToken=function(fa,ca){var ea=this;J.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.LokiFutureObject")?
this.qib.continueWith(function(wa){wa.zh||wa.Xf?ca("LokiTokenManagerTask is either canceled or faulted.",J.AFrameworkApplication.userSessionId):ea.qib.result.fed().then(function(X){X.isSuccess&&X.token&&X.token.length?fa(X.token,J.AFrameworkApplication.userSessionId):ca(X.errorMessage,J.AFrameworkApplication.userSessionId)}).catch(function(X){return D.ULS.sendTraceTag(539617039,3006,10,"Unexpected exception received from GetLokiToken: {0}",JSON.stringify(X))})}):this.Org.fed().then(function(wa){wa.isSuccess&&
wa.token&&wa.token.length?fa(wa.token,J.AFrameworkApplication.userSessionId):ca(wa.errorMessage,J.AFrameworkApplication.userSessionId)}).catch(function(wa){return D.ULS.sendTraceTag(50431107,3006,10,"Unexpected exception received from GetLokiToken: {0}",JSON.stringify(wa))})};Object(E.a)(f,"LivePersonaCardInitializer",null,[]);Object(E.a)(n,"Behavior",null,[]);Object(E.a)(l,"Identifiers",null,[]);Object(E.a)(k,"LivePersonaCardParameters",null,[]);Object(E.a)(e,"PersonaInfo",null,[]);d.prototype.ove=
function(fa){return this.Qpg.xdf()&&fa&&""!==fa?!!window.self.LPC:!1};d.prototype.$zg=function(fa){return this.DNb("addedPersonaToPageV2",fa,0)};d.prototype.Zzg=function(fa){return this.DNb("addedPersonaToPageV2",fa,1)};d.prototype.aAg=function(fa){return this.DNb("addedPersonaToPageV2",fa,2)};d.prototype.openCard=function(fa){return this.DNb("openCard",fa)};d.prototype.o9i=function(fa){return this.DNb("removedPersonaFromPage",fa)};d.prototype.MTg=function(fa){return!!fa.targetElement&&(this.ove(fa.upn||
fa.aadObjectId)||4===fa.action)};d.prototype.DNb=function(fa,ca,ea){ea=void 0===ea?3:ea;if(!this.MTg(ca))return!1;ea=4!==ca.action?this.Y6g(ca,ea):null;var wa=window.self.LPC;if(wa&&wa[fa]){if(ea)wa[fa](ca.targetElement,ea);else wa[fa](ca.targetElement);return!0}return!1};d.prototype.Y6g=function(fa,ca){ca=void 0===ca?3:ca;var ea=Object.assign(new l,{PersonaType:"User",Upn:fa.upn,AadObjectId:fa.aadObjectId});return Object.assign(new k,{personaInfo:Object.assign(new e,{identifiers:ea,displayName:fa.name,
personaCoinColor:fa.color}),behavior:Object.assign(new n,{onCardOpen:function(){D.ULS.sendTraceTag(595067869,3006,100,"LivePersonaCard opened");if(fa.onCardOpen)fa.onCardOpen()},onCardClose:fa.onCardClose,disableClick:2===ca||3===ca,disableHover:0===ca||3===ca})})};Object(E.a)(d,"LivePersonaCardManager",null,[]);c.prototype.ssi=function(){var fa=J.AFrameworkApplication.NK("midgardbootstrapper.js",5);return this.pvg.Ksd(fa).continueWith(function(){v.ate=window.self.MidgardBootstrapper})};Object(E.a)(c,
"LivePersonaCardPackageLoader",null,[979]);var R=b(567);a.prototype.init=function(){J.AFrameworkApplication.fa&&J.AFrameworkApplication.fa.Su(Object(I.a)(this,this.oB,"onFullAppSettingsReady"))};a.prototype.dispose=function(){};a.prototype.Ph=function(fa){this.fb=fa};a.prototype.oB=function(){var fa=J.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.LokiFutureObject")?new f(new c(this.fb.resolve("Common.ISharedDependencyLoader")),null,J.AFrameworkApplication.fa,
R.a.Jq(this.fb.Tb("Common.ILokiTokenManager"))):new f(new c(this.fb.resolve("Common.ISharedDependencyLoader")),this.fb.resolve("Common.ILokiTokenManager"),J.AFrameworkApplication.fa);fa.init().continueWith(function(ca){ca.Xf&&ca.exception?D.ULS.sendTraceTag(50431108,3006,15,"Failed to initialize LivePersonaCard, exception: [{0}]",ca.exception.message):((ca=ca.result)||D.ULS.sendTraceTag(595067868,3006,15,"LivePersonaCardInitializer did not return a result"),ca.isInitialized?D.ULS.sendTraceTag(50431109,
3006,100,"Successfully initialized LivePersonaCard"):D.ULS.sendTraceTag(595067867,3006,ca.isEnabled?15:100,"Failed to initialize LivePersonaCard, failure message: [{0}]",ca.failureMessage))});(new m(J.AFrameworkApplication.ub,new d(fa))).Bg()};a.main=function(){H.a.instance.Qi(new a)};Mf.Object.defineProperties(a.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.LivePersonaCard"}}});Object(E.a)(a,"LivePersonaCardPackage",null,[10,11]);b=b(1343);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.ExcelLive");
Type.registerNamespace("_Ewa");Object(u.a)();Type.registerNamespace("Common.App.RtcHostNotificationSubscription");w.main();Type.registerNamespace("Common.App.LivePersonaCard.Contracts");Type.registerNamespace("Common.App.LivePersonaCard");a.main();Type.registerNamespace("AppRealtimeChannel");Object(b.a)()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.rt.js.map/41960626d0af7df2118fc817f07c9c21/EwaDS.rt.js.map