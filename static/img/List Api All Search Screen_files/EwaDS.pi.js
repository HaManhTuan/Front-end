(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1058:function(u,E,b){function a(x){var D=this;this.businessBar=this.s7a=null;this.fGi=function(I,F){F.P5c?D.hGi(F):D.gGi(F)};this.di=function(I,F){I=F.context.methodName;D.s7a&&I===D.s7a&&(v.ULS.sendTraceTag(537155230,0,50,'NetworkConnectionHealthChecker.OnWebMethodSuccess: Failed web method "{0}" has now succeeded. Querying local storage for BB showings.',D.s7a),D.O7a(a.bKb,!0),D.s7a=null);D.jlf(!1);D.l3b=!1};this.Jn=function(I,
F){y.a.Zg(F.errors,[-1387426400])&&!D.l3b&&(D.l3b=!0,D.$0f()&&window.performance.mark(a.ksf),(new c(D)).pqi())};this.tg=function(){D.jlf(!0);D.O7a(a.$Cb,!1);D.O7a(a.bKb,!1)};this.pya=function(){v.ULS.sendTraceTag(537155225,0,50,"NetworkConnectionHealthChecker.OnNetworkResumed: Network resumed for session. Querying local storage for BB showings.");D.O7a(a.$Cb,!0)};this.$=x;this.oa=this.$.oa;this.localStorage=new w.a;this.l3b=!1;this.$.ea.il(this.tg);this.oa.sf.$mb(this.pya);this.oa.Sq(this.di);this.$.da.Za(5,
function(I){D.businessBar=I;I.vDg(D.fGi)});this.oa.Ey(this.Jn)}function c(x){var D=this;this.ljd=[l.Rgg,l.Egg];this.xn=function(I,F){D.SN[F]=I;D.E4h()&&D.jej("OnNetworkDownImmediatePing"===I.caller)};this.pla=x;this.$=x.$;this.SN={}}function d(){}function e(x,D,I,F,G){this.url="";this.g5a=!1;this.I7=-1;this.testIteration=0;this.baseUrl=I;this.quf=F;this.w7e=D;this.result=new k(D,G)}function k(x,D){this.testName=null;this.startTimeMs=0;this.isSuccess=!1;this.caller=this.errorStatusCode=this.errorMessage=
null;this.reqTotalDurationMs=0;this.browserResourceTiming=null;this.testIteration=0;this.testName=x;this.caller=D;this.reset()}function l(){}function n(){this.scenario=null;this.timeElapsed=0;this.isNewSession=!1;this.rawData=null}b.r(E);u=b(0);var f=b(7),v=b(14),r=b(333),y=b(31),m=b(11),w=b(323);Object(u.a)(n,"ConnectionErrorLogInfo",null,[]);l.Egg="b-ring_Apc_Trans";l.Rgg="cdn_static_resource_ewa_image";Object(u.a)(l,"ResourceHosts",null,[]);var B=b(54),A=b(260);k.prototype.reset=function(){this.isSuccess=
!1;this.startTimeMs=-1;this.errorStatusCode=this.errorMessage="";this.reqTotalDurationMs=-1;this.browserResourceTiming=null};Object(u.a)(k,"NetworkTestResult",null,[]);var z=b(642);e.prototype.runTest=function(){try{if(this.g5a)return v.ULS.sendTraceTag(537155206,0,50,"NetworkTestReq.RunTest: a test for the host {0} is already mid way, not starting a new one.",this.w7e),!1;this.reset();this.g5a=!0;this.result.startTimeMs=Date.now();var x=new A.QueryStringBuilder(this.baseUrl);x.z9("tid",this.result.startTimeMs.toString());
this.url=x.toString();this.Llj();this.testIteration++;this.result.testIteration=this.testIteration;return!0}catch(D){return this.Dtb("Exeption: "+D.message),!1}};e.prototype.reset=function(){this.url="";this.result.reset();this.g5a=!1;this.I7=-1};e.prototype.clearTimeout=function(){-1!==this.I7&&(window.clearTimeout(this.I7),this.I7=-1)};e.prototype.Llj=function(){var x=this;try{var D=new XMLHttpRequest;D.onreadystatechange=function(){4===D.readyState&&(200===D.status?x.AAh():x.Dtb(String.format("Error when downloading resource. status code: {0}, status text: {1}",
D.status,D.statusText),D.status.toString()))};D.onerror=function(){x.Dtb(String.format("Client error when attempting to download resource. status code: {0}, response: {1}",D.status,D.statusText))};this.I7=window.setTimeout(function(){x.I7=-1;x.Dtb("Request timeout")},1E4);D.open("GET",this.url,!0);D.send(null)}catch(I){this.Dtb("Exeption: "+I.message)}};e.prototype.AAh=function(){this.g5a&&(this.result.reqTotalDurationMs=Date.now()-this.result.startTimeMs,this.clearTimeout(),this.result.browserResourceTiming=
z.a(this.url),this.result.isSuccess=!0,this.Z2b())};e.prototype.Dtb=function(x,D){D=void 0===D?null:D;this.g5a&&(this.clearTimeout(),this.result.errorMessage=x,this.result.isSuccess=!1,this.result.errorStatusCode=D,this.Z2b())};e.prototype.Z2b=function(){this.g5a=!1;this.quf&&this.quf(this.result,this.w7e)};Object(u.a)(e,"NetworkTestReq",null,[]);d.wFh=function(x,D,I){I=void 0===I?null:I;d.plc||(d.plc=Array.isArray(B.a.Th(D.ya.NetworkMeasurementUrlList))?B.a.Th(D.ya.NetworkMeasurementUrlList):null);
for(var F=[],G=0;G<d.plc.length;G++){var T=d.plc[G],O=T.key;O||(O=T.Key);if(!I||Array.contains(I,O)){var U=T.value;U||(U=T.Value);O&&U&&F.push(new e(D,O,U,x,"OnNetworkDownImmediatePing"))}}return F};d.plc=null;Object(u.a)(d,"NetworkConnectionHelpers",null,[]);c.prototype.pqi=function(){var x=d.wFh(this.xn,this.$,this.ljd);x=bk(x);for(var D=x.next();!D.done;D=x.next())D.value.runTest()};c.prototype.E4h=function(){for(var x=bk(this.ljd),D=x.next();!D.done;D=x.next())if(D=D.value,void 0===this.SN[D]||
null===this.SN[D])return!1;return!0};c.prototype.jej=function(x){var D=this.$.sf.oV;x&&this.dFj(D);x=bk(this.ljd);for(var I=x.next();!I.done;I=x.next())I=I.value,this.SN[I]=Sys.Serialization.JavaScriptSerializer.serialize(this.SN[I]);x=Date.now();I=this.pla.$fd(b(1058).NetworkConnectionHealthChecker.$Cb).returnValue;var F=this.pla.$fd(b(1058).NetworkConnectionHealthChecker.bKb).returnValue;this.SN.isOfflineMode=D;this.SN.networkDownBBAge=-1===I?I:x-I;this.SN.transientServerCommunicationFailuresBBAge=
-1===F?F:x-F;this.pla.businessBar?(this.SN.isNetworkDownBBShown=this.pla.businessBar.cC(55).toString(),this.SN.isServerErrorBBShown=this.pla.businessBar.cC(21).toString()):(this.SN.isNetworkDownBBShown="unknown",this.SN.isServerErrorBBShown="unknown");v.ULS.sendTraceTag(537155224,0,50,"ConnectionHealthTestsRunner.ReportPingResults: {0}",Sys.Serialization.JavaScriptSerializer.serialize(this.SN))};c.prototype.dFj=function(x){for(var D=b(1058).NetworkConnectionHealthChecker,I={},F=bk(Object.keys(this.SN)),
G=F.next();!G.done;G=F.next())G=this.SN[G.value],I[G.testName]=G.isSuccess;I.isOfflineMode=x;this.pla.fTd(D.n1c,Sys.Serialization.JavaScriptSerializer.serialize(I))};Object(u.a)(c,"ConnectionHealthTestsRunner",null,[]);b.d(E,"NetworkConnectionHealthChecker",function(){return a});a.prototype.dispose=function(){this.$&&(this.$.ea&&this.$.ea.mn(this.tg),this.oa&&(this.oa.sf.cIb(this.pya),this.oa.Bz(this.Jn),this.oa.Zr(this.di)))};a.prototype.hGi=function(x){var D={};D.Timestamp=Date.now().toString();
switch(x.rGa){case 21:this.s7a=x.data.FailedMethod;D.FailedMethod=this.s7a;this.fTd(a.bKb,JSON.stringify(D));break;case 55:this.fTd(a.$Cb,JSON.stringify(D))}};a.prototype.gGi=function(x){switch(x.rGa){case 21:this.O7a(a.bKb,!0);break;case 55:this.O7a(a.$Cb,!0)}};a.prototype.fTd=function(x,D){try{this.localStorage.zf()&&this.localStorage.setItem(x,D)}catch(I){v.ULS.sendTraceTag(537155231,0,15,"NetworkConnectionHealthChecker.StoreDataInLocalStorage: Failed to set item to local storage. reason: {0}",
I.message||"Unknown")}};a.prototype.$fd=function(x){if(this.localStorage.zf()&&(x=this.localStorage.nvb(x))&&"null"!==x){var D=JSON.parse(x);x=parseInt(D.Timestamp,10);D=Sys.Serialization.JavaScriptSerializer.serialize(D);return{returnValue:x,rawData:D}}return{returnValue:-1,rawData:null}};a.prototype.jlf=function(x){if(this.localStorage.zf()){var D=this.localStorage.nvb(a.n1c);if(D&&"null"!==D){var I=-1;this.l3b&&(I=this.HMh(a.ksf,a.VEi));v.ULS.sendTraceTag(537155229,0,50,"NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: Ping Results: {0}, Period offline: {1}, New session: {2}",
Sys.Serialization.JavaScriptSerializer.serialize(D),I,x);this.localStorage.removeItem(a.n1c)}}};a.prototype.HMh=function(x,D){if(!this.$0f())return-1;window.performance.measure(D,x);x=window.performance.getEntriesByName(D);return x.length&&x[x.length-1]?x[x.length-1].duration:(v.ULS.sendTraceTag(537155228,0,10,"NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: measure name {0} returned no measures.",D),-1)};a.prototype.O7a=function(x,D){try{var I=this.$fd(x);var F=I.rawData;var G=I.returnValue;
if(-1!==G){var T=Object(f.a)(new n,{timeElapsed:Date.now()-G,scenario:x,isNewSession:!D,rawData:F});v.ULS.sendTraceTag(537155227,0,50,"NetworkConnectionHealthChecker.LogNetworkIssueBBShown: {0}",JSON.stringify(T))}this.localStorage.removeItem(x)}catch(O){v.ULS.sendTraceTag(537155226,0,15,"NetworkConnectionHealthChecker.LogNetworkIssueBBShown: Failed to get item from local storage. reason: {0}",O.message||"Unknown")}};a.prototype.$0f=function(){return m.HelperMethods.RXc&&r.a.Lob};a.$Cb="NetworkDownBBShown";
a.bKb="ServerCommunicationFailureBBShown";a.n1c="ConnectionHealthPingRsults";a.ksf="offMoStMa";a.VEi="offMoDuMea";Object(u.a)(a,"NetworkConnectionHealthChecker",null,[3])},1314:function(u,E,b){function a(){c.a.ti(".insert-media-dialog-old{width:870px;float:left;margin-top:7px}.insert-media-dialog{width:870px;width:clamp(400px,870px,80vw);float:left;margin-top:7px}.app-rtl .insert-media-dialog{float:right}.insert-media-frame{width:100%;height:100%;visibility:visible}.insert-media-panel-old{height:550px}.insert-media-panel{height:550px;height:clamp(300px,550px,90vh)}.keep-focus-start{position:absolute;width:-1000px;top:-1000px}.keep-focus{position:absolute;width:-1000px;top:1000px}.display-none{display:none}.padding-zero{padding:0}")}
b.d(E,"a",function(){return a});var c=b(559)},1338:function(u,E,b){function a(){nc.a.Fa(function(Da){c.ka(Da)})}function c(Da){var Sb=Pe.call(this)||this;Sb.$=Da;Sb.Gm=ec.a.instance;Sb.Eb();return Sb}function d(Da){var Sb=this;this.d5b="";this.d2=this.Hs=null;this.Npc=!1;this.G6e=function(hb,Xb){Sb.hide(void 0===hb?null:hb,void 0===Xb?null:Xb)};this.gridView=ha.g(Da);this.gridView.ha.vG(this.G6e)}function e(){}function k(Da,Sb){var hb=Jd.call(this,Da)||this;hb.Ko=null;hb.ibi=function(Xb,jc){1===Xb?
(Xb=k.Oeh[jc[k.Neh]],Ha.ULS.sendTraceTag(537167683,0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler OK button pressed with valid input, shift direction = {0}",0===Xb?"Horizontal":"Vertical"),hb.Ko.setResult(Xb)):(Ha.ULS.sendTraceTag(537167682,0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler cancel button pressed"),hb.Ko.jt())};hb.rg(Sb);return hb}function l(Da){this.vEc=this.AOc=null;this.$=Da}function n(){}function f(){}function v(){}function r(){}function y(Da){this.X1c=
this.Ssa=null;this.k$a=15;this.$=Da}function m(Da,Sb){this.$=Da;this.Ynb=Sb}function w(Da,Sb,hb,Xb){Da=Q.call(this,Da)||this;Da.isFromCurrentSession=!1;Da.top=0;Da.left=0;Da.isFromCurrentSession=Sb;Da.top=hb;Da.left=Xb;return Da}function B(Da,Sb,hb,Xb,jc){jc=void 0===jc?null:jc;var Wc=O.call(this,Da,"ArtCopyPasteHandler")||this;Wc.BYg="XLO";Wc.CYg="3";Wc.sU=new F(Da);Wc.t$=Sb;Wc.dZa=hb;Wc.ha=ha.g(Da).ha;Wc.Z1c=jc||new T(Wc.t$);Wc.IWi=new A(hb,Da);Wc.Ynb=Xb;return Wc}function A(Da,Sb){this.CIb=new kc.a;
this.dZa=Da;this.$=Sb;this.p1i=function(hb){return Promise.resolve(hb)};this.HEb=function(hb){return Promise.reject(hb)}}function z(Da,Sb,hb,Xb,jc,Wc,fd,Tc,td){this.promise=null;this.ribbonCommandInfo=Da;this.destination=Sb;this.mGe=hb;this.vOb=jc;this.v0=Wc;this.item=fd;this.pasteContext=Tc;this.uNa=hb||Sb.FirstRow+"_"+Sb.FirstColumn;this.idf=!0;this.cye=td}function x(Da,Sb,hb,Xb,jc,Wc,fd){this.floatingObjectId=Da;this.commandParameters=Sb;this.kt=hb;this.xah=Xb;this.naa=void 0===Wc?null:Wc;this.vOb=
void 0===fd?null:fd;this.W2g=jc}function D(Da,Sb,hb,Xb){Sb=G.call(this,Da,Sb,hb,"AcrossSessionRangeCopyPasteHandler",void 0===Xb?null:Xb)||this;Sb.sU=new F(Da);return Sb}function I(Da,Sb){Sb=void 0===Sb?null:Sb;var hb=Se.call(this,Be[Da])||this;hb.copyErrorName=0;hb.ewaErrors=null;hb.copyErrorName=Da;hb.ewaErrors=Sb;if(null===Sb||void 0===Sb?0:Sb.length)hb.innerError=new se.a(Sb,null);return hb}function F(Da){this.sU=new ve.a(!0);this.$=Da}function G(Da,Sb,hb,Xb,jc){jc=void 0===jc?null:jc;Xb=O.call(this,
Da,Xb)||this;Xb.f3g=Sb;Xb.t$=hb;Xb.$1c=jc||new T(Xb.t$);Xb.gridView=ha.g(Da);Xb.ha=Xb.gridView.ha;Xb.clipboardRangeFactory=Da.da.za(169);return Xb}function T(Da){this.clipboardItems=this.key=null;this.t$=Da}function O(Da,Sb){this._name=Sb;this.$=Da;this.Gm=ec.a.instance;this.Bp=new N(Da,ha.g(Da))}function U(Da){return Da.shadowWorkbookSizeExceedsLimit?!0:J(Da)>qb.a.xkc}function J(Da){return Da?Da.shadowWorkbookSizeExceedsLimit&&void 0!==Da.shadowWorkbookBlockedSize&&null!==Da.shadowWorkbookBlockedSize?
Da.shadowWorkbookBlockedSize:Da.shadowWorkbookBase64?Da.shadowWorkbookBase64.length:0:0}function H(){}function K(Da){var Sb={};this.a6f=(Sb["SourceItemType.Range"]=0,Sb["SourceItemType.Art"]=1,Sb);this.eMb={};Sb={};this.X5f=(Sb["FloatingObjectType.Unknown"]=99,Sb["FloatingObjectType.CardView"]=6,Sb["FloatingObjectType.Chart"]=0,Sb["FloatingObjectType.Group"]=7,Sb["FloatingObjectType.Image"]=1,Sb["FloatingObjectType.Ink"]=8,Sb["FloatingObjectType.InteractiveReport"]=4,Sb["FloatingObjectType.ModernOfficeExtension"]=
3,Sb["FloatingObjectType.Shape"]=5,Sb["FloatingObjectType.Slicer"]=2,Sb["FloatingObjectType.Unsupported"]=100,Sb);Sb={};this.rWc=(Sb["99"]="FloatingObjectType.Unknown",Sb["6"]="FloatingObjectType.CardView",Sb["0"]="FloatingObjectType.Chart",Sb["7"]="FloatingObjectType.Group",Sb["1"]="FloatingObjectType.Image",Sb["8"]="FloatingObjectType.Ink",Sb["4"]="FloatingObjectType.InteractiveReport",Sb["3"]="FloatingObjectType.ModernOfficeExtension",Sb["5"]="FloatingObjectType.Shape",Sb["2"]="FloatingObjectType.Slicer",
Sb["100"]="FloatingObjectType.Unsupported",Sb);Sb={};this.$5f=(Sb["RibbonCommand.Copy"]=-911352779,Sb["RibbonCommand.Cut"]=-1985798686,Sb);Sb={};this.RKd=(Sb["-911352779"]="RibbonCommand.Copy",Sb["-1985798686"]="RibbonCommand.Cut",Sb);Sb={};this.Z5f=(Sb["InputManager.InputMethod.NotDefined"]=-1,Sb["InputManager.InputMethod.Unknown"]=0,Sb["InputManager.InputMethod.Keyboard"]=1,Sb["InputManager.InputMethod.Mouse"]=2,Sb["InputManager.InputMethod.Touch"]=3,Sb["InputManager.InputMethod.CrossSlide"]=9,
Sb);this.Xja={};Sb={};this.Y5f=(Sb["FrameMode.None"]=0,Sb["FrameMode.Reading"]=1,Sb["FrameMode.Edit"]=2,Sb);this.K2a={};Sb={};this.b6f=(Sb["UILocation.Unknown"]=0,Sb["UILocation.UpperRibbon"]=1,Sb["UILocation.Ribbon"]=2,Sb["UILocation.QAT"]=3,Sb["UILocation.Jewel"]=4,Sb["UILocation.NavigationPane"]=5,Sb["UILocation.KeyboardShortcut"]=6,Sb["UILocation.StatusBar"]=7,Sb["UILocation.Dialog"]=8,Sb["UILocation.Floatie"]=9,Sb["UILocation.NotificationBar"]=10,Sb["UILocation.StandaloneCuiRoot"]=11,Sb["UILocation.TaskPane"]=
12,Sb["UILocation.HeroDock"]=13,Sb["UILocation.SingleLineRibbon"]=14,Sb["UILocation.MultilineRibbon"]=15,Sb["UILocation.Overflow"]=16,Sb["UILocation.TellMe"]=17,Sb["UILocation.FarPeripheralControls"]=18,Sb["UILocation.ContextMenu"]=19,Sb["UILocation.DialogMenu"]=20,Sb["UILocation.Header"]=21,Sb["UILocation.FileMenu"]=22,Sb["UILocation.Toolbar"]=26,Sb["UILocation.Canvas"]=30,Sb);this.sr={};this.$=Da;this.Xja.notDefined="InputManager.InputMethod.NotDefined";this.Xja.unknown="InputManager.InputMethod.Unknown";
this.Xja.keyboard="InputManager.InputMethod.Keyboard";this.Xja.mouse="InputManager.InputMethod.Mouse";this.Xja.touch="InputManager.InputMethod.Touch";this.Xja.crossSlide="InputManager.InputMethod.CrossSlide";this.K2a.none="FrameMode.None";this.K2a.reading="FrameMode.Reading";this.K2a.edit="FrameMode.Edit";this.sr.unknown="UILocation.Unknown";this.sr.upperRibbon="UILocation.UpperRibbon";this.sr.ribbon="UILocation.Ribbon";this.sr.QAT="UILocation.QAT";this.sr.jewel="UILocation.Jewel";this.sr.navigationPane=
"UILocation.NavigationPane";this.sr.keyboardShortcut="UILocation.KeyboardShortcut";this.sr.statusBar="UILocation.StatusBar";this.sr.dialog="UILocation.Dialog";this.sr.floatie="UILocation.Floatie";this.sr.notificationBar="UILocation.NotificationBar";this.sr.standaloneCuiRoot="UILocation.StandaloneCuiRoot";this.sr.taskPane="UILocation.TaskPane";this.sr.heroDock="UILocation.HeroDock";this.sr.singleLineRibbon="UILocation.SingleLineRibbon";this.sr.multilineRibbon="UILocation.MultilineRibbon";this.sr.overflow=
"UILocation.Overflow";this.sr.tellMe="UILocation.TellMe";this.sr.farPeripheralControls="UILocation.FarPeripheralControls";this.sr.header="UILocation.Header";this.sr.fileMenu="UILocation.FileMenu";this.sr.contextMenu="UILocation.ContextMenu";this.sr.dialogMenu="UILocation.DialogMenu";this.sr.toolbar="UILocation.Toolbar";this.sr.canvas="UILocation.Canvas";this.eMb.range="SourceItemType.Range";this.eMb.art="SourceItemType.Art"}function N(Da,Sb){var hb=this;this.Cic=this.MMa=null;this.SOa=eb.a.SOa;this.eCd=
eb.a.eCd;this.Dfc=vb.EwaSettings.getBooleanFeatureGate(eb.a.M4b,!1);this.wld=!1;this.xwa=vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.vz=function(Xb,jc){2===jc.Cq?(hb.Yu.clear(),hb.MMa=null):1===jc.Cq&&hb.Yu&&hb.Yu.contains(jc.Ef)&&(Ha.ULS.sendTraceTag(526758673,0,50,"CopyPasteUtils.OnQueueChanged: web method {0} returned, it took {1} milliseconds to complete.",Rc.a(jc.Ef.operation.operationName),jc.Ef.dequeueUtcTime.getTime()-jc.Ef.enqueueUtcTime.getTime()),
hb.Yu.remove(jc.Ef),hb.MMa=null)};this.$=Da;this.gridView=Sb;this.wld&&(this.$.userOperationManager.zr(this.vz),this.Yu=new fb.a)}function M(Da,Sb,hb,Xb,jc,Wc,fd,Tc,td){this.destinationRange=Da;this.Jqb=hb;this.gFf=Xb;this.Ed=jc;this.vOb=Wc;this.pasteContext=fd;this.Kpb=Tc;this.xVd=td}function C(Da){this.parameters=null;this.parameters=Da}function Q(Da){this.pasteParameters=null;this.pasteParameters=Da}function P(Da,Sb){this.content=this.destinationRange=null;this.destinationRange=Da;this.content=
Sb}function ka(Da,Sb,hb){this.destinationRange=this.sourceRange=null;this.pasteFlags=0;this.sourceRange=Da;this.destinationRange=Sb;this.pasteFlags=hb}function R(Da,Sb,hb,Xb,jc,Wc,fd,Tc){Tc=void 0===Tc?null:Tc;fd=Da.Na(1,void 0===fd?null:fd);fd.pasteParameters=Sb;return wb.g(Da,"Paste",fd,hb,Xb,jc,Wc,64,Tc)}function fa(Da,Sb,hb,Xb,jc,Wc,fd,Tc){Tc=void 0===Tc?null:Tc;fd=Da.Na(1,void 0===fd?null:fd);fd.copyParameters=Sb;return wb.g(Da,"Copy",fd,hb,Xb,jc,Wc,0,Tc)}function ca(Da,Sb,hb,Xb,jc,Wc,fd,Tc,
td){td=void 0===td?null:td;Tc=Da.Na(9,Tc);Tc.destinationRange=Sb;Tc.source=hb;return wb.g(Da,"PasteString",Tc,Xb,jc,Wc,fd,64,td)}function ea(Da,Sb,hb,Xb,jc,Wc,fd,Tc){Tc=void 0===Tc?null:Tc;fd=Da.Na(1,fd);fd.pasteHtmlParameters=Sb;return wb.g(Da,"PasteHtmlContent",fd,hb,Xb,jc,Wc,64,Tc)}function wa(){this.B_a=this.gye=null}function X(Da,Sb,hb,Xb,jc,Wc,fd,Tc,td){td=void 0===td?null:td;var Tb=tb.call(this)||this;Tb.pasteShortcutManager=null;Tb.Oaf=vb.EwaSettings.tb();Tb.xwa=vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",
!1);Tb.k8f=null;Tb.H6a=!1;Tb.Gdf=vb.EwaSettings.isChangeGateEnabled("OfficeVSO:6004791_MergedCellOverlapTelemetry");Tb.dqd=vb.EwaSettings.isChangeGateEnabled("OfficeVSO:6660890_Tag_aoi75RetryLoggingFix2");Tb.Uzd=function(Fa){Tb.svj(Fa)&&(Tb.Bp.cxb(),Ha.ULS.sendTraceTag(537167777,0,50,"CopyPasteInfrastructure.OnMetadataChanged: found that cut/copy operation was preformed in another session therefore removed the highlight in this session."))};Tb.Fvi=function(Fa,Qb){Ha.ULS.sendTraceTag(537167768,0,50,
"CopyPasteInfrastructure.LogShortcutDialogAndRestoreFocus: Got shortcut dialog, user pressed [{0}]. userPressedExtensionLink={1}",Fa,Qb);Tb.gridView.focus()};Tb.Yc=function(Fa,Qb){Qb.VM||Qb.jg||Tb.Yq("OnWorkbookOpened",!1).catch(function(){})};Tb.uh=function(Fa,Qb){Fa=ra(Tb.kK);var cc=Tb.Bp.Pvb(Fa);cc&&(Qb.pa&&Qb.pa.sheetName===cc.sheetName&&cc.isFromCurrentSession(Tb.$)?Tb.Bp.c7e(cc.ranges,Fa.commandParameters.commandType):Tb.Bp.cxb())};Tb.Zmc=function(Fa,Qb){Fa=ra(Tb.kK);(Fa=Tb.Bp.Pvb(Fa))&&Qb.item&&
Qb.item.sheetName===Fa.sheetName&&Fa.isFromCurrentSession(Tb.$)&&Tb.Yq("OnItemDeleting",!1).catch(function(){})};Tb.VEb=function(Fa,Qb){Tb.Oaf?Tb.k8f(Fa,Qb):Tb.mCf()};Tb.kR=function(Fa,Qb){1===Qb.Cq&&Qb.Ef.operation.flags&2&&Tb.Yq("OnQueueItemChanged/ItemRemoved",!1).catch(function(){})};Tb.$=Da;Tb.Fg=hb;Tb.gridView=ha.g(Da);Tb.Bp=jc;Tb.hbi=Wc;Tb.kK=Sb;Tb.M3b=Xb;Tb.getStringifiedError=td||copyPasteInfra.getStringifiedError;Tb.B1f=1===Tc;Tb.Pi();Tb.copyPasteShortcutDialogFactory=Tb.$.da.za(85);Ha.ULS.shipAssertTag(537167825,
0,!!Tb.copyPasteShortcutDialogFactory,"CopyPasteInfrastructure.ctor: this.copyPasteShortcutDialogFactory shouldn't be null.");fd||(Ha.ULS.sendTraceTag(537167824,0,50,"CopyPasteInfrastructure.ctor: userId is null, using default userId."),fd=X.och);Tb.userHash=ib.a.Kv(fd);Tb.Hzi="CultureTag: "+ec.a.instance.Srb+" HASH: ";Tb.kK.addMetadataChangeListener(X.Zof,Tb.Uzd);Tb.Xud=Tb.$.ya.MaxCopyPasteLength;Tb.Lxa=Tb.xwa?vb.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",
Tb.$.ya.CopyPasteMaxPayloadLength):qb.a.Lxa;Tb.fo=vb.EwaSettings.getBooleanFeatureGate(eb.a.kPa,!1);Tb.fo&&Da.da.Za(478,function(Fa){Tb.pasteShortcutManager=Fa});Tb.Oaf&&(Tb.k8f=Aa.a(function(){Tb.mCf()},1,Tb.$.la,"CopyPasteInfrastructure.OnStartEditInternal",!0));return Tb}function ja(Da){if(!Da)return"null";var Sb=[];Da=bk(Da.get());for(var hb=Da.next();!hb.done;hb=Da.next())hb=hb.value,hb=String.format("{0}({1})",hb.clipboardDataFormat,hb.data.length),Sb.push(hb);Sb.sort();return Sb.join(",")}
function va(Da){switch(Da){case 0:return"None";case 2:return"Art";case 1:return"Range";default:return"Unknown"}}function ua(Da,Sb){return Da?Sb&&Sb.ya?Da.sessionId!==Sb.ya.UserSessionId:(Ha.ULS.shipAssertTag(537166209,0,!1,"ewaControl shouldn't be null"),!1):(Ha.ULS.shipAssertTag(537166210,0,!1,"copyContext shouldn't be null"),!1)}function Xa(){}function aa(){}function ba(){}function oa(Da,Sb,hb,Xb){this.$=Da;this.originalDestinations=Sb;this.N8b=hb;this.Jjg=Xb;this.bug=this.originalDestinations;
this.Cng=this.N8b;this.trg="PasteRecoveryUI"}function ra(Da){return Da&&(Da=Da.getCachedMetadata(),null===Da||void 0===Da?0:Da.lastCopy)?Da.lastCopy:null}function db(Da){return Da.clipboardItems&&(Da=Da.clipboardItems.getItem(xa.efi))&&"1"===Da?!0:!1}function Ka(Da){return Ga(Da)&&!(void 0===Da.clipboardItems||null===Da.clipboardItems)&&!!Da.clipboardItems.getItem(xa.png)&&!Da.clipboardItems.getItem(xa.plainText)}function Ga(Da){return Da.clipboardItems&&(Da=Da.clipboardItems.getItem(xa.Hii))&&"1"===
Da?!0:!1}function xa(){}function da(){}function qa(Da){return!!Da&&Object.getType(Da)===na}function na(Da,Sb,hb,Xb,jc){Xb=ta.call(this,Xb,jc)||this;Ha.ULS.shipAssertTag(537167645,0,!!Sb&&0<Sb.length,"RangeSourceItem.ctor: ranges should not be null or empty");Xb.$=Da;Xb.ranges=Sb;Xb.sheetName=hb;return Xb}function ia(Da,Sb,hb,Xb,jc){hb=ta.call(this,hb,Xb)||this;hb.activeFloatingObjectControlId=Da;hb.sheetName=Sb;hb.type=jc;return hb}function ta(Da,Sb){var hb=this;this.xEh=function(){var Xb={};Xb.SourceItem=
hb.toString();return Xb};this.sessionStateId=Da;this.sessionId=Sb;this.toJSON=this.xEh}function za(Da,Sb,hb,Xb,jc){var Wc=Da.Stopwatch,fd={};fd.a=jc;fd.e=Wc.id;fd.c="RearrangeRowColumn";fd.b="mouse";fd.d=Da.OperationId.toString();fd.f=hb.toString();fd.g=Xb.toString();fd.h=Sb.toString();fd.i=Da.DragDropIsShiftKeyDown;fd.j=!0;fd.o=Wc.qc;fd.q=!1;fd.r=Da.CopyPasteTargetType.toString();fd.s=Da.EncounteredDeploymentErrors;return fd}function sa(Da){Da=Ob.call(this,Da)||this;Da.AYg=function(){Ha.ULS.sendTraceTag(537167827,
0,50,"ClipboardReadPermissionAskDialog OK button pressed")};Ha.ULS.sendTraceTag(537167828,0,50,"ClipboardReadPermissionAskDialog.ClipboardReadPermissionAskDialog");Da.Rb=0;Da.mc(1,ec.a.instance.ga(2226));var Sb=ec.a.instance.ga(2224),hb=Da.BM();Da.initializeAndShow(Sb,Da.AYg,hb);return Da}var V=b(0),Ia=b(7),Ha=b(14),ob=b(232),ib=b(29),La=b(27),zb=b(366),Fb=b(178),Yb=b(276),kb=b(369),vb=b(1),Wa=b(38),qb=b(8),yb=b(389),ec=b(15),Ob=yb.a;Rk(sa,Ob);sa.prototype.BM=function(){var Da={};Da.id=this.nc;var Sb=
ec.a.instance.ga(2225);Da.DialogMessage=Sb;return Da};Mf.Object.defineProperties(sa.prototype,{nc:{configurable:!0,enumerable:!0,get:function(){return"ClipboardReadPermissionAskDialog"}}});Object(V.a)(sa,"ClipboardReadPermissionAskDialog",yb.a,[]);var Cb=b(50);ta.prototype.Jbf=function(Da){return Da?this.sessionStateId===Da.sessionStateId&&this.sessionId===Da.sessionId:!1};ta.prototype.isFromCurrentSession=function(Da){return this.sessionId===Da.ya.UserSessionId};Object(V.a)(ta,"SourceItem",null,
[]);Rk(ia,ta);ia.prototype.isEqual=function(Da){return Da&&Object.getType(Da)===ia?this.Jbf(Da)&&this.activeFloatingObjectControlId===Da.activeFloatingObjectControlId&&this.sheetName===Da.sheetName:!1};ia.prototype.toString=function(){return this.type.toString()};Object(V.a)(ia,"ArtSourceItem",ta,[]);var ab;(function(Da){Da[Da.valid=0]="valid";Da[Da.notPairwiseDisjoint=1]="notPairwiseDisjoint";Da[Da.cutNotSupportedInDiscontinuousSelection=2]="cutNotSupportedInDiscontinuousSelection";Da[Da.notValidForm=
3]="notValidForm";Da[Da.temporarilyBlockedCopy=4]="temporarilyBlockedCopy"})(ab||(ab={}));Object(V.b)("CopySourceValidationOptions",ab);var ya=b(45);Rk(na,ta);na.prototype.isEqual=function(Da){return Da&&Object.getType(Da)===na?this.Jbf(Da)&&ya.Q(this.ranges,Da.ranges)&&this.sheetName===Da.sheetName:!1};na.prototype.toString=function(){return ya.i(this.ranges,",",this.$,!1)};Object(V.a)(na,"RangeSourceItem",ta,[]);da.aUj="PasteError_FailedToReadFromClipboard_UserHashMismatchError";Object(V.a)(da,
"ExpectedErrorNames",null,[]);xa.plainText="text/plain";xa.html="text/html";xa.png="image/png";xa.shadowWorkbook="data/shadow-workbook";xa.Hii="metadata/is-last-copy-was-external";xa.efi="metadata/is-last-copy-was-external-XLO-source";xa.VWg="metadata/chrome-extension-id";xa.Jqb="copyId";xa.tHg="metadata/additional-signature-data-attributes";Object(V.a)(xa,"ClipboardDataFormat",null,[]);var ma=b(48),ha=b(21),Z=b(33);oa.prototype.IJa=function(){return oa.QWi};oa.prototype.rMh=function(){return this.N8b&&
1===this.N8b.length?this.sMh(this.N8b[0]):null};oa.prototype.sMh=function(Da){var Sb=ha.g(this.$),hb=Sb.eb.dj(Da),Xb=Sb.fg(Da,hb);Sb=Sb.rtl;if(!Xb)return null;Da=ha.g(this.$).Cf(hb);var jc=Da.fn;if(!jc.xd(Xb))return null;Xb=jc.ze(Xb);var Wc=Xb.topLeft.y,fd=Xb.bottomRight.y,Tc=Sb?Xb.bottomRight.x:Xb.topLeft.x;Xb=Sb?Xb.topLeft.x:Xb.bottomRight.x;var td=new ma.a(Xb+(Sb?-81:81),fd+38+6);if(jc.hHa(td))return this.Q3a(Da,jc,hb,Xb,fd,Sb?12:-3,66);td=new ma.a(Xb+(Sb?-81:81),fd);if(jc.hHa(td))return this.Q3a(Da,
jc,hb,Xb,fd,Sb?20:3,22);td=new ma.a(Xb,fd+38+6);if(jc.hHa(td))return this.Q3a(Da,jc,hb,Xb,fd,-81+(Sb?18:0),66);Xb=new ma.a(Tc+(Sb?81:-81),fd);if(jc.hHa(Xb))return this.Q3a(Da,jc,hb,Tc,fd,-81+(Sb?12:-6),22);fd=new ma.a(Tc,Wc-38-6);return jc.hHa(fd)?this.Q3a(Da,jc,hb,Tc,Wc,Sb?15:0,16):this.Q3a(Da,jc,hb,Sb?jc.topLeft.x:jc.bottomRight.x,jc.bottomRight.y,-81+(Sb?15:-6),22)};oa.prototype.Q3a=function(Da,Sb,hb,Xb,jc,Wc,fd){var Tc=ha.g(this.$),td=Tc.rtl;Da=Sys.UI.DomElement.getLocation(Da.domElement);Xb=
new Sys.UI.Point(Xb+(td?0:Da.x)-Sb.topLeft.x,jc+Da.y-Sb.topLeft.y);td&&(Tc=Tc.view.visibleArea,Xb.x=Tc.bottomRight.x-Tc.topLeft.x-Xb.x,2===hb||4===hb)&&(Xb.x+=Sb.bottomRight.x);Xb=Z.a(this.$).rja(Xb);return new Sys.UI.Point(Xb.x+Wc,Xb.y+fd)};Mf.Object.defineProperties(oa.prototype,{sHg:{configurable:!0,enumerable:!0,get:function(){return this.Jjg}},Zqi:{configurable:!0,enumerable:!0,get:function(){return this.trg}},k6i:{configurable:!0,enumerable:!0,get:function(){return this.bug}},Wwh:{configurable:!0,
enumerable:!0,get:function(){return this.Cng}}});oa.QWi=["PasteRecoveryUI"];Object(V.a)(oa,"PasteRecoveryUI",null,[745]);var Na=b(76),eb=b(327);ba.nzg="ActiveSelection";ba.shadowWorkbook="ShadowWorkbook";ba.Uhg="GVML";ba.plainText="PlainText";ba.html="Html";ba.INg="Bitmap";Object(V.a)(ba,"PayloadType",null,[]);aa.FBj="Slice4";aa.GBj="Slice5";aa.HBj="Slice6";Object(V.a)(aa,"SliceName",null,[]);Xa.fDi="NotCalled";Xa.success="Success";Xa.failed="Failed";Object(V.a)(Xa,"SucceededPopulatingSystemClipboardOptions",
null,[]);var cb=b(374),Ua;(function(Da){Da[Da.valid=0]="valid";Da[Da.destinationRangesIsEmpty=1]="destinationRangesIsEmpty";Da[Da.discontinuousSelectionNotSupportPasteFromExternal=2]="discontinuousSelectionNotSupportPasteFromExternal";Da[Da.discontinuousSelectionNotSupportPasteCrossSession=3]="discontinuousSelectionNotSupportPasteCrossSession";Da[Da.multipleSourcesAndMultipleDestinationsAreNotSupported=4]="multipleSourcesAndMultipleDestinationsAreNotSupported";Da[Da.multipleDestinationsAreNotMultiplyOfSourceRange=
5]="multipleDestinationsAreNotMultiplyOfSourceRange";Da[Da.sourceAndDestinationAreOverlapping=6]="sourceAndDestinationAreOverlapping";Da[Da.copySourceNotValid=7]="copySourceNotValid";Da[Da.cutNotSupportedInDiscontinuousSelection=8]="cutNotSupportedInDiscontinuousSelection";Da[Da.pasteLinkNotSupportMultipleDestination=9]="pasteLinkNotSupportMultipleDestination";Da[Da.temporarilyBlockedPaste=10]="temporarilyBlockedPaste";Da[Da.unknown=100]="unknown"})(Ua||(Ua={}));Object(V.b)("PasteValidationOptions",
Ua);var pa=b(51),Qa=b(36),Db=b(151),Kb=b(37),Ab=b(160),ub=b(356),Mb=b(31),Aa=b(329),Za=b(11),Zb=b(22),jb=b(95),Vb=b(126),Ic=b(112),Rb=b(627),kc=b(100),xb=b(58),Va=b(256),tb=Wa.a;Rk(X,tb);X.prototype.JFg=function(Da){this.addHandler(X.PAd,Da)};X.prototype.xbj=function(Da){this.removeHandler(X.PAd,Da)};X.prototype.copy=function(Da){var Sb=this;Da.stopwatch=this.$.Fb.sc("UserAction",Cb.b().ei(Da.ribbonCommandInfo.command)+"ClientSide");if(this.fo){var hb=pa.GetServiceTaskFactory.Ra(this.$.da,478,479,
0);Kb.TaskExtensions.Aa(hb,function(){Sb.pasteShortcutManager=hb.result},this.la,3)}var Xb=!!ra(this.kK);vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!La.a.HC&&(this.H6a=!1);this.Yq("Copy/before/"+zb.a[Da.ribbonCommandInfo.method],!1,void 0,!0,Da.copyPasteTargetType).catch(function(){});var jc=-1985798686===Da.ribbonCommandInfo.command;if(1===this.gridView.Pe&&(jc=this.Bp.abf(this.gridView.ha.sa.selectedRanges,jc),0!==jc)){var Wc=X.j2g(jc);this.Sya(Wc,
ab[jc],!1);return Promise.reject(!1)}Da.userHash=this.userHash;Da.id=Fb.a.create().toString();var fd=this,Tc=this;return this.M3b.onCopy(Da).then(function(td){td.isAsyncCopy||Da.stopwatch.stop();fd.pasteIndicationManager.qIe();Ha.ULS.sendTraceTag(24150883,0,50,"CopyPasteInfrastructure.OnCopy: Copy operation finished successfully. {0}",cb.d(Da));fd.Iti(td,Xb);td=vb.EwaSettings.isChangeGateEnabled("OfficeVSO:6591921_CheckTargetTypeForEnterToPaste")?1===Da.copyPasteTargetType:!0;!Da.isFormatPainter&&
fd.fo&&td&&(fd.pasteShortcutManager?fd.pasteShortcutManager.Tjh():Ha.ULS.shipAssertTag(537167823,0,!1,"Copy: pasteShortcutManager is null."));return Promise.resolve(!0)},function(td){var Tb=!1,Fa="none",Qb=X.Prb,cc=!0,bc=-1,Mc=X.copyErrorName+X.CIa,rd=!1,Hd=null;if(td){Hd=td.copyContext;bc=td.reason;Mc+=X.PJa(td);td.message&&(Qb=td.message);var ic=X.i2g(td);if(ic)if(3===ic.copyErrorName)Tb=!0,Qb=Fa="Async Copy canceled by the user.",cc=!1;else if(Mb.a.Uq(ic.ewaErrors))if(Qb=Tc.Iac(ic.ewaErrors),Mb.a.Zg(ic.ewaErrors,
X.operationSucceededWithAlert))rd=Tb=!0;else if(Mb.a.Zg(ic.ewaErrors,X.pasteDataLimitHit)||Mb.a.Zg(ic.ewaErrors,X.copyThrottlingError))Tb=!0;13===td.reason?(Tb=!0,cc=!1):11===td.reason&&(cc=!1)}Tb?Ha.ULS.sendTraceTag(36304157,0,15,"CopyPasteInfrastructure.OnCopy: Copy operation failed with an expected error. clearStateNeeded: {0}, Friendly message: {1}, Error Message: {2}, CommandParameters: {3}",cc,Fa,td?Tc.getStringifiedError(td):"null",cb.d(Da)):Ha.ULS.sendTraceTag(24150912,0,10,"CopyPasteInfrastructure.OnCopy: Copy operation failed with an unexpected error. clearStateNeeded: {0}, Error Message: {1}, CommandParameters: {2}",
cc,td?Tc.getStringifiedError(td):"null",cb.d(Da));cc&&Tc.Yq("Copy/fail/"+zb.a[Da.ribbonCommandInfo.method],!0,void 0,void 0,Da.copyPasteTargetType).catch(function(){});Tc.Hti(Da,Tb,Qb,Mc,bc,rd,Hd);return Promise.reject(td)})};X.prototype.paste=function(Da){var Sb=this;Da.stopwatch=this.$.Fb.sc("UserAction",Cb.b().ei(Da.ribbonCommandInfo.command)+"ClientSide");vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!La.a.HC&&(Ha.ULS.sendTraceTag(537167822,0,50,
"CopyPasteInfrastructure.OnPaste: Cross-app shadow workbook paste is enabled"),this.H6a=!1,Da.clipboardPicklingApiDataFormatsToRead=[xa.shadowWorkbook]);ha.g(this.$).si&&ha.g(this.$).si.y7(this.Ded(Da.ribbonCommandInfo.command),Da.stopwatch.id);if(Da.isPasteCommandFromRecoveryUI){var hb=this.$.da.za(406);var Xb=Yb.a.clone(hb.Crd);hb=hb.srd;Da.pasteRecoveryCachedClipboardItems=hb?hb[X.iFf]:null}else Xb=Yb.a.clone(this.gridView.ha.sa.selectedRanges);Da.originalDestinations=Xb;Da.expandDestinations=
this.IYc(Da.originalDestinations,Da.commandType);if(this.VYc(Da.commandType,Da.expandDestinations)||this.VTg())return Da.userHash=this.userHash,Da.id=Fb.a.create().toString(),vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PerfImpactExperimentForAsyncApi",!1)&&!La.a.HC&&(Da.clipboardReadPermissionPromptShown=!1,Da.clipboardAsyncApiDataFormatsToRead=[xa.plainText+"Async"],this.M3b.shouldShowClipboardReadPermissionDialog().then(function(jc){jc&&(Da.clipboardReadPermissionPromptShown=!0,
new sa(Sb.$));return Promise.resolve(!0)},function(){return Promise.resolve(!0)})),this.M3b.onPaste(Da).then(function(jc){return Sb.ync(jc,Da)},function(jc){return Sb.HEb(Da,jc)});this.$.Fd(927125067,Na.a.Cb,30,null);Ha.ULS.sendTraceTag(24150913,0,15,'CopyPasteInfrastructure.OnPaste: paste was triggered but the estimated destination range is not editable, do nothing. ExpandDestinations: {0}, CommandType: {1}, copyPasteTargetType="{2}"',ya.i(Da.expandDestinations,",",this.$,!1),Da.commandType,Da.copyPasteTargetType);
return Promise.resolve(!0)};X.prototype.Ded=function(Da){if(vb.EwaSettings.isChangeGateEnabled("OfficeVSO:4313497_PasteOptionPerfTelemetry"))switch(Da){case 1804571062:return 6;case -185374993:return 7;case 1766348718:return 8}return 3};X.prototype.VTg=function(){return!!ha.g(this.$).ha.Oa.activeFloatingObjectControlId&&this.$.hq(null,!1,470)};X.prototype.aBb=function(){var Da=ra(this.kK);return Da&&Da.commandParameters?Da.commandParameters.copyPasteTargetType:0};X.prototype.Gii=function(){return!!ra(this.kK)&&
ua(ra(this.kK),this.$)};X.prototype.Yq=function(Da,Sb,hb,Xb,jc){var Wc=this;hb=void 0===hb?!1:hb;Xb=void 0===Xb?!1:Xb;jc=void 0===jc?0:jc;try{this.fo&&this.pasteShortcutManager&&this.pasteShortcutManager.p6b();var fd=jc,Tc=this.Rpi();if(!Xb&&2===Tc)return Ha.ULS.sendTraceTag(537167821,0,50,"CopyPasteInfrastructure.ClearState clipboard won't be cleared as there's art in the clipboard. clearClipboardContent = '{0}', isExplicit = '{1}', isForce = '{2}', Current CCP operation copyPasteTargetType = '{3}', LastCopyPasteTargetType = '{4}'",
Sb,hb,Xb,jc,Tc),Promise.reject(null);0===fd&&(fd=Tc);var td=this.$.Fb.sc("UserAction","ClearCopyState"),Tb=td.id;Ha.ULS.sendTraceTag(537167820,0,50,"CopyPasteInfrastructure.ClearState clear clipboard state. clearClipboardContent = '{0}', isExplicit = '{1}', isForce = '{2}', Current CCP operation copyPasteTargetType = '{3}', LastCopyPasteTargetType = '{4}'",Sb,hb,Xb,jc,Tc);this.Bp.cxb();this.A3i();return this.M3b.onCancelCopy(Sb).then(function(){Sb&&vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!La.a.HC&&(Wc.H6a=!1);td.stop();Wc.Dkf(Da,Tb,!0,hb,Sb,"","",td.qc,fd);return Promise.resolve(!0)},function(Fa){Ha.ULS.sendTraceTag(24150915,0,15,"CopyPasteInfrastructure.ClearState: error during call to copyPasteFlowManager.OnClear(). error: {0}",Fa?Wc.getStringifiedError(Fa):"null");td.stop();var Qb=X.jUg+X.CIa,cc=X.Prb;Fa&&(Qb+=X.PJa(Fa),Fa.message&&(cc=Fa.message));Wc.Dkf(Da,Tb,!1,hb,Sb,cc,Qb,td.qc,fd);return Promise.reject(Fa)})}catch(Fa){return Promise.reject(null)}};X.prototype.m2b=function(Da,
Sb,hb,Xb,jc){hb=void 0===hb?!1:hb;Xb=void 0===Xb?!1:Xb;jc=void 0===jc?0:jc;return Xb||!vb.EwaSettings.ma(658)||this.Tgh()?this.Yq(Da,Sb,hb,Xb,jc):(Ha.ULS.sendTraceTag(537167819,0,50,"CopyPasteInfrastructure.ClearStateOnlyIfClipboardHasContentFromSameSession clipboard won't be cleared as there is no content in the clipboard from the current session"),Promise.reject(null))};X.prototype.Sya=function(Da,Sb,hb){Ha.ULS.sendTraceTag(590705172,0,50,"CopyPasteInfrastructure.PopupDiscontinuousSelectionErrorDialog: Blocked CCP due to discontinuous selection, reason: {0}",
Sb);var Xb=new kc.a;Xb.ia("reason",Sb);Rb.a(Vb.a.discontinuousSelectionBlocking,[hb?Ic.a.KWi:Ic.a.b3g],!0,!0,!1,!1,Xb);Da=Mb.a.Xc(1,1,754,Da,0,371863010,"DiscontinuousSelectionBlocking");vb.EwaSettings.kz()?new ub.a(this.$,Da):(Da=new Ab.ErrorDialog(this.$,Da),Da.initialize(),Da.gf())};X.prototype.Rpi=function(){var Da=ra(this.kK);return Da&&Da.sourceItem?Object.getType(Da.sourceItem)===ia?2:1:0};X.prototype.dragDropCells=function(Da,Sb,hb,Xb,jc){var Wc=this;jc=void 0===jc?!1:jc;Da.stopwatch=this.$.Fb.sc("UserAction",
"DragDropClientSide");this.Yq("DragDrop/before/"+zb.a[Da.ribbonCommandInfo.method],!1,void 0,void 0,Da.copyPasteTargetType).catch(function(){});var fd=jc?2:1,Tc=0;Tc=jc?4:Xb?256:128;var td={encounteredDeploymentErrors:!1};td.commandParameters=Da;Da.userHash=this.userHash;Da.id=Fb.a.create().toString();return this.dqd?this.Bp.pasteRange(Da.ribbonCommandInfo,ya.q(Sb,this.$),ya.q(hb,this.$),fd,Tc,[Da.stopwatch],td,!1,function(){Ha.ULS.sendTraceTag(537167818,0,50,'CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="{0}"',
Da.copyPasteTargetType);Wc.L7a(Da,fd,Sb,hb,td)},function(Tb){Ha.ULS.sendTraceTag(537167817,0,10,'CopyPasteInfrastructure.DragDropCells: {0}, copyPasteTargetType="{1}"',Tb?Wc.getStringifiedError(Tb):"null",Da.copyPasteTargetType);Wc.g9a(Tb,Da,fd,Sb,hb,td)}).then(function(){Wc.gridView.ha.selectionType=-1;return Promise.resolve(!0)},function(Tb){return Promise.reject(Tb)}):this.Bp.pasteRange(Da.ribbonCommandInfo,ya.q(Sb,this.$),ya.q(hb,this.$),fd,Tc,[Da.stopwatch],td,!1,null,null).then(function(){Ha.ULS.sendTraceTag(521410075,
0,50,'CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="{0}"',Da.copyPasteTargetType);Wc.gridView.ha.selectionType=-1;Wc.L7a(Da,fd,Sb,hb,td);return Promise.resolve(!0)},function(Tb){Ha.ULS.sendTraceTag(521410074,0,10,'CopyPasteInfrastructure.DragDropCells: {0}, copyPasteTargetType="{1}"',Tb?Wc.getStringifiedError(Tb):"null",Da.copyPasteTargetType);Wc.g9a(Tb,Da,fd,Sb,hb,td);return Promise.reject(Tb)})};X.prototype.qhh=function(Da,Sb,hb,Xb,jc){var Wc=this;jc=void 0===jc?!1:jc;Da.stopwatch=
this.$.Fb.sc("UserAction","DragDropReplaceClientSide");this.m2b("DragDropReplace/before/"+zb.a[Da.ribbonCommandInfo.method],!1,void 0,void 0,Da.copyPasteTargetType).catch(function(){});var fd=jc?2:1,Tc=0;Tc=jc?4:Xb?256:128;var td={encounteredDeploymentErrors:!1};td.commandParameters=Da;vb.EwaSettings.getBooleanFeatureGate(eb.a.Z6b,!1)&&(Da.isDragInsert=!1);Da.userHash=this.userHash;Da.id=Fb.a.create().toString();return this.dqd?this.Bp.pasteRange(Da.ribbonCommandInfo,ya.q(Sb,this.$),ya.q(hb,this.$),
fd,Tc,[Da.stopwatch],td,!1,function(){Ha.ULS.sendTraceTag(537167816,0,50,'CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="{0}"',Da.copyPasteTargetType);Wc.L7a(Da,fd,Sb,hb,td)},function(Tb){Ha.ULS.sendTraceTag(537167815,0,10,'CopyPasteInfrastructure.DragDropReplaceCells: {0}, copyPasteTargetType="{1}"',Tb?Wc.getStringifiedError(Tb):"null",Da.copyPasteTargetType);return Wc.g9a(Tb,Da,fd,Sb,hb,td)}).then(function(){Wc.gridView.ha.selectionType=-1;return Promise.resolve(!0)},
function(Tb){return Promise.reject(Tb)}):this.Bp.pasteRange(Da.ribbonCommandInfo,ya.q(Sb,this.$),ya.q(hb,this.$),fd,Tc,[Da.stopwatch],td,!1,null,null).then(function(){Ha.ULS.sendTraceTag(521410073,0,50,'CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="{0}"',Da.copyPasteTargetType);Wc.gridView.ha.selectionType=-1;Wc.L7a(Da,fd,Sb,hb,td);return Promise.resolve(!0)},function(Tb){Ha.ULS.sendTraceTag(521410072,0,10,'CopyPasteInfrastructure.DragDropReplaceCells: {0}, copyPasteTargetType="{1}"',
Tb?Wc.getStringifiedError(Tb):"null",Da.copyPasteTargetType);Wc.g9a(Tb,Da,fd,Sb,hb,td);return Promise.reject(Tb)})};X.prototype.phh=function(Da,Sb,hb,Xb,jc){var Wc=this;jc=void 0===jc?!1:jc;Da.stopwatch=this.$.Fb.sc("UserAction","DragDropInsertClientSide");this.m2b("DragDropInsert/before/"+zb.a[Da.ribbonCommandInfo.method],!1,void 0,void 0,Da.copyPasteTargetType).catch(function(){});var fd=jc?2:1,Tc=ya.K(this.IYc([hb],fd)),td=this.$.ea.pa.sheetName,Tb=this.$.ea.pa.sheetName,Fa=ya.v(Sb,this.$);Fa.SheetName=
td;td=ya.v(Tc,this.$);td.SheetName=Tb;Xb=Tc.isRow||Sb.isRow||Xb?1:0;var Qb={encounteredDeploymentErrors:!1};Da.isDragInsert=!0;Qb.commandParameters=Da;Da.userHash=this.userHash;Da.id=Fb.a.create().toString();if(this.dqd)return jc=this.Bp.xIe(Qb,Fa,td,jc,Xb,Da.ribbonCommandInfo,function(){Ha.ULS.sendTraceTag(537167814,0,50,'CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="{0}"',Da.copyPasteTargetType);Wc.L7a(Da,fd,Sb,hb,Qb)},function(bc){Ha.ULS.sendTraceTag(537167813,0,10,
'CopyPasteInfrastructure.DragDropInsertCells: {0}, copyPasteTargetType="{1}"',bc?Wc.getStringifiedError(bc):"null",Da.copyPasteTargetType);Wc.g9a(bc,Da,fd,Sb,hb,Qb)}),Va.c(jc.then(function(){Wc.gridView.ha.selectionType=-1;return Promise.resolve(!0)},function(bc){return Promise.reject(bc)})).Io(function(){return!0});jc=this.Bp.xIe(Qb,Fa,td,jc,Xb,Da.ribbonCommandInfo,null,null);var cc=this;return Va.c(jc.then(function(){Ha.ULS.sendTraceTag(521410071,0,50,'CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="{0}"',
Da.copyPasteTargetType);Wc.gridView.ha.selectionType=-1;Wc.L7a(Da,fd,Sb,hb,Qb);return Promise.resolve(!0)},function(bc){Ha.ULS.sendTraceTag(521410070,0,10,'CopyPasteInfrastructure.DragDropInsertCells: {0}, copyPasteTargetType="{1}"',bc?cc.getStringifiedError(bc):"null",Da.copyPasteTargetType);cc.g9a(bc,Da,fd,Sb,hb,Qb);return Promise.reject(bc)})).Io(function(){return!0})};X.prototype.gbi=function(Da,Sb){var hb=this,Xb=ra(this.kK);if(!Xb)return Ha.ULS.sendTraceTag(537167812,0,50,"InsertCopiedCutCells: CopyContext must not be null or undefined"),
xb.Task.Ua(!1);if(!qa(Xb.sourceItem))return Ha.ULS.sendTraceTag(537167811,0,50,"InsertCopiedCutCells: CopyContext must be a Range"),xb.Task.Ua(!1);var jc=Xb.sourceItem;if(!jc)return Ha.ULS.shipAssertTag(537167810,0,!!jc,"InsertCopiedCutCells: rangeSourceItem must not be null or undefined"),xb.Task.Ua(!1);if(!jc.isFromCurrentSession(this.$))return Ha.ULS.sendTraceTag(537167809,0,50,"InsertCopiedCutCells: rangeSourceItem is from a different session"),xb.Task.Ua(!1);if(1<jc.ranges.length)return Ha.ULS.sendTraceTag(537167808,
0,50,"InsertCopiedCutCells: multiple source ranges are not supported"),this.Sya(2162,"InsertCopiedCutCells",!0),xb.Task.Ua(!1);Xb=ya.K(jc.ranges);var Wc=this.gridView.ha.sa.Vc.clone();Da=ya.K(this.IYc([Wc],Da));var fd=this.wif();jc=jc.sheetName;Wc=this.$.ea.pa.sheetName;var Tc=ya.v(Xb,this.$);Tc.SheetName=jc;var td=ya.v(Da,this.$);td.SheetName=Wc;return(Da.Te||Xb.Te?xb.Task.Ua(0):Da.isRow||Xb.isRow?xb.Task.Ua(1):this.hbi.d4b(this.$,ha.g(this.$).rtl)).Io(function(Tb){return hb.Bp.executeInsertCopiedCutCellsOperation(Tc,
td,fd,Tb.result,Sb)}).continueWith(function(){fd?hb.Bp.cxb():hb.Yq("InsertCopiedCutCells/success/"+zb.a[Sb.method],!0)})};X.prototype.Nnd=function(){var Da=ra(this.kK),Sb=this.gridView.ha.sa.sg;return!!Da&&qa(Da.sourceItem)&&Sb&&1===Da.sourceItem.ranges.length};X.prototype.wif=function(){return this.xif(-911352779)};X.prototype.Pic=function(){return this.xif(-1985798686)};X.prototype.VYc=function(Da,Sb){var hb=new Db.a(this.$.va),Xb=36===Da,jc=hb.Ud(4);Da=2===this.aBb()&&hb.Ud(1);Xb=Xb&&jc;hb=!hb.fj||
!this.Pic()||!Db.a.N6b(Sb,ha.g(this.$));return Xb||Da||this.$.hq(Sb,!0)&&hb};X.prototype.egc=function(Da,Sb){return this.Bp.egc(Da,Sb)};X.prototype.dispose=function(){tb.prototype.dispose.call(this);this.Tj();this.kK.removeMetadataChangeListener(X.Zof)};X.prototype.X5c=function(Da,Sb,hb,Xb,jc,Wc){if(!this.iYg(Da.commandParameters.ribbonCommandInfo.command))return Da.cseStatus=2,!1;if(Wc&&Sb.xd(Xb))return Da.cseStatus=4,!1;if(hb!==jc)return Da.cseStatus=6,!1;if(vb.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests")&&
(Xb.width%Sb.width||Xb.height%Sb.height))return Da.cseStatus=16,!1;if(vb.EwaSettings.getBooleanFeatureGate(eb.a.oEe,!1)){if(hb=Sb,Xb=Xb.ze(this.gridView.Ug),Sb=null===Sb.ze(this.gridView.Ug),jc=Da.commandParameters.ribbonCommandInfo.command,Sb&&1804571062!==jc&&-185374993!==jc||!Xb)return Da.cseStatus=7,!1}else if(hb=Sb.ze(this.gridView.Ug),Xb=Xb.ze(this.gridView.Ug),!hb||!Xb)return Da.cseStatus=7,!1;Sb=ya.v(hb,this.$);Sb=this.Fg.OWi(this.gridView,Sb,ya.v(Xb,this.$),Da.commandParameters.ribbonCommandInfo.command,
Da.commandParameters.stopwatch);1===Sb&&(Wc&&(this.Fg.J_c(hb,!1),this.Fg.J_c(hb,!0)),-185374993===Da.commandParameters.ribbonCommandInfo.command&&ha.g(this.$).l3i(),this.pasteIndicationManager.Aid(Da.commandParameters.id),this.yuc(Da.commandParameters.expandDestinations,Da.commandParameters.isPasteCommandFromRecoveryUI),this.Txe("DoPasteClientEstimation/"+zb.a[Da.commandParameters.ribbonCommandInfo.method],Da));Da.cseStatus=Sb;return 1===Sb};X.prototype.tGf=function(){this.copyPasteShortcutDialogFactory.create(this.$).showDialog(!0,
!1,!1,this.Fvi)};X.prototype.mlf=function(Da,Sb,hb,Xb){Da=za(Da,Sb,hb,Xb,this.$.ya.UserSessionId);Da.k=!0;Cb.b().Ce(45,Da,!0)};X.prototype.fAf=function(Da,Sb,hb,Xb,jc){var Wc=!1,fd=!1,Tc=X.Prb,td=X.tIe+X.CIa;Da&&(td+=X.PJa(Da),Mb.a.Uq(Da.ewaErrors)?(Tc=this.Iac(Da.ewaErrors),Mb.a.Zg(Da.ewaErrors,[-103190598])&&(Wc=!0)):Da.message&&(Tc=Da.message));fd||(fd=this.Ymd(Da));Sb=za(Sb,hb,Xb,jc,this.$.ya.UserSessionId);Sb.k=!1;Sb.l=fd;Sb.n=Tc;Sb.p=td;Sb.q=Wc;Cb.b().Ce(45,Sb,!0);return Promise.reject(Da)};
X.prototype.iYg=function(Da){switch(Da){case 237279923:case 808159687:return eb.a.Rji;case -185374993:return!0;case 1804571062:return!0;default:return!1}};X.prototype.xif=function(Da){var Sb=ra(this.kK);if(!Sb)return!1;var hb=Sb.sourceItem;return hb&&!hb.isFromCurrentSession(this.$)?(Ha.ULS.sendTraceTag(537167779,0,50,"CopyPasteInfrastructure.LastOperationWasCopyCut: Last copy operation was from a different session."),!1):Sb.commandParameters.ribbonCommandInfo.command===Da};X.prototype.Tgh=function(){var Da=
ra(this.kK);return Da?(Da=Da.sourceItem)&&!Da.isFromCurrentSession(this.$)?(Ha.ULS.sendTraceTag(537167778,0,50,"CopyPasteInfrastructure.DoesClipboardHaveCopiedOrCutContent: Last copy/cut operation was from a different session."),!1):!0:!1};X.prototype.svj=function(Da){return Da&&Da.lastCopy?ua(Da.lastCopy,this.$):!0};X.prototype.AXe=function(Da,Sb,hb,Xb,jc){var Wc={};Wc.a=this.$.ya.UserSessionId;Wc.e=Da.stopwatch.id;Wc.c=Cb.b().ei(Da.ribbonCommandInfo.command);Wc.b=zb.a[Da.ribbonCommandInfo.method];
Wc.d=Da.id;Wc.f=hb.toString();Wc.g=Xb.toString();Wc.h=Sb.toString();Wc.o=Da.stopwatch.qc;Wc.q=!1;Wc.r=Da.copyPasteTargetType.toString();Wc.s=jc.encounteredDeploymentErrors;vb.EwaSettings.getBooleanFeatureGate(eb.a.Z6b,!1)&&(Wc.i=jc.commandParameters.dragDropIsShiftKeyDown,Wc.j=jc.commandParameters.isDragInsert);return Wc};X.prototype.L7a=function(Da,Sb,hb,Xb,jc){Da=this.AXe(Da,Sb,hb,Xb,jc);Da.k=!0;Cb.b().Ce(45,Da,!0)};X.prototype.Qti=function(Da,Sb,hb,Xb,jc,Wc,fd,Tc,td){Da=this.AXe(Da,Sb,hb,Xb,td);
Da.k=!1;Da.l=jc;Da.n=Wc;Da.p=fd;Da.q=Tc;Cb.b().Ce(45,Da,!0)};X.prototype.Dkf=function(Da,Sb,hb,Xb,jc,Wc,fd,Tc,td){var Tb={};Tb.a=this.$.ya.UserSessionId;Tb.b=Sb;Tb.c=Da;Tb.f=hb;Tb.e=Xb;Tb.d=jc;Tb.g=Wc;Tb.h=fd;Tb.i=Tc;Tb.j=td.toString();Cb.b().Ce(46,Tb,!0)};X.prototype.Iti=function(Da,Sb){Da=this.ZWe(Da.commandParameters,Da);Da.l=!0;Da.j=Sb;Cb.b().Ce(43,Da,!0)};X.prototype.Hti=function(Da,Sb,hb,Xb,jc,Wc,fd){Da=this.ZWe(Da,fd);Da.l=!1;Da.m=Sb;Da.o=hb;Da.y=Xb;Da.x=jc;Da.z=Wc;Cb.b().Ce(43,Da,!0);Ha.ULS.sendTraceTag(537167776,
0,15,"CopyPasteInfrastructure.LogCopyFailedTelemetry: ErrorName={0},ErrorReason={1},IsExpectedError={2},IsSucceededWithAlert={3},ErrorMessage={4}",Da.y,Da.x,Da.m,Da.z,Da.o)};X.prototype.ZWe=function(Da,Sb){var hb={};hb.a=this.$.ya.UserSessionId;hb.f=Da.stopwatch.id;hb.g=Da.id;hb.c=Cb.b().ei(Da.ribbonCommandInfo.command);hb.b=zb.a[Da.ribbonCommandInfo.method];hb.q=Da.stopwatch.qc;hb.bd=X.Q$b();hb.bg=Da.copyPasteHandlerName;hb.bj=void 0===Da.ribbonCommandInfo.Le||null===Da.ribbonCommandInfo.Le?null:
kb.a[Da.ribbonCommandInfo.Le];hb.bq=Da.uploadToClipService;hb.br=Da.floatingObjectType;hb.s=Da.copyPasteTargetType.toString();hb.bc=va(Da.copyPasteTargetType);hb.z=!1;if(Sb){hb.bk=Sb.id;hb.bl=Sb.serverRequestTimeInMs;Sb.requestTelemetryData&&(hb.bm=Sb.requestTelemetryData.EcsOperationDuration,hb.bn=Sb.requestTelemetryData.EcsRequestDuration,hb.bo=Sb.requestTelemetryData.WfeRequestDuration);hb.d=Sb.sourceItem?Sb.sourceItem.toString():null;hb.e=-1;if(qa(Sb.sourceItem)){hb.e=0;Da=bk(Sb.sourceItem.ranges);
for(var Xb=Da.next();!Xb.done;Xb=Da.next())hb.e+=Xb.value.EG}hb.h=Sb.isAsyncCopy;hb.i=Sb.isFromCache;hb.k=Sb.isSelectionAllowed;hb.r=Sb.plainTextPayloadSize;hb.u=Sb.htmlPayloadSize;hb.v=Sb.htmlSizeExceedsLimit;hb.w=Sb.copyTotalSizeExceedsLimit;hb.t=Sb.shadowWorkbookPayloadSize;hb.p=Sb.clientSideCopyTime;hb.ba=Sb.encounteredDeploymentErrors;hb.bb=Sb.shadowWorkbookSizeExceedsLimit;hb.be=Sb.syncClipboardItemsKeys;hb.bf=Sb.asyncClipboardItemsKeys;hb.bh=this.hBe(Sb.succeededPopulatingSystemClipboardSync);
hb.bi=this.hBe(Sb.succeededPopulatingSystemClipboardAsync)}return hb};X.prototype.yuc=function(Da,Sb){Sb=void 0===Sb?!1:Sb;if(!this.gridView.isEditing&&!this.gridView.ui){var hb=this.gridView.ha.sa,Xb=!Sb&&1===Da.length&&ya.Q(Da,hb.selectedRanges),jc=Xb?hb.activeCell:Da[0].topLeft;Da[0].contains(jc)||(Ha.ULS.shipAssertTag(537167775,0,!1,"CopyPasteInfrastructure.SelectPastedRange: SelectedRanges {0}, IndexOfActiveRange {1}, ActiveCell {2}, calculatedDestinationRanges {3}, keepThePreviousActiveCell {4}, newActiveCell {5}, isPasteCommandFromRecoveryUI {6}",
hb.selectedRanges,hb.Vs,hb.activeCell,Da,Xb,jc,Sb),jc=Da[0].topLeft);this.gridView.ha.xB(Da,0,jc,0,void 0,jb.a.g3g)}};X.prototype.K_e=function(Da,Sb){var hb={};hb.a=this.$.ya.UserSessionId;hb.g=Da.stopwatch.id;hb.t=Da.stopwatch.qc;hb.bz=!1;Sb&&(hb.bv=Sb.id,hb.bw=Sb.serverRequestTimeInMs,hb.n=Sb.commandParameters.clipboardFormatReadTimes,hb.o=Sb.commandParameters.clipboardFormatReadStatus,hb.p=Sb.commandParameters.clipboardReadPermissionPromptShown,hb.q=Sb.commandParameters.asyncApiReadTimedOut,Sb.requestTelemetryData&&
(hb.cb=Sb.requestTelemetryData.EcsOperationDuration,hb.cc=Sb.requestTelemetryData.EcsRequestDuration,hb.cd=Sb.requestTelemetryData.WfeRequestDuration));hb.x=Da.copyPasteTargetType.toString();hb.bl=va(Da.copyPasteTargetType);hb.br=Da.copyPasteHandlerName;hb.i=ya.i(Da.expandDestinations,",",this.$,!1);hb.h=ya.i(Da.originalDestinations,",",this.$,!1);hb.e=Da.id;hb.d=Da.commandType;hb.c=Cb.b().ei(Da.ribbonCommandInfo.command);hb.b=zb.a[Da.ribbonCommandInfo.method];hb.bf=!1;hb.bg=!1;hb.bp=X.Q$b();hb.bt=
void 0===Da.ribbonCommandInfo.Le||null===Da.ribbonCommandInfo.Le?null:kb.a[Da.ribbonCommandInfo.Le];hb.cj=Da.isPasteCommandFromEnterShortcut;if(hb.ca=Da.isPasteCommandFromRecoveryUI)hb.cf=Da.pasteRecoveryUndoStopwatch.id,hb.cg=Da.pasteRecoveryUndoStopwatch.qc;if(Sb){if((Da=Sb.copyContextSnapshot)&&!Sb.wasLastCopyExternal){hb.f=Da.commandParameters.id;hb.j=Da.sourceItem.toString();hb.k=-1;if(qa(Da.sourceItem)){hb.k=0;for(var Xb=bk(Da.sourceItem.ranges),jc=Xb.next();!jc.done;jc=Xb.next())hb.k+=jc.value.EG}hb.bg=
1===Da.commandParameters.commandType}else Sb.clipboardItems?hb.f=Sb.clipboardItems.getItem(xa.Jqb):Ha.ULS.sendTraceTag(537167774,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext.ClipboardItems is null");hb.bz=Sb.pasteRecoveryUIDisplayed;hb.ci=Sb.cseStatus}else Ha.ULS.sendTraceTag(537167773,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext is null");return hb};X.prototype.Wui=function(Da,Sb,hb,Xb,jc,Wc,fd,Tc,td){Da=this.K_e(Da,Tc);Da.l=!1;Da.m=Sb;Da.s=hb;Da.bc=Xb;Da.be=jc;
Da.bd=Wc;Da.bf=fd;Tc?(Da.y=Ga(Tc)||!Tc.copyContextSnapshot,Da.bi=!Da.y&&ua(Tc.copyContextSnapshot,this.$),Da.bj=Tc.shadowWorkbookSizeExceedsLimit,Da.v=Tc.shadowWorkbookPayloadSize,Da.w=Tc.htmlPayloadSize,Da.bq=ja(Tc.clipboardItems),Da.bb=Tc.activeSelectionType,Da.bs=Tc.isSameSession,Da.bn=Tc.payloadOrigin,Da.bo=Tc.payloadType,Da.bu=Tc.externalAppSource,Da.bx=Tc.indicationDisplayScheduled,Da.by=Tc.pasteIndicationDisplayStatus,Da.ck=Tc.pasteDestinationHasMergedCells):Da.bi=ua(td,this.$);Cb.b().Ce(44,
Da,!0);Ha.ULS.sendTraceTag(537167772,0,15,"CopyPasteInfrastructure.LogPasteFailedTelemetry: ErrorName={0},ErrorReason={1},IsExpectedError={2},IsSucceededWithAlert={3},ErrorMessage={4}",Da.be,Da.bd,Da.m,Da.bf,Da.s)};X.prototype.Xui=function(Da){var Sb=this.K_e(Da.commandParameters,Da);Sb.y=Da.wasLastCopyExternal;Sb.l=!0;Sb.u=Da.plainTextPayloadSize;Sb.v=Da.shadowWorkbookPayloadSize;Sb.w=Da.htmlPayloadSize;Sb.z=Da.isClipboardDataContainShadowWorkbook;Sb.ba=Da.isShadowWorkbookParsedSuccessfully;Sb.bb=
Da.activeSelectionType;Sb.bc=Da.pasteResult;Sb.bh=Da.encounteredDeploymentErrors;Sb.bj=Da.shadowWorkbookSizeExceedsLimit;Sb.bk=db(Da);Sb.bq=ja(Da.clipboardItems);Sb.bs=Da.isSameSession;Sb.bn=Da.payloadOrigin;Sb.bo=Da.payloadType;Sb.bu=Da.externalAppSource;Sb.bx=Da.indicationDisplayScheduled;Sb.by=Da.pasteIndicationDisplayStatus;Sb.ck=Da.pasteDestinationHasMergedCells;Sb.bm=Da.clipboardItems?Da.clipboardItems.getItem(xa.VWg):null;Sb.bi=!Da.isSameSession&&!Da.wasLastCopyExternal;Cb.b().Ce(44,Sb,!0)};
X.prototype.Pi=function(){this.$.va.If(this.uh);this.$.va.xme(this.Zmc);this.$.userOperationManager.zr(this.kR);this.$.Tk(this.Yc);ha.g(this.$).Wb.Ak(this.VEb)};X.prototype.Tj=function(){this.$&&this.$.va&&(this.$.va.vg(this.uh),this.$.va.tPf(this.Zmc));this.$&&this.$.userOperationManager&&this.$.userOperationManager.so(this.kR);this.gridView&&this.gridView.Wb&&this.gridView.Wb.vk(this.VEb)};X.prototype.HEb=function(Da,Sb){var hb=null,Xb=!1,jc=null,Wc="UnknownFailure",fd=-1,Tc=X.Prb,td=X.pasteErrorName+
X.CIa,Tb=!1;this.pasteIndicationManager.Aid(Da.id);this.Gdf&&this.pasteDestinationHasMergedCells(Da.expandDestinations)&&(Sb.pasteContext.pasteDestinationHasMergedCells=!0);var Fa=ra(this.kK);(Da.clearStateOnFinish||Da.clearSystemClipboard)&&this.Yq("Paste/fail/"+zb.a[Da.ribbonCommandInfo.method],!0,void 0,void 0,Da.copyPasteTargetType).catch(function(){});if(Sb){fd=Sb.reason;td+=X.PJa(Sb);Sb.message&&(Tc=Sb.message);if(hb=X.v2g(Sb))if(1===hb.pasteErrorName)Xb=!0,Wc="CopyPasteLengthTooLongPopup",
Tc=jc="The pasted content is too long. Popup a dialog to the user.",Ha.ULS.sendTraceTag(25216992,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0}, copyPasteTargetType="{1}"',jc,Da.copyPasteTargetType),hb=Mb.a.Xc(1,0,26,693,0,1306609195,"CopyPasteOversizeError"),vb.EwaSettings.kz()?new ub.a(this.$,hb):(hb=new Ab.ErrorDialog(this.$,hb),hb.initialize(),hb.gf());else if(7===hb.pasteErrorName)Xb=!0,Wc="No-Op",Tc=jc="The shadow workbook is not ready yet and an async copy failed to populate the clipboard. Do nothing (by the spec)",
Ha.ULS.sendTraceTag(33948251,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0}, copyPasteTargetType="{1}"',jc,Da.copyPasteTargetType);else if(8===hb.pasteErrorName)Xb=!0,Wc="UseShortcutsPopup",Tc=jc="Unable to paste content from the system clipboard. Popup dialog to the user.",Ha.ULS.sendTraceTag(25216994,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0}, copyPasteTargetType="{1}"',jc,Da.copyPasteTargetType),this.tGf();else if(18===hb.pasteErrorName){Xb=!0;Wc="PasteExternalNotSupportMultipleSelectionPopup";
Tc="Paste external not support multiple selection.";jc="Unknown";var Qb=2162;100!==hb.validationFailureReason&&(jc=Ua[hb.validationFailureReason],Qb=X.aBe(hb.validationFailureReason));this.Sya(Qb,jc,!0)}else 20===hb.pasteErrorName||19===hb.pasteErrorName?(Xb=!0,20===hb.pasteErrorName?(Wc="PasteAcrossSessionNotSupportMultipleSelectionPopup",Tc="Paste across session does not support multiple selection."):(Wc="PasteInSameSessionNotSupportMultipleSelectionPopup",Tc="This kind of multiple selection is not supported for same session paste."),
jc="Unknown",Qb=2162,100!==hb.validationFailureReason&&(jc=Ua[hb.validationFailureReason],Qb=X.aBe(hb.validationFailureReason)),hb=6===hb.validationFailureReason,this.VYc(Da.commandType,Da.expandDestinations)&&hb&&this.yuc(Da.expandDestinations),this.Sya(Qb,jc,!0)):6===hb.pasteErrorName?(Xb=!0,Wc="No-Op",Tc=jc="Paste Formatting/Transpose is not yet a supported operation on System Clipboard based content",Ha.ULS.sendTraceTag(36263241,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0}, copyPasteTargetType="{1}"',
jc,Da.copyPasteTargetType)):17===hb.pasteErrorName?(Xb=!0,Wc="No-Op",Tc=jc="Paste text on Art is not yet a supported operation",Ha.ULS.sendTraceTag(0,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0}, copyPasteTargetType="{1}"',jc,Da.copyPasteTargetType)):16===hb.pasteErrorName?(Xb=!0,Wc="No-Op",Tc=jc="Paste has failed because the previous copy has failed",Ha.ULS.sendTraceTag(537167771,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0}, copyPasteTargetType="{1}", error={2}',jc,Da.copyPasteTargetType,
this.getStringifiedError(hb))):Mb.a.Uq(hb.ewaErrors)?(Mb.a.T9(hb.ewaErrors)||Mb.a.Zg(hb.ewaErrors,Mb.a.qcc())?(Xb=!0,Wc="CommunicationError",jc=Mb.a.Ec(hb.ewaErrors),Ha.ULS.sendTraceTag(36304159,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0} copyPasteTargetType="{1}"',Tc,Da.copyPasteTargetType)):Mb.a.Zg(hb.ewaErrors,X.ujj)?(Xb=!0,Wc="SavingWorkbookError",jc=Mb.a.Ec(hb.ewaErrors),Ha.ULS.sendTraceTag(36304160,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0} copyPasteTargetType="{1}"',Tc,Da.copyPasteTargetType)):
Mb.a.Zg(hb.ewaErrors,X.operationSucceededWithAlert)&&(Tb=Xb=!0,Wc="OperationSucceededWithAlert",jc=Mb.a.Ec(hb.ewaErrors),Ha.ULS.sendTraceTag(36304161,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0} copyPasteTargetType="{1}"',Tc,Da.copyPasteTargetType)),Xb||(Tc=this.Iac(hb.ewaErrors),Xb=this.Ymd(Sb))):11===hb.pasteErrorName&&(Xb=!0,Wc="No-Op",Tc="Paste has failed because user try copy cross-session oart object");15===Sb.reason&&(Xb=!0,Wc="No-Op",Tc="Rejecting deferred paste there is metadata update without copy context. Usually it means that copy canceled before finished.");
Zb.a.equals(td,da.aUj,!1)&&(Xb=!0,Wc="No-Op",Tc="User hash of the copy is different then the user hash of the paste during cross-session copy-paste. Do nothing.")}Xb||Ha.ULS.sendTraceTag(24150916,0,10,'CopyPasteInfrastructure.OnPasteFailed: {0}, copyPasteTargetType="{1}"',Sb?this.getStringifiedError(Sb):"null",Da.copyPasteTargetType);this.Wui(Da,Xb,Tc,Wc,td,fd,Tb,Sb.pasteContext,Fa);return Promise.reject(Sb)};X.prototype.ync=function(Da,Sb){var hb;Ha.ULS.sendTraceTag(24150917,0,50,'CopyPasteInfrastructure.OnPasteSuccess: paste succeed. copyPasteTargetType="{0}"',
Sb.copyPasteTargetType);this.pasteIndicationManager.Aid(Sb.id);if(this.TWi(Sb.copyPasteTargetType,Da)){vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!La.a.HC&&Da.wasLastCopyExternal&&Da.payloadType===ba.shadowWorkbook&&(this.H6a=!0);var Xb=null;(null===(hb=Da.pastedRange)||void 0===hb?0:hb.Ranges)&&0<Da.pastedRange.Ranges.length?Xb=ya.g(Da.pastedRange.Ranges):Da.wasLastCopyExternal||(Xb=Sb.expandDestinations);this.elj(Da,Xb);if(this.lxj(Da,Xb)){hb=
Yb.a.clone(Sb.originalDestinations);Xb=1028===Sb.commandType?Yb.a.clone(Sb.expandDestinations):Yb.a.clone(Xb);var jc=null;Da.wasLastCopyExternal&&(Sb.isKeyboardEvent||Sb.isPasteCommandFromRecoveryUI)&&(jc={},jc=(jc[X.iFf]=Da.clipboardItems,jc));this.Gdf&&this.pasteDestinationHasMergedCells(Sb.expandDestinations)&&(Da.pasteDestinationHasMergedCells=!0);Da.pasteRecoveryUIDisplayed=!0;var Wc=new oa(this.$,hb,Xb,jc),fd=pa.GetServiceTaskFactory.Ra(this.$.da,406,405,0);Kb.TaskExtensions.Aa(fd,function(){var Tc=
fd.result;Tc.HNg(Wc);Tc.uAj(Sb.ribbonCommandInfo.method)},this.la,8)}}this.Txe("Paste/success/"+zb.a[Sb.ribbonCommandInfo.method],Da);this.Xui(Da);this.B1f&&(!Sb.isKeyboardEvent||db(Da))&&this.$.ea.Jg.get(66)&&(Ha.ULS.sendTraceTag(537167770,0,15,"CopyPasteInfrastructure.OnPasteSuccess: show localStorage disable notification"),this.B1f=!1,this.Y3g());return Promise.resolve(!0)};X.prototype.lxj=function(Da,Sb){return!Sb||1!==Sb.length||Da.commandParameters.clearSystemClipboard||Da.commandParameters.clearStateOnFinish||
Da.commandParameters.skipClipboardAccess?!1:Ga(Da)&&(Sb=Da.clipboardItems.getItem(xa.plainText),Da=Da.clipboardItems.getItem(xa.html),void 0===Sb||null===Sb||Sb.length>this.Xud||void 0===Da||null===Da||Da.length>this.Lxa)?(Ha.ULS.sendTraceTag(537167769,0,50,"CopyPasteInfrastructure.ShouldShowPasteRecoveryUI: Not showing PasteRecoveryUI for external copy."),!1):!0};X.prototype.TWi=function(Da,Sb){return 1===Da||Sb.payloadType===ba.plainText||vb.EwaSettings.ma(162)&&Sb.payloadType===ba.html||vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!La.a.HC&&Sb.payloadType===ba.shadowWorkbook};X.prototype.pasteDestinationHasMergedCells=function(Da){var Sb=ha.g(this.$).Ea.FE();if(!Sb||!Sb.length)return!1;Sb=bk(Sb);for(var hb=Sb.next();!hb.done;hb=Sb.next())if(hb.value.ew(Da[0]))return!0;return!1};X.prototype.Txe=function(Da,Sb){var hb=this,Xb;(function(){var jc=hb.cfi(Sb);Xb=jc.LGa;return jc})().returnValue&&this.Yq(Da,Xb,void 0,void 0,Sb.commandParameters.copyPasteTargetType).catch(function(){})};X.prototype.g9a=function(Da,Sb,hb,Xb,jc,
Wc){Ha.ULS.sendTraceTag(24150918,0,10,"CopyPasteInfrastructure.OnDragAndDropCellsFailed: {0}",Da?this.getStringifiedError(Da):"null");var fd=!1,Tc=!1,td=!1,Tb=X.Prb,Fa=X.tIe+X.CIa;Da&&(Fa+=X.PJa(Da),Mb.a.Uq(Da.ewaErrors)?(Tb=this.Iac(Da.ewaErrors),Mb.a.Zg(Da.ewaErrors,X.operationSucceededWithAlert)&&(fd=!0),Mb.a.Zg(Da.ewaErrors,X.dragDropNonEmptyRange)&&(Tc=td=!0)):Da.message&&(Tb=Da.message));td||(td=this.Ymd(Da));Tc?this.gridView.ha.selectionType=-1:this.Bp.n6i(jc);this.Qti(Sb,hb,Xb,jc,td,Tb,Fa,
fd,Wc)};X.prototype.IYc=function(Da,Sb){var hb=Da,Xb=this.uQh();if(null===Xb||void 0===Xb?0:Xb.ranges)hb=this.Bp.hTg(Sb,Xb.ranges,Da);return hb};X.prototype.uQh=function(){var Da=ra(this.kK);return Da&&qa(Da.sourceItem)?Da.sourceItem:null};X.prototype.A3i=function(){this.raiseEvent(X.PAd,null)};X.prototype.elj=function(Da,Sb){var hb=Da.commandParameters.originalDestinations;Sb&&(ya.Q(this.gridView.ha.sa.selectedRanges,hb)?(this.yuc(Sb),Ha.ULS.sendTraceTag(537167767,0,50,"CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range, range: {0}",
Za.HelperMethods.Wnb(Sb))):Da.commandParameters.isPasteCommandFromRecoveryUI?(this.yuc(Sb,!0),Ha.ULS.sendTraceTag(537167766,0,50,"CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range for IsPasteCommandFromRecoveryUI, range: {0}, active cell: {1}",Sb,Sb[0].topLeft)):Ha.ULS.sendTraceTag(537167765,0,50,"CopyPasteInfrastructure.SelectPastedRangeIfNeeded: user change his selection during paste operation. don't change selection. originalPasteDestinations: {0}",Za.HelperMethods.Wnb(hb)))};
X.prototype.cfi=function(Da){if(Da.isPlainTextPaste||Da.isHtmlPaste||Ka(Da)||Da.commandParameters.isPasteCommandFromEnterShortcut)return{returnValue:!0,LGa:!1};var Sb=Da.copyContextSnapshot;if(Da.commandParameters.clearStateOnFinish)return{returnValue:!0,LGa:!0};if(Sb&&qa(Sb.sourceItem)){var hb=Sb.sourceItem;if(!hb.isFromCurrentSession(this.$))return{returnValue:!1,LGa:!0};Sb=-1985798686===Sb.commandParameters.ribbonCommandInfo.command;if(!(1<hb.ranges.length||1<Da.commandParameters.expandDestinations.length)){var Xb=
ya.K(hb.ranges);Da=ya.K(Da.commandParameters.expandDestinations);var jc=this.$.ea.pa.sheetName;hb=hb.sheetName;if(hb===jc&&Da.equals(Xb))return{returnValue:!1,LGa:!0};if(hb===jc&&Da.ze(Xb))return{returnValue:!0,LGa:!1}}return{returnValue:Sb,LGa:!0}}return{returnValue:!1,LGa:!0}};X.prototype.mCf=function(){var Da=ra(this.kK);(Da=this.Bp.Pvb(Da))&&Da.isFromCurrentSession(this.$)&&this.Yq("OnStartEdit",!1).catch(function(){})};X.prototype.Iac=function(Da){Da=Mb.a.gNh(Da,X.CIa);return this.Hzi+ib.a.Kv(Da).toString()};
X.prototype.Ymd=function(Da){Da=X.PJa(Da);return!!Da&&Zb.a.D1a(Da,X.Gzi)};X.prototype.Y3g=function(){var Da=Mb.a.Xc(1,2,332,333,La.a.Uo?334:La.a.xH?335:336,530046625,"ActivateLocalStorage"),Sb=pa.GetServiceTaskFactory.Ra(this.$.da,5,4,0);Kb.TaskExtensions.Aa(Sb,function(){Sb.result.Tf(42,Da)},this.la,3)};X.prototype.hBe=function(Da){return void 0===Da||null===Da?Xa.fDi:Da?Xa.success:Xa.failed};X.v2g=function(Da){var Sb=Da.innerError;return Sb&&0!==Sb.pasteErrorName?Da.innerError:null};X.i2g=function(Da){var Sb=
Da.innerError;return Sb&&0!==Sb.copyErrorName?Da.innerError:null};X.PJa=function(Da){var Sb="";if(!Da)return X.yFe;Da.errorName&&(Sb=Da.errorName,Da.innerError&&(Sb+=X.CIa+X.PJa(Da.innerError)));Sb||(Sb=Da&&Da.name?Da.name:X.yFe);return Sb};X.Q$b=function(){X.XLb||(Qa.a.Xdf()?X.XLb=aa.HBj:Qa.a.jod()?X.XLb=aa.GBj:X.XLb=aa.FBj);return X.XLb};X.aBe=function(Da){switch(Da){case 7:case 1:return 2169;case 5:return 2166;case 6:return 2165;case 8:case 3:case 2:case 4:case 9:case 10:return 2162;default:return Ha.ULS.shipAssertTag(537167764,
0,!1,"CopyPasteInfrastructure.ConvertPasteValidationOptionToJsStringId: no case for validationOptions = {0}",Da),2169}};X.j2g=function(Da){switch(Da){case 3:return 2163;case 1:return 2164;case 2:case 4:return 2162;default:return Ha.ULS.shipAssertTag(537167763,0,!1,"CopyPasteInfrastructure.ConvertCopySourceValidationOptionToJsStringId: no case for validationOptions = {0}",Da),2169}};Mf.Object.defineProperties(X.prototype,{pasteIndicationManager:{configurable:!0,enumerable:!0,get:function(){return this.$.da.za(373)}}});
X.Zof="EwaJsMetadataChangeListenerId";X.PAd="cpiOSC";X.och="cpiDID";X.Prb="Unknown";X.yFe="UnknownError";X.CIa="_";X.tIe="DragAndDropError";X.pasteErrorName="PasteError";X.jUg="CancelError";X.copyErrorName="CopyError";X.Gzi="MergedCellOverlap";X.iFf="PasteRecoveryCachedClipboardItems";X.ujj=[1352631530,1679665408];X.operationSucceededWithAlert=[-103190598];X.pasteDataLimitHit=[1306609195];X.copyThrottlingError=[-386183710];X.dragDropNonEmptyRange=[563945982];X.XLb=null;Object(V.a)(X,"CopyPasteInfrastructure",
Wa.a,[733,734,3]);Object(V.a)(wa,"ClipboardPlatformInitializationResult",null,[]);var fb=b(202),ac=b(737),Ac=b(616),Rc=b(127),Fc=b(5),wb=b(62);Object(V.a)(ka,"MacroRecorderPasteRangePayload",null,[438]);P.prototype.getContent=function(){return this.content};Object(V.a)(P,"MacroRecorderPasteStringPayload",null,[438]);var uc=b(64);Object(V.a)(Q,"MacroRecorderPastePayload",null,[438]);var Pb=b(646),sc=b(974),nb=b(564),pc=b(177),Dc=b(216),oc=b(121),Gc=b(294),ld=b(354);C.prototype.getParameters=function(){return this.parameters};
Object(V.a)(C,"MacroRecorderRangeCopyCutCellsInsertedPayload",null,[438]);var gd=b(388);Object(V.a)(M,"PasteHtmlRequestParams",null,[]);N.prototype.copy=function(Da,Sb,hb,Xb,jc){function Wc(Tb,Fa,Qb){var cc={CopyPasteTargetType:1};cc.SourceRanges=Da;cc.CopyOperationId=Sb.id;Ha.ULS.sendTraceTag(537167756,0,50,"CopyPasteInfrastructure.Copy served from CopyPasteProxy : {0}, CopyOperationId : {1}",fd.xwa,cc.CopyOperationId);fd.MMa=fd.xwa?fa(fd.$.oa.Pv,cc,Gc.b(Tb,hb),Xb?Gc.a(Fa,Xb):Fa,Qb,Sb.ribbonCommandInfo,
Tc,jc):fa(fd.$.oa.xa,cc,Gc.b(Tb,hb),Xb?Gc.a(Fa,Xb):Fa,Qb,Sb.ribbonCommandInfo,Tc,jc);return fd.MMa}var fd=this;Xb=void 0===Xb?null:Xb;jc=void 0===jc?null:jc;var Tc=this.$.oa.xa.Pb();this.wld&&this.WX();this.Cic=Tc.ClientRequestId;var td=vb.EwaSettings.Zb()?new pc.a(505,0,Wc,80):new nb.a(505,0,Wc,16);td=this.$.userOperationManager.Sb(td,Sb.ribbonCommandInfo);this.wld&&this.Yu.add(td)};N.prototype.hFf=function(Da,Sb,hb,Xb,jc,Wc){var fd=this;return new Promise(function(Tc,td){var Tb,Fa=Wc.commandParameters.stopwatch.qc,
Qb=2;20===Wc.commandParameters.commandType&&(Qb=16);36===Wc.commandParameters.commandType&&(Qb=32);Qa.a.jod()&&68===Wc.commandParameters.commandType&&(Qb=64);Qa.a.Gqd(fd.$)&&1028===Wc.commandParameters.commandType&&(Qb=1024);var cc=null;if(null===(Tb=Wc.copyContextSnapshot)||void 0===Tb?0:Tb.commandParameters)cc=Wc.copyContextSnapshot.commandParameters.id;N.HMd(fd.$,Da,Xb,Sb,hb,null,function(bc){N.Pcc(bc,Wc,Tc,td,Fa,fd.$,null,null,null)},function(bc){Wc.serverRequestTimeInMs=Wc.commandParameters.stopwatch.qc-
Fa;bc=oc.a.Mf(bc.data);td(new sc.a(5,bc))},jc,Qb,cc,Wc.commandParameters.id)})};N.prototype.pasteRange=function(Da,Sb,hb,Xb,jc,Wc,fd,Tc,td,Tb){var Fa=this;return new Promise(function(Qb,cc){var bc=fd.commandParameters.stopwatch.qc;N.pmj(Fa.$,Da,Sb,hb,Xb|-5&jc,function(Mc){N.Pcc(Mc,fd,Qb,cc,bc,Fa.$,null,td,Tb)},function(Mc){fd.serverRequestTimeInMs=fd.commandParameters.stopwatch.qc-bc;Mc=oc.a.Mf(Mc.data);Mc=new sc.a(5,Mc);null===Tb||void 0===Tb?void 0:Tb(Mc);cc(Mc)},Wc,Tc)})};N.prototype.P0i=function(Da,
Sb,hb,Xb,jc,Wc,fd){var Tc=this;return(new Promise(function(td,Tb){if(Sb)if(Sb.length>Tc.Lxa){var Fa=fd.clipboardItems.getItem(xa.plainText),Qb=-1;void 0!==Fa&&null!==Fa&&(Qb=Fa.length);eb.a.Vbf&&Sb.length<Tc.eCd&&Sb.length>Tc.SOa&&(Tc.mGf(Sb),Tc.uK=new M(Da,Sb,hb,Xb,jc,Wc,fd,0,Tc.bpc.length),window.requestIdleCallback&&window.requestIdleCallback(function(){return Tc.uCd()}));Ha.ULS.sendTraceTag(42071712,0,15,"CopyPasteInfrastructure.ProcessPasteHtml copy paste length too long. clipboardHtml.Length: {0}, MaxHtmlImportLength: {1}, PlainTextLength: {2}",
Sb.length,Tc.Lxa,Qb);Tb(new sc.a(1))}else Fa=function(cc,bc,Mc){Tc.$.ly();var rd=fd.commandParameters.stopwatch.qc;cc=Gc.b(cc,function(zd){N.Pcc(zd,fd,td,Tb,rd,Tc.$,Sb,null,null)});bc=Gc.a(bc,function(zd){fd.serverRequestTimeInMs=fd.commandParameters.stopwatch.qc-rd;zd=oc.a.Mf(zd.data);Tb(new sc.a(3,zd))});var Hd=Tc.$.oa.xa.Pb(),ic=ya.v(Da,Tc.$),Jc={};Jc.SourceHtml=Sb;Jc.DestinationRanges=ic?ya.s(ic):null;Jc.CopyOperationId=hb;Jc.PasteId=Xb;Ha.ULS.sendTraceTag(537167755,0,50,"CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : {0}. PasteId : {1}",
Tc.xwa,Jc.PasteId);return Tc.xwa?ea(Tc.$.oa.Pv,Jc,cc,bc,Mc,null,Hd,Wc):ea(Tc.$.oa.xa,Jc,cc,bc,Mc,null,Hd,Wc)},Fa=vb.EwaSettings.Zb()?new pc.a(204,0,Fa,65):new nb.a(204,0,Fa,1),Tc.$.userOperationManager.Sb(Fa,jc);else td("")})).then(function(){eb.a.Vbf&&Sb.length>Tc.SOa&&(Tc.mGf(Sb),Tc.uK=new M(Da,Sb,hb,Xb,jc,Wc,fd,0,Tc.bpc.length),window.requestIdleCallback&&window.requestIdleCallback(function(){return Tc.uCd()}))})};N.prototype.mGf=function(Da){var Sb=this.$.Fb.sc("Task","pasteHtmlChunkOperation"),
hb=Math.floor(Da.length/this.SOa)+1;this.bpc=Array(hb);for(var Xb=0;Xb<hb;)this.bpc[Xb]=Da.substring(Xb*this.SOa,(Xb+1)*this.SOa),Xb++;Ha.ULS.sendTraceTag(523257954,0,50,"CopyPasteUtils.populatePasteChunks Time taken for chunking: "+Sb.qc)};N.prototype.uCd=function(){var Da=this,Sb=this.bpc[this.uK.Kpb],hb=this.$.Fb.sc("Task","pasteHtmlServerCall");this.MWi(this.uK.destinationRange,Sb,this.uK.Jqb,this.uK.gFf,this.uK.Ed,this.uK.vOb,this.uK.pasteContext,this.uK.Kpb,this.uK.xVd);this.uK.Kpb++;Ha.ULS.sendTraceTag(523257953,
0,15,"CopyPasteUtils.performChunkedPasteHtml server call time: "+hb.qc+",\n       pasteid:"+this.uK.gFf+",\n       chunkIndex:"+this.uK.Kpb+",\n       totalChunks:"+this.uK.xVd);this.uK.Kpb<this.uK.xVd&&window.requestIdleCallback(function(){return Da.uCd()})};N.prototype.MWi=function(Da,Sb,hb,Xb,jc,Wc,fd,Tc,td){function Tb(cc,bc,Mc){var rd=fd.commandParameters.stopwatch.qc;cc=Gc.b(cc);bc=Gc.a(bc,function(){fd.serverRequestTimeInMs=fd.commandParameters.stopwatch.qc-rd});var Hd=Fa.$.oa.xa.Pb(),ic=ya.v(Da,
Fa.$);ic={SourceHtml:Sb,DestinationRanges:ic?ya.s(ic):null,CopyOperationId:hb,PasteId:Xb+"_chunk_"+Tc,ChunkIndex:Tc,TotalChunks:td};Ha.ULS.sendTraceTag(523257952,0,50,"CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : {0}. PasteId : {1}",Fa.xwa,ic.PasteId);return ea(Fa.$.oa.Pv,ic,cc,bc,Mc,null,Hd,Wc)}var Fa=this,Qb=vb.EwaSettings.Zb()?new pc.a(204,0,Tb,65):new nb.a(204,0,Tb,1);this.$.userOperationManager.Sb(Qb,jc)};N.prototype.Q0i=function(Da,Sb,hb,Xb,jc){var Wc=this;return new Promise(function(fd,
Tc){Ha.ULS.sendTraceTag(537167754,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: method start. pasteContext.Id={0}",jc.id);Sb&&(Sb=Zb.a.trimEnd(Sb,"\n","\r"));Ha.ULS.sendTraceTag(537167753,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: after clipboardText.TrimEnd. pasteContext.Id={0}",jc.id);if(Sb){var td=Wc.Xud;if(Sb.length>td)Ha.ULS.sendTraceTag(24150921,0,15,"CopyPasteInfrastructure.ProcessPasteText copy paste length too long. clipboardText.Length: {0}, MaxCopyPasteLength: {1}",
Sb.length,td),Tc(new sc.a(1));else{var Tb=ya.v(Da,Wc.$);Ha.ULS.sendTraceTag(537167752,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: before treatAsLink calculation. pasteContext.Id={0}",jc.id);td=!Wc.$.ea.isNamedObjectViewMode&&!Sb.includes("\n")&&!Sb.includes("\t");Ha.ULS.sendTraceTag(537167751,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: before isLink check. pasteContext.Id={0}. treatAsLink={1}",jc.id,td);td=td&&Zb.a.udf(Sb);Ha.ULS.sendTraceTag(537167750,0,50,
"CopyPasteInfrastructure.ProcessPasteText profiling trace: after treatAsLink calculation. pasteContext.Id={0}. treatAsLink={1}",jc.id,td);var Fa=Wc.$.oa.xa.Pb();if(td){var Qb=526;Ha.ULS.sendTraceTag(537167749,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: before FixUpUrl. pasteContext.Id={0}",jc.id);var cc=Dc.a.X$c(Sb);Ha.ULS.sendTraceTag(537167748,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: after FixUpUrl. pasteContext.Id={0}",jc.id);var bc=ya.s(Tb);td=function(rd,
Hd,ic){var Jc=jc.commandParameters.stopwatch.qc;rd=Gc.b(rd,function(zd){Ha.ULS.sendTraceTag(537167747,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: on ApplyHyperlink successCallback. pasteContext.Id={0}",jc.id);jc.requestTelemetryData=zd.RequestTelemetryData;jc.serverRequestTimeInMs=jc.commandParameters.stopwatch.qc-Jc;zd.Errors&&0<zd.Errors.length?Tc(new sc.a(2,zd.Errors)):fd(Sb)});Hd=Gc.a(Hd,function(zd){jc.serverRequestTimeInMs=jc.commandParameters.stopwatch.qc-Jc;zd=oc.a.Mf(zd.data);
Tc(new sc.a(2,zd))});Wc.$.ly();Ha.ULS.sendTraceTag(537167746,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: before ApplyHyperlink. pasteContext.Id={0}",jc.id);return wb.b(Wc.$.oa.xa,bc,Sb,cc,!1,!1,63,rd,Hd,ic,Da,Fa,Xb)};var Mc=function(){return new Pb.a(bc,Sb,cc)}}else Qb=180,td=function(rd,Hd,ic){Wc.$.ly();var Jc=jc.commandParameters.stopwatch.qc;rd=Gc.b(rd,function(zd){Ha.ULS.sendTraceTag(537167745,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: on PasteString successCallback. pasteContext.Id={0}",
jc.id);N.Pcc(zd,jc,fd,Tc,Jc,Wc.$,Sb,null,null)});Hd=Gc.a(Hd,function(zd){jc.serverRequestTimeInMs=jc.commandParameters.stopwatch.qc-Jc;zd=oc.a.Mf(zd.data);Tc(new sc.a(4,zd))});Ha.ULS.sendTraceTag(537167744,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: before PasteString. pasteContext.Id={0}",jc.id);return ca(Wc.$.oa.xa,Tb,Sb,rd,Hd,ic,null,Fa,Xb)},Mc=function(){return new P(Tb,Sb)};Ha.ULS.sendTraceTag(537167715,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: before UserNonBlockingWebMethodOperation. pasteContext.Id={0}",
jc.id);td=vb.EwaSettings.Zb()?new pc.a(Qb,0,td,65,Mc):new nb.a(Qb,0,td,1,Mc);Ha.ULS.sendTraceTag(537167714,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: returning. pasteContext.Id={0}",jc.id);Wc.$.userOperationManager.Sb(td,hb)}}else fd("")})};N.prototype.c7e=function(Da,Sb){Sb=[1===Sb?4:5];this.gridView.qb.Fw(ld.a.J7(uc.d(this.$.pa),Da),Sb,!0);this.gridView.qb.qn(Sb);this.gridView.qb.update(!0)};N.prototype.cxb=function(){var Da=[4,5];this.gridView.qb.eh(Da,!1,!1);this.gridView.qb.Ti(null,
Da,!1);1===this.gridView.ha.Pe&&this.gridView.qn(!1,!1);this.gridView.qb.update(!1,!1)};N.prototype.hTg=function(Da,Sb,hb){var Xb=[];hb=bk(hb);for(var jc=hb.next();!jc.done;jc=hb.next())Xb.push(this.kTg(Da,Sb,jc.value));return Xb};N.prototype.WX=function(){if(this.Yu)for(var Da=bk(this.Yu),Sb=Da.next();!Sb.done;Sb=Da.next())Sb=Sb.value,this.$&&this.$.userOperationManager&&(Sb.operation&&Ha.ULS.sendTraceTag(526758675,0,50,"CopyPasteUtils.AbortOutstandingUserOperation: Trying to abort pending operation {0}.",
Rc.a(Sb.operation.operationName)),this.hUg(),this.$.userOperationManager.uta(Sb))};N.prototype.hUg=function(){if(this.MMa){var Da=this.MMa.Dt;Ha.ULS.sendTraceTag(526758674,0,15,"Cancelling pending copy request with Id={0}",Da);oc.a.ku(Da);!vb.EwaSettings.isChangeGateEnabled("OfficeVSO:6151555_DisableCancelCopyRequest")&&this.Cic&&wb.h(this.$.oa.xa,this.Cic,null,null,null);this.Cic=this.MMa=null}};N.prototype.kTg=function(Da,Sb,hb){Ha.ULS.shipAssertTag(537167713,0,!!Sb,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray shouldn't be null");
Ha.ULS.shipAssertTag(537167712,0,0<Sb.length,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray length shouldn't be zero");var Xb=0,jc=0,Wc=new Set,fd=new Set;Sb=bk(Sb);for(var Tc=Sb.next();!Tc.done;Tc=Sb.next()){Tc=Tc.value;var td=String.format("{0}_{1}",Tc.left,Tc.right),Tb=String.format("{0}_{1}",Tc.top,Tc.bottom);fd.has(td)||(fd.add(td),jc+=Tc.width);Wc.has(Tb)||(Wc.add(Tb),Xb+=Tc.height)}if(36===Da)return hb.isSingle?N.CQe(jc,Xb,hb):hb.clone();516===Da&&(Da=Xb,Xb=jc,jc=Da);Da=!(hb.width%
jc)&&!(hb.height%Xb);Wc=hb.YZ&&!(hb.height%Xb);hb.m5&&!(hb.width%jc)||Wc?hb=N.CQe(jc,Xb,hb):Da?hb=hb.clone():(hb=hb.clone(),hb.bottom=Math.min(qb.a.sh,hb.top+Xb-1),hb.right=Math.min(qb.a.Bh,hb.left+jc-1));return hb};N.prototype.HKg=function(Da,Sb,hb,Xb,jc,Wc,fd,Tc,td,Tb,Fa){if(!Xb||!Xb.length)return 1;if(1<Xb.length){if(!this.Dfc&&Wc)return 3;if(Tb)return 0;if(Tc)return 9;if(td)return 8;if(Fa)return 2;if(1<Sb.length)return 4;var Qb=Sb[0];if(!fd&&!Yb.a.all(Xb,function(cc){return cc.isSingle||!(cc.width%
Qb.width)&&!(cc.height%Qb.height)}))return 5;if((!this.Dfc||!Wc)&&Zb.a.equals(Da,hb,!0))for(jc=bk(jc),Da=jc.next();!Da.done;Da=jc.next())if(Da=Da.value,Da.xd(Qb)&&!Da.equals(Qb))return 6}else if(Sb&&0<Sb.length){if(0!==this.abf(Sb,td))return 7;if(1<Sb.length){if(!this.Dfc&&Wc)return 3;if((!this.Dfc||!Wc)&&Zb.a.equals(Da,hb,!0))for(Da=bk(Sb),Sb=Da.next();!Sb.done;Sb=Da.next())if(Sb=Sb.value,hb=jc[0],Sb.xd(hb)&&!Sb.equals(hb))return 6}}return 0};N.prototype.abf=function(Da,Sb){if(!Da||1>=Da.length)return 0;
if(Sb)return 2;if(!ya.S(Da))return 1;Sb=new ac.a(Ac.a.Ik());for(var hb=bk(Da),Xb=hb.next();!Xb.done;Xb=hb.next()){Xb=Xb.value;for(var jc=bk(Da),Wc=jc.next();!Wc.done;Wc=jc.next()){Wc=Wc.value;var fd=Xb.top===Wc.top&&Xb.bottom===Wc.bottom,Tc=Xb.left===Wc.left&&Xb.right===Wc.right,td=Math.max(Xb.left,Wc.left)<Math.min(Xb.right,Wc.right);if(Math.max(Xb.top,Wc.top)<Math.min(Xb.bottom,Wc.bottom)&&!fd||td&&!Tc)return 3;Sb.add(String.format("{0}-{1}-{2}-{3}",Xb.top,Xb.bottom,Wc.left,Wc.right));Sb.add(String.format("{0}-{1}-{2}-{3}",
Wc.top,Wc.bottom,Xb.left,Xb.right))}}Da=bk(Da);for(hb=Da.next();!hb.done;hb=Da.next())hb=hb.value,Sb.remove(String.format("{0}-{1}-{2}-{3}",hb.top,hb.bottom,hb.left,hb.right));return 0<Sb.count?3:0};N.prototype.n6i=function(Da){var Sb=this.gridView.ha;Sb.updateSelection(Da,Da.topLeft,0);Sb.selectionType=-1};N.prototype.Pvb=function(Da){if(null===Da||void 0===Da?0:Da.sourceItem){if(!qa(Da.sourceItem))return null;if((Da=Da.sourceItem)&&ya.cb(Da.ranges,!0))return Da}return null};N.prototype.egc=function(Da,
Sb){Ha.ULS.shipAssertTag(537167711,0,!!Da,"CopyPasteUtils.IsFromKeyboardShortcut: commandInfo shouldn't be null");return Sb&&Fc.a.OF in Sb||Da.tabName?!1:1===Da.method};N.pmj=function(Da,Sb,hb,Xb,jc,Wc,fd,Tc,td){function Tb(){return new ka(hb,Xb,jc)}function Fa(cc,bc,Mc){Da.ly();var rd=Da.oa.xa;cc=Gc.b(cc,Wc);bc=Gc.a(bc,fd);var Hd=Tc;Hd=void 0===Hd?null:Hd;var ic=rd.Na(9,Qb);ic.sourceRanges=hb;ic.destinationRanges=Xb;ic.flags=jc;return wb.g(rd,"PasteRange",ic,cc,bc,Mc,null,64,Hd)}var Qb=Da.oa.xa.Pb(td?
{n_:!0,GZ:1}:{n_:!1,GZ:0});td=vb.EwaSettings.Zb()?new pc.a(506,0,Fa,65,Tb):new nb.a(506,0,Fa,1,Tb);Da.userOperationManager.Sb(td,Sb)};N.Pcc=function(Da,Sb,hb,Xb,jc,Wc,fd,Tc,td){fd=void 0===fd?null:fd;Ha.ULS.sendTraceTag(537167710,0,50,"CopyPasteInfrastructure.HandlePasteResult profiling trace: on HandlePasteResult start. pasteContext.Id={0}",Sb.id);Sb.requestTelemetryData=Da.RequestTelemetryData;Sb.serverRequestTimeInMs=Sb.commandParameters.stopwatch.qc-jc;Mb.a.Qg(Da.Errors)?Mb.a.Oga(Da.Errors)?(Sb&&
(Sb.encounteredDeploymentErrors=!0),Ha.ULS.sendTraceTag(537167707,0,15,"CopyPasteUtils.HandlePasteServerResponse: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: {0}",Mb.a.Ec(Da.Errors))):(Da=new sc.a(5,Da.Errors),null===td||void 0===td?void 0:td(Da),Xb(Da)):Da.Result?(Xb=!!Da&&!!Da.RequestTelemetryData,ha.g(Wc).si.dla(Sb.commandParameters.stopwatch.id,Da.StateId,Xb?Da.RequestTelemetryData.EcsOperationDuration:0,Xb?Da.RequestTelemetryData.EcsRequestDuration:
0,Xb?Da.RequestTelemetryData.WfeRequestDuration:0),Sb.pastedRange=Da.Result.SheetMultiRange,Ha.ULS.sendTraceTag(537167708,0,50,"CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise ewaResult.Result is not null. pasteContext.Id={0}",Sb.id),null===Tc||void 0===Tc?void 0:Tc(),hb(!0)):(Ha.ULS.sendTraceTag(537167709,0,50,"CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise when ewaResult.Result is null. pasteContext.Id={0}",Sb.id),hb(fd||!0))};N.HMd=function(Da,
Sb,hb,Xb,jc,Wc,fd,Tc,td,Tb,Fa,Qb){function cc(){return new Q(rd)}function bc(Hd,ic,Jc){Da.ly();return R(Da.oa.xa,rd,Gc.b(Hd,fd),Gc.a(ic,Tc),Jc,Wc,Mc,td)}var Mc=Da.oa.xa.Pb(),rd=N.Z7g(hb,Xb,jc,Tb,Fa,Qb);hb=vb.EwaSettings.Zb()?new pc.a(503,0,bc,65,cc):new nb.a(503,0,bc,1,cc);Da.userOperationManager.Sb(hb,Sb)};N.Z7g=function(Da,Sb,hb,Xb,jc,Wc){var fd={};fd.ShadowWorkbookBase64=Da.shadowWorkbookBase64;fd.SourceRanges={};fd.SourceRanges.Ranges=Array(1);fd.SourceRanges.Ranges[0]={};fd.SourceRanges.Ranges[0].FirstRow=
Da.rangeRowStart;fd.SourceRanges.Ranges[0].LastRow=Da.rangeRowEnd;fd.SourceRanges.Ranges[0].FirstColumn=Da.rangeColumnStart;fd.SourceRanges.Ranges[0].LastColumn=Da.rangeColumnEnd;vb.EwaSettings.getBooleanFeatureGate(eb.a.M4b,!1)?hb?fd.DestinationRanges=ya.u(hb.SheetName,hb.NamedObjectName,ya.g(hb.Ranges)):(Ha.ULS.sendTraceTag(537167706,0,15,"CopyPasteInfrastructure.CreatePasteParameters: multiRangeDestination is null"),fd.DestinationRanges=null):fd.DestinationRanges=Sb?ya.s(Sb):null;fd.CopyPasteTargetType=
1;fd.PasteType=Xb;fd.CopyOperationId=jc;fd.PasteId=Wc;fd.SourceClientPath=Da.sourceClientPath;fd.SourceSheetName=Da.sourceSheetName;fd.SourceWorkbookName=Da.sourceWorkbookName;if(!Da.originalSourceRangesCountExceedsLimit&&Da.originalSourceRanges&&0<Da.originalSourceRanges.length&&1024===Xb){fd.OriginalSourceMultiRange={};Sb=Array(Da.originalSourceRanges.length);for(hb=0;hb<Sb.length;++hb)Sb[hb]={},Sb[hb].FirstRow=Da.originalSourceRanges[hb][0],Sb[hb].FirstColumn=Da.originalSourceRanges[hb][1],Sb[hb].LastRow=
Da.originalSourceRanges[hb][2],Sb[hb].LastColumn=Da.originalSourceRanges[hb][3];fd.OriginalSourceMultiRange.Ranges=Sb}return fd};N.CQe=function(Da,Sb,hb){hb=hb.clone();hb.height<Sb&&(hb.bottom=Math.min(qb.a.sh,hb.top+Sb-1));hb.width<Da&&(hb.right=Math.min(qb.a.Bh,hb.left+Da-1));return hb};N.prototype.executeInsertCopiedCutCellsOperation=function(Da,Sb,hb,Xb,jc,Wc,fd){function Tc(){return new C(td)}Wc=void 0===Wc?null:Wc;fd=void 0===fd?null:fd;var td={};td.InsertDirection=Xb;td.SourceRange=Da;td.DestRange=
Sb;td.CopyCutOperation=hb?0:1;var Tb=this.$.oa.xa;return gd.a(this.$.userOperationManager,function(Fa,Qb,cc){Fa=Wc?Gc.b(Fa,Wc):Fa;Qb=fd?Gc.a(Qb,fd):Qb;var bc=Tb.Na(41,null);bc.insertCopiedCutCellsParameters=td;return wb.g(Tb,"InsertCopiedCutCells",bc,Fa,Qb,cc,null,4)},function(Fa){return new pc.a(104,0,Fa,void 0,Tc)},jc)};N.prototype.xIe=function(Da,Sb,hb,Xb,jc,Wc,fd,Tc){var td=this;return new Promise(function(Tb,Fa){function Qb(bc){bc=oc.a.Mf(bc.data);bc=new sc.a(21,bc);null===Tc||void 0===Tc?void 0:
Tc(bc);Fa(bc)}function cc(bc){Da.requestTelemetryData=bc.RequestTelemetryData;if(bc.Errors&&0<bc.Errors.length){var Mc=new sc.a(21,bc.Errors);null===Tc||void 0===Tc?void 0:Tc(Mc);Fa(new sc.a(21,bc.Errors))}else null===fd||void 0===fd?void 0:fd(),Tb(!0)}vb.EwaSettings.isChangeGateEnabled("OfficeVSO:6126613_RemoveClearingRunningAntsICCCForDragInsert")?td.executeInsertCopiedCutCellsOperation(Sb,hb,Xb,jc,Wc,cc,Qb):td.executeInsertCopiedCutCellsOperation(Sb,hb,Xb,jc,Wc,cc,Qb).continueWith(function(){if(Xb)td.cxb();
else{var bc=td.$.da.za(254);bc&&bc.m2b("DragDropInsert/success/"+zb.a[Wc.method],!0)}})})};Mf.Object.defineProperties(N.prototype,{Xud:{configurable:!0,enumerable:!0,get:function(){Ha.ULS.sendTraceTag(537167757,0,50,"CopyPasteUtils.MaxCopyPasteLength returning BootstrapContext.MaxCopyPasteLength. MaxCopyPasteLength={0}",this.$.ya.MaxCopyPasteLength);return this.$.ya.MaxCopyPasteLength}},Lxa:{configurable:!0,enumerable:!0,get:function(){return this.xwa?vb.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",
this.$.ya.CopyPasteMaxPayloadLength):qb.a.Lxa}}});Object(V.a)(N,"CopyPasteUtils",null,[732]);var Cc=b(543),kd;(function(Da){Da[Da.range=0]="range";Da[Da.art=1]="art"})(kd||(kd={}));Object(V.b)("SourceItemType",kd);var Fd=b(24),rb=b(91);K.prototype.serializeSourceItem=function(Da){var Sb={};if(Da&&Object.getType(Da)===na)Sb.sheetName=Da.sheetName,Sb.topArray=Yb.a.map(Da.ranges,function(hb){return hb.top}),Sb.leftArray=Yb.a.map(Da.ranges,function(hb){return hb.left}),Sb.bottomArray=Yb.a.map(Da.ranges,
function(hb){return hb.bottom}),Sb.rightArray=Yb.a.map(Da.ranges,function(hb){return hb.right}),Sb.sessionStateId=Da.sessionStateId,Sb.sessionId=Da.sessionId,Sb.sourceItemType=this.NWf(0);else if(Da&&Object.getType(Da)===ia)Sb.activeFloatingObjectControlId=Da.activeFloatingObjectControlId,Sb.sheetName=Da.sheetName,Sb.sessionStateId=Da.sessionStateId,Sb.sessionId=Da.sessionId,Sb.floatingObjectType=this.Smj(Da.type),Sb.sourceItemType=this.NWf(1);else return Ha.ULS.shipAssertTag(537167705,0,!1,"EnvironmentSerializationHelper.SerializeSourceItem: sourceItem shouldn't be null."),
null;return JSON.stringify(Sb)};K.prototype.serializeCommandParameters=function(Da){if(!Da)return Ha.ULS.shipAssertTag(537167704,0,!1,"EnvironmentSerializationHelper.Serialize: commandParameters shouldn't be null."),null;var Sb={};Sb.id=Da.id;Sb.commandType=Da.commandType;Sb.copyPasteTargetType=Da.copyPasteTargetType;Da.ribbonCommandInfo&&(Sb.ribbonCommandName=this.$mj(Da.ribbonCommandInfo.command),Sb.inputMethodName=this.Umj(Da.ribbonCommandInfo.method),Sb.frameModeName=this.Tmj(Da.ribbonCommandInfo.mode),
Sb.uiLocationName=this.cnj(Da.ribbonCommandInfo.Le),Sb.tabName=Da.ribbonCommandInfo.tabName);return JSON.stringify(Sb)};K.prototype.deserializeSourceItem=function(Da){if(!Da)return null;try{var Sb=JSON.parse(Da);if(!Sb)return Ha.ULS.shipAssertTag(537167703,0,!1,"EnvironmentSerializationHelper.Deserialize: Json.Parse return null result."),null;var hb=null;switch(this.qdh(Sb.sourceItemType)){case 0:hb=new na(this.$,this.ndh(Sb),Sb.sheetName,Sb.sessionStateId,Sb.sessionId);break;case 1:hb=new ia(Sb.activeFloatingObjectControlId,
Sb.sheetName,Sb.sessionStateId,Sb.sessionId,this.kdh(Sb.floatingObjectType))}return hb}catch(Xb){return Ha.ULS.sendTraceTag(537167702,0,10,"EnvironmentSerializationHelper.DeserializeSourceItem: got exception while try to JSON.Parse string length: {0}, errror: {1}",Da?Da.length:0,Xb),null}};K.prototype.deserializeCommandParameters=function(Da){if(!Da)return null;try{var Sb=JSON.parse(Da);if(!Sb)return Ha.ULS.shipAssertTag(537167701,0,!1,"EnvironmentSerializationHelper.DeserializeCommandParameters: Json.Parse return null result."),
null;var hb=cb.a();hb.id=Sb.id;hb.ribbonCommandInfo=this.pdh(Sb);hb.commandType=Sb.commandType;hb.copyPasteTargetType=Sb.copyPasteTargetType;return hb}catch(Xb){return Ha.ULS.sendTraceTag(537167700,0,10,"EnvironmentSerializationHelper.DeserializeCommandParameters: got exception while try to JSON.Parse string length: {0}, errror: {1}",Da?Da.length:0,Xb),null}};K.prototype.ndh=function(Da){var Sb=[];Ha.ULS.shipAssertTag(537167699,0,!!Da.topArray&&0<Da.topArray.length,"EnvironmentSerializationHelper.DeserializeRanges: TopArray shouldn't be {0}.",
Da.topArray?"empty":"null");Ha.ULS.shipAssertTag(537167698,0,!!Da.leftArray&&0<Da.leftArray.length,"EnvironmentSerializationHelper.DeserializeRanges: LeftArray shouldn't be {0}.",Da.leftArray?"empty":"null");Ha.ULS.shipAssertTag(537167697,0,!!Da.bottomArray&&0<Da.bottomArray.length,"EnvironmentSerializationHelper.DeserializeRanges: BottomArray shouldn't be {0}.",Da.bottomArray?"empty":"null");Ha.ULS.shipAssertTag(537167696,0,!!Da.rightArray&&0<Da.rightArray.length,"EnvironmentSerializationHelper.DeserializeRanges: RightArray shouldn't be {0}.",
Da.rightArray?"empty":"null");if(!(Da.topArray&&Da.leftArray&&Da.bottomArray&&Da.rightArray))return Sb;Ha.ULS.shipAssertTag(537167695,0,Da.topArray.length===Da.bottomArray.length&&Da.topArray.length===Da.leftArray.length&&Da.topArray.length===Da.rightArray.length,"EnvironmentSerializationHelper.DeserializeRanges: The length of TopArray({0}), BottomArray({1}), LeftArray({2}), RightArray({3}) should be the same.",Da.topArray.length,Da.bottomArray.length,Da.leftArray.length,Da.rightArray.length);for(var hb=
Math.min(Da.topArray.length,Da.bottomArray.length,Da.leftArray.length,Da.rightArray.length),Xb=0;Xb<hb;Xb++)Sb.push(new Fd.Range(Da.topArray[Xb],Da.leftArray[Xb],Da.bottomArray[Xb],Da.rightArray[Xb],!1,!1));return Sb};K.prototype.pdh=function(Da){return new rb.a(this.odh(Da.ribbonCommandName),this.mdh(Da.inputMethodName),this.ldh(Da.frameModeName),this.rdh(Da.uiLocationName),Da.tabName)};K.prototype.$mj=function(Da){return void 0!==Da&&null!==Da&&Da.toString()in this.RKd?this.RKd[Da.toString()]:(Ha.ULS.shipAssertTag(537167694,
0,!1,"EnvironmentSerializationHelper.SerializeRibbonCommand expected to get RibbonCommand.Copy({0}) or RibbonCommand.Cut({1}) but got {2}",-911352779,-1985798686,Da),this.RKd["-911352779"])};K.prototype.odh=function(Da){return Da&&Da in this.$5f?this.$5f[Da]:(Ha.ULS.shipAssertTag(537167693,0,!1,"EnvironmentSerializationHelper.DeserializeRibbonCommand: expected to get RibbonCommand.Copy({0}) or RibbonCommand.Cut({1}) but got {2}",-911352779,-1985798686,Da),-911352779)};K.prototype.Umj=function(Da){return void 0!==
Da&&null!==Da&&zb.a[Da]in this.Xja?this.Xja[zb.a[Da]]:(Ha.ULS.shipAssertTag(537167692,0,!1,"EnvironmentSerializationHelper.SerializeInputMethod: got unexpected value {0}",Da),this.Xja.unknown)};K.prototype.mdh=function(Da){return Da&&Da in this.Z5f?this.Z5f[Da]:(Ha.ULS.shipAssertTag(537167691,0,!1,"EnvironmentSerializationHelper.DeserializeInputMethod: got unexpected value {0}",Da),0)};K.prototype.Tmj=function(Da){return void 0!==Da&&null!==Da&&Cc.a[Da]in this.K2a?this.K2a[Cc.a[Da]]:(Ha.ULS.shipAssertTag(537167690,
0,!1,"EnvironmentSerializationHelper.SerializeFrameMode: got unexpected value {0}",Da),this.K2a.edit)};K.prototype.ldh=function(Da){return Da&&Da in this.Y5f?this.Y5f[Da]:(Ha.ULS.shipAssertTag(537167689,0,!1,"EnvironmentSerializationHelper.DeserializeFrameMode: got unexpected value {0}",Da),2)};K.prototype.NWf=function(Da){return void 0!==Da&&null!==Da&&kd[Da]in this.eMb?this.eMb[kd[Da]]:(Ha.ULS.shipAssertTag(537167688,0,!1,"EnvironmentSerializationHelper.SerializeSourceItemType: got unexpected value {0}",
Da),this.eMb.range)};K.prototype.qdh=function(Da){return Da&&Da in this.a6f?this.a6f[Da]:(Ha.ULS.shipAssertTag(537167687,0,!1,"EnvironmentSerializationHelper.DeserializeSourceItemType: got unexpected value {0}",Da),0)};K.prototype.Smj=function(Da){return void 0!==Da&&null!==Da&&Da.toString()in this.rWc?this.rWc[Da.toString()]:(Ha.ULS.shipAssertTag(537167686,0,!1,"EnvironmentSerializationHelper.SerializeArtSourceItemType: got unexpected value {0}",Da),this.rWc["99"])};K.prototype.kdh=function(Da){return Da&&
Da in this.X5f?this.X5f[Da]:(Ha.ULS.shipAssertTag(537167685,0,!1,"EnvironmentSerializationHelper.DeserializeArtSourceItemType: got unexpected value {0}",Da),99)};K.prototype.cnj=function(Da){return void 0!==Da&&null!==Da&&kb.a[Da]in this.sr?this.sr[kb.a[Da]]:(Ha.ULS.shipAssertTag(36229129,0,!1,"EnvironmentSerializationHelper.SerializeUILocation: got unexpected value {0}",Da),this.sr.ribbon)};K.prototype.rdh=function(Da){return Da&&Da in this.b6f?this.b6f[Da]:(Ha.ULS.shipAssertTag(537167684,0,!1,"EnvironmentSerializationHelper.DeserializeUILocation: got unexpected value {0}",
Da),2)};Object(V.a)(K,"EnvironmentSerializationHelper",null,[]);var Kd=b(4);H.dUf="SameSession";H.pEe="CrossSession";H.gjf="LegacyCrossSession";H.external="External";Object(V.a)(H,"PayloadOrigin",null,[]);O.prototype.shouldWaitForCopyToComplete=function(){return!1};O.prototype.onDeferredPasteStarted=function(){};O.prototype.onDeferredPasteCompleted=function(){};O.prototype.beforePaste=function(){};O.prototype.UMj=function(Da){var Sb=null;try{var hb=Da.getItem(xa.shadowWorkbook);if(!hb)return{returnValue:!1,
v0:Sb};Sb=JSON.parse(hb);return{returnValue:this.Uni(Sb),v0:Sb}}catch(Xb){return Ha.ULS.sendTraceTag(537167835,0,50,"BaseCopyPasteHandler.TryParseRangeShadowWorkbookPayload: Exception caught: "+Xb),{returnValue:!1,v0:Sb}}};O.prototype.Uni=function(Da){return!!Da&&(!!Da.shadowWorkbookBase64||Da.shadowWorkbookSizeExceedsLimit)&&void 0!==Da.rangeRowStart&&void 0!==Da.rangeRowEnd&&void 0!==Da.rangeColumnStart&&void 0!==Da.rangeColumnEnd};O.prototype.$oc=function(Da){Da.wasLastCopyExternal=!0;if(vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!La.a.HC&&516!==Da.commandParameters.commandType&&1028!==Da.commandParameters.commandType){var Sb=this.UMj(Da.clipboardItems);var hb=Sb.v0;if(Sb.returnValue)return Da.isShadowWorkbookParsedSuccessfully=!0,this.LWi(Da,hb)}return 516!==Da.commandParameters.commandType&&36!==Da.commandParameters.commandType?vb.EwaSettings.ma(162)&&20!==Da.commandParameters.commandType&&(null===this.$.shortcutKeyManager||this.$.shortcutKeyManager.Ifc)&&(hb=Da.clipboardItems.getItem(xa.html),void 0!==hb&&null!==hb&&
hb&&hb.trim()!==this.uWc&&(hb.startsWith("<")||La.a.Nf&&hb.startsWith("\n<")))?(Sb=Da.clipboardItems.getItem(xa.Jqb),this.JWi(Da,hb,void 0===Sb?null:Sb)):this.cFf(Da):Promise.reject(new sc.a(6))};O.prototype.LWi=function(Da,Sb){Ha.ULS.sendTraceTag(537167834,0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: Pasting shadow workbook from system clipboard");Da.pasteResult="SystemClipboardShadowWorkbookPaste";Da.payloadType=ba.shadowWorkbook;Da.payloadOrigin=H.external;Da.shadowWorkbookPayloadSize=
J(Sb);Da.shadowWorkbookSizeExceedsLimit=U(Sb);var hb=null,Xb=null,jc=Da.commandParameters.originalDestinations;vb.EwaSettings.getBooleanFeatureGate(eb.a.M4b,!1)?hb=ya.r(jc,this.$):Xb=ya.v(ya.K(jc),this.$);Sb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(Da.originalSourceRangesCountExceedsLimit=Sb.originalSourceRangesCountExceedsLimit);if(Da.shadowWorkbookSizeExceedsLimit)return Ha.ULS.sendTraceTag(537167833,0,15,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: shadow workbook length({0}) is over the limit({1}). reject the paste request. ShadowWorkbookSizeExceedsLimit: {2}",
Da.shadowWorkbookPayloadSize,qb.a.xkc,Sb.shadowWorkbookSizeExceedsLimit),Promise.reject(new sc.a(1));Ha.ULS.sendTraceTag(537167832,0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: trigger Paste request. PasteOperationId={0}",Da.commandParameters.id);return this.Bp.hFf(Da.commandParameters.ribbonCommandInfo,Xb,hb,Sb,[Da.commandParameters.stopwatch],Da)};O.prototype.cFf=function(Da){var Sb=Da.clipboardItems.getItem(xa.plainText);if(void 0!==Sb&&null!==Sb&&Sb.trim()===this.uWc)return Promise.reject(new sc.a(7));
void 0!==Sb&&null!==Sb&&(Da.plainTextPayloadSize=Sb.length);Da.isPlainTextPaste=!0;Da.pasteResult="SystemClipboardPaste";Da.payloadOrigin=db(Da)?H.gjf:H.external;Da.payloadType=ba.plainText;Ha.ULS.sendTraceTag(537167831,0,50,"BaseRangeCopyPasteHandler.PasteByPlainText: trigger ProcessPasteText request. pasteContext.Id={0}, PasteOperationId={1}",Da.id,Da.commandParameters.id);Sb=this.Bp.Q0i(ya.K(Da.commandParameters.originalDestinations),Sb,Da.commandParameters.ribbonCommandInfo,[Da.commandParameters.stopwatch],
Da);Ha.ULS.sendTraceTag(537167830,0,50,"BaseRangeCopyPasteHandler.PasteByPlainText: returned from ProcessPasteText. pasteContext.Id={0}",Da.id);return Sb};O.prototype.JWi=function(Da,Sb,hb){Da.htmlPayloadSize=Sb.length;Da.isHtmlPaste=!0;Da.pasteResult="SystemClipboardHtmlPaste";Da.payloadType=ba.html;Da.payloadOrigin=db(Da)?H.gjf:H.external;Ha.ULS.sendTraceTag(42071711,0,50,"BaseRangeCopyPasteHandler.PasteByHtml: trigger ProcessPasteHtml request. PasteOperationId={0}",Da.commandParameters.id);return this.Bp.P0i(ya.K(Da.commandParameters.originalDestinations),
Sb,hb,Da.commandParameters.id,Da.commandParameters.ribbonCommandInfo,[Da.commandParameters.stopwatch],Da)};O.prototype.NDe=function(Da){var Sb={};Da&&(Sb.shadowWorkbookBase64=Da.ShadowWorkbookBase64,Sb.shadowWorkbookSizeExceedsLimit=Da.ShadowWorkbookSizeExceedsLimit,Sb.originalSourceRangesCountExceedsLimit=Da.OriginalSourceRangesCountExceedsLimit,Sb.originalSourceRangesCount=Da.OriginalSourceRangesCount,Sb.shadowWorkbookBlockedSize=Da.ShadowWorkbookBlockedSize);return Sb};O.prototype.qeg=function(Da,
Sb){var hb=Ga(Da),Xb=32===(Da.commandParameters.commandType&32),jc=1024===(Da.commandParameters.commandType&1024),Wc=!1,fd=null,Tc=null,td=!1;if(!hb){Wc=-1985798686===Da.commandParameters.ribbonCommandInfo.command;var Tb=Da.copyContextSnapshot;if(Sb)td=!Tb.sourceItem.isFromCurrentSession(this.$);else if(Tb=this.Bp.Pvb(Tb))fd=Tb.ranges,Tc=Tb.sheetName,td=!Da.isSameSession}return this.Bp.HKg(Tc,fd,this.$.pa.sheetName,Da.commandParameters.originalDestinations,Da.commandParameters.expandDestinations,
td,Xb,jc,Wc,Sb,hb)};Mf.Object.defineProperties(O.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},uWc:{configurable:!0,enumerable:!0,get:function(){return this.Gm.Xa(5)}}});Object(V.a)(O,"BaseCopyPasteHandler",null,[755,756,757]);T.prototype.getValue=function(Da){return this.key&&this.key.isEqual(Da)?this.createClipboardItems(this.clipboardItems):null};T.prototype.setValue=function(Da,Sb){this.key=Da;this.clipboardItems=this.createClipboardItems(Sb)};T.prototype.createClipboardItems=
function(Da){var Sb=this.t$.create(),hb=Da.getItem(xa.plainText);hb&&Sb.setItem(xa.plainText,hb);(hb=Da.getItem(xa.shadowWorkbook))&&Sb.setItem(xa.shadowWorkbook,hb);(Da=Da.getItem(xa.html))&&Sb.setItem(xa.html,Da);return Sb};Object(V.a)(T,"CopyCache",null,[]);var Qd=b(74);Rk(G,O);G.prototype.getSourceItem=function(){var Da=Yb.a.clone(this.gridView.ha.sa.selectedRanges);return new na(this.$,Da,this.$.ea.pa.sheetName,this.$.ea.Ue,this.$.ya.UserSessionId)};G.prototype.beforeSerialize=function(Da){var Sb=
this;Da.isSelectionAllowed=!1;Da.isAsyncCopy=!1;Da.isFromCache=!1;Da.encounteredDeploymentErrors=!1;Da.plainTextPayloadSize=0;Da.shadowWorkbookPayloadSize=0;Da.htmlPayloadSize=0;Da.clientSideCopyTime=0;var hb=new Db.a(this.$.va),Xb=Da.sourceItem;Da.isSelectionAllowed=Yb.a.all(Xb.ranges,function(jc){return Sb.isSelectionAllowed(hb,jc)});Da.isSelectionAllowed&&this.Bp.c7e(Xb.ranges,Da.commandParameters.commandType)};G.prototype.hMa=function(Da){return this.gridView.Ea.OZ()&&ha.i(this.gridView,Da)};
G.prototype.fXi=function(Da,Sb,hb,Xb){var jc=!1,Wc=1===Sb.commandParameters.commandType,fd=Xb[0].EG;1===hb.ranges.length&&1===Xb.length?vb.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests1")&&Wc&&1!==fd&&fd!==hb.ranges[0].EG?Da.cseStatus=17:jc=this.f3g.X5c(Da,ya.K(hb.ranges),hb.sheetName,ya.K(Da.commandParameters.expandDestinations),this.$.ea.pa.sheetName,Wc):Da.cseStatus=5;jc&&ha.g(this.$).si.A0(Da.commandParameters.stopwatch.id,Qd.BasicTelemetryCalculator.HQ);return this.RWi(Da,
hb,ya.u(this.$.pa.sheetName,null,Xb),Sb.commandParameters.commandType,jc)};G.prototype.isSelectionAllowed=function(Da,Sb){return Da.Zzb(Sb,this.gridView)};G.prototype.RWi=function(Da,Sb,hb,Xb,jc){Sb=ya.u(Sb.sheetName,null,Sb.ranges);Da.pasteResult="SameSessionPaste";Da.payloadOrigin=H.dUf;Da.payloadType=ba.nzg;Ha.ULS.sendTraceTag(537167829,0,50,"BaseRangeCopyPasteHandler.PasteSameSession: trigger PasteRange request. PasteOperationId={0}",Da.commandParameters.id);return this.Bp.pasteRange(Da.commandParameters.ribbonCommandInfo,
Sb,hb,Xb,Da.commandParameters.commandType,[Da.commandParameters.stopwatch],Da,jc,null,null)};Object(V.a)(G,"BaseRangeCopyPasteHandler",O,[]);var ve=b(34);F.prototype.onDeferredPasteStarted=function(Da){this.sU.kb(Da.id)||this.sU.add(Da.id,!0);if(0<this.sU.count){var Sb=pa.GetServiceTaskFactory.Ra(this.$.da,5,4,0);Kb.TaskExtensions.Aa(Sb,function(){Sb.result.Tf(28,null)},this.$.la,3)}};F.prototype.onDeferredPasteCompleted=function(Da){var Sb=0<this.sU.count;this.sU.kb(Da.id)&&this.sU.remove(Da.id);
if(Sb&&!this.sU.count){var hb=pa.GetServiceTaskFactory.Ra(this.$.da,5,4,0);Kb.TaskExtensions.Aa(hb,function(){hb.result.removeEntry(28)},this.$.la,3)}};Object(V.a)(F,"DeferredPasteTracker",null,[]);var Be;(function(Da){Da[Da.none=0]="none";Da[Da.loadClipboardFromServerFailed=1]="loadClipboardFromServerFailed";Da[Da.loadCopiedDataFromServerFailed=2]="loadCopiedDataFromServerFailed";Da[Da.asyncCopyCanceled=3]="asyncCopyCanceled";Da[Da.loadCopiedArtDataFromServerFailed=4]="loadCopiedArtDataFromServerFailed"})(Be||
(Be={}));Object(V.b)("CopyErrorType",Be);var Ie=b(1132),se=b(1313),Se=Ie.a;Rk(I,Se);Object(V.a)(I,"CopyInnerError",Ie.a,[]);Rk(D,G);D.prototype.serialize=function(Da){var Sb=Da.sourceItem,hb={},Xb=this.$1c.getValue(Sb);if(Xb)hb.synchronousResult=Xb,Da.isFromCache=!0,Da.clientSideCopyTime=Da.commandParameters.stopwatch.qc;else{var jc=null,Wc=ya.F(Sb.ranges);if(!Qa.a.Rcf()&&this.hMa(Wc)){Ha.ULS.sendTraceTag(537167936,0,50,"AcrossSessionRangeCopyPasteHandler.Serialize: All data is loaded prepare the data in the client side.");
Wc=this.clipboardRangeFactory.create(Wc);try{jc=Wc.toString(),Xb=this.t$.create(),Xb.setItem(xa.plainText,jc),this.$1c.setValue(Sb,Xb),hb.synchronousResult=Xb,Da.clientSideCopyTime=Da.commandParameters.stopwatch.qc}finally{Wc&&Wc.dispose()}}else Da.isAsyncCopy=!0,hb.synchronousResult=this.t$.create(),hb.synchronousResult.setItem(xa.plainText,this.uWc);hb.asynchronousResult=this.Bcd(Da,Sb,jc)}Da.syncClipboardItemsKeys=ja(hb.synchronousResult);return hb};D.prototype.shouldWaitForCopyToComplete=function(Da){if(!Da||
!Da.copyContextSnapshot)return Ha.ULS.sendTraceTag(537167907,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: pasteContext or pasteContext.CopyContextSnapshot is not define, return false."),!1;Ha.ULS.shipAssertTag(537167906,0,!!this.$.ya,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: this.EwaControl.BootstrapContext shouldn't be null");if(Da.copyContextSnapshot.sessionId===this.$.ya.UserSessionId)return Ha.ULS.sendTraceTag(537167905,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: Same session copy scenario, return false."),
!1;Ha.ULS.sendTraceTag(537167904,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0};D.prototype.onDeferredPasteStarted=function(Da){this.sU.onDeferredPasteStarted(Da)};D.prototype.onDeferredPasteCompleted=function(Da){this.sU.onDeferredPasteCompleted(Da)};D.prototype.deserialize=function(Da){Da.isClipboardDataContainShadowWorkbook=!(void 0===Da.clipboardItems.getItem(xa.shadowWorkbook)||null===Da.clipboardItems.getItem(xa.shadowWorkbook));if(ha.g(this.$).ha.Pe&
326)return Ga(Da)&&(Da.wasLastCopyExternal=!0),Promise.reject(new sc.a(17));var Sb=this.qeg(Da,!1);if(0!==Sb)return Promise.reject(new sc.a(Ga(Da)?18:Da.isSameSession?19:20,void 0,void 0,void 0,Sb));var hb=Da.copyContextSnapshot,Xb=this.Bp.Pvb(hb);if(Ga(Da))return this.$oc(Da);Sb=Da.commandParameters.originalDestinations;if(Xb&&Da.isSameSession)return this.fXi(Da,hb,Xb,Sb);if(516!==Da.commandParameters.commandType){Xb=this.TMj(Da.clipboardItems);hb=Xb.v0;if(Xb.returnValue){Da.isShadowWorkbookParsedSuccessfully=
!0;var jc=Xb=null;vb.EwaSettings.getBooleanFeatureGate(eb.a.M4b,!1)?Xb=ya.r(Sb,this.$):jc=ya.v(ya.K(Sb),this.$);return this.HWi(Da,jc,Xb,hb)}if(Da.isClipboardInaccessible)return Promise.reject(new sc.a(8));if(36!==Da.commandParameters.commandType)return this.cFf(Da)}return Promise.reject(new sc.a(6))};D.prototype.beforePaste=function(Da){this.$.da.za(373).Ojj(Da);Da.indicationDisplayScheduled=!0};D.prototype.mMj=function(Da){if(!(Da&&Da.SourceRanges&&Da.SourceRanges.Ranges&&Da.SourceRanges.Ranges.length&&
(Da.OriginalSourceRangesCountExceedsLimit||Da.OriginalSourceMultiRange&&Da.OriginalSourceMultiRange.Ranges&&Da.OriginalSourceMultiRange.Ranges.length)))return{returnValue:!1,v0:null};var Sb=Da.SourceRanges.Ranges[0];if(!Da.ShadowWorkbookBase64&&!Da.ShadowWorkbookSizeExceedsLimit)return{returnValue:!1,v0:null};var hb=this.NDe(Da);hb.rangeRowStart=Sb.FirstRow;hb.rangeRowEnd=Sb.LastRow;hb.rangeColumnStart=Sb.FirstColumn;hb.rangeColumnEnd=Sb.LastColumn;hb.sourceClientPath=Da.SourceClientPath;hb.sourceSheetName=
Da.SourceSheetName;hb.sourceWorkbookName=Da.SourceWorkbookName;if(!Da.OriginalSourceRangesCountExceedsLimit)for(Da=Da.OriginalSourceMultiRange.Ranges,hb.originalSourceRanges=Array(Da.length),Sb=0;Sb<Da.length;++Sb)hb.originalSourceRanges[Sb]=[Da[Sb].FirstRow,Da[Sb].FirstColumn,Da[Sb].LastRow,Da[Sb].LastColumn];return{returnValue:!0,v0:hb}};D.prototype.TMj=function(Da){var Sb=null;Da=Da.getItem(xa.shadowWorkbook);if(!Da)return{returnValue:!1,v0:Sb};Sb=JSON.parse(Da);return{returnValue:this.Tni(Sb),
v0:Sb}};D.prototype.Tni=function(Da){return!!Da&&(!!Da.shadowWorkbookBase64||Da.shadowWorkbookSizeExceedsLimit)&&void 0!==Da.rangeRowStart&&void 0!==Da.rangeRowEnd&&void 0!==Da.rangeColumnStart&&void 0!==Da.rangeColumnEnd};D.prototype.HWi=function(Da,Sb,hb,Xb){Ha.ULS.shipAssertTag(537167903,0,!!Xb,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadowWorkbookPayload shouldn't be null");Kd.AFrameworkApplication.$M("Microsoft.Office.Excel.Server.Flighting.IDenyListNewCopyPasteExperienceAcrossSessions");
Da.pasteResult="CrossSessionPaste";Da.payloadOrigin=H.pEe;Da.payloadType=ba.shadowWorkbook;Da.shadowWorkbookPayloadSize=J(Xb);Da.shadowWorkbookSizeExceedsLimit=U(Xb);Xb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(Da.originalSourceRangesCountExceedsLimit=Xb.originalSourceRangesCountExceedsLimit);if(Da.shadowWorkbookSizeExceedsLimit)return Ha.ULS.sendTraceTag(34415003,0,15,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadow workbook length({0}) is over the limit({1}). reject the paste request. ShadowWorkbookSizeExceedsLimit: {2}",
Da.shadowWorkbookPayloadSize,qb.a.xkc,Xb.shadowWorkbookSizeExceedsLimit),Promise.reject(new sc.a(1));if(1028===Da.commandParameters.commandType&&Da.originalSourceRangesCountExceedsLimit)return Ha.ULS.sendTraceTag(572617859,0,15,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: Original source ranges count({0}) is over the limit({1}). Reject the paste request. OriginalSourceRangesCountExceedsLimit: {2}",Xb.originalSourceRangesCount,qb.a.yyi,Xb.originalSourceRangesCountExceedsLimit),Promise.reject(new sc.a(1));
Ha.ULS.sendTraceTag(537167902,0,50,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: trigger Paste request. PasteOperationId={0}",Da.commandParameters.id);return this.Bp.hFf(Da.commandParameters.ribbonCommandInfo,Sb,hb,Xb,[Da.commandParameters.stopwatch],Da)};D.prototype.Bcd=function(Da,Sb,hb){var Xb=this;Ha.ULS.shipAssertTag(537167901,0,!!Da,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: copyContext shouldn't be null");var jc=Da.commandParameters.stopwatch.qc;return new Promise(function(Wc,
fd){Ha.ULS.sendTraceTag(26035421,0,50,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data for copy Id: {0}",Da.id);var Tc=ya.u(Sb.sheetName,null,Sb.ranges);Xb.Bp.copy(Tc,Da.commandParameters,function(td){Da.requestTelemetryData=td.RequestTelemetryData;Da.serverRequestTimeInMs=Da.commandParameters.stopwatch.qc-jc;if(Mb.a.Qg(td.Errors))Mb.a.Oga(td.Errors)?(Da.encounteredDeploymentErrors=!0,Ha.ULS.sendTraceTag(537167898,0,15,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: {0}. copy Id: {1}",
Mb.a.Ec(td.Errors),Da.id)):(Ha.ULS.sendTraceTag(26035419,0,10,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: {0}. copy Id: {1}",Mb.a.Ec(td.Errors),Da.id),fd(new I(2,td.Errors)));else if(Ha.ULS.sendTraceTag(537167900,0,50,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeed for copy Id: {0}",Da.id),Da.markForCancellation)fd(new I(3,td.Errors));else{td=td.Result;var Tb=td.PlainTextResult;void 0!==hb&&null!==
hb&&(Tb=hb);void 0!==Tb&&null!==Tb&&(Da.plainTextPayloadSize=Tb.length);var Fa=Xb.t$.create(),Qb=Xb.mMj(td);var cc=Qb.v0;Qb.returnValue&&(Da.shadowWorkbookPayloadSize=J(cc),Da.shadowWorkbookSizeExceedsLimit=U(cc),Da.originalSourceRangesCountExceedsLimit=td.OriginalSourceRangesCountExceedsLimit,cc=JSON.stringify(cc),Fa.setItem(xa.shadowWorkbook,cc));Fa.setItem(xa.plainText,Tb);Qa.a.Rcf()&&(Tb=td.HtmlResult,Da.htmlSizeExceedsLimit=td.HtmlSizeExceedsLimit,void 0!==Tb&&null!==Tb&&(Da.htmlPayloadSize=
Tb.length),Fa.setItem(xa.html,Tb));Da.copyTotalSizeExceedsLimit=td.CopyTotalSizeExceedsLimit;Fa.setItem(xa.Jqb,Da.commandParameters.id);Xb.$1c.setValue(Sb,Fa);Da.asyncClipboardItemsKeys=ja(Fa);Wc(Fa)}},function(td){Da.serverRequestTimeInMs=Da.commandParameters.stopwatch.qc-jc;td=oc.a.Mf(td.data);Ha.ULS.sendTraceTag(537167897,0,10,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: {0}. copy Id: {1}",Mb.a.Ec(td),Da.id);fd(new I(2,td))},[Da.commandParameters.stopwatch])})};
Object(V.a)(D,"AcrossSessionRangeCopyPasteHandler",G,[]);Object(V.a)(x,"CopyArtRequest",null,[]);Object(V.a)(z,"PasteArtRequest",null,[]);A.prototype.h3h=function(Da){if(this.Sji(Da.uNa)){Ha.ULS.sendTraceTag(537167681,5,50,"PasteArtRequestManager.HandleRequest: Enqueued paste request as a result of rapid paste on same destination: {0}",Da.uNa);var Sb=this.CIb.na(Da.uNa);this.CIb.ia(Da.uNa,Da);var hb=Sb.promise;Sb.idf=!1;return this.qkh(Da,hb)}this.CIb.ia(Da.uNa,Da);return this.Qqi(Da)};A.prototype.Sji=
function(Da){return this.CIb.kb(Da)};A.prototype.Qqi=function(Da){var Sb=this;return new Promise(function(hb,Xb){Da.promise=Sb.dZa.bFf(Da).then(function(jc){hb(null);return Sb.ync(Da,jc)},function(jc){Xb(null);return Sb.HEb(jc)})})};A.prototype.qkh=function(Da,Sb){var hb=this;return new Promise(function(Xb,jc){Da.promise=Sb.then(function(Wc){hb.ZRj(Da,Wc);return hb.dZa.bFf(Da).then(function(fd){Xb(null);return hb.ync(Da,fd)},function(fd){jc(null);return hb.HEb(fd)})},function(Wc){return hb.HEb(Wc)})})};
A.prototype.ync=function(Da,Sb){Da.idf&&(this.FXg(Da.uNa),this.lMd(Da,Sb));return this.p1i(Sb)};A.prototype.FXg=function(Da){this.CIb.remove(Da)};A.prototype.lMd=function(Da,Sb){var hb=this.gWh();Da.uNa===hb&&this.dZa.lMd(Da.destination,Sb,Da.item.type)};A.prototype.gWh=function(){var Da=ha.g(this.$).ha.Oa.activeFloatingObjectControlId;Da||(Da=ya.v(ha.g(this.$).ha.sa.activeCell,this.$),Da=Da.FirstRow+"_"+Da.FirstColumn);return Da};A.prototype.ZRj=function(Da,Sb){Da.destination=null;Da.mGe=Sb};Object(V.a)(A,
"PasteArtRequestManager",null,[]);var Le=b(191),rf=b(122),af=b(105);Rk(B,O);B.prototype.getSourceItem=function(){Ha.ULS.shipAssertTag(537167896,0,!!this.ha.Oa.activeFloatingObjectControlId,"Expecting a floating object to be currently selected for copy");Ha.ULS.sendTraceTag(537167895,0,50,"ArtCopyPasteHandler.GetSourceItem: Creating ArtSourceItem with FloatingObjectId=[{0}]",this.ha.Oa.activeFloatingObjectControlId);return new ia(this.ha.Oa.activeFloatingObjectControlId,this.$.ea.pa.sheetName,this.$.ea.Ue,
this.$.ya.UserSessionId,this.ha.Oa.Yb.floatingObject.type)};B.prototype.beforeSerialize=function(Da){Da&&Da.commandParameters?(Da?(Da.isAsyncCopy=!1,Da.isSelectionAllowed=!1,Da.isFromCache=!1,Da.plainTextPayloadSize=0,Da.shadowWorkbookPayloadSize=0,Da.htmlPayloadSize=0,Da.htmlSizeExceedsLimit=!1,Da.clientSideCopyTime=0,Da.encounteredDeploymentErrors=!1,Da.shadowWorkbookSizeExceedsLimit=!1,Da.originalSourceRangesCountExceedsLimit=!1,Da.copyTotalSizeExceedsLimit=!1):Ha.ULS.sendTraceTag(537167826,0,
10,"CommonCopyPasteUtils.InitializeCopyContext: copyContext is null."),Da.commandParameters.copyPasteTargetType=2):Ha.ULS.sendTraceTag(537167894,0,10,"ArtCopyPasteHandler.BeforeSerialize: copyContext or copyContext.CommandParameters is null.")};B.prototype.serialize=function(Da){var Sb=Da.sourceItem,hb={};if(!Sb)return Ha.ULS.sendTraceTag(537167893,0,10,"ArtCopyPasteHandler.Serialize: artSourceItem should not be null"),hb;if(!this.Gmi())return Ha.ULS.sendTraceTag(36824456,0,50,"ArtCopyPasteHandler.Serialize: Unsupported floating object type. This will clear the clipboard"),
hb;Ha.ULS.sendTraceTag(537167892,0,50,"ArtCopyPasteHandler.Serialize: Serializing ArtSourceItem with FloatingObjectId=[{0}]",Sb.activeFloatingObjectControlId);this.pDd();var Xb=this.Z1c.getValue(Sb);if(Xb)hb.synchronousResult=Xb,Da.isFromCache=!0,Da.isAsyncCopy=!1,Da.clientSideCopyTime=Da.commandParameters.stopwatch.qc,1===Da.commandParameters.commandType&&this.$.Fd(2045211913,Da.commandParameters.ribbonCommandInfo.method,Da.commandParameters.ribbonCommandInfo.Le,null);else{Da.isFromCache=!1;Da.isAsyncCopy=
!0;Xb=this.t$.create();if(Da.commandParameters.uploadToClipService){var jc={};jc["data-clipservice-ccpid"]=Da.commandParameters.id;jc["data-pkey"]=Da.commandParameters.pKey;jc["data-clipservice-type"]=Da.commandParameters.clipServiceDataType;jc["data-clipservice-count"]=Da.commandParameters.objectCount.toString();jc["data-clipservice-dc"]=Da.commandParameters.clipServiceDataCenter;jc["data-clipservice-client"]=this.BYg;jc["data-TimeStamp"]=(new Date).toUTCString();jc["data-clipservice-version"]=this.CYg;
Xb.setItem(xa.tHg,JSON.stringify(jc))}hb.synchronousResult=this.SAg(Xb);hb.asynchronousResult=this.Bcd(Da,Sb,Xb)}Da.syncClipboardItemsKeys=ja(hb.synchronousResult);return hb};B.prototype.SAg=function(Da){Ha.ULS.shipAssertTag(537167891,0,!!this.ha.Oa.Yb,"Expecting a floating object to be currently selected for copy");Da||(Da=this.t$.create());var Sb=this.ha.Oa.Yb.nub();Sb&&(Sb=String.format("<img src='{0}'>",Sb),Da.setItem(xa.html,Sb));return Da};B.prototype.pDd=function(){var Da=this.ha.Oa.Yb;this.Ynb.pDd(rf.a.Ypb(Da.floatingObject),
rf.a.EYg(Da.Nt))};B.prototype.shouldWaitForCopyToComplete=function(){Ha.ULS.sendTraceTag(537167890,0,50,"ArtCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0};B.prototype.onDeferredPasteStarted=function(Da){this.sU.onDeferredPasteStarted(Da)};B.prototype.onDeferredPasteCompleted=function(Da){this.sU.onDeferredPasteCompleted(Da)};B.prototype.deserialize=function(Da){var Sb=Ga(Da),hb=null,Xb=null,jc=!1;if(!Sb){hb=Da.copyContextSnapshot;Xb=hb.sourceItem;if(!Xb)return Promise.reject(new sc.a(10));
jc=Xb.isFromCurrentSession(this.$)}var Wc=this.qeg(Da,!0);if(0!==Wc)return Promise.reject(new sc.a(Sb?18:jc?19:20,void 0,void 0,void 0,Wc));if(Sb)return this.$oc(Da);if(!jc&&!B.Hfi(Xb))return Da=String.format("User attempted to paste art of type [{0}] between sessions.",Xb.type),Ha.ULS.sendTraceTag(537167889,0,50,Da),Promise.reject(new sc.a(11,void 0,void 0,Da));if(hb.isAsyncSerializeFailed)return Promise.reject(new sc.a(16,void 0,void 0,"Last async serialize failed, therefore no current shadow workbook payload to paste"));
try{var fd=Da.clipboardItems.getItem(xa.shadowWorkbook);var Tc=JSON.parse(fd)}catch(td){return Ha.ULS.sendTraceTag(537167888,0,10,"ArtCopyPasteHandler.Deserialize: Failed to parse shadow workbook JSON with exception: {0}",copyPasteInfra.getStringifiedError(td)),Promise.reject(new sc.a(12,void 0,td))}Tc.floatingObjectId!==Xb.activeFloatingObjectControlId?Ha.ULS.sendTraceTag(537167887,0,10,"ArtCopyPasteHandler.Deserialize: FloatingObjectId mismatch! Deserializing with artSourceItem.ActiveFloatingObjectControlId=[{0}], shadowWorkbookPayload.FloatingObjectId=[{1}]",
Xb.activeFloatingObjectControlId,Tc.floatingObjectId):Ha.ULS.sendTraceTag(537167886,0,50,"ArtCopyPasteHandler.Deserialize: Deserializing with artSourceItem.ActiveFloatingObjectControlId=[{0}], shadowWorkbookPayload.FloatingObjectId=[{1}]",Xb.activeFloatingObjectControlId,Tc.floatingObjectId);if(!Tc||!Tc.shadowWorkbookBase64)return Promise.reject(new sc.a(13,void 0,void 0,String.format("shadowWorkbookPayload is null = {0}",!Tc)));Da.isShadowWorkbookParsedSuccessfully=!0;Da.shadowWorkbookPayloadSize=
J(Tc);Da.shadowWorkbookSizeExceedsLimit=U(Tc);Da.payloadOrigin=jc?H.dUf:H.pEe;Da.payloadType=ba.Uhg;if(U(Tc))return Da=String.format("Shadow workbook size [{0}] is over the limit [{1}]. ShadowWorkbookSizeExceedsLimit: {2}",Da.shadowWorkbookPayloadSize,qb.a.xkc,Tc.shadowWorkbookSizeExceedsLimit),Ha.ULS.sendTraceTag(36304156,0,15,"ArtCopyPasteHandler.Deserialize: {0}",Da),Promise.reject(new sc.a(1,void 0,void 0,Da));hb=Sb=null;ha.g(this.$).ha.Pe&326?hb=ha.g(this.$).ha.Oa.activeFloatingObjectControlId:
Sb=this.$.pa&&this.$.pa.activeCell?ya.v(this.$.pa.activeCell,this.$):ya.v(ya.K(Da.commandParameters.originalDestinations),this.$);jc=null;if(this.Ynb.c1f(Xb))try{jc=this.Ynb.X5c()}catch(td){Ha.ULS.sendTraceTag(537167885,0,10,"ArtCopyPasteHandler.Deserialize: Exception encountered while performing client-side estimation. Exception: {0}",copyPasteInfra.getStringifiedError(td))}return this.IWi.h3h(new z(Da.commandParameters.ribbonCommandInfo,Sb,hb,Da.commandParameters.commandType,[Da.commandParameters.stopwatch],
Tc,Xb,Da,jc))};B.prototype.$oc=function(Da){Da.wasLastCopyExternal=!0;if(Da.clipboardItems.getItem("image/png")){var Sb=Da.commandParameters.stopwatch.qc;Da.payloadType=ba.INg;var hb={};return Va.b(this.$.Fd(1403967063,Da.commandParameters.ribbonCommandInfo.method,Da.commandParameters.ribbonCommandInfo.Le,(hb.dataUrl=Da.clipboardItems.getItem("image/png"),hb))).then(function(Xb){Da.serverRequestTimeInMs=Da.commandParameters.stopwatch.qc-Sb;return Xb?Promise.resolve(null):Promise.reject(new sc.a(15))},
function(){Da.serverRequestTimeInMs=Da.commandParameters.stopwatch.qc-Sb;return Promise.reject(new sc.a(15))})}Ha.ULS.shipAssertTag(537167884,0,!1,"Should not paste external content that is not image via ArtCopyPasteHandler");return O.prototype.$oc.call(this,Da)};B.prototype.Gmi=function(){var Da=ha.g(this.$).ha;return Da.Oa.activeFloatingObjectControlId&&Da.Oa.Yb&&Da.Oa.Yb.floatingObject?Da.Oa.Yb.floatingObject.yTd():!1};B.prototype.Bcd=function(Da,Sb,hb){var Xb=this;return new Promise(function(jc,
Wc){var fd=Da.commandParameters.stopwatch.qc;Ha.ULS.sendTraceTag(41562516,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data...");Xb.dZa.Y2g(new x(Sb.activeFloatingObjectControlId,Da.commandParameters,function(Tc){Da.requestTelemetryData=Tc.RequestTelemetryData;Da.serverRequestTimeInMs=Da.commandParameters.stopwatch.qc-fd;if(Mb.a.Qg(Tc.Errors))Mb.a.Oga(Tc.Errors)?(Da.encounteredDeploymentErrors=!0,Ha.ULS.sendTraceTag(537167879,0,15,"ArtCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: {0}",
Mb.a.Ec(Tc.Errors))):(Ha.ULS.sendTraceTag(36229122,0,10,"ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: {0}",Mb.a.Ec(Tc.Errors)),Wc(new I(4,Tc.Errors)));else if(Ha.ULS.sendTraceTag(537167883,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeeded for FloatingObjectId=[{0}].",Sb.activeFloatingObjectControlId),Da.markForCancellation)Wc(new I(3,Tc.Errors));else{Mb.a.Uq(Tc.Errors)&&Ha.ULS.sendTraceTag(537167882,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: Server messages present. Errors: {0}",
Mb.a.Ec(Tc.Errors));var td=Tc.Result;if(td){td=Xb.NDe(td);td.floatingObjectId=Sb.activeFloatingObjectControlId;Da.shadowWorkbookPayloadSize=J(td);Da.shadowWorkbookSizeExceedsLimit=U(td);try{var Tb=JSON.stringify(td)}catch(Fa){Wc(new sc.a(14,void 0,Fa,String.format("Failed to stringify shadow workbook: copyContext.ShadowWorkbookPayloadSize: [{0}], shadowWorkbookPayload.FloatingObjectId: [{1}]",Da.shadowWorkbookPayloadSize,td.floatingObjectId)));return}Ha.ULS.shipAssertTag(537167881,0,!!hb,"Expecting syncClipboardItems to be defined");
hb.setItem(xa.shadowWorkbook,Tb);1===Da.commandParameters.commandType&&(Xb.WZi(Sb.type,Sb.activeFloatingObjectControlId,Tc.StateId),Xb.deleteFloatingObject(Sb.activeFloatingObjectControlId,Sb.type));Xb.Z1c.setValue(Sb,hb);Da.asyncClipboardItemsKeys=ja(hb);jc(hb)}else Ha.ULS.sendTraceTag(537167880,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: Result form server returned null, copied item id: {0}",Sb.activeFloatingObjectControlId),jc(Xb.Z1c.getValue(Sb))}},Da.commandParameters.commandType,Sb.type,
function(Tc){Da.serverRequestTimeInMs=Da.commandParameters.stopwatch.qc-fd;Tc=oc.a.Mf(Tc.data);1===Da.commandParameters.commandType&&Xb.dZa.SNj(Sb.type,Sb.activeFloatingObjectControlId);Ha.ULS.sendTraceTag(537167878,0,10,"ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: {0}",Mb.a.Ec(Tc));Wc(new I(4,Tc))},[Da.commandParameters.stopwatch]))})};B.prototype.deleteFloatingObject=function(Da,Sb){Da=Le.a.Vy(Sb,Da);if(Da=af.a(this.$).oq(Da))af.a(this.$).deleteFloatingObject(Da,
14,!0),ha.g(this.$).ha.Oa.nC=null};B.prototype.WZi=function(Da,Sb,hb){var Xb=this.$.da.za(277);if(Xb){var jc=null;Da=Le.a.Vy(Da,Sb);Da=af.a(this.$).oq(Da);if(null===Da||void 0===Da?0:Da.Fi)jc=Da.Fi.block;if(jc){var Wc=Da.floatingObject.Gg();Xb.GYb(function(){return!jc.Ii.kb(Wc)},hb,"CutArt")}}};B.Hfi=function(Da){return 1===Da.type||5===Da.type};Object(V.a)(B,"ArtCopyPasteHandler",O,[]);var xe=b(54);Rk(w,Q);Object(V.a)(w,"MacroRecorderPasteArtPayload",Q,[]);m.prototype.z8h=function(Da,Sb,hb,Xb,jc,
Wc,fd){var Tc=this;Wc=void 0===Wc?null:Wc;fd=void 0===fd?null:fd;var td=this.$.oa.xa.Pb(),Tb=null,Fa={CopyPasteTargetType:2};Fa.FloatingObjectId=Da;Fa.CopyOperationId=hb.id;hb.floatingObjectType=Sb;Fa.UploadToClipService=hb.uploadToClipService;Fa.PKey=hb.pKey;Fa.ClipServiceDataCenter=hb.clipServiceDataCenter;var Qb=0;2===jc?(jc=505,Qb=16,Tb=function(cc,bc,Mc){return fa(Tc.$.oa.xa,Fa,Gc.b(cc,Xb),Wc?Gc.a(bc,Wc):bc,Mc,hb.ribbonCommandInfo,td,fd)}):(jc=179,Tb=function(cc,bc,Mc){Tc.sgh(Sb,Da);Tc.$.ly();
var rd=Tc.$.oa.xa;cc=Gc.b(cc,Xb);bc=Wc?Gc.a(bc,Wc):bc;var Hd=hb.ribbonCommandInfo,ic=fd;ic=void 0===ic?null:ic;var Jc=rd.Na(1,void 0===td?null:td);Jc.copyParameters=Fa;return wb.g(rd,"Cut",Jc,cc,bc,Mc,Hd,0,ic)});vb.EwaSettings.Zb()?this.$.userOperationManager.Sb(new pc.a(jc,0,Tb,Qb|64),hb.ribbonCommandInfo):this.$.userOperationManager.Sb(new nb.a(jc,0,Tb,Qb),hb.ribbonCommandInfo)};m.prototype.sgh=function(Da,Sb){var hb=Le.a.Vy(Da,Sb);(hb=af.a(this.$).oq(hb))?(ha.g(this.$).ha.Oa.NG(hb),hb.isVisible=
!1):Ha.ULS.sendTraceTag(537167876,0,50,"ArtCopyPasteUtils.DoCutClientEstimation: floatingObjectcontrol is null. FloatingObjectType : {0}, FloatingObjectId: {1}",Da,Sb)};m.prototype.SNj=function(Da,Sb){Da=Le.a.Vy(Da,Sb);if(Da=af.a(this.$).oq(Da))Da.isVisible=!0};m.prototype.Y2g=function(Da){this.z8h(Da.floatingObjectId,Da.W2g,Da.commandParameters,Da.kt,Da.xah,Da.naa,Da.vOb)};m.prototype.Z8h=function(Da,Sb,hb,Xb,jc,Wc,fd,Tc,td){var Tb=this;Tc=void 0===Tc?null:Tc;td=void 0===td?!0:td;return new Promise(function(Fa,
Qb){var cc=Wc.commandParameters.stopwatch.qc;Tb.HMd(Da,jc,Sb,hb,function(bc){Wc.requestTelemetryData=bc.RequestTelemetryData;Wc.serverRequestTimeInMs=Wc.commandParameters.stopwatch.qc-cc;if(Mb.a.Oga(bc.Errors))Wc&&(Wc.encounteredDeploymentErrors=!0),Ha.ULS.sendTraceTag(537167875,0,15,"ArtCopyPasteUtils.PasteArt: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: {0}",Mb.a.Ec(bc.Errors));else if(Mb.a.Qg(bc.Errors))Ha.ULS.sendTraceTag(36459652,0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: {0}",
Mb.a.Ec(bc.Errors)),Qb(new sc.a(9,bc.Errors));else if(bc.Result){var Mc=bc.Result;Ha.ULS.sendTraceTag(537167874,0,50,"ArtCopyPasteUtils.PasteArt: PasteArt succeeded.");Tb.k_i(fd,Mc.FloatingObjectId,bc.StateId);Fa(m.Pjd(Mc.FloatingObjectId))}else Ha.ULS.sendTraceTag(537167873,0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed, result returned from server is null."),Qb(new sc.a(9,bc.Errors))},function(bc){Wc.serverRequestTimeInMs=Wc.commandParameters.stopwatch.qc-cc;bc=oc.a.Mf(bc.data);Ha.ULS.sendTraceTag(537167872,
0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: {0}",Mb.a.Ec(bc));Qb(new sc.a(9,bc))},Xb,Tc,td)})};m.prototype.k_i=function(Da,Sb,hb){var Xb=this,jc=this.$.da.za(277);if(jc){var Wc=Le.a.Vy(Da,m.Pjd(Sb));jc.GYb(function(){return!!af.a(Xb.$).oq(Wc)},hb,"PasteArt")}};m.prototype.LWd=function(Da,Sb){Sb&&this.Ynb.LWd(Da,Le.a.Vy(Da.type,Sb))};m.prototype.bFf=function(Da){var Sb=this;return this.Z8h(Da.ribbonCommandInfo,Da.destination,Da.mGe,Da.vOb,Da.v0,Da.pasteContext,Da.item.type,Da.cye,Da.item.isFromCurrentSession(this.$)).then(function(hb){return hb},
function(hb){Sb.LWd(Da.item,Da.cye);return Promise.reject(hb)})};m.prototype.lMd=function(Da,Sb,hb){Da||(Da=ya.v(ha.g(this.$).ha.sa.activeCell,this.$));ha.g(this.$).nhc(ya.D(Da),1)?af.a(this.$).ana(hb,Sb,!0):ha.g(this.$).ha.Oa.vsa(Da,Sb,hb).continueWith(function(Xb){Xb.result?Ha.ULS.sendTraceTag(537167843,5,50,"ArtCopyPasteUtils.SelectPastedObject: Selection succeeded in async manner for object ID [{0}]",Sb):Ha.ULS.sendTraceTag(537167842,5,10,"ArtCopyPasteUtils.SelectPastedObject: Selection failed in async manner for object ID [{0}]",
Sb)})};m.prototype.HMd=function(Da,Sb,hb,Xb,jc,Wc,fd,Tc,td){function Tb(){if(td){var Mc=xe.a.Th(xe.a.xc(bc));Mc.FloatingObjectId=Sb.floatingObjectId;bc.DestinationRanges||(Mc.DestinationRanges=ya.p(Qb.$.va.pa.sheetName,"",0,0,0,0));return new w(Mc,td,0,0)}return new w(bc,td,0,0)}function Fa(Mc,rd,Hd){Tc||Qb.$.ly();return R(Qb.$.oa.xa,bc,Gc.b(Mc,jc),Gc.a(rd,Wc),Hd,null,cc,fd)}var Qb=this;td=void 0===td?!0:td;var cc=this.$.oa.xa.Pb(),bc={};bc.ShadowWorkbookBase64=Sb.shadowWorkbookBase64;bc.FloatingObjectId=
Xb;bc.DestinationRanges=hb?ya.s(hb):null;bc.CopyPasteTargetType=2;bc.ClientEstimationFloatingObjectId=Tc;hb=vb.EwaSettings.Zb()?new pc.a(503,0,Fa,void 0,Tb):new nb.a(503,0,Fa,void 0,Tb);hb.flags=vb.EwaSettings.Zb()?65:1;this.$.userOperationManager.Sb(hb,Da)};m.Pjd=function(Da){return String.format("{0}.{{{1}}}",Da.length+2,Da.toUpperCase())};Object(V.a)(m,"ArtCopyPasteUtils",null,[748]);var Td=b(226);y.prototype.pDd=function(Da,Sb){this.Ssa=Da;this.X1c=Sb};y.prototype.X5c=function(){if(!this.Ssa||
!this.X1c)return Ha.ULS.sendTraceTag(537167841,0,15,"ArtPasteClientEstimation.DoPasteClientEstimation: copiedFloatingObjectControl and/or copiedEffectsExtents is null, aborting client side estimation."),"";var Da=rf.a.Ypb(new Le.a(this.Ssa));Da.Id=m.Pjd(Fb.a.create().toString());Da.Version=-1;Da.Name="";Da.IsClientEstimation=!0;var Sb=this.m$h(Da);if(!Sb)return null;var hb=new Le.a(Da);Sb.block.Ii.add(hb);hb.HIb();var Xb=af.a(this.$);Xb.b4b(hb,Sb);Sb=Xb.oq(Le.a.dPh(Da));!Sb||Sb.floatingObject.SLa||
Sb.floatingObject.oMa||Sb.dRa(this.X1c);Xb.ana(Da.Type,Da.Id,!0);return Da.Id};y.prototype.c1f=function(Da){return vb.EwaSettings.ma(223)&&Da.isFromCurrentSession(this.$)&&!ha.g(this.$).rtl&&!ha.g(this.$).eb.Ji};y.prototype.LWd=function(Da,Sb){this.c1f(Da)&&(Da=af.a(this.$).oq(Sb))&&(Ha.ULS.sendTraceTag(537167840,5,50,"ArtPasteClientEstimation.UndoPasteClientEstimation: undoing client-side estimation. Removing floating object with ID: [{0}] of type [{1}]",Sb,Da.floatingObject.type),af.a(this.$).deleteFloatingObject(Da,
15,!0),Da.Fi&&Da.Hab(Da.Fi,!1))};y.prototype.m$h=function(Da){if(!Da)return Ha.ULS.sendTraceTag(537167839,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: Called with null FloatingObjectData."),null;if(ha.g(this.$).ha.Oa.activeFloatingObjectControlId){var Sb=ha.g(this.$).ha.Oa.nC.floatingObject;Da.OriginDeltaX=Sb.offsetX+this.k$a;Da.OriginDeltaY=Sb.offsetY+this.k$a;Da.AbsoluteLeft+=this.k$a;Da.AbsoluteTop+=this.k$a;Da.AbsoluteRight+=this.k$a;Da.AbsoluteBottom+=this.k$a;Da.ZOrder=Sb.wy+
1;return ha.g(this.$).ha.Oa.nC.Fi}if(!this.$.pa||!this.$.pa.activeCell)return Ha.ULS.sendTraceTag(537167838,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: ActiveItem/ActiveCell is null - cannot perform estimation for grid paste."),null;var hb=this.$.pa.activeCell;Sb=ha.g(this.$).Y0(hb);if(!Sb)return Ha.ULS.sendTraceTag(537167837,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: gridViewBlock for range {0} is null.",hb.toString()),null;var Xb=Za.HelperMethods.Avb(Sb.domElement,
Sb.lj.domElement);hb=Sb.gridView.fg(hb,2);if(!Xb||!hb)return Ha.ULS.sendTraceTag(537167836,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: blockPositionRelativeToGridOrigin is null: {0}. cellPositionRelativeToGridOrigin is null: {1} .",!Xb,!hb),null;Da.OriginDeltaX=hb.topLeft.x-Xb.x;Da.OriginDeltaY=hb.topLeft.y-Xb.y;Da.AbsoluteLeft=hb.topLeft.x;Da.AbsoluteTop=hb.topLeft.y;Da.AbsoluteRight=Da.AbsoluteLeft+Math.abs(this.Ssa.AbsoluteRight-this.Ssa.AbsoluteLeft);Da.AbsoluteBottom=Da.AbsoluteTop+
Math.abs(this.Ssa.AbsoluteBottom-this.Ssa.AbsoluteTop);Da.ZOrder=this.Ssa.ZOrder+100;return new Td.a(Sb.gridView.Ea.ll(Sb.hashCode),Sb.hashCode)};Object(V.a)(y,"ArtPasteClientEstimation",null,[747]);r.prototype.create=function(){var Da=window.clipboardPlatform;return Da?Da.createClipboardItems():null};Object(V.a)(r,"ClipboardItemsFactory",null,[746]);v.undefined="Undefined";Object(V.a)(v,"CCPTelemetryConsts",null,[]);f.cells="Cells";f.floatingObject="FloatingObject";f.unknown="Unknown";Object(V.a)(f,
"ActiveSelection",null,[]);n.Efh="DisplayNotInvoked";n.P5c="Displayed";n.v_i="PrerequisitesNotReady";Object(V.a)(n,"PasteIndicationDisplayStatus",null,[]);var Bc=b(110);l.prototype.getCopyFlowHandler=function(Da){var Sb=this.ZKh(ha.g(this.$).Pe);Da.commandParameters.copyPasteHandlerName=Sb.name;return Sb};l.prototype.getPasteFlowHandler=function(Da){var Sb=Da.copyContextSnapshot;Sb=Ka(Da)?this.qWc:Ga(Da)?this.tFd:(null===Sb||void 0===Sb?0:Sb.sourceItem)&&Object.getType(Sb.sourceItem)===ia?this.qWc:
this.tFd;Da.commandParameters.copyPasteHandlerName=Sb.name;return Sb};l.prototype.initializePasteContext=function(Da){if(Da&&(Da.isSameSession=!1,Da.isShadowWorkbookParsedSuccessfully=!1,Da.pasteResult=v.undefined,Da.payloadOrigin=v.undefined,Da.payloadType=v.undefined,Da.encounteredDeploymentErrors=!1,Da.shadowWorkbookSizeExceedsLimit=!1,Da.originalSourceRangesCountExceedsLimit=!1,Da.activeSelectionType=this.LGh(),Da.indicationDisplayScheduled=!1,Da.pasteDestinationHasMergedCells=!1,Da.pasteIndicationDisplayStatus=
n.Efh,Da.copyContextSnapshot)){var Sb=Da.copyContextSnapshot,hb=qa(Sb.sourceItem),Xb=Sb.sourceItem;var jc=!!Xb&&Object.getType(Xb)===ia;Xb=0;var Wc=!1;hb?(Wc=Sb.sourceItem,Da.isSameSession=Wc.isFromCurrentSession(this.$),Xb=1,Wc=this.Tji(Wc,Da)):jc&&(Da.isSameSession=Sb.sourceItem.isFromCurrentSession(this.$),Xb=2);if(Da.copyContextSnapshot.commandParameters){jc=-1985798686===Sb.commandParameters.ribbonCommandInfo.command;var fd=Da.commandParameters;var Tc=this.$;Sb?Tc&&Tc.ya?Sb=Sb.sessionId===Tc.ya.UserSessionId:
(Ha.ULS.shipAssertTag(537166211,0,!1,"ewaControl shouldn't be null"),Sb=!1):(Ha.ULS.shipAssertTag(537166212,0,!1,"copyContext shouldn't be null"),Sb=!1);fd.clearSystemClipboard=Sb&&jc&&hb&&!Wc;Da.commandParameters.copyPasteTargetType=Xb}}};l.prototype.getSessionId=function(){return this.$.ya.UserSessionId};l.prototype.Tji=function(Da,Sb){var hb=Bc.b(Da.ranges,function(Xb){return Xb.Te})&&Bc.b(Sb.commandParameters.originalDestinations,function(Xb){return 1!==Xb.top});return Bc.b(Da.ranges,function(Xb){return Xb.isRow})&&
Bc.b(Sb.commandParameters.originalDestinations,function(Xb){return 1!==Xb.left})||hb};l.prototype.ZKh=function(Da){switch(Da){case 1:return this.tFd;case 64:case 4:case 2:case 256:return this.qWc;default:throw Error.invalidOperation("Unsupported selection");}};l.prototype.LGh=function(){return ha.g(this.$).ha.Pe&470?f.floatingObject:1===ha.g(this.$).ha.Pe?f.cells:f.unknown};l.prototype.getDialogResponse=function(){};Mf.Object.defineProperties(l.prototype,{tFd:{configurable:!0,enumerable:!0,get:function(){if(!this.AOc){var Da=
this.$.da.za(254,!0);Da&&(this.AOc=new D(this.$,Da,new r))}return this.AOc}},qWc:{configurable:!0,enumerable:!0,get:function(){if(!this.vEc&&this.$.da.za(254,!0)){var Da=new y(this.$);this.vEc=new B(this.$,new r,new m(this.$,Da),Da)}return this.vEc}}});Object(V.a)(l,"ExcelCopyPasteApplicationHost",null,[731]);var qd=b(162),Jd=yb.a;Rk(k,Jd);k.prototype.rg=function(Da){this.Ko=new qd.a;var Sb=ec.a.instance.ga(16);Da=this.BM(Da);this.initializeAndShow(Sb,this.ibi,Da)};k.prototype.BM=function(Da){var Sb=
{};return Sb[k.Vv]=this.nc,Sb[k.vli]=Da,Sb};Mf.Object.defineProperties(k.prototype,{nc:{configurable:!0,enumerable:!0,get:function(){return"InsertCopiedCutCellsDialog"}}});k.Neh="direction";k.vli="isRtl";var ad={};k.Oeh=(ad.Vertical=1,ad.Horizontal=0,ad);Object(V.a)(k,"InsertCopiedCutCellsDialog",yb.a,[]);e.prototype.d4b=function(Da,Sb){return(new k(Da,Sb)).Ko.task};Object(V.a)(e,"InsertCopiedCutCellsDialogFactory",null,[729]);var Yd=b(89),pe=b(47),Wd=b(44);d.prototype.qIe=function(){var Da=this;
this.Npc||(Ha.ULS.sendTraceTag(537167680,0,50,"PasteIndicationManager.DownloadPrerequisitesIfNeeded: Trying to get appChrome"),this.gridView.$.bB(function(Sb){Sb.aja(0).then(function(){Da.Npc=!0})}))};d.prototype.Ojj=function(Da){var Sb=this,hb=Da.commandParameters.id;Ha.ULS.sendTraceTag(537167651,0,50,"PasteIndicationManager.ScheduleDisplay: pasteCommandId = {0}, cancelCtx is null = {1}, PrerequisitesDownloaded = {2}",hb,!this.Hs,this.Npc);this.qIe();this.d5b=hb;hb=!this.Gqf();if(!this.Hs||hb)this.vve(),
this.Hs=pe.a.instance.create(function(){Sb.Dfh(Da)},void 0===Da.timeoutToShowSpinnerInMs||null===Da.timeoutToShowSpinnerInMs?100:Da.timeoutToShowSpinnerInMs,Wd.a.NWi);this.d2=Da.commandParameters.originalDestinations};d.prototype.Dfh=function(Da){this.Npc?(this.display(Da.commandParameters.originalDestinations),Da.pasteIndicationDisplayStatus=n.P5c):(Ha.ULS.sendTraceTag(537167650,0,50,"PasteIndicationManager.DisplayIfPossible: Prerequisites were not ready, skipping display"),this.hide(),Da.pasteIndicationDisplayStatus=
n.v_i)};d.prototype.display=function(Da){Ha.ULS.sendTraceTag(537167649,0,50,"PasteIndicationManager.Display: started");this.gridView.qb.Fw(ld.a.J7(uc.d(this.gridView.$.pa),Da),d.apc,!0);this.gridView.qb.qn(d.apc)};d.prototype.Aid=function(Da){Ha.ULS.sendTraceTag(537167648,0,50,"PasteIndicationManager.HideForPasteId: pasteCommandId = {0}, currentPasteCommandId = {1}",Da,this.d5b);Da&&Zb.a.equals(Da,this.d5b,!1)&&this.hide()};d.prototype.hide=function(Da){this.d2&&(void 0===Da?0:Da)&&this.Gqf()&&Ha.ULS.sendTraceTag(537167647,
0,15,"PasteIndicationManager.Hide: Triggered by a SelectionChanged event while indication is (or will be) active but active range did not change");this.d5b="";this.vve();this.d2=null;this.gridView.qb.eh(d.apc);this.gridView.qb.Ti(null,d.apc)};d.prototype.Gqf=function(){return ya.Q(this.gridView.ha.sa.selectedRanges,this.d2)};d.prototype.vve=function(){this.Hs&&(Yd.a.Ia(this.Hs),this.Hs=null)};d.prototype.dispose=function(){this.hide();this.gridView.ha.zF(this.G6e)};d.apc=[30];Object(V.a)(d,"PasteIndicationManager",
null,[730,3]);var bf=b(1182),ke=b(53),cf=b(911),Pe=ob.a;Rk(c,Pe);c.prototype.create=function(){var Da=this,Sb=ke.a.BV([73,74],4,this.hb,void 0,void 0,void 0,c.dAa),hb=pa.GetServiceTaskFactory.create(this.$.da,18,this.$.la,this.hb);Kb.TaskExtensions.Aa(Kb.TaskExtensions.Vd([hb,Sb],this.la),function(){var Xb=new bf.a,jc=null;Da.z0g(Xb).then(function(Wc){jc=Wc.gye;var fd=copyPasteInfra.createCopyPasteInfra(jc,new l(Da.$),Xb,Da.$);Ha.ULS.shipAssertTag(537167762,0,!!Da.$.ya,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext should not be null");
Ha.ULS.shipAssertTag(537167761,0,!!Da.$.ya&&!!Da.$.ya.DocumentHostInfo,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext.DocumentHostInfo should not be null");var Tc=jc.getMetadataManager(),td=Object(cf.b)(Da.$.da,254,function(){return new X(Da.$,Tc,hb.result,fd,new N(Da.$,ha.g(Da.$)),new e,Da.$.ya.DocumentHostInfo.UserId,jc.getInitializationError())});Da.pb(td);Wc.B_a?Ha.ULS.sendTraceTag(41731933,0,50,"CopyPasteInfrastructureFactory.Create: Initialize CCP infra succeed. SliceName={0}, StrategyType={1}, StrategyCapabilities={2}, IsBestStrategyTypeInitialized={3}, InfraLoadTimeMS={4}",
X.Q$b(),Wc.B_a.dataClipboardStrategyType,JSON.stringify(Wc.B_a.dataClipboardCapabilities),Wc.B_a.clipboardStrategiesToInitialize[0].clipboardStrategyType===Wc.B_a.dataClipboardStrategyType,void 0===window.bsqmXLSPageLoadStartTime||null===window.bsqmXLSPageLoadStartTime?"-1":(Date.now()-window.bsqmXLSPageLoadStartTime.getTime()).toString()):Ha.ULS.shipAssertTag(537167760,0,!1,"CopyPasteInfrastructureFactory.Create: initResult.ClipboardPlatformEnvironmentInitializationInfo should not be null")},function(Wc){Ha.ULS.shipAssertTag(38847436,
0,!1,"CopyPasteInfrastructureFactory.Create: error during call to clipboardPlatformEnvironment.Init(). Copy Paste operations will not be available in this session. SliceName: {0} error: {1}",X.Q$b(),Wc?copyPasteInfra.getStringifiedError(Wc):"null")})},this.la,3)};c.prototype.dispose=function(){Pe.prototype.dispose.call(this)};c.prototype.z0g=function(Da){var Sb=null,hb=window.clipboardPlatform;hb&&(Sb=hb.getClipboardPlatformEnvironment());if(!Sb)return Ha.ULS.shipAssertTag(537167759,0,!1,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: getClipboardPlatformEnvironment should have returned a valid object"),
Promise.reject(null);hb=this.$.ya;var Xb=[hb.OfficeOnlineChromeExtensionId,hb.ChromeClipboardAccessExtensionId],jc=this.Gm.Xa(5),Wc=this.$.Jf.get(57),fd=!Wc&&this.$.Jf.get(5),Tc=this.$.ea.hc;Tc&&(Tc.inWebPart||Tc.inViewerFromWebPart||Tc.isDivSyndicated)&&(fd=!1);Wc=this.XJh(fd,!Wc);Ha.ULS.shipAssertTag(537167758,0,!!hb.DocumentHostInfo,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: bootstrapContext.DocumentHostInfo should not be null");return Sb.init(this.$,Da,Xb,hb.SharedClipboardHostingApp,
hb.SharedClipboardHostingApps,hb.SharedClipboardHostingEnvironments,hb.SharedClipboardOverrideOrigin,hb.SharedClipboardSchemaVersion,hb.SharedClipboardExpirationInMinutes,hb.ClipboardPromiseTimeoutInMinutes,jc,hb.MachineCluster,new K(this.$),Wc,hb.DocumentHostInfo.UserId,hb.ClipboardTtlInMS,vb.EwaSettings.ma(311),hb.UserSessionId).then(function(td){return Object(Ia.a)(new wa,{gye:Sb,B_a:td})},function(td){return Promise.reject(td)})};c.prototype.XJh=function(Da,Sb){var hb=[];Da&&Sb&&hb.push(this.X9g());
Sb&&(hb.push(this.C3c(7)),hb.push(this.C3c(0)));Da&&hb.push(this.VCe());hb.push({clipboardStrategyType:4});Ha.ULS.sendTraceTag(39978242,0,50,"CopyPasteInfrastructureFactory.GetClipboardStrategiesInitList: create clipboard stratgy initialization list: isBrowserStorageAllowed={0}, isSystemClipboardAllowed={1}, result = {2}",Da,Sb,hb?hb.join(","):"[]");return hb};c.prototype.VCe=function(){var Da=this.$.ya,Sb={clipboardStrategyType:5};Sb.sessionId=Da.UserSessionId;Sb.useSharedClipboardIframe=!0;Sb.sharedClipboardHostingApp=
Da.SharedClipboardHostingApp;Sb.sharedClipboardHostingApps=Da.SharedClipboardHostingApps;Sb.sharedClipboardHostingEnvironments=Da.SharedClipboardHostingEnvironments;Sb.sharedClipboardOverrideOrigin=Da.SharedClipboardOverrideOrigin;Sb.sharedClipboardSchemaVersion=Da.SharedClipboardSchemaVersion;Sb.sharedClipboardExpirationInMinutes=Da.SharedClipboardExpirationInMinutes;Sb.wacCluster=Da.MachineCluster;return Sb};c.prototype.X9g=function(){var Da={clipboardStrategyType:6};Da.localStorageStrategyParameters=
this.VCe();Da.systemClipboardStrategyParameters=this.C3c(0);return Da};c.prototype.C3c=function(Da){var Sb={};Sb.clipboardStrategyType=Da;Sb.skipFilesIfPlainTextExists=!0;return Sb};c.ka=function(Da){Da.da.Ga(373,new d(Da));Da.da.Ga(c.dAa,new c(Da))};c.dAa=255;Object(V.a)(c,"CopyPasteInfrastructureFactory",ob.a,[]);var nc=b(10);b.d(E,"a",function(){return a})},1350:function(u,E,b){function a(){Type.registerNamespace("Common");Type.registerNamespace("Common.App.ApplicationFeatureHelper");c.main()}
function c(){this.fb=null}function d(Xa,aa){if(void 0===Xa||null===Xa||void 0===aa||null===aa)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.ib=Xa;this.Og=aa;this.ZPc=this.he=null}function e(){this.kIe=this.Qdg=this.Kt=0;this.lIe=this.Rdg=this.mHa="";this.HQc=this.qea=2}function k(Xa,aa){this.wFc=0;this.C2b=null;this.Dib=new w(Xa,aa);this.ib=Xa;aa=Xa.Wa("HostAuthType");this.eEa=Xa.qa("OcpsIsEnabled")&&Xa.qa("IsO365CommercialHost")&&!(void 0===aa||null===aa)&&"aad"===aa.toLowerCase();
this.kbe=H.b(Xa.Wa("OcpsDefaultSettings")||"{}");this.sjb=this.cbc();aa=this.ib.Zn("ServicesControlsMicrosoftControllerServicesList")?this.ib.dw("ServicesControlsMicrosoftControllerServicesList")||[]:[];this.sRb=new K.a;for(var ba=0;ba<aa.length;ba++)this.sRb.add(aa[ba]);this.eEa&&!Xa.qa("IsAnonymousUser")&&Xa.qa("SideCarIsEnabled")?this.C2b=this.KMj():this.C2b=this.moa(this.eEa,this.Tua("/afhs/CloudPolicySettings.ashx"),Object(D.a)(this,this.bWi,"parseCloudPolicySettingsResponse"));this.C2b.then(function(){return null}).catch(function(oa){A.ULS.sendTraceTag(50622685,
3004,10,JSON.stringify(oa))})}function l(){this.ControllerConnectedServicesFeatureNames=this.PolicySettings=null}function n(){}function f(Xa,aa){this.PolicySettings=null;this.ExpirationTime=0;this.PolicySettings=Xa.PolicySettings;Xa=new Date;Xa.setMinutes(Xa.getMinutes()+aa);this.ExpirationTime=Xa.getTime()}function v(Xa,aa,ba,oa,ra){var db=this;ba=void 0===ba?null:ba;oa=void 0===oa?null:oa;ra=void 0===ra?null:ra;this.iua=this.JVb=this.Mde=this.kqa=this.MWb=null;this.Dib=new w(Xa,aa);this.ib=Xa;this.yrg=
Xa.kd("LicensingMaxRetryAttempts",0);this.zKc=Xa.qa("IsO365ConsumerHost");this.yKc=Xa.qa("IsO365CommercialHost");this.qTb=Xa.qa("PremiumUpsellIsEnabled");this.t2d=ba;this.Uhe=oa;this.La=ra;this.jqa=Xa.qa("LicensingIsEnabled");this.eEa=Xa.qa("OcpsIsEnabled")&&this.yKc;this.XRc=Xa.qa("ShowPrivacyDialog")&&!!oa;this.C7d=Xa.qa("IsAnonymousUser");this.S9c=new Promise(function(Ka){Ka(!1)});this.nBa=new Promise(function(Ka){Ka(!0)});this.hua=new z.a(x.a.Ik());this.xXb=this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SupportUserConsentBasedFeaturesInAFH",
!1);this.e$d=this.IQh();this.ood()&&!this.C7d?(void 0!==O.AFrameworkApplication.ta&&null!==O.AFrameworkApplication.ta&&(this.MWb=O.AFrameworkApplication.ta.pD,void 0!==this.MWb&&null!==this.MWb&&(this.kqa=this.MWb.Kg("WebServiceCall","ApplicationFeatureHelperService"))),this.iua=this.sWd()):this.iua=new Promise(function(Ka){Ka({})});this.iua.catch(function(Ka){A.ULS.sendTraceTag(42513088,3004,10,JSON.stringify(Ka))});this.xXb&&(this.qTb=!1,this.isFeatureEnabled("FreemiumUpsell",!0).then(function(Ka){db.qTb=
db.ib.qa("PremiumUpsellIsEnabled")&&Ka;return null}))}function r(Xa,aa,ba){this.featureName=null;this.isEnabled=!1;this.tierName=0;this.featureName=Xa;this.isEnabled=aa;this.tierName=ba}function y(Xa,aa){this.TJj=3E5;if(void 0===Xa||null===Xa||void 0===aa||null===aa)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.ib=Xa;this.oQb=new z.a(x.a.Ik());this.Dib=new w(Xa,aa);void 0!==J.a.Otd&&null!==J.a.Otd&&void 0!==J.a.Ujc&&null!==J.a.Ujc&&0<J.a.Ujc&&(Xa=new m,Xa.Token=J.a.Otd,
Xa.ExpirationTime=J.a.Ujc,this.oQb.ia("loki",Xa))}function m(){this.Token=null;this.ExpirationTime=0}function w(Xa,aa){this.ib=Xa;this.Og=aa}function B(){this.message=null;this.Vdc=0}u=b(0);var A=b(14),z=b(894),x=b(616),D=b(84),I=b(85),F;(function(Xa){Xa[Xa.applicationFeatureHelperHandler=0]="applicationFeatureHelperHandler";Xa[Xa.cloudPolicySettings=1]="cloudPolicySettings";Xa[Xa.alternateAuthToken=2]="alternateAuthToken"})(F||(F={}));Object(u.b)("ApplicationFeatureHelperRequestType",F);Object(u.a)(B,
"HttpRequstToPromiseRejectData",null,[]);var G=b(99),T=b(246);w.prototype.S2c=function(Xa,aa,ba,oa,ra,db,Ka,Ga){var xa=this;oa=void 0===oa?null:oa;ra=void 0===ra?null:ra;db=void 0===db?null:db;Ka=void 0===Ka?null:Ka;Ga=void 0===Ga?null:Ga;var da=F[ba],qa=da+"RequestFailure";G.Health.instance.recordKpiUsage(qa,0,"jpittsdirects",null);return new Promise(function(na,ia){A.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",da);var ta=
null!=Ka?Ka:xa.ib.kd("ApplicationFeatureHelperRequestQueueTimeout",15E3),za=null!=Ga?Ga:xa.ib.kd("ApplicationFeatureHelperRequestSentTimeout",3E4);xa.Og.A9(Xa,1,null,xa.nPh(ba,oa),db,!1,1,function(sa){A.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",da);try{if(void 0===sa||null===sa||void 0===sa.data||null===sa.data||void 0===sa.data.Td||null===sa.data.Td){G.Health.instance.recordKpiFailure(qa,"Invalid RequestSucceededEventArgs",
!1,!0,null);var V=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",da);ia(xa.Qvb(V,sa))}else if(sa.data.httpStatus!==T.a.JO){G.Health.instance.recordKpiFailure(qa,"HttpStatusCode_"+sa.data.httpStatus.toString(),!1,!0,null);var Ia=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",
sa.data.httpStatus,da);ia(xa.Qvb(Ia,sa))}else{void 0!==ra&&null!==ra&&void 0!==sa.data.responseHeaders&&null!==sa.data.responseHeaders&&ra(sa.data.responseHeaders);var Ha=aa(sa.data.Td);if(Ha)A.ULS.sendTraceTag(50622690,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",da),na(Ha);else{G.Health.instance.recordKpiFailure(qa,"Parse Failure",!1,!0,null);var ob=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",
da);ia(xa.Qvb(ob,sa))}}}catch(ib){G.Health.instance.recordKpiFailure(qa,"Unexpected Failure",!1,!0,null),V=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",ib,da),ia(xa.Qvb(V,sa))}},function(sa){A.ULS.sendTraceTag(50622691,3004,10,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} failed.",da);if(sa.data){G.Health.instance.recordKpiFailure(qa,"HttpStatusCode_"+sa.data.httpStatus.toString(),!1,!0,null);var V=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",
sa.data.httpStatus,sa.data.Td||"No Data",da)}else G.Health.instance.recordKpiFailure(qa,"Invalid RequestFailedEventArgs",!1,!0,null),V=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",da);ia(xa.Qvb(V,sa))},null,void 0,void 0,ta,za)})};w.prototype.Qvb=function(Xa,aa){var ba=new B;ba.message=Xa;ba.Vdc=aa&&aa.data?aa.data.httpStatus:-1;return ba};w.prototype.nPh=function(Xa,aa){var ba={};ba["x-UserDataSignature"]=this.ib.Wa("UserDataSignature");
ba["x-LicensingIsEnabled"]=this.ib.qa("LicensingIsEnabled").toString();ba["x-CacheIsEnabled"]=this.ib.qa("LicensingRedisIsEnabled").toString();ba["x-OcpsIsEnabled"]=this.ib.qa("OcpsIsEnabled").toString();ba["x-LicensingAADIdIsEnabled"]=this.ib.qa("LicensingAadIdIsEnabled").toString();0===Xa&&(ba["x-LicenseCheckOnTenantEnabled"]=this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SafeLinksLicenseCheck",!1).toString(),ba["x-SupportUserConsentDependentFeatures"]=this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SupportUserConsentBasedFeaturesInAFH",
!1).toString(),ba["x-AFHUserConsentGroupValue"]=this.ib.getIntFeatureGate("Microsoft.Office.SharedOnline.AFHUserConsentGroupValue",0).toString(),ba["x-UseShellServiceForUserConsentGroup"]=this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseShellServiceForUserConsentGroup",!1).toString(),ba["x-SMBUserLicensingEnabled"]=this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SMBUserLicensingEnabled",!1).toString());if(aa){Xa=bk(aa.keys);for(var oa=Xa.next();!oa.done;oa=Xa.next())oa=
oa.value,ba[oa]=aa.na(oa)}return ba};Object(u.a)(w,"HttpRequestToPromiseUtility",null,[]);var O=b(4),U;(function(Xa){Xa[Xa.loki=0]="loki";Xa[Xa.augloopACLP=1]="augloopACLP"})(U||(U={}));Object(u.b)("AlternateAuthSupportApp",U);var J=b(943),H=b(41);Object(u.a)(m,"WacAlternateAuthToken",null,[]);y.prototype.xHh=function(){var Xa=null;this.oQb.kb(U[0])&&(Xa=this.oQb.na(U[0]));return void 0===Xa||null===Xa||this.jqd(Xa)?this.hyh():Promise.resolve(Xa.Token)};y.prototype.jqd=function(Xa){return Xa.ExpirationTime-
Date.now()<this.TJj};y.prototype.hyh=function(){var Xa=this,aa=new z.a(x.a.Ik());aa.ia("X-AlternateAuthApp",U[0]);return this.Dib.S2c(this.Tua("/afhs/AlternateAuthHelperHandler.ashx"),Object(D.a)(this,this.YVi,"parseAlternateAuthTokenResponse"),2,aa).then(function(ba){A.ULS.sendTraceTag(545821456,3004,50,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Retrieved WacAlternateAuthToken for {0}",U[0]);Xa.oQb.ia(U[0],ba);return ba.Token},function(ba){ba=Object(I.a)(B,ba);A.ULS.sendTraceTag(545604827,
3004,10,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Error: {0}, status code: {1}",ba.message,ba.Vdc);return null})};y.prototype.YVi=function(Xa){var aa=H.d(Xa).Lt;A.ULS.sendTraceTag(545821457,3004,aa?50:10,"ParseAlternateAuthTokenResponse: fetched WacAlternateAuthToken from {0}",Xa);return aa};y.prototype.Tua=function(Xa){return String.format("{0}{1}?{2}",this.ib.Wa("WebServiceBase"),Xa,O.AFrameworkApplication.Yi)};Object(u.a)(y,"AlternateAuthHelper",null,[491]);var K=b(491);Object(u.a)(r,
"FeatureStateChangeArgs",null,[]);var N=b(136),M=b(260),C=b(27),Q=b(113),P=b(178),ka;(function(Xa){Xa[Xa.Enabled=0]="Enabled";Xa[Xa.Disabled=1]="Disabled"})(ka||(ka={}));Object(u.b)("FeatureState",ka);var R=b(83),fa=b(25),ca=b(190);v.prototype.IQh=function(){for(var Xa=this.ib.Zn("AllLicensedFeatures")?this.ib.dw("AllLicensedFeatures"):[],aa=new K.a,ba=0;ba<Xa.length;ba++)aa.add(Xa[ba]);return aa};v.prototype.ood=function(){return this.yKc||this.zKc};v.prototype.sWd=function(Xa,aa){var ba=this;Xa=
void 0===Xa?0:Xa;aa=void 0===aa?!1:aa;A.ULS.sendTraceTag(51185368,3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",aa);var oa=N.a.Cr();oa&&(oa.set("retryAttempt",Xa.toString()),oa.set("forceRefresh",aa.toString()),oa.set("isO365ConsumerHost",this.zKc.toString()),oa.set("isO365CommercialHost",this.yKc.toString()),oa.set("isFreemiumUpsellEnabled",this.qTb.toString()));G.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest","waclicensing",oa);G.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",
1,"waclicensing",oa);void 0!==this.kqa&&null!==this.kqa&&this.kqa.start();var ra=null;aa&&(ra=new z.a(x.a.Ik()),ra.ia("x-LicensingForceRefresh","true"));this.Mde=new Date;return(this.jqa?this.Dib.S2c(this.Tua("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(D.a)(this,this.aWi,"parseApplicationFeatureHelperResponse"),0,ra,Object(D.a)(this,this.r0i,"processApplicationFeatureHelperResponseHeaders"),["Date"]):Promise.resolve({})).then(function(db){var Ka=Object.assign(new ca.a,{durationMs:ba.u5f()});
Ka.extendedProperties=oa;Ka.extendedProperties&&db&&(Ka.extendedProperties.set("featureCount",Q.a.count(db).toString()),Ka.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in db).toString()),Ka.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in db).toString()),ba.JVb&&Ka.extendedProperties.set("fromCache",(ba.JVb<ba.Mde).toString()));G.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",Ka);return db},function(db){var Ka=Object.assign(new ca.a,
{durationMs:ba.u5f()}),Ga=Object(I.a)(B,db);if(!Ga)return A.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),G.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,Ka),new Promise(function(xa,da){da(db)});Ka.extendedProperties=oa;Ka.extendedProperties&&Ka.extendedProperties.set("status",Ga.Vdc.toString());G.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest",
"RequestFailed",!1,!0,Ka);return 408===Ga.Vdc&&++Xa<=ba.yrg?ba.sWd(Xa):new Promise(function(xa,da){da(Ga)})})};v.prototype.aWi=function(Xa){(Xa=H.b(Xa))?(A.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),A.ULS.sendTraceTag(50938594,3004,50,"{0}",Xa)):A.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set");return Xa.Features};v.prototype.Tua=function(Xa){var aa=
String.format("{0}{1}",this.ib.Wa("WebServiceBase"),Xa);this.ib.Zn("ApplicationFeatureHelperHttpCachingEnabled")&&this.ib.qa("ApplicationFeatureHelperHttpCachingEnabled")&&(Xa=v.cbc(this.ib))&&0<Xa.length&&(this.xXb&&(Xa+="ucbf"),aa=new M.QueryStringBuilder(aa),aa.Ei("afhskey",Xa),aa=aa.toString());return aa};v.prototype.isFeatureEnabled=function(Xa,aa){var ba=this;if(!this.eEa&&!this.XRc&&!this.jqa)return this.nBa;A.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",
Xa);if("ConnectedServices"===Xa){var oa=this.eEa?this.t2d.KJ("ControllerConnectedServicesEnabled"):this.nBa,ra=this.XRc?this.Uhe.getSettings().then(function(Ga){return 2!==Ga.Kt},function(){return aa}):this.nBa;return oa.then(function(Ga){return Ga?ra:ba.S9c})}oa=null;oa=this.eEa?this.t2d.isFeatureEnabled(Xa):this.nBa;var db=null;db=this.jqa?this.Qgi(Xa,aa):this.nBa;var Ka=null;Ka=this.XRc?this.Uhe.isFeatureEnabled(Xa):this.nBa;return oa.then(function(Ga){return Ga?Ka.then(function(xa){return xa?
db:ba.S9c}):ba.S9c}).then(function(Ga){ba.Nkf(Xa,Ga,!0);return Ga},function(){ba.Nkf(Xa,aa,!1);return aa})};v.prototype.Nkf=function(Xa,aa,ba){A.ULS.sendTraceTag(526713106,3004,50,"FeatureName={0}, IsEnabled={1}, IsSuccess={2}",Xa,aa,ba)};v.prototype.getFeatureTier=function(Xa,aa){var ba=this;if(!this.jqa)return new Promise(function(oa){oa(2)});A.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",Xa);return this.iua.then(function(oa){return ba.bcc(Xa,
oa,aa)},function(){return aa})};v.prototype.isFreemiumUpsellEnabled=function(){return this.qTb&&this.zKc&&!this.C7d};v.prototype.launchUpsellExperience=function(Xa,aa){aa=void 0===aa?null:aa;A.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",Xa));var ba=N.a.Cr();ba&&(ba.set("experienceId",Xa),aa&&ba.set("campaignId",aa));G.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",1,"waclicensing",ba);
if(ba=R.a.instance.mh("Common.IInProductMessagingUIManager")){var oa=Object(D.a)(this,this.u1h,"handleDimeTaskComplete");ba.Xif(Xa,oa,aa)}else A.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),G.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),aa={},this.La.$d(fa.a.k$b,2,(aa.experience=Xa,aa))};v.prototype.yma=function(Xa,aa){if(!this.jqa)return null;if(!Xa||!aa)return A.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),
null;var ba=P.a.create().toString();this.hua.kb(Xa)||this.hua.ia(Xa,new z.a(x.a.Ik()));this.hua.na(Xa).add(ba,aa);A.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",ba,Xa));return ba};v.prototype.xHd=function(Xa,aa){this.jqa&&(Xa&&this.hua.kb(Xa)?aa&&P.a.isValid(aa)?this.hua.na(Xa).kb(aa)?(A.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",
aa,Xa)),this.hua.na(Xa).remove(aa)):A.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",aa,Xa)):A.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",aa,Xa)):A.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",
Xa)))};v.prototype.bcc=function(Xa,aa,ba){return this.xXb?Xa in aa?aa[Xa].LicenseTier:ba:Xa in aa?this.yWi(aa[Xa],ba):ba};v.prototype.yWi=function(Xa,aa){switch(Xa.toLowerCase()){case "unknown":return 0;case "basic":return 1;case "premium":return 2;default:return aa}};v.prototype.u1h=function(){var Xa=this;A.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete");this.iua.then(function(aa){Xa.CMf(aa)}).catch(function(){Xa.CMf({})})};v.prototype.CMf=function(Xa){var aa=
this;A.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");var ba=this.sWd(0,!0);ba.then(function(oa){aa.iua=ba;Q.a.count(oa)>Q.a.count(Xa)?G.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",null):G.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(var ra=bk(aa.hua.keys),db=ra.next();!db.done;db=ra.next())if(db=db.value,db in oa){var Ka=aa.bcc(db,oa,0);db in Xa?aa.bcc(db,Xa,0)!==Ka&&aa.sxd(db,
!0,Ka):aa.sxd(db,!0,Ka)}else db in Xa&&aa.sxd(db,!1,aa.bcc(db,Xa,0))}).catch(function(oa){G.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",!1,!0,null);A.ULS.sendTraceTag(594051086,3004,10,JSON.stringify(oa))})};v.prototype.sxd=function(Xa,aa,ba){A.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",Xa,aa,ba);aa=new r(Xa,aa,ba);ba=this.hua.na(Xa);ba=bk(ba);for(var oa=
ba.next();!oa.done;oa=ba.next()){oa=oa.value;try{oa.value(aa)}catch(ra){A.ULS.sendTraceTag(594051084,3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",Xa,oa.key,ra.message))}}};v.prototype.Ud=function(Xa,aa){var ba=this;if(this.jqa){var oa=this.e$d.contains(Xa),ra=!0,db="",Ka=!1;return this.iua.then(function(Ga){Xa in Ga?(Ga=Ga[Xa],db=ka[Ga.FeatureState],ra=1!==Ga.FeatureState):ra=!oa;
ba.Xkf(Xa,oa,db,Ka,aa,ra);return ra},function(){Ka=!0;oa&&(ra=aa);ba.Xkf(Xa,oa,db,Ka,aa,ra);return ra})}return this.nBa};v.prototype.Xkf=function(Xa,aa,ba,oa,ra,db){A.ULS.sendTraceTag(557389507,3004,50,"featureName : {0}, isLicenseControlledFeature={1}, encounteredError = {2}, featureData={3}, fallbackValue={4}, isAllowed={5}",Xa,aa,oa,ba,ra,db)};v.prototype.Qgi=function(Xa,aa){if(this.xXb)return this.Ud(Xa,aa);if(this.jqa){if(this.e$d.contains(Xa))return this.iua.then(function(ba){return Xa in ba},
function(){return aa});A.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",Xa)}return this.nBa};v.prototype.r0i=function(Xa){try{Xa&&"Date"in Xa&&(this.JVb=new Date(Xa.Date),A.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",this.JVb.toString()))}catch(aa){A.ULS.sendTraceTag(578863818,3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",
aa)}};v.prototype.u5f=function(){if(void 0!==this.kqa&&null!==this.kqa){var Xa=this.kqa.qc;this.kqa.stop();return Xa}return null};v.cbc=function(Xa){try{if(C.a.cGj){var aa=Xa.Wa("UserDataSignature").split(".");if(1<aa.length){var ba=window.self.atob(aa[1]),oa=JSON.parse(ba).LocalStorageKey;if(void 0!==oa&&null!==oa&&0<oa.length)return oa}}}catch(ra){A.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",ra.toString())}return null};Object(u.a)(v,"ApplicationFeatureHelper",null,
[492]);var ea=b(202);Object(u.a)(f,"CloudPolicySettingsCacheData",null,[]);var wa=b(1027),X=b(392),ja=b(236);n.A3f=function(){return O.AFrameworkApplication.fa.qa("SideCarIsEnabled")?n.kuc&&n.Fmd?new Promise(function(Xa){Xa(!0)}):new Promise(function(Xa,aa){n.kuc=ja.a.create(O.AFrameworkApplication.fa.Wa("SideCarUrl"));X.a.lia(n.kuc);n.kuc.E9(function(ba,oa){(n.Fmd=oa.succeeded)?Xa(oa.succeeded):aa(oa.succeeded)})}):new Promise(function(Xa){Xa(!1)})};n.Fmd=!1;n.kuc=null;Object(u.a)(n,"SideCarLoader",
null,[]);Object(u.a)(l,"CloudPolicySettingsData",null,[]);k.prototype.KJ=function(Xa,aa){aa=void 0===aa?!0:aa;if(!this.eEa){var ba=this;return new Promise(function(Ka){Ka(ba.zvb(Xa))})}var oa=this,ra=this,db=this.C2b.then(function(Ka){try{var Ga=null;Ka.PolicySettings&&"unknown"in Ka.PolicySettings&&(Ga=Ka.PolicySettings.unknown);if(Ga){if(Xa in Ga&&void 0!==Ga[Xa]&&null!==Ga[Xa])return new Promise(function(da){da("0"!==Ga[Xa])});var xa=Xa.toLowerCase();if(xa in Ga&&void 0!==Ga[xa]&&null!==Ga[xa])return new Promise(function(da){da("0"!==
Ga[xa])});A.ULS.sendTraceTag(51512667,3004,50,"Policy"+Xa+" not found, using default");return new Promise(function(da){da(oa.zvb(Xa))})}return new Promise(function(da){da(oa.zvb(Xa))})}catch(da){return A.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+Xa+" policy value. Error Message: {0}",da.message),oa.handleError(da.toString(),aa,oa.zvb(Xa))}},function(Ka){return ra.handleError(Ka,aa,ra.zvb(Xa))});db.then(function(Ka){A.ULS.sendTraceTag(50651667,3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",
Xa,Ka);return null});return db};k.prototype.isFeatureEnabled=function(Xa,aa){aa=void 0===aa?!0:aa;if(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.Sgi(Xa,aa);var ba=new Promise(function(ra){ra(!0)}),oa="";this.sRb.contains(Xa)&&(oa="ControllerConnectedServicesEnabled",ba=this.KJ(oa,aa));ba.then(function(ra){A.ULS.sendTraceTag(50651668,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",
Xa,ra,oa);return null});return ba};k.prototype.Sgi=function(Xa,aa){aa=void 0===aa?!0:aa;var ba=new Promise(function(ra){ra(!0)}),oa="";"mso_sendASmile"===Xa?oa="Enabled":"Survey"===Xa||"FloodgateSurvey"===Xa?oa="SurveyEnabled":this.sRb.contains(Xa)&&(oa="ControllerConnectedServicesEnabled");""!==oa&&(ba=this.KJ(oa,aa));ba.then(function(ra){A.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",Xa,ra,oa);return null});
return ba};k.prototype.handleError=function(Xa,aa,ba){return aa?new Promise(function(oa){oa(ba)}):new Promise(function(oa,ra){ra(Xa)})};k.prototype.moa=function(Xa,aa,ba){var oa=this;if(!Xa)return Promise.resolve(new l);var ra=!1,db=null;G.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);var Ka=this.p2c("GetCloudPolicySettings");return(new Promise(function(Ga,xa){if(void 0!==oa.sjb&&null!==oa.sjb&&0<oa.sjb.length){var da=oa.uMj();if(void 0!==da&&null!==da){ra=!0;Ga(da);
return}}oa.Dib.S2c(aa,ba,1,null,Object(D.a)(oa,oa.v0i,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],oa.ib.kd("CloudPolicySettingsRequestQueueTimeout",15E3),oa.ib.kd("CloudPolicySettingsRequestSentTimeout",3E4)).then(function(qa){A.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS");oa.jNj(qa);Ga(qa);return qa},function(qa){xa(qa);return null})})).then(function(Ga){var xa=oa.fyc(Ka);Ka=xa.stopwatch;db=xa.returnValue;(xa=N.a.Cr())&&xa.set("FromCache",
ra.toString());xa=Object.assign(new ca.a,{durationMs:db,extendedProperties:xa});G.Health.instance.recordKpiSuccess("GetCloudPolicySettings",xa);return Ga})};k.prototype.KMj=function(){return n.A3f().then(function(){A.ULS.sendTraceTag(593282845,3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar");return sidecar.cloudPolicy.GetCloudPolicySettingsData()})};k.prototype.Tua=function(Xa){return String.format("{0}{1}",this.ib.Wa("WebServiceBase"),Xa)};k.prototype.bWi=
function(Xa){var aa=H.d(Xa).Lt;A.ULS.sendTraceTag(50622687,3004,aa?50:10,"ParseCloudPolicySettingsResponse: fetched CloudPolicySettingsData from {0}",Xa);return aa};k.prototype.v0i=function(Xa){try{if(void 0!==Xa&&null!==Xa&&"CheckIn-Interval"in Xa){var aa=parseInt(Xa["CheckIn-Interval"]);void 0!==aa&&null!==aa&&0<aa&&(this.wFc=aa)}}catch(ba){A.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",ba)}};k.prototype.zvb=function(Xa){return Xa in this.kbe?"0"!==
this.kbe[Xa]:!0};k.prototype.uMj=function(){try{var Xa=wa.a.instance.getItem(this.sjb);if(void 0===Xa||null===Xa)return A.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),null;A.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",Xa);var aa=JSON.parse(Xa);if(void 0===aa||null===aa)return A.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),
null;if(void 0===aa.ExpirationTime||null===aa.ExpirationTime)return A.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),null;if((new Date(aa.ExpirationTime)).getTime()<Date.now())return A.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),null;var ba=new l;ba.PolicySettings=aa.PolicySettings;ba.ControllerConnectedServicesFeatureNames=new ea.a;this.ib.Zn("ServicesControlsMicrosoftControllerServicesList")&&
this.ib.dw("ServicesControlsMicrosoftControllerServicesList");for(var oa=bk(this.sRb),ra=oa.next();!ra.done;ra=oa.next())ba.ControllerConnectedServicesFeatureNames.add(ra.value);A.ULS.sendTraceTag(51662941,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved");return ba}catch(db){return A.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",db.toString()),null}};k.prototype.jNj=function(Xa){try{if(void 0===Xa||null===Xa||void 0===Xa.PolicySettings||
null===Xa.PolicySettings)A.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(0>=this.wFc)A.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");else{var aa=new f(Xa,this.wFc),ba=JSON.stringify(aa);A.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",ba);wa.a.instance.setItem(this.sjb,ba);A.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(oa){A.ULS.sendTraceTag(51662976,
3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",oa.toString())}};k.prototype.cbc=function(){var Xa=v.cbc(this.ib);return Xa&&0<Xa.length?"OCPS"+Xa:null};k.prototype.p2c=function(Xa){var aa=R.a.instance.mh("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");return void 0!==aa&&null!==aa?aa.sc("WebServiceCall",Xa):null};k.prototype.fyc=function(Xa){if(void 0!==Xa&&null!==Xa){var aa=Xa.qc;Xa.stop();return{returnValue:aa,stopwatch:null}}return{returnValue:null,stopwatch:Xa}};Object(u.a)(k,
"CloudPolicySettingsHelper",null,[489]);e.prototype.clone=function(){var Xa=new e;Xa.Kt=this.Kt;Xa.Qdg=this.Qdg;Xa.kIe=this.kIe;Xa.mHa=this.mHa;Xa.Rdg=this.Rdg;Xa.lIe=this.lIe;Xa.qea=this.qea;Xa.HQc=this.src;return Xa};e.prototype.serialize=function(Xa){Xa=void 0===Xa?null:Xa;var aa={};if(!Xa||Xa.contains(e.VNa))aa[e.VNa]=this.Kt;if(!Xa||Xa.contains(e.BDb))aa[e.BDb]=this.mHa;if(!Xa||Xa.contains(e.CDb))aa[e.CDb]=this.qea;return JSON.stringify(aa)};e.create=function(Xa,aa){aa=void 0===aa?null:aa;var ba=
new e;ba.HQc=Xa;void 0!==aa&&null!==aa&&(e.VNa in aa&&(ba.Kt=aa[e.VNa]),e.BDb in aa&&(ba.mHa=aa[e.BDb]),e.CDb in aa&&(ba.qea=aa[e.CDb]));return ba};e.deserialize=function(Xa,aa){try{var ba=JSON.parse(Xa);if(void 0!==ba&&null!==ba)return e.create(aa,ba);A.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",Xa);throw Error.argument("settingsData");}catch(oa){throw A.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",oa.toString()),
oa;}};Mf.Object.defineProperties(e.prototype,{src:{configurable:!0,enumerable:!0,get:function(){return this.HQc}}});e.VNa="CCS";e.BDb="CCSTime";e.CDb="OfficePrivacyRoamedNoticeShown";Object(u.a)(e,"UserPrivacySettings",null,[]);var va=b(130);d.prototype.Tua=function(Xa){var aa=String.format("{0}RoamingServiceHandler.ashx?action=",this.ib.appSettings.RoamingServiceHandlerWebServiceBase||"");aa=new Sys.StringBuilder(aa);aa.append(Xa);aa.append("&");aa.append(O.AFrameworkApplication.Yi);return aa.toString()};
d.prototype.executeRequest=function(Xa,aa,ba,oa){return this.Og.SYb(Xa,aa,void 0===oa?null:oa,null,ba,"33",!1,null,6E4)};d.prototype.saveSettings=function(Xa){var aa=this;return new Promise(function(ba,oa){try{if(void 0===aa.he||null===aa.he||void 0===Xa||null===Xa)A.ULS.sendTraceTag(51258443,3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),oa("Can't determine setting changes to save");else{var ra=aa.he.Kt!==Xa.Kt;if(2===aa.he.src&&ra)aa.ijj(Xa),ba(!0);else{var db=aa.anj(Xa);
if(void 0===db||null===db||!db.length)A.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),oa("No changes to save");else if(1===aa.he.src)ba(aa.L$f(db));else if(0===aa.he.src){A.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",db);var Ka=aa.executeRequest(aa.Tua("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",db);Ka.continueWith(function(){if(Ka.zh||Ka.Xf)A.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),
ba(!1);else{var Ga=Ka.result;void 0!==Ga.Rg&&null!==Ga.Rg&&void 0!==Ga.Rg.data&&null!==Ga.Rg.data&&Ga.Rg.data.httpStatus===T.a.JO?(A.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),ba(!0)):(A.ULS.sendTraceTag(51258446,3004,10,"SaveUserPrivacySettings: Roaming Request Failed"),ba(!1))}})}}}}catch(Ga){A.ULS.sendTraceTag(50860930,3004,10,"SaveUserPrivacySettings: Exception = {0}",Ga.toString()),ba(!1)}})};d.prototype.anj=function(Xa){if(void 0===this.he||null===
this.he||void 0===Xa||null===Xa)throw Error.invalidOperation("User Privacy settings have not been initialized");var aa=new ea.a;0===Xa.src?(this.he.Kt!==Xa.Kt&&(aa.add(e.VNa),aa.add(e.BDb)),this.he.qea!==Xa.qea&&aa.add(e.CDb)):1===Xa.src&&this.he.Kt!==Xa.Kt&&aa.add(e.VNa);return aa.count?Xa.serialize(aa):(A.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),null)};d.prototype.getSettings=function(){if(!this.ZPc){var Xa=this;this.ZPc=new Promise(function(aa){try{Xa.he?
aa(Xa.he.clone()):Xa.CMj().then(function(ba){Xa.he=ba;aa(Xa.he.clone());return null},function(){Xa.AMj().then(function(ba){Xa.he=ba;aa(Xa.he.clone());return null},function(){Xa.BMj().then(function(ba){Xa.he=ba;aa(Xa.he.clone());return null},function(){A.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)");Xa.he=new e;aa(Xa.he.clone());return null});return null});return null})}catch(ba){A.ULS.sendTraceTag(50860932,3004,10,"UserPrivacySettings GetSettings: Exception = {0}",
ba.toString()),Xa.he=new e,aa(Xa.he.clone())}})}return this.ZPc};d.prototype.CMj=function(){var Xa=this;return new Promise(function(aa,ba){try{var oa=-1!==window.location.href.indexOf("&wd_pn=2");if(Xa.ib.qa("PrivacyDialogShouldCheckRoaming")||oa){var ra=Xa.executeRequest(Xa.Tua("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");ra.continueWith(function(){try{if(ra.zh||ra.Xf)A.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure");else{var db=
ra.result;if(db&&db.Rg&&db.Rg.data)if(db.Rg.data.httpStatus!==T.a.JO)A.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",db.Rg.data.httpStatus);else{if(db.Rg.data.Td){aa(d.parse(db.Rg.data.Td,0));A.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",db.Rg.data.Td);return}A.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else A.ULS.sendTraceTag(50860935,
3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");ba("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}}catch(Ka){A.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",Ka.toString()),ba("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}})}else A.ULS.sendTraceTag(50860933,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),ba("Roaming should not be used")}catch(db){A.ULS.sendTraceTag(50860939,
3004,10,"TryGetSettingsFromRoaming Exception = {0}",db.toString()),ba("UserPrivacySettings TryGetSettingsFromRoaming Exception")}})};d.prototype.AMj=function(){var Xa=this;return new Promise(function(aa,ba){try{var oa=va.a.get("WacUPToggleState"),ra=null;void 0!==oa&&null!==oa&&0<oa.length&&(ra=decodeURIComponent(oa));if(void 0!==ra&&null!==ra&&0<ra.length){var db=d.parse(ra,1);A.ULS.sendTraceTag(51258448,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",db.toString());
aa(db)}else{var Ka=e.create(1),Ga=new ea.a;Ga.add(e.VNa);var xa=Ka.serialize(Ga);Xa.L$f(xa)?(A.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",xa),aa(Ka)):(A.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",xa),ba("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}}catch(da){A.ULS.sendTraceTag(50860941,3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",
da.toString()),ba("UserPrivacySettings TryGetSettingsFromCookie Eception")}})};d.prototype.BMj=function(){return new Promise(function(Xa){try{var aa=-1!==window.location.href.indexOf("&wdccsoff=1"),ba=e.create(2);aa?(ba.Kt=2,O.AFrameworkApplication.TGe(),A.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",ba.toString())):(ba.Kt=1,A.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",
ba.toString()));Xa(ba)}catch(oa){A.ULS.sendTraceTag(50967431,3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",oa.toString()),aa=e.create(2),aa.Kt=1,Xa(aa)}})};d.prototype.ijj=function(Xa){A.ULS.sendTraceTag(51258453,3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam");2===Xa.Kt?O.AFrameworkApplication.TGe():O.AFrameworkApplication.Ojh();A.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",Xa)};d.prototype.L$f=function(Xa){try{A.ULS.sendTraceTag(51258455,
3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",Xa);var aa=this.ib.Wa("PrivacyCookieDomain")||"";if(!aa||!aa.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");A.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",Xa);return va.a.FOd("WacUPToggleState",Xa,va.a.HV,"/",aa)}catch(ba){return A.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",ba.toString()),!1}};d.prototype.isFeatureEnabled=
function(Xa){var aa=this;return this.getSettings().then(function(ba){for(var oa=aa.ib.Zn("ServicesControlsMicrosoftControllerServicesList")?aa.ib.dw("ServicesControlsMicrosoftControllerServicesList"):[],ra=new K.a,db=0;db<oa.length;db++)ra.add(oa[db]);return ra.contains(Xa)?2!==ba.Kt:!0},function(){A.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",Xa);return!0})};d.parse=function(Xa,aa){try{return A.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",
Xa,aa),e.deserialize(Xa,aa)}catch(ba){throw A.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",ba.toString()),ba;}};Object(u.a)(d,"UserPrivacySettingsHelper",null,[490]);var ua=b(254);c.prototype.Ph=function(Xa){var aa=this;this.fb=Xa;this.fb.register(489,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").tc().Cc(function(){return new k(O.AFrameworkApplication.fa,O.AFrameworkApplication.qd)});this.fb.register(490,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").tc().Cc(function(){return new d(O.AFrameworkApplication.fa,
O.AFrameworkApplication.qd)});this.fb.register(491,"Common.App.ApplicationFeatureHelper.IAlternateAuthHelper").tc().Cc(function(){return new y(O.AFrameworkApplication.fa,O.AFrameworkApplication.qd)});this.fb.register(492,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").tc().Cc(function(){return new v(O.AFrameworkApplication.fa,O.AFrameworkApplication.qd,aa.fb.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),aa.fb.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),
O.AFrameworkApplication.ub)})};c.prototype.init=function(){var Xa=this;O.AFrameworkApplication.fa.Su(function(){var aa=Xa.fb.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");O.AFrameworkApplication.fa.qa("LicensingIsEnabled")&&(aa.isFeatureEnabled("LicensingTestFeature",!1).then(function(ba){A.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",ba,O.AFrameworkApplication.fa.Wa("IsAnonymousUser"));
return null}),aa.getFeatureTier("LicensingTestFeature",0).then(function(ba){A.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",ba,O.AFrameworkApplication.fa.Wa("IsAnonymousUser"));return null}));Xa.fb.resolve("Common.App.ApplicationFeatureHelper.IAlternateAuthHelper");Xa.AHj()})};c.prototype.dispose=function(){};c.prototype.AHj=function(){try{O.AFrameworkApplication.fa.qa("SideCarIsEnabled")&&n.A3f().then(function(Xa){A.ULS.sendTraceTag(594057429,
3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",Xa);return Xa})}catch(Xa){}};c.main=function(){ua.a.instance.Qi(new c)};Mf.Object.defineProperties(c.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}}});Object(u.a)(c,"ApplicationFeatureHelperPackage",null,[10,11]);b.d(E,"a",function(){return a})},1359:function(u,E,b){function a(){x.a.Fa(function(Fb){c.ka(Fb)})}function c(Fb){var Yb=
zb.call(this)||this;Yb.$=Fb;Yb.Eb();return Yb}function d(){}function e(Fb,Yb,kb,vb,Wa,qb,yb){Fb=l.call(this,Fb,Yb,kb,vb,Wa,!1)||this;Fb.nYd=!1;Fb.G0=yb;Fb.cec=e.JEh(qb);qb=Fb.MYd(Fb.cec.name,Fb.cec.size);if(0!==qb)return Fb.dRd(qb),Fb.G0.setException(Error.create("DataUrlUploaderWrapper: Invlid data url")),Fb.dispose(),Fb;Fb.wj=new y(Fb.$.domElement,Fb.dFb,Fb.zoa,vb,!1,Fb.$);return Fb}function k(Fb,Yb){this.filename=Fb;this.blob=Yb}function l(Fb,Yb,kb,vb,Wa,qb){qb=void 0===qb?!0:qb;Fb=v.call(this,
Fb,kb,vb,Wa,!1)||this;Fb.Ed=Yb;qb&&Fb.showDialog();return Fb}function n(Fb,Yb){this.dataUri=this.sheetName=null;this.sheetName=Fb;this.dataUri=Yb}function f(Fb,Yb,kb,vb,Wa,qb){qb=void 0===qb?!0:qb;Yb=v.call(this,Fb,Yb,kb,vb,!1)||this;Yb.Jyh=Wa;Yb.k9b=Fb.Fb.Kg("LoadResource","FileReaderUploaderLoadResource");qb&&Yb.showDialog();return Yb}function v(Fb,Yb,kb,vb,Wa){Wa=void 0===Wa?!0:Wa;var qb=Ha.call(this,null,Yb,kb)||this;qb.kt=null;qb.maa=null;qb.T6a=!1;qb.CCd=null;qb.zoa=function(yb){qb.DZd.stop();
qb.T_b.cancel();if(y.Ogi(yb))qb.Azc?qb.e4e(4):(yb=new G.a(0,2,null,null,!1,null,null,null),yb.status=8,qb.UVd(new T.a(yb),null,"InsertPictureWebMethod")),I.ULS.sendTraceTag(526399121,0,50,"Http Error occurred, isTimeoutError: {0}",qb.Azc);else{var ec=v.SUj(yb);0!==ec?(I.ULS.sendTraceTag(526399122,0,50,"Server returned error, response: {0}",yb),qb.e4e(ec)):qb.C3h(yb)}qb.ioc();qb.dispose()};qb.wJi=function(yb){qb.IBa(yb,qb.wj)&&qb.finalizeUpload(qb.wj,null)};qb.dFb=function(yb){I.ULS.sendTraceTag(526399120,
0,50,"Upload frame initialized");qb.wj=yb;if(!qb.a1a){if(qb.nYd){if(qb.fve()||qb.z8a&&O.a.cF){yb.L6b(qb.wJi);return}var ec=yb.L6b(null);if(!qb.IBa(ec,yb))return}qb.finalizeUpload(yb,null)}};qb.FSi=function(){qb.Azc=!0};qb.jb=Fb;qb.DZd=Fb.Fb.Kg("WebServiceCall","InsertPictureOperation");qb.T_b=Q.a.instance.create(qb.FSi,1E5,P.a.fNg,!1);qb.Azc=!1;qb.ukc=qb.$.ya.InsertPictureMaxFileSizeBytes;vb&&(qb.T6a="TestOnly"in vb);Wa&&qb.showDialog();return qb}function r(Fb,Yb,kb){var vb=B.call(this,Fb,!1)||this;
vb.JU=null;vb.OAa=!1;vb.ymc=function(){vb.rXd("");vb.AAc();return!1};vb.$=Yb;vb.HBc=Fb;vb.FQ=ra.a.instance;vb.fa=kb;vb.m_f();vb.Ekd();vb.$.ob.mz=!0;return vb}function y(Fb,Yb,kb,vb,Wa,qb,yb){Fb=m.call(this,Fb,Yb,kb,vb,Wa,"UploadFrame",qb.ea.sessionId,"image/*",!1,null,void 0===yb?!1:yb)||this;Fb.$=qb;Fb.Ddg=!0;R.EwaSettings.isChangeGateEnabled("OfficeVSO:5329840_InsertPictureOpenFileBrowserDirectly")?Fb.J9e():Fb.Cpe();return Fb}function m(Fb,Yb,kb,vb,Wa,qb,yb,ec,Ob,Cb,ab){Ob=void 0===Ob?!0:Ob;ab=
void 0===ab?!1:ab;this.ERe="FileUpload.ashx";this.Pn=null;this._initialized=!1;this.Cg=this.Zhb=this.FHc=this.lga=this.qSb=this.Lq=this.rs=null;this.nm=!1;this.xD=this.rSb=this.TRc=null;this._parent=Fb;this.Ppg=Yb;this.yug=kb;this.S5d=Wa;this.WPc=yb;this.b0d=ec;this.X1d=void 0===Cb?null:Cb;this.SRc=!1;this.nqg=vb.qa("CanaryRenewalForFileUploadIsEnabled");this.Ddg=!1;(this.zqa=ab)||this.S3g(qb);Ob&&this.J9e()}function w(Fb,Yb,kb){if(Fb){var vb=0;do{try{Fb();break}catch(Wa){if(I.ULS.sendTraceTag(50946190,
306,10,"RetryOnException: [Retries: {0}] [Caller: {1}] [Exception: {2}] [Callstack: {3}].",vb,kb,Wa.message,Wa.stack),vb>=Yb)break}vb++}while(1)}}function B(Fb,Yb){return z.call(this,Fb,void 0===Yb?!0:Yb)||this}function A(){}function z(Fb,Yb){Yb=void 0===Yb?!0:Yb;var kb=oa.call(this,!1,!1,z.mu)||this;kb.JWa=null;kb.n5d=!1;kb.Om=[];kb.wj=null;kb.qXb=Fb;kb.mvg=Yb;kb.Ige=!1;kb.yv=!1;kb.lga=null;kb.GHc=!1;kb.Vf=kb.reh;kb.ye="InsertFileDialog";kb.mc(1,kb.OXb);if(z.mu){Fb={};Yb={};var vb={};kb.JWa=(vb.id=
kb.ye,vb.bodyControls=(Yb.uploadButtonProps=(Fb.label=CommonUIStrings.l_DialogChooseFile,Fb.onExecute=Object(X.a)(kb,kb.hTi,"onUploadButtonClick"),Fb),Yb),vb.uploadStatusLabel=CommonUIStrings.l_DialogNoFileChosen,vb.onFrameReady=Object(X.a)(kb,kb.ZJi,"onFrameReady"),vb);kb.initializeAndShow(kb.titleText,Object(X.a)(kb,kb.Iec,"insertDialogHandler"),kb.JWa);kb.TRb=!0}else kb.showDialog(kb.titleText,Object(X.a)(kb,kb.Iec,"insertDialogHandler")),Yb&&kb.m_f(),(Fb=kb.UU(1))&&kb.Om.push(Fb),(Fb=kb.UU(0))&&
kb.Om.push(Fb),kb.qcg(),kb.TRb=!1;return kb}var x=b(10);u=b(0);var D=b(232),I=b(14),F=b(1563),G=b(733),T=b(612),O=b(27),U=b(89),J=b(29),H=b(162),K=b(8),N=b(54),M=b(160),C=b(356),Q=b(47),P=b(44),ka=b(31),R=b(1),fa=b(22),ca=b(15),ea=b(105),wa=b(85),X=b(84),ja=b(150),va=b(4),ua=b(13),Xa=b(96),aa=b(43),ba=b(1277),oa=ja.a;Rk(z,oa);z.prototype.validate=function(){this.wj.xE||I.ULS.sendTraceTag(25798091,322,10,"UploadFrame.FileInputElement is null");return this.wj.xE.value?!0:(z.Iz(CommonUIStrings.l_FileUploadNoFileSpecified),
!1)};z.prototype.ZJi=function(Fb){this.mvg&&(this.wj=this.l_f(Fb,this.qXb))};z.prototype.hTi=function(){this.wj&&this.wj.xE&&(this.n5d||(this.wj.Y7i(Object(X.a)(this,this.jzd,"onFileChosen")),this.n5d=!0),this.wj.yRe())};z.prototype.jzd=function(Fb){this.JWa.uploadStatusLabel=Fb;this.kTa(this.titleText,Object(X.a)(this,this.Iec,"insertDialogHandler"),this.JWa)};z.prototype.Iec=function(Fb){1===Fb&&this.isEnabled()?z.mu&&this.wj.xE&&!this.wj.xE.value?(this.JWa.uploadStatusLabel=CommonUIStrings.l_FileUploadNoFileSpecified,
this.kTa(this.titleText,Object(X.a)(this,this.Iec,"insertDialogHandler"),this.JWa)):(this.hxb(),this.qXb.finalizeUpload(this.wj,Object(X.a)(this,this.dispose,"dispose"))):0===Fb&&this.hide()};z.prototype.m_f=function(){this.GHc=!1;this.wj=this.l_f(document.getElementById("uploadFrameContainer"),this.qXb);va.AFrameworkApplication.fa.qa("InsertPictureDialogFocusLoopFixIsEnabled")&&(this.lga=Object(X.a)(this,this.XAd,"onUploadFrameLoad"),aa.a.addHandler(this.wj.iFrame,"load",this.lga));this.wj.xE||I.ULS.sendTraceTag(25798092,
322,15,"UploadFrame.FileInputElement is null");this.sIf()};z.prototype.XAd=function(){this.sIf()};z.prototype.sIf=function(){if(this.wj&&!this.GHc){var Fb=this.wj.xE;Fb&&(aa.a.addHandler(Fb,ua.a.Lb,Object(X.a)(this,this.onKeyDown,"onKeyDown")),Fb=[Fb],this.Om=Fb.concat.apply(Fb,this.Om),this.qcg(),this.GHc=!0)}};z.prototype.dispose=function(){if(this.wj&&!z.mu){var Fb=this.wj.xE;Fb&&aa.a.removeHandler(Fb,ua.a.Lb,Object(X.a)(this,this.onKeyDown,"onKeyDown"));this.lga&&aa.a.removeHandler(this.wj.iFrame,
"load",this.lga)}this.wj=null;oa.prototype.dispose.call(this)};z.prototype.qcg=function(){if(0<this.Om.length){var Fb=new ba.a(this.Om),Yb=Xa.FocusManager.instance().sQ();Yb&&(this.Om[0].focus(),Yb.Ve=Fb,Yb.m_=!0)}};z.prototype.onKeyDown=function(Fb){4!==Xa.FocusManager.instance().uIf(Fb)&&Fb.preventDefault()};z.Iz=function(Fb){var Yb=document.getElementById("errorText");Yb.innerText=Fb;Yb.style.display="inline-block"};Mf.Object.defineProperties(z.prototype,{ETj:{configurable:!0,enumerable:!0,get:function(){return this.qXb}}});
Mf.Object.defineProperties(z,{mu:{configurable:!0,enumerable:!0,get:function(){return va.AFrameworkApplication.ta.Qa.Vu&&va.AFrameworkApplication.ta.Qa.Tef}}});Object(u.a)(z,"InsertFileDialog",ja.a,[]);Mf.Object.defineProperties(A,{Vf:{configurable:!0,enumerable:!0,get:function(){return ja.a.No(A.qk,CommonUIStrings.l_ImageUploadDialogText,CommonUIStrings.l_ImageUploadNoFileSpecified)}}});A.qk="<div class='WACDialogRow' id='block1'> <label id='labelText' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRowNoBreak' id='block2'> <div id='uploadFrameContainer'></div> <div class='WACDialogError' id='errorText' role='alert'>{1}</div> </div>";
Object(u.a)(A,"InsertImageDialogHtml",null,[]);Rk(B,z);B.prototype.validate=function(){this.wj.xE||I.ULS.sendTraceTag(25798095,322,10,"UploadFrame.FileInputElement is null");var Fb=Object(wa.a)(F.a,this.ETj),Yb=Fb.oeg(this.wj.xE.value);return 0!==Yb?(z.Iz(Fb.NXe(Yb)),!1):!0};Mf.Object.defineProperties(B.prototype,{OXb:{configurable:!0,enumerable:!0,get:function(){return CommonUIStrings.l_ImageUploadButtonText}},titleText:{configurable:!0,enumerable:!0,get:function(){return CommonUIStrings.l_ImageUploadingTitle}},
reh:{configurable:!0,enumerable:!0,get:function(){return A.Vf}}});Object(u.a)(B,"InsertImageDialog",z,[]);var ra=b(617),db=b(108),Ka=b(88),Ga=b(41),xa=b(260),da=b(205),qa=b(81),na=b(496),ia=b(178);m.prototype.J9e=function(){this.xD=ia.a.create().toString();this.zqa?this.u7c():this.Cpe()};m.prototype.S3g=function(Fb){this.Pn=document.createElement("iframe");this.Pn.className=Fb;this.Pn.id=Fb;this.S5d&&(this.Pn.style.visibility="visible",this.Pn.style.height="30px",this.Pn.setAttribute("frameborder",
"0"));this.lga=Object(X.a)(this,this.XAd,"onUploadFrameLoad");aa.a.addHandler(this.Pn,"load",this.lga)};m.prototype.L6b=function(Fb){var Yb=this;Fb=void 0===Fb?null:Fb;va.AFrameworkApplication.ta.Lpc();if(!this.Lq)return I.ULS.sendTraceTag(25798093,322,50,"_fileInput is null"),"";aa.a.addHandler(this.Lq,"change",function(){Yb.Dyh(Fb)});w(Object(X.a)(this,this.yRe,"fileInputClick"),1,"DoFileOpenDialog");return this.Lq.value};m.prototype.Dyh=function(Fb){Fb&&Fb(this.Lq.value)};m.prototype.Eyh=function(){this.qSb&&
(this.qSb.innerText=this.ZYe())};m.prototype.Y7i=function(Fb){var Yb=this;aa.a.addHandler(this.Lq,"change",function(){Fb(Yb.ZYe())})};m.prototype.ZYe=function(){var Fb=null;if(this.Lq.value){var Yb=this.Lq.value,kb=Yb.lastIndexOf("\\");0<kb&&(Fb=Yb.substring(kb+1,Yb.length))}return Fb?Fb:""};m.prototype.yRe=function(){try{I.ULS.sendTraceTag(35939520,322,50,"UploadFrame.FileInputClick - Clicking on File input element."),this.Lq.click()}catch(Fb){throw I.ULS.sendTraceTag(36783331,322,10,"UploadFrame.FileInputClick Exception: {0}",
Fb.message),Fb;}};m.prototype.pFj=function(){this.Rli()?this.m6f():(this.eYd(),this.rs.submit())};m.prototype.Rli=function(){return(this.nqg||this.zqa)&&!(void 0===window.self.FormData||null===window.self.FormData)};m.prototype.FWf=function(Fb){if(Fb){var Yb=this.HBe();this.Cg=new XMLHttpRequest;this.Cg.open("POST",Yb);this.Cg.setRequestHeader("X-CorrelationId",this.xD);this.dui(Fb);this.Cg.onreadystatechange=Object(X.a)(this,this.zoa,"uploadResponseReceived");this.Cg.send(Fb)}};m.prototype.dui=function(Fb){if(!O.a.pka&&
Fb.get){var Yb=Fb.get("ImageId");Fb=window.self.navigator;var kb={};Yb=(kb.CorrelationId=this.xD,kb.Canary=va.AFrameworkApplication.canary,kb.ImageNodeId=Yb,kb);Fb&&(Fb=Fb.connection?Fb.connection:Fb.mozConnection?Fb.mozConnection:Fb.webkitConnection?Fb.webkitConnection:null)&&(Yb.effectiveType=Fb.effectiveType,Yb.downlink=Fb.downlink,Yb.type=Fb.type,Yb.rtt=Fb.rtt);I.ULS.sendTraceTag(573345858,322,50,"LogFileUploadStatistics: FileUpload {0}",Yb)}};m.prototype.m6f=function(){try{this.eYd();I.ULS.sendTraceTag(594888409,
322,50,"SubmitFormWithRequest is preparing to send an upload request");var Fb=new (Type.parse("FormData"))(this.rs);this.FWf(Fb)}catch(Yb){I.ULS.sendTraceTag(594888407,322,10,"SubmitFormWithRequest failed to send the request with exception "+Yb.message),this.M9a(null)}};m.prototype.l6f=function(Fb){try{if(this.eYd(),I.ULS.sendTraceTag(594888406,322,50,"SubmitFormWithBlob is preparing to send an upload request"),this.OUj(Fb)){this.rSb=Fb;this.rs.contains(this.Lq)&&this.rs.removeChild(this.Lq);var Yb=
new (Type.parse("FormData"))(this.rs);Yb.append("applicationfileInput",Fb.blob,Fb.filename);this.FWf(Yb)}else this.M9a(null)}catch(kb){I.ULS.sendTraceTag(591267743,322,10,"SubmitFormWithBlob failed to send the request with exception "+kb.message),this.M9a(null)}};m.prototype.OUj=function(Fb){return Fb&&void 0!==Fb.blob&&null!==Fb.blob&&void 0!==Fb.filename&&null!==Fb.filename&&""!==Fb.filename?void 0===window.self.FormData||null===window.self.FormData?(I.ULS.sendTraceTag(578380442,322,10,"FormData isn't supported"),
!1):!0:(Fb=Fb?String.format("[isNull: false] [blobIsNullorEmpty: {0}] [filenameIsNullOrEmpty: {1}]",void 0===Fb.blob||null===Fb.blob,void 0===Fb.filename||null===Fb.filename||""===Fb.filename):"[isNull: true] [blobIsNullorEmpty: false] [filenameIsNullOrEmpty: false]",I.ULS.sendTraceTag(578380441,322,10,String.format("Content of the blob is empty {0}",Fb)),!1)};m.prototype.zoa=function(){if(4===this.Cg.readyState)if(200===this.Cg.status){I.ULS.sendTraceTag(594888405,322,50,"UploadResponseReceived received a successful response. CorrelationId: {0}",
this.xD);var Fb=this.Cg.getResponseHeader("X-NewKey"),Yb=this.Jei(this.Cg),kb=!1;if(void 0!==Fb&&null!==Fb&&Yb&&(kb=this.FUj(Fb),!this.SRc&&kb)){I.ULS.sendTraceTag(594888404,322,50,"UploadResponseReceived resubmitting the upload request with a fresh canary. correlationId: {0}",this.xD);this.SRc=!0;void 0!==this.rSb&&null!==this.rSb?this.l6f(this.rSb):this.m6f();return}I.ULS.sendTraceTag(594888403,322,50,"UploadResponseReceived processing the response [retried: {0}] [canaryInvalid: {1}] [gotNewCanary: {2}] [canaryRenewed: {3}] [CorrelationId: {4}]",
this.SRc,Yb,!(void 0===Fb||null===Fb),kb,this.xD);this.M9a(this.Cg.responseText)}else I.ULS.sendTraceTag(42874946,322,15,"Upload request failed with status: {0} [isResponseNull: {1}] [correlationId: {2}]",this.Cg.status,this.Cg.responseText?!1:!0,this.xD),this.M9a(null)};m.prototype.Jei=function(Fb){try{var Yb=Ga.a(Fb.responseText).Responses;if(void 0!==Yb&&null!==Yb&&1===Yb.length){var kb=Yb[0];if(void 0!==kb&&null!==kb&&2===kb.length&&28===kb[1].StatusCode)return!0}}catch(vb){}return!1};m.prototype.FUj=
function(Fb){na.a.ubg(Fb);return va.AFrameworkApplication.canary!==Fb?!1:!0};m.prototype.eYd=function(){this.TRc||(this.TRc=new Date)};m.prototype.dispose=function(){this.nm||(this.zqa?this._parent.removeChild(this.rs):(this._parent.removeChild(this.Pn),aa.a.removeHandler(this.Pn,"load",this.lga),this.lga=null),this.FHc&&(aa.a.removeHandler(this.Lq,"change",this.FHc),this.FHc=null),this.zRe&&(this.Zhb&&(aa.a.removeHandler(this.Lq,"change",this.Zhb),this.Zhb=null),this.qSb=null),this.Lq=this.rs=this._parent=
this.Pn=null,this.nm=!0,this.TRc=null,I.ULS.sendTraceTag(25798094,322,50,"UploadFrame disposed"))};m.prototype.delayedDispose=function(){this.dispose()};m.prototype.u6g=function(Fb){if(this.rs){var Yb;(Yb=this.rs.querySelector("input[name=__REQUESTDIGEST]"))?Yb.value=Fb:(Yb=this.W2c(),Yb.type="hidden",Yb.id="__REQUESTDIGEST",Yb.name="__REQUESTDIGEST",Yb.value=Fb,this.rs.appendChild(Yb))}};m.prototype.W2c=function(){return this.zqa?document.createElement("input"):this.Pn.contentWindow.document.createElement("input")};
m.prototype.XAd=function(){try{if(!this.Pn.contentWindow.document.body)return}catch(vb){this.O3h();return}if(!(this._initialized||this.z8a&&O.a.cF))this.u7c();else if(!this.z8a||!O.a.cF||this.Mii){var Fb=O.a.Yt?this.Pn.contentWindow.document.body.innerText:this.Ddg?this.Pn.contentWindow.document.body.firstChild.innerText:this.Pn.contentWindow.document.body.firstChild.innerHTML;var Yb=this.Pn.contentWindow.document.body.innerText.toLowerCase(),kb=0<=Yb.indexOf("responses")||0<=Yb.indexOf("wopisrc");
Yb=0<=Yb.indexOf("http error");!kb&&Yb&&I.ULS.sendTraceTag(42551183,322,15,"Couldn't obtain a valid response but the frame contains: "+this.Pn.contentWindow.document.body.innerText);this.M9a(Fb)}};m.prototype.u7c=function(){if(!this._initialized){var Fb=this.ga("uploadForm"),Yb=this.ga("fileInput"),kb=this.HBe();this.a6g();this.rs.id=Fb;this.rs.method="post";this.rs.encoding="multipart/form-data";this.rs.action=kb;this.Lq.type="file";this.b0d&&(this.Lq.accept=this.b0d,this.X1d&&(this.Lq.capture=this.X1d));
this.Lq.id=Yb;this.Lq.name=Yb;this.AIg&&(this.Lq.multiple=!0);!this.zRe||O.a.Yt||O.a.xH||(this.Zhb=Object(X.a)(this,this.Eyh,"fileInputChangedHandleAccessibility"),aa.a.addHandler(this.Lq,"change",this.Zhb),this.qSb=Ka.a.ype(this.rs,this.Lq,"InputFileDescription"));this.S5d&&(this.zqa||(Fb=this.Pn.contentWindow.document.body,Fb.style.margin="0",Fb.style.overflow="hidden"),Fb=va.AFrameworkApplication.ta,this.Lq.style.fontFamily=Fb.P0,this.Lq.style.fontSize=Fb.mAc,this.Lq.style.margin="0");(Fb=document.getElementById("__REQUESTDIGEST"))&&
this.u6g(Fb.value);this.rs.appendChild(this.Lq);this._initialized=!0;this.Ppg(this)}};m.prototype.a6g=function(){if(this.zqa)this.rs=document.createElement("form"),this._parent.appendChild(this.rs),this.Lq=document.createElement("input");else{this.rs=this.Pn.contentWindow.document.createElement("form");var Fb=this.Pn.contentWindow.document;Fb.body.appendChild(this.rs);this.Lq=Fb.createElement("input")}};m.prototype.Cpe=function(){this._parent.appendChild(this.Pn);this.z8a&&O.a.cF&&this.u7c()};m.prototype.HBe=
function(){var Fb=new xa.QueryStringBuilder(this.ERe);va.AFrameworkApplication.ZXa(Fb);this.Pnj(Fb);Fb=Fb.toString();if(O.a.Nf||O.a.cF||O.a.xH)Fb=qa.a.fVe(Fb);return Fb};m.prototype.mke=function(){var Fb=new db.a(2,1,0,Object(X.a)(this,this.delayedDispose,"delayedDispose"),4);va.AFrameworkApplication.yi.Dg(Fb)};Mf.Object.defineProperties(m.prototype,{ASf:{configurable:!0,enumerable:!0,get:function(){return this.yug}},sessionId:{configurable:!0,enumerable:!0,get:function(){return this.WPc}},iFrame:{configurable:!0,
enumerable:!0,get:function(){return this.Pn}},xE:{configurable:!0,enumerable:!0,get:function(){return this.Lq}},z8a:{configurable:!0,enumerable:!0,get:function(){return va.AFrameworkApplication.fa?va.AFrameworkApplication.fa.qa("NativeFileOpenDialogIsEnabled"):!1}},zRe:{configurable:!0,enumerable:!0,get:function(){return va.AFrameworkApplication.fa?va.AFrameworkApplication.fa.qa("FileInputDescriptionAccessibilityIsEnabled"):!1}},Mii:{configurable:!0,enumerable:!0,get:function(){return this.zqa?!1:
da.b(this.Pn.contentWindow.location.pathname,this.ERe,0)}},AIg:{configurable:!0,enumerable:!0,get:function(){return!O.a.pka&&va.AFrameworkApplication.fa.qa("AllowMultipleImageInsertFromLocalDevice")}}});Object(u.a)(m,"UploadFrame",null,[3]);var ta=b(45),za=b(121),sa=b(21);Rk(y,m);y.prototype.ga=function(Fb){return Fb};y.prototype.Pnj=function(Fb){I.ULS.shipAssertTag(526399105,0,!!this.sessionId,"SessionId shouldn't be null.");za.a.LVc(Fb,this.$.ya);Fb.z9(K.a.sessionId,this.sessionId);var Yb=sa.g(this.$).ha;
Yb=ta.o(Yb.sa.W3,this.$);Fb.z9(K.a.J1i,this.$.va.pa.name);Fb.z9(K.a.I1i,Yb.FirstRow.toString());Fb.z9(K.a.H1i,Yb.FirstColumn.toString())};y.prototype.O3h=function(){this.ASf("ServerUploadError")};y.prototype.M9a=function(Fb){this.ASf(Fb)};y.Ogi=function(Fb){return!Fb||fa.a.equals(Fb,"ServerUploadError",!1)};Object(u.a)(y,"UploadFrameWrapper",m,[]);Rk(r,B);r.prototype.l_f=function(Fb,Yb){return new y(Fb,Object(X.a)(Yb,Yb.dFb,"onUploadFrameInitialized"),Object(X.a)(Yb,Yb.zoa,"uploadResponseReceived"),
this.fa,!0,this.$)};r.prototype.dispose=function(){this.AAc();this.FQ=this.HBc=null;B.prototype.dispose.call(this)};r.prototype.hide=function(){B.prototype.hide.call(this);this.$.ob.mz=!1};r.prototype.validate=function(){var Fb=this.HBc.MYd(this.wj.xE.value,this.HBc.q$f(this.wj));return 0!==Fb?(Fb=this.HBc.Wcd(Fb).Description,this.rXd(Fb),this.nTd(),!1):!0};r.prototype.isEnabled=function(){return!0};r.prototype.rXd=function(Fb){this.JU.innerHTML=Fb};r.prototype.Ekd=function(){this.JU=document.getElementById("errorText");
this.JU.style.display="inline-block";this.OAa=!1;this.rXd("");this.cIa.style.maxWidth=this.cIa.currentStyle.minWidth};r.prototype.nTd=function(){this.FQ.ra(ua.a.click,this.wj.xE,this.ymc);this.FQ.ra(ua.a.Lb,this.wj.xE,this.ymc);this.OAa=!0};r.prototype.AAc=function(){this.OAa&&(this.FQ.Ba(ua.a.click,this.wj.xE,this.ymc),this.FQ.Ba(ua.a.Lb,this.wj.xE,this.ymc),this.OAa=!1)};Object(u.a)(r,"InsertImageDialogWrapper",B,[]);var V=b(50),Ia=b(58),Ha=F.a;Rk(v,Ha);v.prototype.dispose=function(){U.a.Ia(this.T_b);
this.wj&&this.wj.mke();this.wj=this.T_b=this.jb=null};v.prototype.f5i=function(Fb){function Yb(){vb.Jw(!0)}var kb=this;if(!this.$)return I.ULS.sendTraceTag(526399119,0,50,"ReadPictureAsDataURLTask: EwaControl is null"),Ia.Task.Ua(!0);if(!this.$.wba)return Ia.Task.Ua(!0);var vb=new H.a,Wa=new FileReader;Fb=Fb.xE.files[0];Wa.onload=function(){kb.CCd=Wa.result;vb.Jw(!0)};Wa.onerror=Yb;Wa.onabort=Yb;Wa.readAsDataURL(Fb);return vb.task};v.prototype.q$f=function(Fb){var Yb=-1;Fb=Fb.xE;(null===Fb||void 0===
Fb?0:Fb.files)&&0<Fb.files.length&&(Yb=Fb.files[0].size);return Yb};v.prototype.MYd=function(Fb,Yb){var kb=v.Q2g(F.a.IBa(Fb));0===kb?-1!==Yb&&(I.ULS.sendTraceTag(526399118,0,50,"Validating picture, pictureSize: {0}, maxAllowedSize: {1}, remainingWorkbookSize: {2}",Yb,this.ukc,this.$.ea.Cif),Yb>this.ukc?kb=3:Yb>this.$.ea.Cif&&(kb=7)):6===kb&&this.cwi(Fb);I.ULS.sendTraceTag(526399117,0,50,"Validated file on client, validation result: {0}",kb);return kb};v.prototype.IBa=function(Fb,Yb){Fb=this.MYd(Fb,
this.q$f(Yb));return 0!==Fb?(this.a1a||1===Fb||this.dRd(Fb),!1):!0};v.prototype.N9f=function(Fb){Fb.pFj()};v.prototype.Wcd=function(Fb){var Yb=0,kb=1,vb=-1100324317,Wa="InsertPictureUnknownError",qb=null;switch(Fb){case 1:Yb=1733;kb=0;vb=940870981;Wa="InsertPictureNoFileSelected";break;case 3:kb=0;vb=1250467391;Wa="InsertPicturePictureTooBig";qb=String.format(ca.a.instance.mb(176),this.qyi.toLocaleString());break;case 6:Yb=1737;kb=0;vb=1380041209;Wa="InsertPictureUnsupportedFormat";break;case 7:Yb=
1734;kb=0;vb=-903115058;Wa="InsertPictureExceedWorkbookSize";break;case 4:Yb=1735;kb=0;vb=1218352119;Wa="InsertPictureUploadTimeout";break;case 5:Yb=1736,kb=0,vb=1979899005,Wa="InsertPictureServiceNonDeterministicError"}Fb=v.Xc(Yb,kb,vb,Wa);qb&&(Fb.Description=qb);return Fb};v.prototype.showDialog=function(){this.fve()?(this.a1a=!1,this.wj=new y(this.$.domElement,this.dFb,this.zoa,this.fa,!1,this.$,!0)):(I.ULS.sendTraceTag(526399115,0,50,"Showing Insert Picture dialog"),!this.T6a&&(O.a.Uu||O.a.cF&&
72>O.a.kxe)?(this.a1a=!1,this.wj=new y(this.$.domElement,this.dFb,this.zoa,this.fa,!1,this.$)):(this.a1a=!0,this.wj=(new r(this,this.$,this.fa)).wj))};v.prototype.C3h=function(Fb){var Yb={};try{if(Yb=N.a.Th(Fb),V.b().rA(this.DZd.id,Yb.ServerCorrelationId,"actions","ServerActions"),!ka.a.Qg(Yb.Errors)&&Yb.Result){this.$.ea.gX(Yb.StateId,"BasePictureUploaderWrapper.UploadResponseReceived");var kb=Yb.Result;ea.a(this.$).ana(1,kb);var vb=this.$.da.za(277);vb&&vb.GTc(this.$,1,Yb.Result,Yb,"InsertPicture");
I.ULS.sendTraceTag(526399114,0,50,"Insert picture completed successfully :)")}}catch(Wa){I.ULS.sendTraceTag(526399113,0,50,"BasePictureUploaderWrapper.HandleSuccessCallback: got exception while try to JSON.Parse string length: {0}, errror: {1}",Fb?Fb.length:-1,Wa)}this.$zc(Yb,null,"InsertPictureWebMethod")};v.prototype.e4e=function(Fb){Fb={Errors:[this.Wcd(Fb)]};this.$zc(Fb,null,"InsertPictureWebMethod")};v.prototype.$zc=function(Fb,Yb,kb){this.kt(Fb,Yb,kb)};v.prototype.UVd=function(Fb,Yb,kb){this.maa(Fb,
Yb,kb)};v.prototype.dRd=function(Fb){Fb=this.Wcd(Fb);R.EwaSettings.kz()?new C.a(this.$,Fb):(new M.ErrorDialog(this.$,Fb)).gf()};v.prototype.cwi=function(Fb){var Yb=this.$.ya.InsertPicturUnsupportedExtensionsForLogging;Fb=J.a.al(Fb);for(var kb=0;kb<Yb.length;++kb)if(Fb.endsWith(Yb[kb])){I.ULS.sendTraceTag(526399112,0,50,"Insert picture blocked invalid extension: {0}",Yb[kb]);break}};v.SUj=function(Fb){return!Fb||fa.a.equals(Fb,K.a.insertPictureUnknownError,!0)?2:fa.a.equals(Fb,K.a.insertPictureNoFileSelectedError,
!0)?1:fa.a.equals(Fb,K.a.tbi,!0)?3:fa.a.equals(Fb,K.a.ubi,!0)?5:0};v.Xc=function(Fb,Yb,kb,vb){return ka.a.Xc(1,0,0,Fb,Yb,kb,vb)};v.Q2g=function(Fb){switch(Fb){case 1:return 1;case 2:return 6}return 0};v.prototype.fve=function(){return R.EwaSettings.isChangeGateEnabled("OfficeVSO:5329840_InsertPictureOpenFileBrowserDirectly")&&!this.T6a&&void 0!==window.self.FormData&&null!==window.self.FormData?!0:!1};Mf.Object.defineProperties(v.prototype,{$:{configurable:!0,enumerable:!0,get:function(){return this.jb}},
qyi:{configurable:!0,enumerable:!0,get:function(){return this.ukc/1024/1024}}});Object(u.a)(v,"BasePictureUploaderWrapper",F.a,[3]);Rk(f,v);f.prototype.Yyj=function(){this.ukc=28E5;this.dRd(3)};f.prototype.t$c=function(Fb){var Yb=this;I.ULS.sendTraceTag(526399111,0,50,"FileReaderUploaderWrapper.finalizeUploadImpl - Start function.");var kb=new FileReader;Fb=Fb.xE.files;if(0==Fb.length)I.ULS.sendTraceTag(526399110,0,15,"FileReaderUploaderWrapper.finalizeUploadImpl - No image file found.");else{var vb=
Fb[0];kb.onload=function(){Yb.k9b.stop();Yb.Jyh.$Ri(kb.result,Yb);I.ULS.sendTraceTag(526399109,0,50,"FileReaderUploaderWrapper.finalizeUploadImpl - End function. Type:{0}, Size:{1}",vb.type,vb.size.toString())};kb.onerror=function(){Yb.k9b.stop();I.ULS.sendTraceTag(526399108,0,10,"FileReaderUploaderWrapper.finalizeUploadImpl - Can't read image. Type:{0}, Size:{1}",vb.type,vb.size.toString())};kb.onabort=function(){Yb.k9b.stop();I.ULS.sendTraceTag(526399107,0,10,"FileReaderUploaderWrapper.finalizeUploadImpl - Aborted read image. Type:{0}, Size:{1}",
vb.type,vb.size.toString())};this.k9b.start();kb.readAsDataURL(vb)}};f.prototype.finalizeUpload=function(Fb,Yb){this.t$c(Fb,Yb)};Object(u.a)(f,"FileReaderUploaderWrapper",v,[686]);var ob=b(564),ib=b(388),La=b(177);n.prototype.getSheetName=function(){return this.sheetName};Object(u.a)(n,"MacroRecorderPictureInsertedPayload",null,[438]);Rk(l,v);l.prototype.t$c=function(Fb,Yb){var kb=this;v.prototype.finalizeUpload.call(this,Fb,Yb);ib.a(this.$.userOperationManager,function(vb,Wa){kb.kt=vb;kb.maa=Wa;
kb.DZd.start();kb.T_b.Hq();kb.Azc=!1;kb.N9f(Fb);return kb.f5i(Fb)},function(vb){function Wa(){return new n(yb,kb.CCd?kb.CCd:"")}var qb={};kb.$.Lj(qb);var yb=qb.SheetName;vb=R.EwaSettings.Zb()?new La.a(510,0,vb,72,Wa):new ob.a(510,0,vb,8,Wa);vb.pna(function(){return!0});vb.Ed=kb.Ed;return vb},this.Ed)};l.prototype.finalizeUpload=function(Fb,Yb){this.t$c(Fb,Yb)};Object(u.a)(l,"PictureUploaderWrapper",v,[]);Object(u.a)(k,"UploadBlobParameters",null,[]);Rk(e,l);e.prototype.UVd=function(Fb,Yb,kb){l.prototype.UVd.call(this,
Fb,Yb,kb);this.G0.setException(Error.create("DataUrlUploaderWrapper.TriggerFailedCallback: File upload request failed"))};e.prototype.$zc=function(Fb,Yb,kb){l.prototype.$zc.call(this,Fb,Yb,kb);ka.a.Qg(Fb.Errors)?this.G0.setException(Error.create(String.format("DataUrlUploaderWrapper.TriggerSuccessCallback: File upload request returned with errors: {0}",ka.a.Ec(Fb.Errors)))):this.G0.setResult(!0)};e.prototype.N9f=function(Fb){var Yb=new k(this.cec.name,this.cec);Fb.l6f(Yb)};e.JEh=function(Fb){var Yb=
Fb.split(",");Fb=Yb[0].includes("base64")?window.self.atob(Yb[1]):window.self.decodeURI(Yb[1]);Yb=Yb[0].split(":")[1].split(";")[0];for(var kb=new Uint8Array(Fb.length),vb=0;vb<Fb.length;vb++)kb[vb]=Fb.charCodeAt(vb);Fb=new Blob([kb],{type:Yb});Fb.name="Image.png";return Fb};Object(u.a)(e,"DataUrlUploaderWrapper",l,[]);d.prototype.aai=function(Fb,Yb,kb,vb,Wa){new l(Fb,Yb,kb,vb,Wa,!0)};d.prototype.Y9h=function(Fb,Yb,kb,vb,Wa,qb){new e(Fb,null,Yb,kb,vb,Wa,qb)};d.prototype.j$h=function(Fb,Yb,kb,vb,Wa){new f(Fb,
Yb,kb,vb,Wa,!0)};Object(u.a)(d,"UploaderCreator",null,[653]);var zb=D.a;Rk(c,zb);c.ka=function(Fb){Fb.da.Ga(485,new c(Fb))};c.prototype.create=function(){var Fb;this.pb(null!==(Fb=this.$.da.za(484))&&void 0!==Fb?Fb:this.$.da.Ga(484,new d))};Object(u.a)(c,"UploaderCreatorFactory",D.a,[]);b.d(E,"a",function(){return a})},1391:function(u,E,b){function a(){f.a.Fa(function(na){c.ka(na)})}function c(na){return qa.call(this,na)||this}function d(na,ia){this.$=na;this.uploaderCreator=ia}function e(na,ia,ta,
za,sa,V){var Ia=Ka.call(this,null,ta,za)||this;Ia.fmf=0;Ia.zoa=function(Ha){if(Ha){for(var ob=Array(Ha.length),ib=0;ib<Ha.length;ib++){var La=Ha[ib];ob[ib]={};ob[ib].SourceUrl=La.SourceUrl;z.a.Awa(La.LicenseUrl)&&z.a.Awa(La.PageUrl)&&(ob[ib].LicenseUrl=La.LicenseUrl,ob[ib].LicenseDisplayName=La.LicenseDisplayName,ob[ib].PageUrl=La.PageUrl);ob[ib].AltText=-2053056795===Ia.Ed.command?La.Caption:""}var zb=-2009825598===Ia.Ed.command?"bing":"M365";ib=Q.g(Ia.$);var Fb=G.o(ib.ha.sa.activeCell,Ia.$);T.a(Ia.$.userOperationManager,
function(Yb,kb,vb){return U.r(Ia.$.oa.xa,Fb,ob,zb,M.b(Yb,Ia.cPi),M.a(kb,Ia.bPi),vb,null)},function(Yb){return new O.a(595,0,Yb)},Ia.Ed);K.HelperMethods.VZ?(ib=new Map,ib.set("MediaProvider",zb),ib.set("ImagesCount",Ha.length.toString()),ib.set("TimeTakenToOpenDialog",Ia.fmf.toString()),x.Health.instance.recordKpiUsage(db.a.qbi,1,ra.a.J7f,ib)):B.ULS.sendTraceTag(537155805,0,15,"OnlinePictureUploaderWrapper.UploadResponseReceived: KPI Usage not supported.");Ia.ioc()}else B.ULS.sendTraceTag(537155806,
0,10,"OnlinePictureUploaderWrapper.UploadResponseReceived: Response is null")};Ia.cPi=function(Ha){H.a(Ha)?B.ULS.sendTraceTag(537155799,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded with errors. Errors: {0}",J.a.Ec(Ha.Errors)):(B.ULS.sendTraceTag(537155801,0,50,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded."),Ha.Result?C.a(Ia.$).ana(1,Ha.Result):B.ULS.sendTraceTag(537155800,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess:Result.result is null"))};
Ia.bPi=function(){B.ULS.sendTraceTag(537155798,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadFailed: Operation failed")};Ia.$=na;Ia.Ed=ia;Ia.G0=V;Ia.gpe=D.a.instance.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");Ia.showDialog();return Ia}function k(na,ia,ta,za,sa,V){var Ia=oa.call(this)||this;Ia.pgc=!1;Ia.Xva=null;Ia.rR=null;Ia.aNa=null;Ia.tGi=function(){Ia.gua(Ia.Mob)};Ia.lrd=function(Ha){Ha.keyCode===Sys.UI.Key.tab&&("KeepFocusDiv"!==Ha.target.id||Ha.shiftKey?"KeepFocusStartDiv"===
Ha.target.id&&Ha.shiftKey&&(Ha.preventDefault(),document.getElementById("KeepFocusDiv").focus()):(Ha.preventDefault(),document.getElementById("KeepFocusStartDiv").focus()))};Ia.sNi=function(){Ia.Dnb&&(Ia.Dnb.launchUpsellExperience("stockimages"),B.ULS.sendTraceTag(537155807,0,50,"OnLaunchM365Upsell: Launched Dime Upsell flow"))};Ia.zl=V;Ia.$=na;Ia.W9e=ia;Ia.Dnb=ta;Ia.Yza=[];Ia.Hof=za;Ia.seh=sa;Ia.woe=Ia.$.ya.InsertOnlinePictureMaxCountOfImagesToInsert;Ia.Vf=Ia.J6g();return Ia}function l(){}function n(na,
ia){return Xa.call(this,na,ua.a.Oaa(ia))||this}var f=b(10);u=b(0);var v=b(905),r=b(162),y=b(104),m=b(4),w=b(186),B=b(14),A=b(1563),z=b(29),x=b(99),D=b(83),I=b(619),F=b(178),G=b(45),T=b(388),O=b(177),U=b(255),J=b(31),H=b(295),K=b(11),N=b(15),M=b(294),C=b(105),Q=b(21),P=b(150),ka=b(88),R=b(96),fa=b(170),ca=b(183),ea=b(98),wa=b(160),X=b(356),ja=b(1),va=b(1442),ua=b(81),Xa=va.a;Rk(n,Xa);n.prototype.lrc=function(na,ia){this.isEnabled()&&this.rFa(this.targetOrigin)&&(this.Tn(na),this.Ml(na,ia))};Object(u.a)(n,
"InsertMediaCrossDocumentMessenger",va.a,[723,171,3]);var aa=b(7);Object(u.a)(l,"OnlineMediaSearchResult",null,[]);var ba=b(325),oa=P.a;Rk(k,oa);k.prototype.xzj=function(na){var ia=this;this.pgc=!1;this.showDialog(this.zl,null);this.Xva=document.getElementById(this.$h("InsertMediaFrame"));if(!this.Xva)throw this.gua(this.Mob),Error.invalidOperation("Couldn't get InsertMediaIframe.");var ta=document.getElementById(this.$h("WACDialogPanel"));ta&&ta.setAttribute(ka.a.Hd,ka.a.ZYa);ta=document.createElement("div");
ta.id="KeepFocusStartDiv";ta.tabIndex=0;ta.className="keep-focus-start";this.Xva.parentNode.insertBefore(ta,this.Xva.parentNode.firstChild);ta=document.createElement("div");ta.id="KeepFocusDiv";ta.tabIndex=0;ta.className="keep-focus";this.Xva.parentNode.appendChild(ta);$addHandler(this.cIa,"keydown",this.lrd);this.Xva.src=this.W9e;this.Xva.frameBorder="0";ta=document.getElementById(this.$h("WACDialogButtonPanel"));if(!ta)throw Error.invalidOperation("Couldn't get WACDialogButtonPanel.");ta.className=
"display-none";ta=document.getElementById(this.$h("WACDialogTitleText"));if(!ta)throw Error.invalidOperation("Couldn't get WACDialogTitleText.");ta.className="display-none";2===this.Hof&&(document.getElementById(this.$h("WACDialogTitlePanel")).className="display-none",document.getElementById(this.$h("WACDialogBodyPanel")).className="padding-zero");R.FocusManager.instance().sQ().scope.YM=!0;this.rR=new n(this.Xva.contentWindow,this.W9e);this.rR.lrc(fa.a.YAg,function(za){ia.oFi(za,na.zoa)});this.rR.lrc(fa.a.insert,
function(){ia.IMi(na.zoa)});this.rR.lrc(fa.a.cZc,this.tGi);2===this.Hof&&0===this.seh&&(this.rR.lrc(fa.a.Hqi,this.sNi),this.aNa=this.Dnb.yma("MsoPremiumStockImages",function(za){B.ULS.sendTraceTag(537155811,0,50,"OnCompleteM365Upsell: Upsell completed from stock images");if(za.isEnabled){var sa={};ia.rR.uj(fa.a.yTj,(sa.LicenseTier=za.toString(),sa))}else B.ULS.sendTraceTag(537155810,0,10,"OnCompleteM365Upsell: Upsell completed but license tier didn't upgrade.")}))};k.prototype.dispose=function(){this.Yza=
null;this.Dnb&&this.aNa&&this.Dnb.xHd("MsoPremiumStockImages",this.aNa);this.rR&&(this.rR.dispose(),this.rR=null);oa.prototype.dispose.call(this)};k.prototype.hide=function(){oa.prototype.hide.call(this);ea.a.xvc(this.$)};k.prototype.oFi=function(na,ia){na=na&&na.Values?(na=na.Values)?Object(aa.a)(new l,{Action:na.action||"",Caption:na.caption||"",ContentType:na.contentType||"",FileExtension:na.extension||"",PageUrl:na.pageUrl||"",SourceUrl:na.sourceUrl||"",ThumbnailUrl:na.thumbnailUrl||"",LicenseUrl:na.licenseUrl||
"",LicenseDisplayName:na.licenseDisplayName||"",Height:na.height||0,Width:na.width||0}):null:null;na&&(this.Yza.push(na),this.pgc&&(B.ULS.sendTraceTag(537155809,0,50,"InsertMediaDialog.OnAddItem: Insert Message handling was pending"),ia(this.Yza),this.pgc=!1,this.gua(this.Mob)))};k.prototype.IMi=function(na){this.Yza&&0<this.Yza.length?this.Yza.length<=this.woe?(na(this.Yza),this.gua(this.Mob)):(this.Iz(),B.ULS.sendTraceTag(537155808,0,10,"OnInsert : Tried to insert more than allowed limit of items."),
Array.clear(this.Yza)):this.pgc=!0};k.prototype.J6g=function(){var na=document.createElement("div");na.id="InsertMediaDialog";na.className=ja.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixHorizonalScroll",!0)?"insert-media-dialog":"insert-media-dialog-old";var ia=document.createElement("div");ia.id="InsertMediaPanel";ia.className=ja.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixCancelButton",!0)?"insert-media-panel":
"insert-media-panel-old";var ta=document.createElement("iframe");ta.id="InsertMediaFrame";ta.className="insert-media-frame";na.appendChild(ia);ia.appendChild(ta);return ba.b(na)};k.prototype.Iz=function(){var na=J.a.Xc(1,0,0,0,0,466721363,"InsertPictureExceededAllowedCount");na.Description=String.format(N.a.instance.mb(201),this.woe.toLocaleString());ja.EwaSettings.kz()?new X.a(this.$,na):(new wa.ErrorDialog(this.$,na)).gf()};Mf.Object.defineProperties(k.prototype,{X3:{configurable:!0,enumerable:!0,
get:function(){return ca.a.g6b+"/InsertMediaDialog"}},canBePreempted:{configurable:!0,enumerable:!0,get:function(){return!1}}});Object(u.a)(k,"InsertMediaDialog",P.a,[]);var ra=b(494),db=b(396),Ka=A.a;Rk(e,Ka);e.prototype.dispose=function(){this.$=null};e.prototype.showDialog=function(){var na=this,ia=null;ia=this.$.Fb.sc("UserAction","showOnlineImagesDialogTimeStopwatch");switch(this.Ed.command){case -2009825598:this.Jyj();break;case -2053056795:this.gpe.execute(function(ta){ta.isFeatureEnabled("MsoPremiumStockImages",
!1).catch(function(za){return B.ULS.sendTraceTag(557200643,0,10,"OnlinePictureUploaderWrapper::ShowDialog - Failed to load the premium state from application feature helper: {0}",za)}).then(function(za){na.Kyj(za);return null})})}ia.stop();this.fmf=ia.qc};e.prototype.Jyj=function(){var na=this.$.ya.BingPictureEndpoint,ia=I.a.aH(m.AFrameworkApplication.lcid),ta=F.a.create();na?(na=0<na.search(RegExp("insertmedia.bing.office.net","gi"))?String.format(na,1,1):String.format(na,1,m.AFrameworkApplication.lcid,
ia?ia.name:"en-us",m.AFrameworkApplication.buildVersion,ta.toString(),1,this.$.ya.DocumentHostInfo.LoggableUserId),this.d4b(na,1,-1,N.a.instance.ga(1739))):(B.ULS.sendTraceTag(537155804,0,10,"OnlinePictureUploaderWrapper::ShowDialogForBingPictures - Can't access the Bing service endpoint"),this.G0.setException(Error.create("Failed to access the Bing service endpoint")))};e.prototype.Kyj=function(na){var ia=this.$.ya.M365PictureEndpoint,ta=F.a.create();if(ia){var za=this.$.ya.DocumentHostInfo.UserId;
za=za?z.a.Kv(za).toString():"0";var sa=this.gpe.instance.isFreemiumUpsellEnabled();na=na?1:sa?0:-1;ta=ta.toString();sa=I.a.aH(m.AFrameworkApplication.lcid).name;ia=String.format(ia,m.AFrameworkApplication.lcid,sa,m.AFrameworkApplication.buildVersion,ta,1,za,na,1);this.d4b(ia,2,na,N.a.instance.ga(1738))}else B.ULS.sendTraceTag(537155803,0,10,"OnlinePictureUploaderWrapper::ShowDialogForStockImages - Can't access the M365 service endpoint"),this.G0.setException(Error.create("Failed to access the M365 service endpoint"))};
e.prototype.d4b=function(na,ia,ta,za){try{(new k(this.$,na,D.a.instance.mh("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),ia,ta,za)).xzj(this),this.G0.setResult(!0)}catch(sa){B.ULS.sendTraceTag(537155802,0,10,"OnlinePictureUploaderWrapper::CreateAndShowDialog failed [Exception : {0}] [MediaProvider : {1}] [DialogLicenseTier : {2}]",sa,ia,ta),this.G0.setException(sa)}};Object(u.a)(e,"OnlinePictureUploaderWrapper",A.a,[3]);var Ga=b(58);d.prototype.executeCommand=function(na,ia,ta){na=
ia.command;switch(na){case 1403967063:if(ta&&"dataUrl"in ta)return ia=new r.a,this.uploaderCreator&&this.uploaderCreator.Y9h(this.$,y.a.instance,m.AFrameworkApplication.fa,ta,ta.dataUrl,ia),ia.task;this.uploaderCreator&&this.uploaderCreator.aai(this.$,ia,y.a.instance,m.AFrameworkApplication.fa,ta);return Ga.Task.Ua(!0);case -2053056795:case -2009825598:return na=new r.a,new e(this.$,ia,y.a.instance,m.AFrameworkApplication.fa,ta,na),na.task;default:return w.a(na)}};d.prototype.zc=function(na,ia){if(na=
this.$.isEditMode)switch(ia.command){case 1403967063:na=!0;break;case -2053056795:na=!0;break;case -2009825598:na=!0;break;default:na=!1}return na};d.prototype.Qc=function(){return!1};d.prototype.Lc=function(){return!1};Object(u.a)(d,"PictureCommandHandler",null,[429]);var xa=b(37),da=b(51),qa=v.a;Rk(c,qa);c.prototype.Ad=function(){var na=this;xa.TaskExtensions.Aa(da.GetServiceTaskFactory.Ra(this.$.da,484,485,1),function(ia){na.jd([new d(na.$,ia.result)])},this.$.la,3)};c.ka=function(na){v.a.Qd(90,
new c(na))};Object(u.a)(c,"PictureCommandHandlerFactory",v.a,[]);b.d(E,"a",function(){return a})},1416:function(u,E,b){function a(){k.a.Fa(function(x){c.ka(x)})}function c(x){var D=z.call(this)||this;D.$=x;D.Eb();return D}function d(x,D){var I=B.call(this)||this;I.$=x;I.Ju=D;I.vua={};I.dS={};I.Lqe=!1;I.styles=null;I.TJi=function(F,G,T){n.ULS.sendTraceTag(520710152,1,50,"FontServiceManager.onFontPreviewRequestComplete: Attempt to request FontUrl method: {0} has succeeded.",T);I.$Zi(F);I.Lqe=!0;I.R2i()};
I.UJi=function(F,G,T){n.ULS.sendTraceTag(520710151,1,10,"FontServiceManager.onFontPreviewRequestFailed: Encountered errors for {0}.",T)};I.Eej=function(){I.$m&&I.pdd(I.TJi,I.UJi)};I.$m=m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FontServiceIntegration",!1);I.Eej();return I}function e(){}var k=b(10);u=b(0);var l=b(232),n=b(14),f=b(559),v=b(38),r=b(62);e.pdd="GetFontPreviewData";Object(u.a)(e,"FontWebServiceMethods",null,[]);var y=b(11),m=b(1),w={xlyellow:"xlyellow"},B=v.a;Rk(d,B);d.prototype.$Zi=
function(x){var D=this;if(this.Mni(x)){var I=y.HelperMethods.dca(function(){var F=x.Result;D.styles='@font-face{font-family:"msofpNew";font-style:normal;font-weight:normal;src:url(\''+F.PreviewUrl+"') format('truetype')}";var G=F.FontFacePropertiesList;F.FontNameList.forEach(function(T,O){D.vua[T]=G[O].Codepoint;D.styles=D.yJg(D.styles,T,"https://fs.microsoft.com/fs/"+F.CatalogVersion+"/rawguids/"+G[O].FontGuid);D.dS[T]=T});f.a.ti(D.styles)});10<I&&n.ULS.sendTraceTag(520710159,1,50,"FontServiceManager.prepareFontCodepointMap: Duration for prepareFontCodepointMap the model, duration={0}",
I)}};d.prototype.Mni=function(x){if(!x.Result)return n.ULS.sendTraceTag(520710158,1,15,"FontServiceManager.isValidFontPreviewData: Result in EwaResult is Null."),!1;x=x.Result;return x?x.PreviewUrl?x.FontFacePropertiesList?x.FontNameList?0===x.FontFacePropertiesList.length||x.FontFacePropertiesList.length!==x.FontNameList.length?(n.ULS.sendTraceTag(520710153,1,15,"FontServiceManager.isValidFontPreviewData: Mismatch in length of FontFacePropertiesList and FontNameList in fontListPreviewData."),!1):
!0:(n.ULS.sendTraceTag(520710154,1,15,"FontServiceManager.isValidFontPreviewData: FontNameList in fontListPreviewData is Null."),!1):(n.ULS.sendTraceTag(520710155,1,15,"FontServiceManager.isValidFontPreviewData: FontFacePropertiesList in fontListPreviewData is Null."),!1):(n.ULS.sendTraceTag(520710156,1,15,"FontServiceManager.isValidFontPreviewData: PreviewUrl in fontListPreviewData is Null."),!1):(n.ULS.sendTraceTag(520710157,1,15,"FontServiceManager.isValidFontPreviewData: fontListPreviewData is Null."),
!1)};d.prototype.yJg=function(x,D,I){return x+('@font-face{font-family:"'+D+"\";src:url('"+I+"')}")};d.prototype.pdd=function(x,D){var I=this.Ju,F=this.Ju.Pb(),G=e.pdd;F=I.Na(5,void 0===F?null:F);return r.g(I,G,F,x,D,null,null,644)};d.prototype.R2i=function(){this.lnd&&this.raiseEvent(d.ATe)};d.prototype.isFontSupported=function(x){return this.$m&&this.dS&&(!!this.dS[x]||!!w[x.replace(/\s/g,"").toLowerCase()])};d.prototype.Rme=function(x){this.addHandler(d.ATe,x)};Mf.Object.defineProperties(d.prototype,
{Dyc:{configurable:!0,enumerable:!0,get:function(){return this.dS}},lCh:{configurable:!0,enumerable:!0,get:function(){return this.vua}},lnd:{configurable:!0,enumerable:!0,get:function(){return this.Lqe}}});d.ATe="fsmFD";Object(u.a)(d,"FontServiceManager",v.a,[649]);var A=b(911),z=l.a;Rk(c,z);c.ka=function(x){x.da.Ga(505,new c(x))};c.prototype.create=function(){var x=this;this.pb(Object(A.c)(this.$.da,504,function(){return new d(x.$,x.$.oa.Ju)}))};Object(u.a)(c,"FontServiceManagerFactory",l.a,[]);
b.d(E,"a",function(){return a})},1453:function(u,E,b){function a(){x.a.Fa(function(D){c.ka(D)})}function c(D){var I=z.call(this)||this;I.$=D;I.Eb();return I}function d(D,I,F){var G=B.call(this)||this;G.statusBarManager=null;G.$Ge=function(){G.p6b()};G.Weh=function(){G.p6b()};G.ZGe=function(T){10===T&&G.p6b()};G.onKeyDown=function(T){if(13===T.Ca.keyCode){T=new r.a(237279923,1,2,6,null);var O={};G.$.Ka.Kb(T,(O[w.a.skipClipboardAccess]=!0,O[w.a.UKe]=!0,O));return!0}return!1};G.$=D;G.ir=I;G.jm=F;G.G7c=
!1;G.C1f=y.EwaSettings.getBooleanFeatureGate(v.a.kPa,!1);G.hgf=y.EwaSettings.isChangeGateEnabled("OfficeVSO:6082903_PasteToEnterKeyDownEventForGrid");G.C1f&&G.$.da.Za(29,function(T){G.statusBarManager=T;T.gJ(G)});return G}u=b(0);var e=b(109),k=b(232),l=b(14),n=b(13),f=b(38),v=b(327),r=b(91),y=b(1),m=b(21),w=b(5),B=f.a;Rk(d,B);d.prototype.dispose=function(){this.Tj();this.jm=this.ir=this.$=null;this.statusBarManager&&(this.statusBarManager.wF(this),this.statusBarManager=null)};d.prototype.an=function(){return this.C1f};
d.prototype.Ir=function(D,I){if("QueryPasteShortcutEnabledLabel"!==D&&!Array.contains(d.zEj,D))return!1;var F=this.fo();"QueryPasteShortcutEnabledLabel"===D?(I.Visible=F,l.ULS.sendTraceTag(537167636,0,100,"PasteShortcutManager.ExecuteRootCommand: Setting visible to {0} for commandId {1}",F,D)):(I.Visible=!F,l.ULS.sendTraceTag(537167635,0,100,"PasteShortcutManager.ExecuteRootCommand: Setting visible to {0} for commandId {1}",!F,D));return!0};d.prototype.Tjh=function(){this.Pi();this.raiseEvent("pasteShortcutStatusChanged")};
d.prototype.p6b=function(){this.Tj();this.raiseEvent("pasteShortcutStatusChanged")};d.prototype.fo=function(){return this.G7c};d.prototype.gq=function(D){this.addHandler("pasteShortcutStatusChanged",D)};d.prototype.Eq=function(D){this.removeHandler("pasteShortcutStatusChanged",D)};d.prototype.Pi=function(){if(!this.fo()){this.G7c=!0;m.g(this.$).Gi.Ak(this.$Ge);this.jm.ka("blur",this.Weh);var D=this.$.da.za(65);D&&D.X2&&D.X2.registerForCommentEvents(this.ZGe);this.ir.ft(n.a.Lb,this.hgf?this.$.Ov:this.$.domElement,
this.onKeyDown,!0)}};d.prototype.Tj=function(){if(this.fo()){this.G7c=!1;m.g(this.$).Gi.vk(this.$Ge);this.jm.detach("blur");var D=this.$.da.za(65);D&&D.X2&&D.X2.unregisterForCommentEvents(this.ZGe);this.ir.pt(n.a.Lb,this.hgf?this.$.Ov:this.$.domElement,this.onKeyDown,!0)}};d.zEj=["QuerySheetNumberButton","QueryWorkbookStatisticsButton"];Object(u.a)(d,"PasteShortcutManager",f.a,[654,472,303,3]);var A=b(129),z=k.a;Rk(c,z);c.prototype.create=function(){var D=this.$;this.pb(D.da.za(478)||this.$.da.Ga(478,
new d(D,e.KeyInputManager.instance,A.a.instance.JG())))};c.ka=function(D){D.da.Ga(479,new c(D))};Object(u.a)(c,"PasteShortcutManagerFactory",k.a,[]);var x=b(10);b.d(E,"a",function(){return a})},1454:function(u,E,b){function a(){e.a.Fa(function(J){c.ka(J)})}function c(J){var H=U.call(this)||this;H.$=J;H.Eb();return H}function d(J,H,K,N){var M=this;this.recoveryUI=null;this.jya=function(){M.qba()&&(M.grid.Uab(M.jya),M.O9f())};this.O9f=function(){if(x.g(M.$).Ab.f5(M.pasteRange))v.ULS.sendTraceTag(526758983,
306,50,"RecoveryUIController:triggerHandRaiseAfterConsistentGrid Last paste was a table. Table hand raise is not triggered.");else if(x.g(M.$).Ab.d5(M.pasteRange))v.ULS.sendTraceTag(526758982,306,50,"RecoveryUIController:triggerHandRaiseAfterConsistentGrid Last paste was a pivot table. Table hand raise is not triggered.");else{var C=F.d(M.$.va.pa);C=new G.a(M.pasteRange,C);M.NLj(C)}};this.Gcg=function(){M.recoveryUI&&(M.pZd=z.a.Ta.Wd.m,M.hide(),A.a.instance.create(function(){M.gSj()},250,"RecoveryUI.UpdatePositionOnVisibleAreaChanged",
void 0,!0))};this.oHe=function(C){10===C&&M.jIa()};this.nfh=function(){if(M.recoveryUI){var C=document.getElementById("PasteRecoveryUI");C&&w.a.Wj===C.getAttribute(w.a.jY)&&C.click();M.documentHidden=!0;M.jIa()}};this.pHe=function(){M.jIa()};this.qHe=function(){M.jIa()};this.onKeyUp=function(C){if(M.recoveryUI){if(M.d_)return!1;if(17===C.Ca.keyCode&&M.O8b){C=document.getElementById("PasteRecoveryUI");if(!C)return v.ULS.shipAssertTag(537154070,0,!1,"RecoveryUIController.OnKeyUp: recoveryUIElement is null."),
!1;var Q=C.getAttribute(w.a.jY)||"";if(w.a.Vq===Q)return C.click(),!0}}return!1};this.onKeyDown=function(C){if(M.recoveryUI){M.O8b=!1;M.d_=C.ctrlKey;C=C.Ca.keyCode;if(27===C)return M.jIa(),D.EwaSettings.isChangeGateEnabled("OfficeVSO:6022397_ClearStateWhileHidingRecoveryUI")&&(C=M.$.da.za(254))&&C.Yq("RecoveryUIController.onKeyDown",!0,!0).catch(function(){}),!0;if(17===C)return M.O8b=!0}return!1};this.hR=function(C,Q){C=Q.Ed;M.MAb=C;-1027730316!==C.command&&-1059615499!==C.command?M.jIa():(Q=Q.properties)&&
Q.launcherId!==M.yQh()&&M.jIa()};this.$=J;this.Gqc=H;this.ir=K;this.jm=N;this.Crd=this.MAb=this.srd=null;this.d_=this.O8b=this.u6b=this.xdc=!1;this.pZd=0;this.documentHidden=!1;this.grid=x.g(this.$);this.pasteRange=null;D.EwaSettings.xl()||this.$.da.Ga(406,this)}var e=b(10);u=b(0);var k=b(109),l=b(232),n=b(129),f=b(7),v=b(14),r=b(4),y=b(1601),m=b(13),w=b(5),B=b(1243),A=b(47),z=b(28),x=b(21),D=b(1),I=b(45),F=b(64),G=b(354),T=b(37),O=b(51);d.prototype.dispose=function(){this.Eag();this.Lag();this.Crd=
this.srd=this.recoveryUI=this.jm=this.ir=this.Gqc=this.$=null;this.pZd=0};d.prototype.HNg=function(J){this.recoveryUI=J;this.srd=J.sHg;this.Crd=J.k6i};d.prototype.jIa=function(){this.recoveryUI&&(this.pasteRange=I.K(this.recoveryUI.Wwh),this.qCj(),this.hide(),this.Eag(),this.recoveryUI=null)};d.prototype.qCj=function(){var J=[1868184698,-1985798686,753331043,2137617149,237279923,1804571062,1766348718,42074747,-875588320,-958589048,-185374993,-111689794,-1502853784,-1096627081,1441131127,-1027730316];
r.AFrameworkApplication.l_("XLS-SmartView-OnPasteEnabled-Control;XLS-SmartView-OnPasteEnabled-Treatment");D.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.OnPasteEnabled",!1)&&this.pasteRange&&(v.ULS.sendTraceTag(523622037,0,50,"RecoveryUIController:smartViewOnPaste RecoveryUI is being dismissed."),null!=this.MAb&&J.includes(this.MAb.command)?(v.ULS.sendTraceTag(526758984,306,50,"RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. Last command was {0}",B.a[this.MAb.command]),
this.MAb=null):this.documentHidden?(v.ULS.sendTraceTag(523833603,306,50,"RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. User clicked outside of document."),this.documentHidden=!1):this.qba()?this.O9f():(v.ULS.sendTraceTag(520725721,306,50,"RecoveryUIController:smartViewOnPaste Grid is not in consistent state."),this.grid.oYa(this.jya)))};d.prototype.qba=function(){return this.grid.Ea.$J(4,this.$.pa)};d.prototype.Qki=function(){return!!this.recoveryUI&&this.Gqc.bhi};d.prototype.uAj=
function(J){this.recoveryUI?this.show(J):v.ULS.shipAssertTag(537154072,0,!1,"RecoveryUIController.ShowRecoveryUI: recoveryUI is null.")};d.prototype.yQh=function(){return this.recoveryUI?this.recoveryUI.Zqi:null};d.prototype.show=function(J){var H=this.recoveryUI.rMh();H?(this.Gqc.showFloatie(Object(f.a)(new y.a,{x:H.x,y:H.y}),this.recoveryUI.IJa(),J),this.Pi()):v.ULS.sendTraceTag(537154071,0,100,"RecoveryUIController.Show: point is null.")};d.prototype.hide=function(){this.Qki()&&this.Gqc.rC();this.Lag()};
d.prototype.Pi=function(){if(!this.u6b){var J=x.g(this.$);J.view.Es(this.Gcg);J.Gi.Ak(this.pHe);this.jm.ka("blur",this.nfh);this.$.Ka.xFa(this.hR);this.$.va.If(this.qHe);(J=this.$.da.za(65))&&J.X2&&J.X2.registerForCommentEvents(this.oHe);this.u6b=!0}this.xdc||(this.ir.ft(m.a.Lb,this.$.domElement,this.onKeyDown,!0),this.ir.ft(m.a.Gd,this.$.domElement,this.onKeyUp,!0),this.xdc=!0)};d.prototype.Eag=function(){if(this.u6b){var J=x.g(this.$);J.view.Fq(this.Gcg);J.Gi.vk(this.pHe);this.jm.detach("blur");
this.$.Ka.Aza(this.hR);this.$.va.vg(this.qHe);(J=this.$.da.za(65))&&J.X2&&J.X2.unregisterForCommentEvents(this.oHe);this.u6b=!1}};d.prototype.Lag=function(){this.xdc&&(this.ir.pt(m.a.Lb,this.$.domElement,this.onKeyDown,!0),this.ir.pt(m.a.Gd,this.$.domElement,this.onKeyUp,!0),this.xdc=this.d_=this.O8b=!1)};d.prototype.gSj=function(){this.recoveryUI&&250<=z.a.Ta.Wd.m-this.pZd&&this.show(-1)};d.prototype.NLj=function(J){T.TaskExtensions.Aa(O.GetServiceTaskFactory.Ra(this.$.da,426,427,1),function(H){H.result.eea(J,
"Paste");v.ULS.sendTraceTag(523622036,0,50,"RecoveryUIController.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)};Object(u.a)(d,"RecoveryUIController",null,[486,3]);var U=l.a;Rk(c,U);c.prototype.create=function(){var J=this;if(D.EwaSettings.xl())this.sCi();else{var H=this.$;H.bB(function(K){K.pec().then(function(N){J.pb(J.$.da.za(406)||new d(H,N,k.KeyInputManager.instance,n.a.instance.JG()))})})}};c.prototype.sCi=function(){var J=this,H=this.$,K=this.$.da.za(406);
K?this.pb(K):H.bB(function(N){N.pec().then(function(M){K=new d(H,M,k.KeyInputManager.instance,n.a.instance.JG());J.$.da.Ga(406,K);J.pb(K)})})};c.ka=function(J){J.da.Ga(405,new c(J))};Object(u.a)(c,"RecoveryUIControllerFactory",l.a,[]);b.d(E,"a",function(){return a})},1480:function(u,E,b){function a(){Type.registerNamespace("Common.App.InsertFile")}b.d(E,"a",function(){return a})},1481:function(u,E,b){function a(){Type.registerNamespace("Common.App.InsertPicture")}b.d(E,"a",function(){return a})},
1563:function(u,E,b){function a(y,m,w){y=c.call(this,y,m,w)||this;y.mra=null;y.ZUb=null;return y}function c(y,m,w){this.wj=this.WAd=null;this.AEa=this.Rqa=0;this.sSb=null;this.DS=y;this.ae=m;this.ib=w;this.a1a=!1;this.nYd=!0;this.wfj();this.z8a=this.fa.qa("NativeFileOpenDialogIsEnabled")}u=b(0);var d=b(14),e=b(84);b(108);var k=b(27);c.prototype.dFb=function(y){this.wj=y;if(!this.a1a){if(this.nYd){if(this.z8a&&k.a.cF){this.sSb=y.L6b(Object(e.a)(this,this.jzd,"onFileChosen"));return}this.sSb=y.L6b(null);
if(!this.IBa(this.sSb,y))return}this.finalizeUpload(y,null)}};c.prototype.jzd=function(y){if(this.IBa(y,this.wj)){if(k.a.cF||k.a.Nf)this.sSb=y;this.finalizeUpload(this.wj,null)}};c.prototype.ioc=function(){this.WAd&&this.WAd()};c.prototype.wfj=function(){this.Rqa=0;this.AEa=this.fa.kd("Box4UploadRetryDelayStart",200);this.wj&&(this.wj.dispose(),this.wj=null)};Mf.Object.defineProperties(c.prototype,{context:{configurable:!0,enumerable:!0,get:function(){return this.DS}},fa:{configurable:!0,enumerable:!0,
get:function(){return this.ib}},retryCount:{configurable:!0,enumerable:!0,get:function(){return this.Rqa}},LKd:{configurable:!0,enumerable:!0,get:function(){return this.AEa}}});Object(u.a)(c,"FileUploader",null,[]);var l=b(4),n=b(332),f=b(995),v=b(135),r=b(29);b.d(E,"a",function(){return a});Rk(a,c);a.prototype.NXe=function(y){switch(y){case 1:return CommonUIStrings.l_ImageUploadNoFileSpecified;case 2:return CommonUIStrings.l_ImageUploadUnsupportedFileType;default:return""}};a.prototype.oeg=function(y){return a.IBa(y,
this.NZh())};a.prototype.NZh=function(){return a.Yhe};a.prototype.IBa=function(y,m){m=void 0===m?null:m;y=this.oeg(y);return 0!==y?(m&&m.mke(),2===y&&this.hj(0,this.NXe(y)),!1):!0};a.prototype.finalizeUpload=function(y,m){d.ULS.sendTraceTag(36783360,322,50,"PictureUploader.FinalizeUpload");this.WAd=m;this.Fzj();n.a.mark(5576);this.ZUb=this.kO.sc("LoadResource","PictureUploadTime")};a.prototype.hj=function(y,m){var w=new v.StandardDialog;w.Rb=0;w.Iz(y,CommonUIStrings.l_ImageUploadFailedTitle,m,null)};
a.prototype.ioc=function(){d.ULS.sendTraceTag(36783361,322,50,"PictureUploader.OnUploadComplete");c.prototype.ioc.call(this);this.ZUb&&(this.ZUb.stop(),this.ZUb=null);this.QYg()};a.prototype.Fzj=function(){this.mra=(new f.a).create();this.mra.message=CommonUIStrings.l_ImageUploadWait;this.mra.Rb=5;this.mra.Pu=!1;this.mra.DAa(null,null,null)};a.prototype.QYg=function(){this.mra&&(this.mra.close(),this.mra=null)};a.P4h=function(y,m){y=r.a.al(y);for(var w=0;w<m.length;++w)if(y.endsWith(m[w]))return!0;
return!1};a.IBa=function(y,m){m=void 0===m?null:m;m||(m=a.Yhe);return y?a.P4h(y,m)?0:2:1};Mf.Object.defineProperties(a.prototype,{kO:{configurable:!0,enumerable:!0,get:function(){return l.AFrameworkApplication.ta.pD}}});a.Yhe=".jpg .jpeg .png .gif .bmp .tif .tiff".split(" ");Object(u.a)(a,"PictureUploader",c,[])},1635:function(u,E,b){function a(ic){var Jc=bc.call(this)||this;Jc.$=ic;Jc.Eb();return Jc}function c(ic,Jc,zd){zd=void 0===zd?!0:zd;var sd=cc.call(this)||this;sd.TRa=null;sd.Fna=null;sd.XNa=
null;sd.n3b=null;sd.y0=null;sd.vqf=0;sd.Dab=!1;sd.Cab=!1;sd.trc=!1;sd.documentVisibilityObserver=null;sd.wqf=null;sd.iBj=null;sd.qfa=!1;sd.H7=0;sd.$jd=0;sd.Kzb=!1;sd.J3f=0;sd.ZPd=!1;sd.M0=null;sd.BEb=function(){sa.ULS.sendTraceTag(537155219,0,50,"NetworkConnectionStateManager.OnNetworkDownEvent: Network down.");sd.Tkc(1,!1)};sd.f9a=function(){sd.jka||sd.VBb?window.setTimeout(function(){sd.cVd()},sd.vqf):sd.cVd();sd.documentVisibilityObserver.WHb(sd.f9a);sd.Kzb=!1};sd.Af=function(){sa.ULS.sendTraceTag(537155218,
0,50,"NetworkConnectionStateManager.OnEditEnded: Edit ended. IsInOfflineMode:{0}, IsInDuringWorkSilentReopenMode:{1}",sd.VBb&&sd.xwc,sd.Vjc&&!sd.qfa&&sd.jLb);sd.VBb&&sd.xwc&&sd.$ie();sd.Vjc&&!sd.qfa&&sd.jLb&&sd.Xie();Va.g(sd.$).$b.Nl(sd.Af);sd.Cab=!1;sd.Dab=!1};sd.Xyf=function(){sa.ULS.sendTraceTag(537155213,0,50,"NetworkConnectionStateManager.OnNetworkResumedEvent: network was resumed.");sd.Tkc(1,!0);sd.Cab&&!sd.Dab&&Va.g(sd.$).$b.Nl(sd.Af);sd.Cab=!1};sd.yOa=function(Pd,De){sd.$jd=sd.H7;sd.H7=De.vzc};
sd.$Bf=function(){sd.$&&(sd.trc||(uc.a(sd.$).qQ(wb.a.FOa).kEg(sd.gzf),sd.$.Tk(sd.Yc),sd.trc=!0),sd.qfa=sd.hei(),sd.Tkc(2,!1))};sd.gzf=function(){var Pd=uc.a(sd.$).ii,De=Pd.tKg();Pd=Ac.f(Pd.ns.fd.errors,function(lc){return lc.MessageIdName});sa.ULS.sendTraceTag(545842889,0,50,"NetworkConnectionStateManager.OnOpenWebMethodErrorUserAlertExecuting: IsStateUnrecoverable:{0}, IsB2W:{1}, Errors: {2}",De,sd.qfa,nc.a.xc(Pd));De&&(sd.TRa?(sd.qfa=!1,sd.jFe(),sd.xAc()):sd.Fna&&(sd.kFe(),sd.xAc()))};sd.Yc=function(){sd.$?
(sa.ULS.sendTraceTag(541193955,0,50,"NetworkConnectionStateManager.OnWorkbookOpened: Workbook opened."),sd.qfa=!1,kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5543662_StopSilentReopenDuringWorkTimerMethodContextOnWorkbookOpened")&&sd.y0&&sd.y0.Lp&&(cf.a.Ia(sd.y0),sd.y0=null),kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5533387_ReportLongSilentReopenBackToWorkVeto")&&sd.M0&&sd.M0.Lp&&(cf.a.Ia(sd.M0),sd.M0=null),sd.Tkc(2,!0),sd.xAc()):sa.ULS.sendTraceTag(537155212,0,10,"NetworkConnectionStateManager.OnWorkbookOpened: bug monitoring: EwaControl is null.")};
sd.yuf=function(){sd.ppf(!0)};sd.zuf=function(){sd.ppf(!1)};sd.gWb=w.Wri;sd.o1c=w.connected;sd.$=ic;sd.sf=ic.oa.sf;sd.O0f=kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5618694_BackToWorkLoadingUIEnabled");sd.jLb=kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5798300_SilentReopenDuringWorkUIEnabled");sd.xwc=kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5618594_OfflineModeUXEnabled");zd&&(sd.wqf=new k(ic,Jc));kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5589104_AlwaysInitDocumentVisibilityObserver")&&
sd.$.da.Za(291,function(Pd){sd.documentVisibilityObserver=Pd});sd.xwc&&(kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5589104_AlwaysInitDocumentVisibilityObserver")||sd.$.da.Za(291,function(Pd){sd.documentVisibilityObserver=Pd}),sd.vqf=sd.$.ya.ExcelNetworkCheckAfterTabActivationDelayMs,sd.sf.pFg(sd.BEb),sd.sf.$mb(sd.Xyf),sd.sf.Zle(sd.yuf),sd.sf.QDg(sd.zuf));if(sd.O0f||sd.jLb)sd.iBj=new d(sd.$,sd);sd.Ylf=sd.$.ya.LongInactivityTimePeriodSeconds;sd.$.ea.PUc(sd.$Bf);sd.$.ea.df.Era(sd.yOa);sd.jLb&&(sd.J3f=
sd.$.ya.SilentReopenDuringWorkDelayMs);return sd}function d(ic){var Jc=this;this.x7=null;this.aCf=function(zd,sd){Jc.YBf(sd,3)};this.nyf=function(zd,sd){Jc.YBf(sd,2)};this.$=ic;this.Rf=Xb.a(this.$).Rf;this.Rf.Gme(this.nyf);this.Rf.DGg(this.aCf)}function e(ic,Jc,zd,sd){ic=m.call(this,ic,Jc,zd)||this;ic.wasInteruptedByOfflineMode=!1;ic.type=sd;ic.wasInteruptedByOfflineMode=!1;return ic}function k(ic,Jc){this.pla=this.nCi=this.lsf=null;this.$=ic;!kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5618594_OfflineModeUXEnabled")||
kc.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&ha.a.Nf||(this.lsf=new l(ic,Jc));!kc.EwaSettings.ma(561)||kc.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&ha.a.Nf||(this.pla=new Tb.NetworkConnectionHealthChecker(this.$));this.V0g=new v(this.$)}function l(ic,Jc){var zd=this;this.WNa=this.mU=null;this.$Dd=-1;this.Qtb=null;this.Gif=Fb.Task.delay(0);this.B9a=function(sd,Pd){Pd.JL?zd.JOi(Pd.Wna):zd.KOi()};this.vca=function(sd,
Pd){5===Pd.WEf&&zd.x2a()};this.tUf=function(sd,Pd){zd.mU.kpj(Pd.IU)};this.x2a=function(){zd.WNa.mQj();zd.ojj(l.bCd,Sys.Serialization.JavaScriptSerializer.serialize(zd.WNa))};this.eej=function(sd){if(sd=sd.result)zd.pfg=!0,sa.ULS.sendTraceTag(576811915,0,50,"OfflineModeTelemetryManager.ReportOfflinePartialInteractivityDataFromIDB: Previous session's offline partial interactivy data: {0}",sd)};this.v9i=function(){zd.pfg&&(zd.$?ke.TaskExtensions.Aa(zd.indexedDB.f5c(l.bCd),function(){sa.ULS.sendTraceTag(537155204,
0,50,"OfflineModeTelemetryManager.RemoveDataFromIDB: Previous session's offline partial interactivy data successfuly removed from IDB.")},zd.$.la):sa.ULS.sendTraceTag(537155203,0,10,"OfflineModeTelemetryManager.RemoveDataFromIDB: EwaControl is null when attempting to remove offline mode data stored in IDB."))};this.aOa=function(){if(zd.WNa&&0<zd.WNa.count){var sd=Sys.Serialization.JavaScriptSerializer.serialize(zd.WNa);sa.ULS.sendTraceTag(560791644,0,50,"OfflineModeTelemetryManager.OnBeforeUnload: This session's offline partial interactivy data: {0}",
sd)}};this.$=ic;this.indexedDB=Jc;this.pfg=!1;this.indexedDB.zf()&&(this.indexedDB.initialize(l.gkd,l.hkd),this.Bdj(),this.WNa=new f(this.$.ya.UserSessionId),Xb.a(this.$).Rf.wUc(this.B9a));this.jm=Fa.a.instance.JG();this.jm.ka("beforeunload",this.aOa)}function n(ic,Jc,zd){ic=m.call(this,ic,Jc,zd)||this;ic.timeFromLastOffline=0;ic._errorDataDuringOfflineMode=null;ic.timeFromLastOffline=-1;ic.type=5;return ic}function f(ic){this._count=0;this.sessionID=this.allOfflinePartialInteractivitiesDataInSession=
null;this.allOfflinePartialInteractivitiesDataInSession=[];this.sessionID=ic}function v(ic){var Jc=this;this.Fic=this.data=null;this.P9c=0;this.rAe=null;this.Auf=function(zd,sd){sd.JL?(Jc.data=new y(af.a.Ta.Jb,Jc.$,5===sd.Wna,0!==sd.Wna,Jc.$.sf.disconnectionSource,Jc.rAe),Jc.Fic=Jc.$.sf.Mif,Jc.P9c=1,Jc.$.oa.sf.$Gg(Jc.Jn),Wc.a(Jc.$).lUc(Jc.sUf)):(Jc.data.EHi(Jc.$,5===sd.Wna),Jc.$.oa.sf.WPf(Jc.Jn),Jc.data.lastFailedRequestToOnlineTimeGapSec=Sb.getElapsedSeconds(Jc.Fic,af.a.Ta.Jb),kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_7pzab_ConnectivityIssues")?
td.b().YJb(557682689,0,50,r.connectivityIssues,Jc.data.durationMs,"ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: {0}",nc.a.xc(Jc.data)):sa.ULS.sendTraceTag(557682689,0,50,"ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: {0}",nc.a.xc(Jc.data)),kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5508233_ReportNetworkDownVeto")&&Jc.data&&Jc.data.isToastShown&&Pe.Health.instance.recordQosError(fd.a.gYg,[Tc.a.ljc],
!0,!1,!1,!1,null),Wc.a(Jc.$).iId(Jc.sUf),Jc.data=null)};this.sUf=function(zd,sd){Jc.data.jpj(sd.IU)};this.Jn=function(zd,sd){Jc.data.R5i(sd.context.methodName);zd=af.a.Ta.Jb;sd=Sb.getElapsedSeconds(Jc.Fic,zd);Jc.Fic=zd;sd>Jc.data.longestDurationBetweenFailedRequestsSec&&(Jc.data.longestDurationBetweenFailedRequestsSec=sd);Jc.P9c++;Jc.data.averageDurationBetweenFailedRequestsSec=Jc.OSg(sd)};this.xuf=function(zd,sd){Jc.rAe=sd.RLj};this.$=ic;Xb.a(this.$).Rf.$le(this.Auf);this.$.sf.Zle(this.xuf)}function r(){}
function y(ic,Jc,zd,sd,Pd,De){ic=m.call(this,ic,Jc,sd)||this;ic.swappedByOffline=!1;ic.swappedOffline=!1;ic.averageDurationBetweenFailedRequestsSec=0;ic.longestDurationBetweenFailedRequestsSec=0;ic.lastFailedRequestToOnlineTimeGapSec=0;ic.disconnectionSource=null;ic.errorDataDuringConnectivityIssuesMode=null;ic.failedRequests=[];ic.triggeringRequest=null;ic.type=4;ic.swappedOffline=zd;ic.disconnectionSource=Enum.toString(jc.a,Pd);ic.triggeringRequest=De;return ic}function m(ic,Jc,zd){var sd=this,
Pd;this.type=0;this.startTime=null;this.blockedOperationsCount=this.durationMs=0;this.blockedActions=null;this.blockedUserOperationsWhileToastShown=this.durationUntilToastShownMs=0;this.toastRaiser=null;this.wasUserActiveOnPIEnd=this.wasUserActiveOnPIStart=this.hasTabbedOut=this.isToastShown=!1;this.durationUntilUserInactive=-1;this.isTaskPaneCollapsed=this.isTaskPaneShown=this.isDialogShown=!1;this.qtf=function(De,lc){sd.blockedOperationsCount++;De=String.format("{0}_{1}_{2})",lc.componentName,lc.actionName,
lc.details);sd.blockedActions[De]=sd.blockedActions[De]?sd.blockedActions[De]+1:1;sd.isToastShown&&sd.blockedUserOperationsWhileToastShown++};this.ZAd=function(De){sd.durationUntilUserInactive=Sb.getElapsedSeconds(sd.startTime,af.a.Ta.Jb);De.RId(sd.ZAd)};this.c6=function(){sd.hasTabbedOut=!0};this.vca=function(De,lc){lc.WEf!==sd.type||sd.isToastShown||(sd.durationUntilToastShownMs=hb.a(af.a.Ta,sd.startTime),sd.toastRaiser=lc.toastRaiser,sd.isToastShown=!0)};this.startTime=ic;this.durationUntilToastShownMs=
0;this.blockedActions={};this.isToastShown=zd;if(null===(Pd=Jc.ea)||void 0===Pd?0:Pd.df)this.wasUserActiveOnPIStart=Jc.ea.df.Qr;this.Pi(Jc);kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5340853_ImprovePIData")?(this.isDialogShown=0<Jc.ob.nR,ic=Jc.da.za(183),this.isTaskPaneShown=!!ic&&ic.isVisible&&!ic.isCollapsed,this.isTaskPaneCollapsed=!!ic&&ic.isVisible&&ic.isCollapsed):this.isTaskPaneCollapsed=this.isTaskPaneShown=this.isDialogShown=!1}function w(){}function B(ic){var Jc=Wd.call(this)||this;Jc.Dc=
ic;Jc.Eb();return Jc}function A(ic,Jc,zd){zd=void 0===zd?null:zd;var sd=pe.call(this)||this;sd.k_a=null;sd.Z4a=null;sd.mec=null;sd.BCa=null;sa.ULS.sendTraceTag(537155417,0,50,"MergeSuspensionManager.ctor started");sd.$=ic;sd.BWa=new O(ic);kc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SelectionAdjust",!1)&&(sd.Zza=new z(sd.$));sd.g1a=new I(sd.$.oa.xa,sd.$,void 0,void 0,sd.Zza);sd.i9h(ic,zd);sd.zfa=new U(sd.BCa,sd.BWa);sd.KJd=new F(ic,sd.zfa,Jc,sd.g1a);kc.EwaSettings.ma(255)&&(sd.mec=
new M(ic,sd));sa.ULS.sendTraceTag(588276810,0,50,"MergeSuspensionManager created");return sd}function z(ic){var Jc=this;this.mMb=0;this.Fy=this.Lx=null;this.A0d=new D;this.B0d=new D(!0);this.KC=0;this.EHj=!1;this.ipf=1E4;this.Yc=function(){Jc.KDe()};this.xi=function(){Jc.JWc(!0,!1)};this.Z8a=function(){Jc.JWc(!1,!1)};this.$=ic;this.gridView=Va.g(this.$);this.gridView.Ea.hx(this.xi);this.gridView.Ea.Ds(this.Z8a);this.gridView.Ea.Rle(this.Z8a);this.gridView.Ea.Cga(this.Z8a);kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6385622_SelectionAdjustImplementsCustomReportManager")&&
this.$.Tk(this.Yc);this.oej=kc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ReportSelections",!1);this.KDe();this.OCb=kc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SelectionAdjustMultiRangeSupport",!1);this.Kdj=kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6354017_reportEditRaceCondition");this.OQf=kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6367531_reportDivergenceOnResponse");this.Foe=kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6409189_alwaysVerifyMaxBlockRevisionBeforeAdjust")}
function x(ic,Jc,zd,sd,Pd,De){var lc=this;this.NI=void 0;this.jb=ic;this.eG=Jc;this.n9=zd;this.pWb=sd;this.JDc=Pd;kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6592063_GetIndexOfActiveRangeFromInitialSelection_V2")&&(this.NI=De);this.oUb=kc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SelectionAdjustMultiRangeSupport",!1);this.X5d=kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6399793_GetBlocksOnAdjustCheck");this.Ljg=kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6399805_adjustIfNoCachedBlocks");
this.X5d||(this.oUb?this.BQb=this.selectedRanges.map(function(Pc){return lc.dAc(Pc,Pd)}):this.dCa&&(this.BQb=[this.dAc(this.selectedRanges[0],Pd)]))}function D(ic){this.divergenceOnResponse=this.adjustedDidntChangeWithDivergence=this.editBoxDivergence=this.differentSheetAdjust=this.parallel=this.errors=this.nonContinuous=this.divergenceOnViewportReady=this.adjusted=this.adjustedDidntChange=0;this.K7h=void 0===ic?!1:ic}function I(ic,Jc,zd,sd,Pd){zd=void 0===zd?null:zd;sd=void 0===sd?null:sd;Pd=void 0===
Pd?null:Pd;var De=Td.call(this)||this;De.$Ab=null;De.dBd=0;De.documentVisibilityObserver=null;De.Xhf=!1;De.xa=ic;De.ctc=Jc.ya.MergeSuspensionRequestThrottlingTimeInMs;var lc=Jc.ya.GetRangeContentPrefetchDelayForMergeInMs;De.ly=function(){Jc.fVf(lc)};De.ah=zd||af.a.Ta;De.CYd=0;De.pO=sd;De.Zza=Pd;De.ydg=kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6248201_useDoPendingMergeSuccessCallback");De.sTg=kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6237816_CallDoPendingMergeRequest");Jc.da.Za(291,function(Pc){De.documentVisibilityObserver=
Pc});return De}function F(ic,Jc,zd,sd){var Pd=Se.call(this)||this;Pd.g1a=null;Pd.AAb=0;Pd.j7a=null;Pd.BAb=null;Pd.eAf=function(De,lc){Pd.g1a.cMg(lc.eca,lc.BIg)};Pd.$Eb=function(De,lc){lc.Iwa?Pd.ODj():Pd.iyc()};Pd.tyf=function(){Pd.AAb=0};Pd.wWf=function(){var De=Pd.N5.led();G(Pd.xa,null!=De.SuspensionStartTimestamp?De.SuspensionStartTimestamp:0,null,function(){Pd.eNi(De)},null,null,Pd.xa.Pb())};Pd.QBa=function(De,lc){if(lc){lc.unb.MergeCount=Pd.N5.led();var Pc=Va.g(Pd.$).Wzi();De=Pc.min;Pc=Pc.max;
kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5524817_LogOnMergeRaceCondition2")?lc.unb.ClientRevisions=Object(Gc.a)(new T,{Min:De,Max:Pc,MaxFromBlockCache:Va.g(Pd.$).Ea.bvd}):lc.unb.ClientRevisions=Object(Gc.a)(new T,{Min:De,Max:Pc})}};Pd.$=ic;Pd.gZa=zd;Pd.N5=Jc;Pd.N5.$Fg(Pd.eAf);Pd.N5.DZb(Pd.$Eb);Pd.N5.iFg(Pd.tyf);Pd.$.oa.Gga(Pd.QBa);Pd.xa=Pd.$.oa.xa;Pd.ctc=Pd.$.ya.MergeSuspensionRequestThrottlingTimeInMs;Pd.qpi=Pd.$.ya.KeepBlockingPendingMergesRequestIntervalMs;Pd.g1a=sd;sa.ULS.sendTraceTag(588276807,
0,50,"RequestController initialized");return Pd}function G(ic,Jc,zd,sd,Pd,De,lc){lc=ic.Na(1,void 0===lc?null:lc);lc.suspensionStartTimestamp=Jc;return se.g(ic,"KeepBlockingPendingMerges",lc,zd,sd,Pd,De,0)}function T(){}function O(ic){var Jc=Be.call(this)||this;Jc.C1=null;Jc.Kic=0;Jc.b8=function(zd,sd){var Pd;if(null===(Pd=null===sd||void 0===sd?void 0:sd.Wc)||void 0===Pd?0:Pd.MergeCount)pc.a.equals(sd.Wc.SessionId,Jc.$.ea.sessionId,!1)?Jc.mya(sd.Wc.MergeCount,O.xsb):sa.ULS.sendTraceTag(579737049,
0,50,"Stale merge counter ({0}/{1})",sd.Wc.MergeCount.Current,sd.Wc.MergeCount.Pending)};Jc.yCb=function(zd,sd){(null===sd||void 0===sd?0:sd.eca)&&Jc.mya(sd.eca,O.FZd)};Jc.avc=function(){Jc.fSf();Jc.SJf(Jc.C1,O.ofj)};Jc.i9a=function(zd,sd){sd.oqb&&Jc.C1.SuspensionStartTimestamp&&sa.ULS.sendTraceTag(17318084,0,50,"PendingMergeMonitor.OnEditCellEnded: committed with counter {0}",fa(Jc.C1))};Jc.fSf();Jc.$=ic;Jc.$.ea.Vj(Jc.avc);Jc.$.ea.QL(Jc.avc);Va.g(Jc.$).Wb.tm(Jc.i9a);kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6329027_UpdateMergeCountWhenWebMethodReturnsWithErrors")||
Jc.$.oa.Sq(Jc.b8);Jc.$.da.Za(292,function(zd){zd.sYa(Jc.yCb);sa.ULS.sendTraceTag(588276809,0,50,"PendingMergeMonitor initialized")});return Jc}function U(ic,Jc){var zd=ve.call(this)||this;zd.nya=function(sd,Pd){sd=zd.getState();var De=zd.ila;zd.ila=Pd.eca;Pd=zd.getState();zd.Yui(sd,Pd,De);zd.raiseEvent(U.tvd);zd.ySe(sd,Pd)};zd.tOa=function(sd,Pd){sd=zd.getState();zd.MH=Pd.MH;Pd=zd.getState();zd.ySe(sd,Pd)};zd.Eyb=kc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",
!1);zd.zha=ic;zd.zha.yZb(zd.tOa);zd.gma=Jc;zd.gma.sYa(zd.nya);zd.ila=Object(Gc.a)(new ld.a,{Pending:0,Current:0,SuspensionStartTimestamp:null});zd.MH=zd.O8h();return zd}function J(ic,Jc){ic=Qd.call(this,ic)||this;ic.BIg=Jc;return ic}function H(ic){this.uoe=!1;this.uoe=ic;return this}function K(){}function N(ic){var Jc=gd.call(this)||this;Jc.Iwa=ic;return Jc}function M(ic,Jc){var zd=oc.call(this)||this;zd.statusBarManager=null;zd.Swd=!1;zd.nya=function(sd,Pd){sd=String.format("{0}{1}",Pd.eca.Current===
Pd.eca.Pending?"\u26ad":"\u26ae",Pd.eca.Current);pc.a.equals(zd.slc,sd,!1)||(zd.slc=sd,zd.qz())};zd.tOa=function(sd,Pd){sd=0==Pd.MH;zd.Swd!==sd&&(zd.Swd=sd,zd.qz())};zd.mergeSuspensionManager=Jc;zd.mergeSuspensionManager.gma.sYa(zd.nya);zd.slc="";sc.a.h2(1905775613,nb.a.wc,0,1);zd.Ka=ic.Ka;zd.iNb=new C;ic.da.Za(29,function(sd){zd.mergeSuspensionManager&&(zd.statusBarManager=sd,sd.gJ(zd),zd.mergeSuspensionManager.zha.yZb(zd.tOa))});zd.Ka.i2(zd.iNb);return zd}function C(){return Dc.call(this)||this}
function Q(ic,Jc){Jc=void 0===Jc?null:Jc;var zd=Pb.call(this,1)||this;zd.sfa=!1;zd.nN=function(){zd.refresh()};zd.Kuf=function(){zd.refresh()};zd.$=ic;zd.S6d=Jc||uc.a(ic).qQ(wb.a.idle);uc.a(ic).kUc(zd.Kuf);zd.Y4a.gq(zd.nN);zd.refresh();return zd}function P(ic,Jc){var zd=Fc.call(this)||this;zd.Eif=null;zd.Lic=!1;zd.yQa=new Z.a;zd.Hie=ic;zd.gma=Jc;zd.Eyb=kc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);zd.Eyb&&(zd.Hie.jFg(zd.uyf.bind(zd)),zd.gma.sYa(zd.nya.bind(zd)));
return zd}function ka(ic){return(null===ic||void 0===ic?void 0:ic.SuspensionStartTimestamp)&&ic.Pending>ic.Current}function R(ic,Jc){return ic||Jc?ic&&Jc?ic.Current===Jc.Current&&ic.Pending===Jc.Pending&&ic.SuspensionStartTimestamp===Jc.SuspensionStartTimestamp:!1:!0}function fa(ic){return ic?String.format("{0} / {1} @{2}",ic.Current,ic.Pending,ic.SuspensionStartTimestamp):null}function ca(ic,Jc){this.handler=null;this.publisher=ic;this.MH=Jc}function ea(ic){var Jc=fb.call(this,1)||this;Jc.sfa=!1;
Jc.Gtf=function(){Jc.refresh()};Jc.Htf=function(){Jc.refresh()};Jc.gridView=Va.g(ic);Jc.gridView.Wb.Ak(Jc.Htf);Jc.gridView.Wb.tm(Jc.Gtf);Jc.refresh();return Jc}function wa(ic){var Jc=Za.call(this)||this;Jc.Yjd=null;Jc.$=ic;Jc.Eb();return Jc}function X(ic){var Jc=Mb.call(this)||this;Jc.$=ic;Jc.Eb();return Jc}function ja(ic,Jc){this.NSe=ic;this.VAh=Jc}function va(ic){this.$=ic}function ua(){this.fb=null}function Xa(){this.fib=this.ySb=this.Bv=null}function aa(ic,Jc,zd,sd,Pd){this.Bv=ic;this.sib=Jc;
this.oib=zd;this.Jce=void 0===sd?null:sd;this.wkb=void 0===Pd?null:Pd}function ba(){this.fb=null}function oa(ic){this.Vb=ic}function ra(){this.ohe=0;this.hWa=Array(5);this.hWa[0]=10;this.hWa[1]=15;this.hWa[2]=50;this.hWa[3]=100;this.hWa[4]=200}function db(ic,Jc,zd,sd,Pd){this.j$b=!1;this.asb=null;this.La=ic;this.AXa=Jc;this.GVb=zd;this.d1=sd;this.nEc=Pd}function Ka(){this.yNf=this.rSf=this.u7f=this.djc=this.instance=null}function Ga(ic,Jc,zd){this.La=ic;this.Re=Jc;this.$Sb=zd}function xa(){this.completed=
this.Z8i=!1}function da(){this.Nfe=this.qae=this.$0d=!0;this.vdj=this.YXi=null;this.rBi=!1;this.locale=null;this.bag={}}function qa(){}function na(){this.eVb=this.xSb=null}function ia(ic){return ob.call(this,ic)||this}b.r(E);var ta=b(1350),za=b(0),sa=b(14),V=b(4),Ia=b(120),Ha=b(422),ob=Ha.a;Rk(ia,ob);ia.prototype.createElement=function(){var ic=document.createElement("link");ic.setAttribute("rel","stylesheet");ic.setAttribute("type","text/css");ic.setAttribute("href",this.ht);return ic};ia.prototype.Q2c=
function(){return null};ia.prototype.yrc=function(){this.element.setAttribute("href","");this.element.setAttribute("href",this.Dz.ht)};Mf.Object.defineProperties(ia.prototype,{R3b:{configurable:!0,enumerable:!0,get:function(){return!1}}});Object(za.a)(ia,"CssResource",Ha.a,[]);var ib=b(392),La=b(236),zb=b(29),Fb=b(58);na.prototype.hsi=function(){this.xSb||(sa.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this.xSb=Fb.Task.WAA(na.msi(),na.esi()),this.xSb.continueWith(function(ic){sa.ULS.sendTraceTag(21030599,
324,10,"{0}",zb.a.Xcd(ic.exception))},5));return this.xSb};na.prototype.jsi=function(){if(!this.eVb)try{sa.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage"),this.eVb=Fb.Task.WAA(na.n7c(La.a.create(V.AFrameworkApplication.fa.Wa("DimeUrl"),null,null))),this.eVb.continueWith(function(ic){sa.ULS.sendTraceTag(39978391,324,10,"{0}",zb.a.Xcd(ic.exception))},5)}catch(ic){sa.ULS.sendTraceTag(594874951,324,10,"{0}",zb.a.Xcd(ic))}return this.eVb};na.msi=function(){var ic=na.dcc("inproductmessaging.js");
ic=La.a.create(ic,null,null);return na.n7c(ic)};na.esi=function(){var ic=na.dcc("inproductmessaging.css");ic=new ia(ic);return na.n7c(ic)};na.dcc=function(ic){return Ia.a.W2b(String.format("ipm/{0}",ic))};na.n7c=function(ic){ib.a.lia(ic);return ic.K7a};Object(za.a)(na,"DependencyDownloader",null,[993]);qa.mVi="inProductMessagingOverlayDiv";qa.XXi="PlayButtonImage";qa.udj="ReplayButtonImage";Object(za.a)(qa,"Constants",null,[]);da.prototype.lrj=function(){this.Dle(qa.XXi,this.YXi);this.Dle(qa.udj,
this.vdj)};da.prototype.Dle=function(ic,Jc){Jc&&(this.bag[ic]=Jc)};Mf.Object.defineProperties(da.prototype,{DMg:{configurable:!0,enumerable:!0,get:function(){return this.$0d},set:function(ic){this.$0d=ic}},uAi:{configurable:!0,enumerable:!0,get:function(){return this.qae},set:function(ic){this.qae=ic}},Bzj:{configurable:!0,enumerable:!0,get:function(){return this.Nfe},set:function(ic){(this.Nfe=ic)&&this.lrj()}}});Object(za.a)(da,"FirstRunExperienceUISettings",null,[991]);Object(za.a)(xa,"FirstRunExperienceViewData",
null,[992]);var Yb=b(84),kb=b(181),vb=b(107),Wa=b(25);Ga.prototype.Bg=function(){this.La.He(Wa.a.WAh,vb.a.frame,Object(Yb.a)(this,this.UAh,"firstRunExperienceHandler"),64);this.La.Mb(Wa.a.MSe,vb.a.frame,Object(Yb.a)(this,this.N7h,"inProductMessagingTabHandler"));this.La.Mb(Wa.a.LSe,vb.a.frame,Object(Yb.a)(this,this.M7h,"inProductMessagingShiftTabHandler"));this.La.Mb(Wa.a.Jeh,vb.a.frame,Object(Yb.a)(this,this.Keh,"dimeLaunchHandler"));this.La.Mb(Wa.a.TQf,vb.a.frame,kb.ActionManager.eg);this.La.Mb(Wa.a.Sdj,
vb.a.frame,kb.ActionManager.eg);this.La.Mb(Wa.a.Tdj,vb.a.frame,kb.ActionManager.eg);this.Re&&this.Re.updateCommandUI()};Ga.prototype.UAh=function(ic,Jc,zd,sd,Pd){2===zd&&this.$Sb.Fqi(Pd);return 32};Ga.prototype.Keh=function(ic,Jc,zd,sd,Pd){2===zd&&this.$Sb.Cqi(Pd);return 32};Ga.prototype.N7h=function(ic,Jc,zd){return 2===zd?this.$Sb.Svd():32};Ga.prototype.M7h=function(ic,Jc,zd){return 2===zd?this.$Sb.Qvd():32};Object(za.a)(Ga,"InProductMessagingActor",null,[]);var qb=b(85);Object(za.a)(Ka,"DimeExperienceUISettings",
null,[]);var yb=b(167),ec=b(500);db.prototype.z$h=function(ic){yb.b("getHeaderApi")?ic.isFeatureEnabled("MsoPremiumBadge",!0).then(function(Jc){var zd=ic.isFreemiumUpsellEnabled();zd&&(appChrome.getHeaderApi().then(function(sd){sd.updatePremiumStatus(Jc,zd);return null}),ic.yma("MsoPremiumBadge",function(sd){appChrome.getHeaderApi().then(function(Pd){Pd.updatePremiumStatus(sd.isEnabled,zd);return null})}));return null}):sa.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")};db.prototype.Fqi=
function(ic){var Jc=this;this.GVb.hsi().continueWith(function(){Jc.AXa.WAj(ic)})};db.prototype.Cqi=function(ic){function Jc(){}var zd="gopremium",sd=null;ic?(ic.experience&&""!==Object(qb.a)(String,ic.experience)&&(zd=Object(qb.a)(String,ic.experience)),ic.onTaskComplete&&(Jc=ic.onTaskComplete),ic.campaignId&&""!==Object(qb.a)(String,ic.campaignId)&&(sd=Object(qb.a)(String,ic.campaignId))):sa.ULS.sendTraceTag(51675402,324,50,"Experience not given, using default experience");this.Xif(zd,Jc,sd)};db.prototype.Xif=
function(ic,Jc,zd){var sd=this;zd=void 0===zd?null:zd;if(this.j$b&&this.asb){var Pd={};Pd.experience=ic||"gopremium";Pd.campaignId=zd||ec.b(this.d1,this.nEc,Object(qb.a)(String,Pd.experience),!0);this.La.processAction(Wa.a.TQf,2);sa.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+Pd.experience);try{var De=Object.assign(new Ka,{instance:this.asb,djc:Pd,u7f:Jc||function(){},rSf:function(lc){sa.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+lc.status)},yNf:function(){sa.ULS.sendTraceTag(51675406,
324,10,"Dime launch error");sd.j$b=!1;sd.asb=null}});this.AXa.hzj(De)}catch(lc){sa.ULS.sendTraceTag(51675407,324,10,"Dime launch error: "+lc.message),this.j$b=!1,this.asb=null,ic={},this.La.$d(Wa.a.k$b,2,(ic.experience=Pd.experience,ic))}}else sa.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),Pd={},this.La.$d(Wa.a.k$b,2,(Pd.experience=ic,Pd))};db.prototype.Ojf=function(){var ic=this;this.GVb.jsi().continueWith(function(){try{var Jc=zb.a.al(V.AFrameworkApplication.uiCulture),
zd=ec.c(ic.d1);if(zd){Jc={partnerId:zd,language:Jc};Jc.sessionId=V.AFrameworkApplication.userSessionId;Jc.authHint=V.AFrameworkApplication.fa.Wa("UserPrincipalName");var sd=V.AFrameworkApplication.fa.Wa("Puid")||"";""!==sd&&(Jc.userInfo={puid:sd});ic.asb=new Dime(Jc);ic.j$b=!0;sa.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}else sa.ULS.sendTraceTag(51675409,324,15,"App not supported")}catch(Pd){sa.ULS.sendTraceTag(51675410,324,10,"FreemiumUpsellDialogDependencies failed: "+Pd.message)}},
3)};db.prototype.Svd=function(){return this.AXa.Svd()};db.prototype.Qvd=function(){return this.AXa.Qvd()};Object(za.a)(db,"InProductMessagingUIManager",null,[990]);ra.prototype.Init=function(ic){this.ohe=ic};ra.prototype.SendTrace=function(ic,Jc){sa.ULS.sendTraceTag(34182235,this.ohe,this.hWa[ic],"{0}",Jc)};Object(za.a)(ra,"DefaultNetworkingManager",null,[1007]);var Ob=b(273),Cb=b(326),ab=b(96);oa.prototype.WAj=function(ic){ic&&(InProductMessaging.Networking.NetworkingMgr=new ra,InProductMessaging.Networking.NetworkingMgr.Init(387),
InProductMessaging.Init(ic.Bzj,ic.uAi,ic.DMg,ic.rBi,ic.locale,Object(Yb.a)(this,this.DIi,"onDismissFirstRunExperience"),ic.bag),this.iRa(qa.mVi,!0))};oa.prototype.hzj=function(ic){var Jc=this;if(ic&&ic.instance&&ic.djc){var zd=document.getElementById("wacDimeContainer");zd||(zd=document.createElement("div"),zd.id="wacDimeContainer",document.body.appendChild(zd));V.AFrameworkApplication.fa.qa("DimeFocusManagerIsEnabled")&&this.iRa("wacDimeContainer",!1);ic.djc.parentElementId="wacDimeContainer";ic.instance.launch(ic.djc,
ic.u7f).then(function(sd){Jc.FHb();document.body.removeChild(zd);ic.rSf(sd)}).catch(function(sd){Jc.FHb();document.body.removeChild(zd);ic.yNf(sd)})}else throw Error.argument("DimeExperienceUISettings");};oa.prototype.iRa=function(ic,Jc){if(this.Vb&&ic&&(ic=document.getElementById(ic),this.q$h(ic),ic=this.Vb.CM("InProductMessagingFocusId"))){var zd=this.Vb.ji;zd&&"InProductMessagingFocusId"===zd.name||this.Vb.tR("InProductMessagingFocusId",!1);Jc&&this.FLf(ic.scope)}};oa.prototype.q$h=function(ic){var Jc=
!1;Jc=void 0===Jc?!0:Jc;var zd=this.Vb.li("InProductMessagingFocusId");zd.parent=Ob.AFrame.zT;var sd=new Cb.DOMFocusListing(function(){return ic});sd.Gab=Jc;sd.Un(3);sd.Un(2);sd.Un(4);Jc=this.Vb.gsa(function(){return ic},zd,sd);Jc.xHb();Jc.m_=!0;Jc.eHa=!0};oa.prototype.FLf=function(ic){ic.hk(ab.FocusManager.instance().T1);ic.hk(ab.FocusManager.instance().U1);ic.bindAction(ab.FocusManager.instance().T1,Wa.a.MSe);ic.bindAction(ab.FocusManager.instance().U1,Wa.a.LSe)};oa.prototype.FHb=function(){this.Vb&&
(this.Vb.Hca("InProductMessagingFocusId"),this.Vb.RPa("InProductMessagingFocusId"))};oa.prototype.DIi=function(ic,Jc){this.FHb();ic=Object.assign(new xa,{completed:ic,Z8i:Jc});V.AFrameworkApplication.ub.$d(Wa.a.TAh,2,ic)};oa.prototype.Svd=function(){var ic=document.activeElement,Jc=this.Vb.sQ();return ic&&Jc&&Jc.Ve&&ic===Jc.Ve.jw?(Jc.Ve.tl(ic),Jc.Pxa()?32:8):4};oa.prototype.Qvd=function(){var ic=document.activeElement,Jc=this.Vb.sQ();return ic&&Jc&&Jc.Ve&&ic===Jc.Ve.firstElement?(Jc.Ve.tl(ic),Jc.MNa()?
32:8):4};Object(za.a)(oa,"InProductMessagingUIWrapper",null,[989]);var ya=b(142),ma=b(254),ha=b(27);ba.prototype.Ph=function(ic){ic.register(na,"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").tc().Cc(function(){return new na});ic.register(oa,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").tc().Cc(function(){return new oa(ab.FocusManager.instance())});ic.register(db,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").tc().Cc(function(){return new db(V.AFrameworkApplication.ub,
ic.resolve("Common.IInProductMessagingUIWrapper"),ic.resolve("Common.App.InProductMessaging.IDependencyDownloader"),V.AFrameworkApplication.ta.Qa.Cj,V.AFrameworkApplication.ta.Qa.lca)});ic.register(Ga,"Common.App.InProductMessaging.InProductMessagingActor").tc().Cc(function(){return new Ga(V.AFrameworkApplication.ub,V.AFrameworkApplication.ta,ic.resolve("Common.IInProductMessagingUIManager"))});ic.register(da,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").tc().Cc(function(){return new da});
ic.register(xa,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").tc().Cc(function(){return new xa});this.fb=ic};ba.prototype.init=function(){var ic=this;this.fb.resolve("Common.App.InProductMessaging.InProductMessagingActor").Bg();V.AFrameworkApplication.fa.Su(function(){V.AFrameworkApplication.ta.Qa.isReactSharedHeaderUxEnabled&&ya.a.get_instance().ak(15,function(){ic.fb.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(function(Jc){ic.fb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").z$h(Jc)})});
V.AFrameworkApplication.fa.qa("FreemiumUpsellShowDialogIsEnabled")&&ec.a()&&!ha.a.pka&&1!==V.AFrameworkApplication.ta.Qa.Cj&&ic.fb.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(function(Jc){Jc.isFeatureEnabled("MsoPremiumBadge",!0).then(function(zd){!zd&&Jc.isFreemiumUpsellEnabled()&&ic.fb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").Ojf();return null})})})};ba.prototype.dispose=function(){};ba.main=function(){ma.a.instance.Qi(new ba)};Mf.Object.defineProperties(ba.prototype,
{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.InProductMessaging"}}});Object(za.a)(ba,"InProductMessagingPackage",null,[10,11]);var Z=b(202),Na=b(41);aa.prototype.G8b=function(ic){var Jc=new Sys.StringBuilder(this.Bv.XIb);Jc.append("RoamingServiceHandler.ashx?action=");Jc.append("getFirstRunExperienceSettings");Jc.append("&");Jc.append(this.Yed(ic));Jc.append("&");Jc.append(V.AFrameworkApplication.Yi);V.AFrameworkApplication.qd.Yl(Jc.toString(),1,null,null,!0,2,Object(Yb.a)(this,
this.sja,"getRequestSuccessCallback"),Object(Yb.a)(this,this.d4,"getRequestFailureCallback"),null)};aa.prototype.d2a=function(ic){var Jc=new Sys.StringBuilder(this.Bv.XIb);Jc.append("RoamingServiceHandler.ashx?action=");Jc.append("saveFirstRunExperienceSettings");Jc.append("&");Jc.append(V.AFrameworkApplication.Yi);Jc=Jc.toString();ic=Na.c(ic);V.AFrameworkApplication.qd.Yl(Jc,2,ic,null,!0,4,Object(Yb.a)(this,this.vZi,"postRequestSuccessCallback"),Object(Yb.a)(this,this.cW,"postRequestFailureCallback"),
null)};aa.prototype.sja=function(ic){var Jc=!1,zd=null;try{if(0<ic.data.Td.length){var sd=Object(qb.a)(Object,Na.a(ic.data.Td)),Pd=sd?sd[this.Bv.GVc]:null;Pd&&(zd=Object(qb.a)(Object,Na.a(Pd.toString())))}Jc=!0}catch(De){this.d4(null)}Jc&&this.sib&&this.sib(ic.data,zd)};aa.prototype.d4=function(ic){this.oib&&this.oib(ic?ic.data:null)};aa.prototype.vZi=function(ic){this.Jce&&this.Jce(ic?ic.data:null)};aa.prototype.cW=function(ic){this.wkb&&this.wkb(ic?ic.data:null)};aa.prototype.Yed=function(ic){for(var Jc=
new Sys.StringBuilder("requestedsettings="),zd=0;zd<ic.count;zd++)Jc.append(ic.na(zd)),zd<ic.count-1&&Jc.append(";");return Jc.toString()};Object(za.a)(aa,"FirstRunExperienceRequestHandler",null,[]);var eb=b(238),cb=b(83);Xa.prototype.YQd=function(ic){ic?(this.Bv=ic,this.$ii()&&(sa.ULS.sendTraceTag(51675532,306,50,"Initiating call to get FRE data for current user from Roaming Settings Service"),ic=new Z.a,ic.add(this.Bv.GVc),this.ySb=new aa(this.Bv,Object(Yb.a)(this,this.sja,"getRequestSuccessCallback"),
Object(Yb.a)(this,this.d4,"getRequestFailureCallback"),null,Object(Yb.a)(this,this.cW,"postRequestFailureCallback")),this.ySb.G8b(ic)),(this.Bv.T6a||V.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUITest",!1))&&this.ZQd()):sa.ULS.sendTraceTag(51675531,306,10,"Invalid launcherSettings")};Xa.prototype.$ii=function(){try{if(this.Bv.T6a)return!0;if(!V.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceEnabled",
!0)||V.AFrameworkApplication.fa.qa("IsAnonymousUser"))return!1;if(this.Bv.Tfi||this.Bv.V6a||V.AFrameworkApplication.fa.qa("IsO365ConsumerHost"))return!0;var ic=V.AFrameworkApplication.fa.Wa("FlightId");return-1!==(ic?ic.toString().toLowerCase():"").indexOf("firstrunexperienceui")}catch(Jc){sa.ULS.sendTraceTag(576582624,306,10,"Error checking setting {0}",Jc?Jc.toString():null)}return!1};Xa.prototype.uUf=function(ic){var Jc={},zd={};zd.FREDisplayedDate=(new Date).toUTCString();zd.VersionDisplayed=
ic;zd.RemindMeLater=!1;Jc[this.Bv.GVc]=Na.c(zd);sa.ULS.sendTraceTag(51675533,306,50,"Initiating call to save FRE data for current user from Roaming Settings Service");this.ySb&&this.ySb.d2a(Jc)};Xa.prototype.sja=function(ic,Jc){ic=ic?+ic.Z2-+ic.XE:-1;ic>this.Bv.lTf?sa.ULS.sendTraceTag(51675534,306,50,"Call to Roaming Settings Service took {0}ms. This is more than the {1}ms threshold. A new attempt will be made next time the user starts a new session.",ic,this.Bv.lTf):Jc?this.Yxj(Jc)?(sa.ULS.sendTraceTag(51675536,
306,50,"FRE data already exists for current user. FRE UI should be displayed again. User selected 'Remind me later' option more than {0} hours ago.",this.Bv.gpf),this.ZQd()):(this.K5c(!1),sa.ULS.sendTraceTag(51675537,306,100,"Current user has already seen this version of the FRE. No further action required.")):(sa.ULS.sendTraceTag(51675535,306,50,"No FRE data found for current user. FRE UI should be displayed."),this.ZQd())};Xa.prototype.d4=function(ic){this.K5c(!1);sa.ULS.sendTraceTag(51675541,306,
10,"First Run Experience failed to GET data from Roaming Settings Service with status: {0}",ic?ic.httpStatus:-1)};Xa.prototype.cW=function(ic){sa.ULS.sendTraceTag(51675542,306,10,"First Run Experience failed to POST data to Roaming Settings Service with status: {0}",ic?ic.httpStatus:-1)};Xa.prototype.ZQd=function(){var ic=this;this.K5c(!0);var Jc=cb.a.instance.mh("Common.ISystemInitiatedFeedback");Jc?this.p2f(Jc):(sa.ULS.sendTraceTag(51675543,306,50,"Error resolving ISystemInitiatedFeedback"),V.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUIResolveFuture",
!0)&&((Jc=cb.a.instance.Tb("Common.ISystemInitiatedFeedback"))?Jc.execute(function(zd){ic.p2f(zd)}):sa.ULS.sendTraceTag(539494111,306,50,"Error resolving ISystemInitiatedFeedback Future")))};Xa.prototype.p2f=function(ic){if(ic){var Jc=this.Bv.gBh;Jc&&(V.AFrameworkApplication.txa(Jc),V.AFrameworkApplication.l_(Jc));sa.ULS.sendTraceTag(51675544,306,50,"Attempting to display First Run Experience UI using floodgate.",Jc);ic.logActivity("ShowFirstRunExperienceUIV2",null);window.addEventListener?(this.fib=
Object(Yb.a)(this,this.BJi,"onFirstRunExperienceCampaignEvent"),window.addEventListener("FGWebSurfaceEvent",this.fib,!0),window.addEventListener("FRELaunchedEvent",this.fib,!0)):(sa.ULS.sendTraceTag(51675545,306,50,"FRE V2 UI triggered. Attempting to save FRE data."),this.uUf(this.Bv.currentVersion))}else sa.ULS.sendTraceTag(539494112,306,50,"Invalid ISystemInitiatedFeedback")};Xa.prototype.BJi=function(ic){if(ic){var Jc=ic.detail;ic=ic.type;var zd=this.Bv&&this.Bv.campaignId?this.Bv.campaignId.split("-")[0]:
null;if("FRELaunchedEvent"===ic||zd&&Jc&&Jc.id&&-1!==Jc.id.indexOf(zd))Jc.success&&(sa.ULS.sendTraceTag(51675546,306,50,"FRE V2 UI has been launched. Attempting to save FRE data."),this.uUf(this.Bv.currentVersion)),window.removeEventListener&&(window.removeEventListener("FGWebSurfaceEvent",this.fib,!0),window.removeEventListener("FRELaunchedEvent",this.fib,!0))}};Xa.prototype.Yxj=function(ic){if("RemindMeLater"in ic&&"FREDisplayedDate"in ic){if("true"===ic.RemindMeLater.toString()&&(+new Date-+new Date(ic.FREDisplayedDate.toString()))/
36E5>this.Bv.gpf)return!0}else if(V.AFrameworkApplication.fa.qa("WacShowVersionBasedFREToAllUsers")&&"VersionDisplayed"in ic&&ic.VersionDisplayed<this.Bv.currentVersion)return sa.ULS.sendTraceTag(528262853,306,50,"Current version is higher so FRE V2 UI should be displayed again."),!0;return!1};Xa.prototype.K5c=function(ic){if(V.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DispatchFREDecisionEvent")){var Jc={};ic=(Jc.show=ic,Jc);eb.a.dispatch("FREDecisionEvent",
ic)}};Object(za.a)(Xa,"FirstRunExperienceLauncher",null,[950]);ua.prototype.Ph=function(ic){this.fb=ic;this.fb.register(950,"Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher").tc().Cc(function(){return new Xa})};ua.prototype.init=function(){};ua.prototype.dispose=function(){};ua.main=function(){ma.a.instance.Qi(new ua)};Mf.Object.defineProperties(ua.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.FirstRunExperienceLauncher"}}});Object(za.a)(ua,"FirstRunExperienceLauncherPackage",
null,[10,11]);var Ua=b(1480),pa=b(1481),Qa=b(1338),Db=b(1453),Kb=b(10),Ab=b(232);va.prototype.isEnabled=function(){if(V.AFrameworkApplication.fa?V.AFrameworkApplication.fa.qa("IsAnonymousUser"):1)return!1;var ic=V.AFrameworkApplication.Ob?Object(qb.a)(String,V.AFrameworkApplication.Ob.AudienceGroup):"";return"Unknown"!==ic&&"Automation"!==ic};Mf.Object.defineProperties(va.prototype,{GVc:{configurable:!0,enumerable:!0,get:function(){return"Excel"}},campaignId:{configurable:!0,enumerable:!0,get:function(){return"aed9de6b-d4e7-4878-988a-9dfec66fed9e"}},
version:{configurable:!0,enumerable:!0,get:function(){return 1}},currentVersion:{configurable:!0,enumerable:!0,get:function(){return 0}},Tfi:{configurable:!0,enumerable:!0,get:function(){return this.isEnabled()&&this.$.ma(337)}},V6a:{configurable:!0,enumerable:!0,get:function(){return this.isEnabled()&&this.$.ma(339)}},T6a:{configurable:!0,enumerable:!0,get:function(){return this.$.ma(338)}},gBh:{configurable:!0,enumerable:!0,get:function(){return null}},gpf:{configurable:!0,enumerable:!0,get:function(){return 24}},
lTf:{configurable:!0,enumerable:!0,get:function(){return 4E3}},XIb:{configurable:!0,enumerable:!0,get:function(){return this.$.ya.WebServiceBase||""}}});Object(za.a)(va,"FirstRunExperienceLauncherSettings",null,[945]);ja.prototype.YQd=function(){this.NSe&&this.NSe.YQd(this.VAh)};Object(za.a)(ja,"FirstRunExperienceManager",null,[946]);var ub=b(911),Mb=Ab.a;Rk(X,Mb);X.prototype.create=function(){var ic=this,Jc=Object(ub.a)(this.$.da,311,function(){return ic.V5g()});this.pb(Jc)};X.prototype.V5g=function(){var ic=
new va(this.$);ic=new ja(cb.a.instance.resolve("Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher"),ic);ic.YQd();return ic};X.ka=function(ic){ic.da.Ga(312,new X(ic))};Object(za.a)(X,"FirstRunExperienceManagerFactory",Ab.a,[]);var Aa=b(59),Za=Ab.a;Rk(wa,Za);wa.prototype.create=function(){var ic=this,Jc=Object(ub.a)(this.$.da,361,function(){return ic.G6g()});this.pb(Jc)};wa.prototype.G6g=function(){var ic=this;this.Yjd=cb.a.instance.mh("Common.IInProductMessagingUIManager");Aa.a.qg.isReactSharedHeaderUxEnabled?
ya.a.get_instance().ak(16,function(){ic.M9e()}):this.M9e();return this.Yjd};wa.prototype.M9e=function(){var ic=this;cb.a.instance.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(function(Jc){Jc.isFeatureEnabled("MsoPremiumBadge",!0).then(function(zd){!zd&&Jc.isFreemiumUpsellEnabled()&&ic.Yjd.Ojf();return null})})};wa.ka=function(ic){ic.da.Ga(362,new wa(ic))};Object(za.a)(wa,"InProductMessagingManagerFactory",Ab.a,[]);var Zb=b(1391),jb=b(1314),Vb=b(47),Ic=b(440),Rb=b(79),
kc=b(1),xb=b(593),Va=b(21),tb=b(639),fb=xb.a;Rk(ea,fb);ea.prototype.KOd=function(ic){this.sfa!==ic&&(this.sfa=ic,this.MGb())};ea.prototype.dispose=function(){this.gridView.Wb.vk(this.Htf);this.gridView.Wb.Nl(this.Gtf);this.gridView=null;fb.prototype.dispose.call(this)};ea.prototype.MGb=function(){this.pFd(this.sfa)};ea.prototype.refresh=function(){this.KOd(!this.gridView.isEditing)};Mf.Object.defineProperties(ea.prototype,{MH:{configurable:!0,enumerable:!0,get:function(){return this.Kkc(this.sfa)}},
name:{configurable:!0,enumerable:!0,get:function(){return tb.a.cellEdit}}});Object(za.a)(ea,"CellEditSafeStatePublisher",xb.a,[]);var ac=b(38),Ac=b(110);Object(za.a)(ca,"SafeStatePublisherState",null,[]);var Rc=b(707),Fc=ac.a;Rk(P,Fc);P.prototype.yZb=function(ic){this.addHandler(P.xQa,ic)};P.prototype.tsc=function(ic){this.removeHandler(P.xQa,ic)};P.prototype.vza=function(ic,Jc){function zd(De,lc){Pd.MH=lc.MH;sd.OGb()}var sd=this,Pd=new ca(ic,Jc);this.yQa.add(Pd);ic.yZb(zd);Pd.handler=zd;this.OGb()};
P.prototype.YWd=function(ic){for(var Jc=null,zd=bk(this.yQa),sd=zd.next();!sd.done;sd=zd.next())if(sd=sd.value,sd.publisher===ic){this.$ag(sd);Jc=sd;break}Jc&&(this.yQa.remove(Jc),this.OGb())};P.prototype.dispose=function(){for(var ic=bk(this.yQa),Jc=ic.next();!Jc.done;Jc=ic.next())this.$ag(Jc.value);this.yQa.clear();this.Eyb&&(this.Hie.gbj(this.uyf.bind(this)),this.gma.Wab(this.nya.bind(this)));Fc.prototype.dispose.call(this)};P.prototype.K$b=function(){var ic=A.K$b(this.yQa.toArray().map(function(Jc){return Jc.MH}));
return this.Lic&&1===ic?2:ic};P.prototype.$ag=function(ic){ic.publisher.tsc(ic.handler)};P.prototype.OGb=function(){var ic=this.K$b();ic!==this.Eif&&(this.raiseEvent(P.xQa,new Rc.a(ic)),this.Eif=ic)};P.prototype.uyf=function(){this.Lic&&sa.ULS.sendTraceTag(523317957,0,15,"ClientStateMonitor.onMergeWasAborted: Aborted merge occurred after another aborted merge.");this.Lic=!0;this.OGb()};P.prototype.nya=function(ic,Jc){ic=Jc.eca;(Jc=!ka(ic))||(Jc=this.Wpi,Jc=(null===ic||void 0===ic?void 0:ic.SuspensionStartTimestamp)!==
(null===Jc||void 0===Jc?void 0:Jc.SuspensionStartTimestamp));Jc&&(this.Lic=!1);this.Wpi=ic;this.OGb()};Mf.Object.defineProperties(P.prototype,{VOj:{configurable:!0,enumerable:!0,get:function(){return Ac.f(Ac.c(this.yQa.toArray(),function(ic){return 0!=ic.MH}),function(ic){return ic.publisher.name})}}});P.xQa="SSC";Object(za.a)(P,"ClientStateMonitor",ac.a,[]);var wb=b(6),uc=b(67),Pb=xb.a;Rk(Q,Pb);Q.prototype.KOd=function(ic){ic!==this.sfa&&(this.sfa=ic,this.MGb())};Q.prototype.dispose=function(){uc.a(this.$).Zrc(this.Kuf);
this.Y4a.Eq(this.nN);this.S6d=null;Pb.prototype.dispose.call(this)};Q.prototype.MGb=function(){this.pFd(this.sfa)};Q.prototype.refresh=function(){this.KOd(1===this.Y4a.Pt||uc.a(this.$).ii===this.Y4a)};Mf.Object.defineProperties(Q.prototype,{MH:{configurable:!0,enumerable:!0,get:function(){return this.Kkc(this.sfa)}},name:{configurable:!0,enumerable:!0,get:function(){return tb.a.Y4a}},Y4a:{configurable:!0,enumerable:!0,get:function(){return this.S6d}}});Object(za.a)(Q,"IdleActivitySafeStatePublisher",
xb.a,[]);var sc=b(328),nb=b(3),pc=b(22),Dc=Rb.a;Rk(C,Dc);C.prototype.Lc=function(){return!1};C.prototype.executeCommand=function(){return Fb.Task.Ua(!0)};C.prototype.zc=function(ic,Jc){return 1905775613===Jc.command};C.prototype.Qc=function(){return!1};Object(za.a)(C,"ToggleMergeSuspensionSafeState",Rb.a,[429]);var oc=ac.a;Rk(M,oc);M.prototype.gq=function(ic){this.addHandler(M.yvd,ic)};M.prototype.Eq=function(ic){this.removeHandler(M.yvd,ic)};M.prototype.qz=function(){this.raiseEvent(M.yvd)};M.prototype.an=
function(ic){return ic===M.Q1i&&!!this.mergeSuspensionManager};M.prototype.Ir=function(ic,Jc){if(!this.an(ic))return!1;this.mergeSuspensionManager&&(Jc.LabelText=this.slc,Jc.On=this.Swd);return!0};M.prototype.dispose=function(){this.iNb&&(this.Ka.Jab(this.iNb),this.iNb.dispose(),this.iNb=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.gma.Wab(this.nya),this.mergeSuspensionManager.zha.tsc(this.tOa),this.mergeSuspensionManager=null);this.statusBarManager&&(this.statusBarManager.wF(this),
this.statusBarManager=null);this.slc=null;oc.prototype.dispose.call(this)};M.yvd="MSMSC";M.Q1i="QueryMergeSuspensionStatus";Object(za.a)(M,"MergeSuspensionIndicatorManager",ac.a,[472,303,3]);var Gc=b(7),ld=b(1086),gd=Sys.EventArgs;Rk(N,gd);Object(za.a)(N,"TogglePendingMergeBlockedByClientEventArgs",Sys.EventArgs,[]);Object(za.a)(K,"SuspensionState",null,[]);Rk(H,K);Object(za.a)(H,"ReadyForPendingMergeState",K,[]);var Cc=new K,kd=new K,Fd=new H(!1),rb=new H(!0),Kd=b(1087),Qd=Kd.a;Rk(J,Qd);Object(za.a)(J,
"ReadyForPendingMergesUpdatedEventArgs",Kd.a,[]);var ve=ac.a;Rk(U,ve);U.prototype.O8h=function(){return Object(Ic.a)(P,this.zha)?Object(qb.a)(P,this.zha).K$b():1};U.prototype.DZb=function(ic){this.addHandler(U.dVd,ic)};U.prototype.wsc=function(ic){this.removeHandler(U.dVd,ic)};U.prototype.$Fg=function(ic){this.addHandler(U.ZFd,ic)};U.prototype.Lbj=function(ic){this.removeHandler(U.ZFd,ic)};U.prototype.iFg=function(ic){this.addHandler(U.tvd,ic)};U.prototype.fbj=function(ic){this.removeHandler(U.tvd,
ic)};U.prototype.B3i=function(){this.nFd(this.getState()===kd)};U.prototype.dispose=function(){this.zha.tsc(this.tOa);this.zha=null;this.gma.Wab(this.nya);this.gma=null;ve.prototype.dispose.call(this)};U.prototype.led=function(){return Object(Gc.a)(new ld.a,{Current:this.ila.Current,Pending:this.ila.Pending,SuspensionStartTimestamp:this.ila.SuspensionStartTimestamp})};U.prototype.getState=function(){return ka(this.ila)?0==this.MH?rb:this.Eyb&&1==this.MH?Fd:kd:Cc};U.prototype.ySe=function(ic,Jc){ic!==
Jc&&(Jc===kd?this.nFd(!0):ic===kd&&this.nFd(!1));Jc instanceof H&&this.raiseEvent(U.ZFd,new J(this.ila,Jc.uoe||!this.Eyb))};U.prototype.Yui=function(ic,Jc,zd){ic===Cc&&Jc!==Cc?(ic=Jc===kd,Jc=Jc===Fd,sa.ULS.sendTraceTag(252760283,0,50,"MergeSuspensionStateHandler.LogPendingMergesStatusChanged: Pending changes exist. IsBlocking: {0} publisher: {1} counter: {2} isBlockingAllMerges: {3}",Jc,Jc||ic?this.zha.VOj.join(","):"",fa(this.ila),ic)):ic!==Cc&&Jc===Cc&&sa.ULS.sendTraceTag(252760284,0,50,"MergeSuspensionStateHandler.LogPendingMergesStatusChanged: No pending changes. counter: {0}",
fa(zd))};U.prototype.nFd=function(ic){this.raiseEvent(U.dVd,new N(ic))};U.dVd="TPMBBC";U.ZFd="RFPMU";U.tvd="MCC";Object(za.a)(U,"MergeSuspensionStateHandler",ac.a,[]);var Be=ac.a;Rk(O,Be);O.prototype.sYa=function(ic){this.addHandler("MCU",ic)};O.prototype.Wab=function(ic){this.removeHandler("MCU",ic)};O.prototype.mya=function(ic,Jc){Jc=void 0===Jc?"":Jc;var zd=this.C1.Current<ic.Current||this.C1.Pending<ic.Pending;if(ic.SuspensionStartTimestamp&&this.Kic!==ic.SuspensionStartTimestamp){if(this.Kic>
ic.SuspensionStartTimestamp){zd&&sa.ULS.sendTraceTag(553736149,0,50,"PendingMergeMonitor.OnMergeCounterReceivedFromServer: skipping a higher stale counter received via {0}. S: {1}, C: {2}",Jc,O.xCb(ic),O.xCb(this.C1));return}zd||sa.ULS.sendTraceTag(553736148,0,50,"PendingMergeMonitor.OnMergeCounterReceivedFromServer: recovering from a potentially stale counter. S: {0}, C: {1}",O.xCb(ic),O.xCb(this.C1))}else if(!zd)return;this.C1=ic;this.SJf(ic,Jc)};O.prototype.dispose=function(){this.$.ea.wk(this.avc);
this.$.ea.yR(this.avc);Va.g(this.$).Wb.Nl(this.i9a);kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6329027_UpdateMergeCountWhenWebMethodReturnsWithErrors")||this.$.oa.Zr(this.b8);var ic=this.$.da.za(292);ic&&ic.Wab(this.yCb);Be.prototype.dispose.call(this)};O.prototype.SJf=function(ic,Jc){Jc=void 0===Jc?"":Jc;ka(ic)&&ic.SuspensionStartTimestamp>this.Kic&&(sa.ULS.sendTraceTag(537155416,0,50,"PendingMergeMonitor.RaiseMergeCounterUpdated: Merge suspension requested. MergeCounter: {0}, Origin: {1}",fa(ic),
Jc),this.Kic=ic.SuspensionStartTimestamp);this.raiseEvent("MCU",new Kd.a(ic))};O.prototype.fSf=function(){sa.ULS.sendTraceTag(588276808,0,50,"PendingMergeMonitor.ResetMergeCounter : Last counter was {0}",O.xCb(this.C1));this.C1=Object(Gc.a)(new ld.a,{Pending:0,Current:0,SuspensionStartTimestamp:null})};O.xCb=function(ic){return ic?String.format("({0}/{1} @{2})",ic.Current,ic.Pending,ic.SuspensionStartTimestamp):"null"};Mf.Object.defineProperties(O.prototype,{ila:{configurable:!0,enumerable:!0,get:function(){return this.C1}}});
O.FZd="PMM.RTC";O.xsb="PMM.EwaResult";O.ofj="PMM.resetMergeCounter";Object(za.a)(O,"PendingMergeMonitor",ac.a,[]);Object(za.a)(T,"ClientRevisions",null,[]);var Ie=b(44),se=b(62),Se=ac.a;Rk(F,Se);F.prototype.dispose=function(){this.$.oa.Jma(this.QBa);this.iyc();this.N5.Lbj(this.eAf);this.N5.wsc(this.$Eb);this.N5.fbj(this.tyf);this.N5=null;Se.prototype.dispose.call(this)};F.prototype.ODj=function(){this.iyc();if(this.NGe()){var ic=this.N5.led();sa.ULS.sendTraceTag(537155414,0,50,"RequestController.StartKeepBlockingPendingMergesTimer: Prevented starting StartKeepBlockingPendingMergesTimer because of repeated failure in counter {0} fail count: {1}",
fa(ic),this.AAb)}else this.BAb=this.gZa.create(this.wWf,this.ctc,Ie.a.BAb),this.j7a=this.gZa.nE(this.wWf,this.qpi,Ie.a.j7a)};F.prototype.iyc=function(){this.j7a&&(this.BAb.cancel(),this.j7a.cancel(),this.j7a=this.BAb=null)};F.prototype.eNi=function(ic){var Jc=" fail count: "+this.AAb;this.AAb++;this.NGe()&&this.iyc();sa.ULS.sendTraceTag(542229773,0,10,"RequestController.OnKeepBlockingPendingMergesRequestFailed: request failed {0}{1}",fa(ic),Jc)};F.prototype.NGe=function(){return this.AAb>F.Fyi};F.Fyi=
5;Object(za.a)(F,"RequestController",ac.a,[]);var Le=b(162),rf=b(214),af=b(28),xe=b(294),Td=ac.a;Rk(I,Td);I.prototype.jFg=function(ic){this.addHandler(I.zvd,ic)};I.prototype.gbj=function(ic){this.removeHandler(I.zvd,ic)};I.prototype.cMg=function(ic,Jc){var zd=this;this.uLb(ic,Jc)?(new Le.a).setResult(!0):(Jc=this.dXi(ic,Jc),this.$Ab=ic,this.dBd++,Jc.continueWith(function(){zd.HIi()},0,rf.a.none,this.pO))};I.prototype.dXi=function(ic,Jc){this.CYd=this.ah.Y7;this.Xhf=Jc;sa.ULS.sendTraceTag(554767493,
0,50,"DoPendingMergeSender.performDoPendingMergeInternal: Sending DoPendingMerge {0} / {1} @{2}. allowSelectionAdjustment: {3}",ic.Current,ic.Pending,ic.SuspensionStartTimestamp,Jc);this.isDocumentHidden||this.ly();return this.Tlj(Jc,ic)};I.prototype.uLb=function(ic,Jc){if(this.Zza&&!Jc&&!this.Zza.vmi())return sa.ULS.sendTraceTag(523317956,0,50,"DoPendingMergeSender.shouldThrottle: We can't retrieve selection and selection adjustments are disallowed."),!0;if(!this.$Ab||ic.SuspensionStartTimestamp>
this.$Ab.SuspensionStartTimestamp)return this.rLa&&sa.ULS.sendTraceTag(523551556,0,50,"DoPendingMergeSender.shouldThrottle: Allowing request for new suspension while previous is ongoing, new counter: {0} / {1} @{2}",ic.Current,ic.Pending,ic.SuspensionStartTimestamp),!1;if(this.rLa)return!0;if(this.ydg){ic=R(ic,this.$Ab);var zd=this.ah.Y7-this.CYd<this.ctc;Jc=this.Xhf===Jc;return ic&&zd&&Jc}return R(ic,this.$Ab)&&this.ah.Y7-this.CYd<this.ctc};I.prototype.Tlj=function(ic,Jc){function zd(){sa.ULS.sendTraceTag(588276806,
0,10,"DoPendingMergeSender.sendDoPendingMergeRequest: request failed {0} / {1} @{2}",Jc.Current,Jc.Pending,Jc.SuspensionStartTimestamp)}var sd=this.xa.Pb();return this.Zza?this.Zza.uij(this.uMh(ic,zd,sd)):this.Tue(null,!0,void 0,zd,sd)};I.prototype.uMh=function(ic,Jc,zd){var sd=this;return function(Pd,De,lc){var Pc=void 0;sd.ydg&&(sa.ULS.shipAssertTag(523317955,0,null!=Pd||ic,"!allowSelectionAdjustment requires a non-null initialViewportState."),Pc=sd.IIi.bind(sd));De&&(Pc=xe.b.call(null,function(md){var bd=
md.Result,Od=null===bd||void 0===bd?void 0:bd.AdjustedViewportState;3===(null===bd||void 0===bd?void 0:bd.MergeResultState)&&(Od=void 0);De(Od,md.StateId)},Pc));lc&&(Jc=xe.a.call(null,lc,Jc));return sd.Tue(Pd,ic,Pc,Jc,zd)}};I.prototype.Tue=function(ic,Jc,zd,sd,Pd){if(this.sTg){var De=this.xa;Pd=De.Na(1,void 0===Pd?null:Pd);Pd.viewportState=ic;Pd.allowViewAdjustment=Jc;ic=se.g(De,"DoPendingMerge",Pd,zd,sd,null,null,0)}else De=this.xa,Pd=De.Na(1,void 0===Pd?null:Pd),Pd.viewportState=ic,Pd.allowViewAdjustment=
Jc,ic=se.g(De,"DoPendingMergeNew",Pd,zd,sd,null,null,0);return ic};I.prototype.IIi=function(ic){ic=ic.Result;void 0!=ic&&3===ic.MergeResultState&&(sa.ULS.sendTraceTag(523317954,0,50,"DoPendingMergeSender.onDoPendingMergeSucceeded: Aborted merge."),this.e3i())};I.prototype.e3i=function(){this.raiseEvent(I.zvd,new Sys.EventArgs)};I.prototype.HIi=function(){this.dBd--};Mf.Object.defineProperties(I.prototype,{rLa:{configurable:!0,enumerable:!0,get:function(){return 0<this.dBd}},isDocumentHidden:{configurable:!0,
enumerable:!0,get:function(){return!!this.documentVisibilityObserver&&this.documentVisibilityObserver.Ni}}});I.zvd="MWA";Object(za.a)(I,"DoPendingMergeSender",ac.a,[975,976]);Mf.Object.defineProperties(D.prototype,{reportName:{configurable:!0,enumerable:!0,get:function(){return this.K7h?"SelectionAdjustInHiddenDocument":"SelectionAdjust"}}});Object(za.a)(D,"SelectionAdjustSessionEndsReport",null,[463]);var Bc=b(45),qd=b(95);x.prototype.Yeg=function(ic){var Jc=this;this.X5d&&(this.oUb?this.BQb=this.selectedRanges.map(function(De){return Jc.dAc(De,
Jc.JDc)}):this.dCa&&(this.BQb=[this.dAc(this.selectedRanges[0],this.JDc)]));for(var zd=bk(this.BQb),sd=zd.next();!sd.done;sd=zd.next()){sd=sd.value;if(!this.Ljg&&!sd)return!1;if(sd){sd=bk(sd);for(var Pd=sd.next();!Pd.done;Pd=sd.next())if(Pd=Pd.value,Pd.sk&&Pd.ie.Revision<ic)return!1}}return!0};x.prototype.vJj=function(){var ic;if(this.dCa||this.oUb){var Jc={SheetName:this.sheetName,ActiveCell:null===(ic=this.activeCell)||void 0===ic?void 0:ic.toString(),SelectedRange:this.selectedRanges[0].toString(),
TopLeft:void 0,SelectedRanges:void 0};this.oUb&&(Jc.SelectedRange=void 0,Jc.SelectedRanges=Bc.r(this.selectedRanges,this.jb));return Jc}};x.prototype.toString=function(){var ic,Jc;return String.format("active cell: {0} selection: {1}",null!==(Jc=null===(ic=this.activeCell)||void 0===ic?void 0:ic.toString())&&void 0!==Jc?Jc:"null",Ac.f(this.selectedRanges,function(zd){var sd;return null!==(sd=null===zd||void 0===zd?void 0:zd.toString())&&void 0!==sd?sd:"null"}).join(","))};x.prototype.equals=function(ic){return ic?
this.activeCell.equals(ic.activeCell)&&Bc.Q(this.selectedRanges,ic.selectedRanges)&&this.sheetName===ic.sheetName:!1};x.prototype.aTg=function(){for(var ic=bk(this.selectedRanges.entries()),Jc=ic.next();!Jc.done;Jc=ic.next()){var zd=bk(Jc.value);Jc=zd.next().value;zd=zd.next().value;if(null===zd||void 0===zd?0:zd.contains(this.activeCell))return Jc}return-1};x.prototype.dAc=function(ic,Jc){var zd,sd=Va.g(this.jb).Ea.d3a(ic,Jc);sd||sa.ULS.sendTraceTag(522803340,0,50,"SelectionState.tryGetBlockCacheItemsFromRange: no items found. range: {0} ; activeItemNameIsDefined: {1}",
null!==(zd=null===ic||void 0===ic?void 0:ic.toString())&&void 0!==zd?zd:"null",!!Jc);return sd};Mf.Object.defineProperties(x.prototype,{activeCell:{configurable:!0,enumerable:!0,get:function(){return this.eG}},selectedRanges:{configurable:!0,enumerable:!0,get:function(){return this.n9}},Vs:{configurable:!0,enumerable:!0,get:function(){var ic=!1;if(null===this.NI||void 0===this.NI)ic=!0;else if(this.NI>=this.selectedRanges.length||!this.selectedRanges[this.NI].contains(this.activeCell))sa.ULS.sendTraceTag(521200010,
0,50,"SelectionState.indexOfActiveRange: the index of the adjusted active range has changed. indexOfActiveRange: {0}, selectedRangesLength: {1}",this.NI,this.selectedRanges.length),ic=!0;ic&&(this.NI=this.aTg());return this.NI}},activeRange:{configurable:!0,enumerable:!0,get:function(){return 0>this.Vs?this.activeCell:this.selectedRanges[this.Vs]}},sheetName:{configurable:!0,enumerable:!0,get:function(){return this.pWb}},activeItemName:{configurable:!0,enumerable:!0,get:function(){return this.JDc}},
dCa:{configurable:!0,enumerable:!0,get:function(){return 1===this.selectedRanges.length}}});Object(za.a)(x,"SelectionState",null,[]);var Jd=b(208),ad;(function(ic){ic[ic.none=0]="none";ic[ic.waitingForAdjusted=1]="waitingForAdjusted";ic[ic.invalid=2]="invalid";ic[ic.nonContinuous=3]="nonContinuous";ic[ic.noAdjustRequired=4]="noAdjustRequired";ic[ic.noAdjustRequiredWithDivergence=5]="noAdjustRequiredWithDivergence";ic[ic.divergenceOnResponse=6]="divergenceOnResponse";ic[ic.waitingForViewport=7]="waitingForViewport";
ic[ic.adjusted=8]="adjusted";ic[ic.divergenceOnViewportReady=9]="divergenceOnViewportReady";ic[ic.differentSheetAdjust=10]="differentSheetAdjust";ic[ic.editBoxDivergence=11]="editBoxDivergence";ic[ic.exception=12]="exception"})(ad||(ad={}));Object(za.b)("SelectionAdjustState",ad);var Yd=b(949);z.prototype.uij=function(ic){function Jc(){zd.qFi()}var zd=this,sd=null,Pd=null;this.eaf()?(this.UL.parallel++,sa.ULS.sendTraceTag(526390086,0,15,"SelectionAdjustManager.runRequestWithSelectionAdjust: Skipping parallel request. Current adjustedSelection is defined : {0}",
!!this.Fy)):(sd=function(De,lc){zd.rFi(De,lc)},Pd=this.prj());return null===ic||void 0===ic?void 0:ic(Pd,sd,Jc)};z.prototype.vmi=function(){return!this.eaf()&&this.Gaa().dCa};z.prototype.prj=function(){var ic;sa.ULS.shipAssertTag(525135961,0,0===this.KC,"SelectionAdjustManager.setPreRequestState: unexpected state");this.Fy&&(this.UL.errors++,sa.ULS.sendTraceTag(526960090,0,10,"SelectionAdjustManager.setPreRequestState: About to ignore a defined Adjusted selection: {0}",this.Fy.toString()));this.Fy=
null;this.Lx=this.Gaa();var Jc=null,zd=null===(ic=this.Lx)||void 0===ic?void 0:ic.vJj();zd&&(Jc={ActiveSheetName:this.Lx.sheetName,SheetViewportStateChanges:[zd]});this.KC=1;return Jc};z.prototype.qFi=function(){sa.ULS.shipAssertTag(525135960,0,1===this.KC,"SelectionAdjustManager.onAdjustedRequestFailed: unexpected state");this.UL.errors++;this.KC=2;this.Yq()};z.prototype.rFi=function(ic,Jc){try{sa.ULS.shipAssertTag(525135959,0,1===this.KC,"SelectionAdjustManager.onAdjustedSelectionReady: unexpected state"),
this.mMb=Jc,Jc=2,this.Lx?ic?(this.Fy=this.Ruj(ic))?(Jc=7,this.OCb||this.Lx.dCa)?this.Lx.equals(this.Fy)?this.OQf&&!this.Lx.equals(this.Gaa())?(this.UL.adjustedDidntChangeWithDivergence++,Jc=5):(this.UL.adjustedDidntChange++,Jc=4):this.Lx.sheetName!=this.Fy.sheetName?(this.UL.differentSheetAdjust++,Jc=10):this.OQf&&!this.Lx.equals(this.Gaa())&&(this.UL.divergenceOnResponse++,Jc=6,this.NQf()):(this.UL.nonContinuous++,Jc=3):this.UL.errors++:(this.UL.errors++,sa.ULS.sendTraceTag(537155412,0,15,"SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted returned null, initialSelection: {0}",
this.Lx.toString())):(this.UL.errors++,sa.ULS.sendTraceTag(537155413,0,10,"SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted selection results returned when not waiting for them, adjusted:  ActiveCell: {0}, SelectedRange: {1}",null===ic||void 0===ic?void 0:ic.ActiveCell,null===ic||void 0===ic?void 0:ic.SelectedRange)),this.KC=Jc}catch(zd){this.KC=12,sa.ULS.sendTraceTag(525135958,0,10,"SelectionAdjustManager.OnAdjustedSelectionReady: caught Exception {0}",zd)}finally{7!=this.KC?this.Yq():this.JWc(!1,
!0)}};z.prototype.dispose=function(){this.gridView.Ea.dv(this.xi);this.gridView.Ea.Dq(this.Z8a);this.gridView.Ea.SOf(this.Z8a);this.gridView.Ea.Nab(this.Z8a);kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6385622_SelectionAdjustImplementsCustomReportManager")&&this.$.rl(this.Yc)};z.prototype.eaf=function(){return 1===this.KC||7===this.KC};z.prototype.Ruj=function(ic){var Jc=this,zd,sd;if(!function(){var Pc=Bc.Z(ic.ActiveCell,Jc.$.va);zd=Pc.range;return Pc}().returnValue)return sa.ULS.sendTraceTag(537155411,
0,10,"SelectionAdjustManager.sheetViewportStateToSelectionState: Unable to extract active cell {0}",ic.ActiveCell),null;var Pd=[];if(this.OCb){var De=this.$.pa,lc=!!De&&2===De.LF;if(ic.SelectedRanges)Pd=Bc.g(ic.SelectedRanges.Ranges);else if(!lc)return sa.ULS.sendTraceTag(522826913,0,10,"SelectionAdjustManager.sheetViewportStateToSelectionState: SelectedRanges is null, active sheet exists: {0}",!!De),null}else{if(!function(){var Pc=Bc.Z(ic.SelectedRange,Jc.$.va);sd=Pc.range;return Pc}().returnValue)return sa.ULS.sendTraceTag(537155410,
0,10,"SelectionAdjustManager.sheetViewportStateToSelectionState: Unable to extract selected range {0}",ic.SelectedRange),null;Pd.push(sd)}return new this.iWf(this.$,zd,Pd,ic.SheetName,this.Lx.activeItemName,this.Lx.Vs)};z.prototype.Gaa=function(){var ic=this.$.pa;if((null===ic||void 0===ic?0:ic.activeCell)&&ic.selectedRanges&&ic.sheetName)return new this.iWf(this.$,ic.activeCell,ic.selectedRanges,ic.sheetName,this.$.activeItemName,ic.Vs);sa.ULS.sendTraceTag(525135957,0,10,"SelectionAdjustManager.getCurrentSelection: invalid activeItem. activeItem null: {0}, activeCell null: {1}, selectedRanges null: {2}, sheetName null: {3}",
!ic,!(null===ic||void 0===ic?0:ic.activeCell),!(null===ic||void 0===ic?0:ic.selectedRanges),!(null===ic||void 0===ic?0:ic.sheetName));return null};z.prototype.KDe=function(){var ic=this;this.$.da.Za(276,function(){var Jc=Jd.a(ic.$);Jc.dY(ic.A0d);Jc.dY(ic.B0d)})};z.prototype.JWc=function(ic,Jc){var zd;if(this.Kki(ic))if(kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6280340_preventRecursionOfAttemptAdjustSelection")&&8===this.KC)sa.ULS.sendTraceTag(523106438,0,15,"SelectionAdjustManager.attemptAdjustSelection: skipping as was already adjusted");
else{Jc&&sa.ULS.sendTraceTag(524039250,0,50,"SelectionAdjustManager.attemptAdjustSelection: viewport ready on response");try{if(sa.ULS.shipAssertTag(525135956,0,7===this.KC,"SelectionAdjustManager.attemptAdjustSelection: unexpected state"),this.Lx.equals(this.Gaa()))if(this.Kdj&&(null===(zd=this.gridView)||void 0===zd?0:zd.isEditing))this.UL.editBoxDivergence++,this.KC=11;else{ic=0;if(this.OCb&&(ic=this.Fy.Vs,-1==ic)){this.UL.errors++;sa.ULS.sendTraceTag(522826912,0,10,"SelectionAdjustManager.attemptAdjustSelection: invalid indexOfActiveRange");
return}this.UL.adjusted++;this.KC=8;kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6413876_AdjustSelectionWithoutCallingGoto")?this.gridView.ha.xB(this.Fy.selectedRanges,ic,this.Fy.activeCell,0,void 0,qd.a.gWf):this.gridView.aV(this.Fy.selectedRanges,ic,this.Fy.sheetName,null,this.Fy.activeCell,null,null,0,qd.a.gWf)}else this.UL.divergenceOnViewportReady++,this.NQf(),this.KC=9}catch(sd){this.KC=12,sa.ULS.sendTraceTag(525135955,0,10,"SelectionAdjustManager.attemptAdjustSelection: caught Exception {0}",
sd)}finally{this.Yq()}}};z.prototype.Kki=function(ic){if(!this.Fy)return!1;if(!this.Lx)return sa.ULS.sendTraceTag(537155409,0,10,"SelectionAdjustManager.attemptAdjustSelection: initialSelection is null while adjustedSelection isn't null, adjustedSelection: {0}",this.Fy.toString()),!1;if(this.Foe&&Va.g(this.$).Ea.bvd<this.mMb)return!1;if(ic||this.EHj){if(!this.Foe&&Va.g(this.$).Ea.bvd<this.mMb)return!1;(this.OCb||this.Lx.dCa)&&sa.ULS.sendTraceTag(528590295,0,15,"SelectionAdjustManager.attemptAdjustSelection: got to blockCacheConsistent while pending for selection adjust")}else if(!this.Lx.dCa&&
!this.OCb||!this.Lx.Yeg(this.mMb)||!this.Fy.Yeg(this.mMb))return!1;return!0};z.prototype.Yq=function(){var ic,Jc,zd,sd;this.oej&&2!=this.KC&&sa.ULS.sendTraceTag(526792898,0,50,"SelectionAdjustManager.clearState: initial: {0}, adjusted: {1}, state: {2}, hidden: {3}",null!==(Jc=null===(ic=this.Lx)||void 0===ic?void 0:ic.toString())&&void 0!==Jc?Jc:"null",null!==(sd=null===(zd=this.Fy)||void 0===zd?void 0:zd.toString())&&void 0!==sd?sd:"null",ad[this.KC],Yd.a.dB(this.ipf));this.Lx=this.Fy=null;this.KC=
0};z.prototype.NQf=function(){var ic=this.Gaa();sa.ULS.sendTraceTag(537155408,0,50,"SelectionAdjustManager.ReportDivergence: initial: {0} current: {1} adjusted: {2} sheetSameBetweenInitialAndAdjusted: {3} sheetSameBetweenInitialAndCurrent: {4}",this.Lx.toString(),ic?ic.toString():"",this.Fy.toString(),this.Lx.sheetName===this.Fy.sheetName,this.Lx.sheetName===(ic?ic.sheetName:null))};Mf.Object.defineProperties(z.prototype,{iWf:{configurable:!0,enumerable:!0,get:function(){return x}},UL:{configurable:!0,
enumerable:!0,get:function(){return Yd.a.dB(this.ipf)?this.B0d:this.A0d}}});Object(za.a)(z,"SelectionAdjustManager",null,[977,3]);var pe=Rb.a;Rk(A,pe);A.prototype.DZb=function(ic){this.zfa.DZb(ic)};A.prototype.wsc=function(ic){this.zfa&&this.zfa.wsc(ic)};A.prototype.vza=function(ic,Jc){this.BCa.vza(ic,Jc)};A.prototype.YWd=function(ic){this.BCa.YWd(ic)};A.prototype.mya=function(ic,Jc){this.BWa.mya(ic,void 0===Jc?"":Jc)};A.prototype.dispose=function(){this.mec&&(this.mec.dispose(),this.mec=null);this.Zza&&
this.Zza.dispose();this.g1a.dispose();this.KJd&&(this.KJd.dispose(),this.KJd=null);this.zfa&&(this.zfa.dispose(),this.zfa=null);this.BWa.dispose();this.BWa=null;this.BCa.dispose();this.BCa=null;this.k_a&&(this.k_a.dispose(),this.k_a=null);this.Z4a&&(this.Z4a.dispose(),this.Z4a=null);this.$=null;pe.prototype.dispose.call(this)};A.prototype.MGb=function(){this.zfa.B3i()};A.K$b=function(ic){var Jc=0;ic=bk(ic);for(var zd=ic.next();!zd.done;zd=ic.next()){zd=zd.value;if(2==zd)return 2;1==zd&&(Jc=1)}return Jc};
A.prototype.i9h=function(ic,Jc){this.BCa=new P(this.g1a,this.BWa);Jc?Object(Ic.a)(Q,Jc)?this.vza(Jc,Object(qb.a)(Q,Jc).MH):Object(Ic.a)(ea,Jc)?this.vza(Jc,Object(qb.a)(ea,Jc).MH):this.vza(Jc,0):(this.k_a=new ea(ic),this.Z4a=new Q(ic),this.vza(this.k_a,this.k_a.MH),this.vza(this.Z4a,this.Z4a.MH))};Mf.Object.defineProperties(A.prototype,{zha:{configurable:!0,enumerable:!0,get:function(){return this.BCa}},gma:{configurable:!0,enumerable:!0,get:function(){return this.BWa}},N5:{configurable:!0,enumerable:!0,
get:function(){return this.zfa}}});Object(za.a)(A,"MergeSuspensionManager",Rb.a,[941,3]);var Wd=Ab.a;Rk(B,Wd);B.prototype.create=function(){sa.ULS.sendTraceTag(537155419,0,50,"MergeSuspensionFactory.Create");this.pb(this.Dc.da.za(343)||this.Dc.da.Ga(343,new A(this.Dc,Vb.a.instance)))};B.ka=function(ic){sa.ULS.sendTraceTag(537155418,0,50,"MergeSuspensionFactory.Attach");ic.da.Ga(344,new B(ic))};Object(za.a)(B,"MergeSuspensionFactory",Ab.a,[]);var bf=b(51),ke=b(37),cf=b(89),Pe=b(99),nc=b(54),Da=b(15);
w.Wri=3;w.connected=0;Object(za.a)(w,"ConnectionStateConstants",null,[]);var Sb=b(111),hb=b(119),Xb=b(42);m.prototype.hYf=function(){this.durationMs=hb.a(af.a.Ta,this.startTime)};m.prototype.jAd=function(ic){var Jc=this,zd;this.hYf();Xb.a(ic).rsc(this.qtf);Xb.a(ic).Rf.ssc(this.vca);ic.da.Za(291,function(sd){sd.Pab(Jc.c6)});if(null===(zd=ic.ea)||void 0===zd?0:zd.df)ic.ea.df.RId(this.ZAd),this.wasUserActiveOnPIEnd=ic.ea.df.Qr};m.prototype.Pi=function(ic){var Jc=this;Xb.a(ic).tZb(this.qtf);this.isToastShown?
this.toastRaiser="Immediate":Xb.a(ic).Rf.EUc(this.vca);ic.da.Za(291,function(zd){Jc.hasTabbedOut=zd.Ni;zd.kYa(Jc.c6)});this.wasUserActiveOnPIStart&&ic.ea.df.wne(this.ZAd)};Object(za.a)(m,"PartialInteractivityData",null,[]);var jc=b(1315);Rk(y,m);y.prototype.EHi=function(ic,Jc){this.swappedByOffline=Jc;this.jAd(ic)};y.prototype.jpj=function(ic){this.errorDataDuringConnectivityIssuesMode=ic};y.prototype.R5i=function(ic){10>this.failedRequests.length&&(ic=ic+"_"+Sb.getElapsedSeconds(this.startTime,af.a.Ta.Jb).toString(),
this.failedRequests.push(ic))};Object(za.a)(y,"ConnectivityIssuesData",m,[]);var Wc=b(165),fd=b(126),Tc=b(112);r.Uhh="DuringWork";r.connectivityIssues="ConnectivityIssues";r.offline="Offline";Object(za.a)(r,"UnavailabilityTypes",null,[]);var td=b(50);v.prototype.dispose=function(){this.$&&(Xb.a(this.$).Rf.aPf(this.Auf),this.$.sf&&this.$.sf.$Of(this.xuf));this.data&&this.$.oa.sf.WPf(this.Jn);this.$=null};v.prototype.OSg=function(ic){var Jc=this.P9c-1;return(this.data.averageDurationBetweenFailedRequestsSec*
(Jc-1)+ic)/Jc};Object(za.a)(v,"ConnectivityIssuesTelemetryManager",null,[3]);var Tb=b(1058),Fa=b(129),Qb=b(998);f.prototype.mQj=function(){this.mU&&this.mU.hYf()};f.prototype.CBg=function(ic){this.allOfflinePartialInteractivitiesDataInSession.push(ic);this._count++};Mf.Object.defineProperties(f.prototype,{count:{configurable:!0,enumerable:!0,get:function(){return this._count}},mU:{configurable:!0,enumerable:!0,get:function(){return this.allOfflinePartialInteractivitiesDataInSession[this.allOfflinePartialInteractivitiesDataInSession.length-
1]}}});Object(za.a)(f,"OfflinePartialInteractivitiesDataForLog",null,[]);Rk(n,m);n.prototype.Msj=function(ic){this.timeFromLastOffline=ic};n.prototype.kpj=function(ic){this._errorDataDuringOfflineMode=ic};Object(za.a)(n,"OfflinePartialInteractivityData",m,[]);l.prototype.dispose=function(){this.$&&Xb.a(this.$)&&Xb.a(this.$).Rf.uId(this.B9a);cf.a.Ia(this.Qtb);this.$=this.Qtb=null};l.prototype.JOi=function(ic){this.mU=new n(af.a.Ta.Jb,this.$,0!==ic);this.mU.Msj(-1!==this.$Dd?window.performance.now()-
this.$Dd:-1);this.WNa.CBg(this.mU);Xb.a(this.$).Rf.EUc(this.vca);this.x2a();this.Qtb=Vb.a.instance.nE(this.x2a,l.EBh,Ie.a.x2a);Wc.a(this.$).lUc(this.tUf)};l.prototype.KOi=function(){this.mU.jAd(this.$);this.x2a();cf.a.Ia(this.Qtb);this.Qtb=null;this.$Dd=window.performance.now();Xb.a(this.$).Rf.ssc(this.vca);Wc.a(this.$).iId(this.tUf);this.Gdj()};l.prototype.ojj=function(ic,Jc){var zd=this;this.$?this.Gif=ke.TaskExtensions.Aa(this.Gif,function(){zd.indexedDB.Mbb(new Qb.a(ic,Jc))},this.$.la):sa.ULS.sendTraceTag(537155205,
0,15,"OfflineModeTelemetryManager.SaveToIndexedDBSequential: EwaControl is null when attempting to write to IDB")};l.prototype.Bdj=function(){var ic=this.$.la;ke.TaskExtensions.Aa(ke.TaskExtensions.Aa(this.indexedDB.C3a(l.bCd),this.eej,ic),this.v9i,ic)};l.prototype.Gdj=function(){if(this.mU){var ic=Sys.Serialization.JavaScriptSerializer.serialize(this.mU);kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_71qb3_Offline")?td.b().YJb(560791645,0,50,r.offline,this.mU.durationMs,
"OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: {0}",ic):sa.ULS.sendTraceTag(560791645,0,50,"OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: {0}",ic)}kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5508233_ReportNetworkDownVeto")&&this.mU&&this.mU.isToastShown&&Pe.Health.instance.recordQosError(fd.a.dUj,[Tc.a.ljc],!0,!1,!1,!1,null)};l.gkd="NetworkAvailability";l.hkd=
"NetworkAvailabilityData";l.bCd="partialInteractivityData";l.EBh=3E3;Object(za.a)(l,"OfflineModeTelemetryManager",null,[3]);k.prototype.dispose=function(){cf.a.Ia(this.lsf);cf.a.Ia(this.nCi);cf.a.Ia(this.pla);cf.a.Ia(this.V0g);this.$=null};Object(za.a)(k,"NetworkConnectionTelemetryManager",null,[3]);Rk(e,m);e.prototype.B9a=function(){this.wasInteruptedByOfflineMode=!0};Object(za.a)(e,"SilentReopenData",m,[]);d.prototype.dispose=function(){this.Rf.APf(this.nyf);this.Rf.lcj(this.aCf);this.x7=this.Rf=
this.$=null};d.prototype.YBf=function(ic,Jc){ic.JL?this.x7=new e(af.a.Ta.Jb,this.$,0!==ic.Wna,Jc):(5===ic.Wna&&(this.x7.wasInteruptedByOfflineMode=!0),3!==ic.Wna&&2!==ic.Wna||sa.ULS.sendTraceTag(537155202,0,10,"SilentReopenPartialInteractivityTelemetryManager.OnSilentReopen: BackToWork/DuringWork partial interactivity has been swapped to DuringWork/BackToWork."),this.x7.jAd(this.$),2===Jc?kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_8dtae_B2W")?td.b().ZJb(571289604,
0,50,r.offline,this.x7.durationMs,this.x7):sa.ULS.sendTraceTag(571289604,0,50,nc.a.xc(this.x7)):kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_6w9lg_DuringWork")?td.b().ZJb(542782150,0,50,r.Uhh,this.x7.durationMs,this.x7):sa.ULS.sendTraceTag(542782150,0,50,nc.a.xc(this.x7)),this.x7=null)};Object(za.a)(d,"SilentReopenPartialInteractivityTelemetryManager",null,[3]);var cc=ac.a;Rk(c,cc);c.prototype.dispose=function(){this.sf&&(this.xwc&&(this.sf.lbj(this.BEb),this.sf.cIb(this.Xyf)),
this.sf.$Of(this.yuf),this.sf.Y$i(this.zuf));this.Kzb&&this.documentVisibilityObserver&&(this.documentVisibilityObserver.WHb(this.f9a),this.Kzb=!1);this.$&&(this.trc&&this.xAc(),this.$.ea&&(this.$.ea.QPf(this.$Bf),this.$.ea.df&&this.$.ea.df.VPa(this.yOa)));kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5533387_ReportLongSilentReopenBackToWorkVeto")&&this.M0&&(this.M0.dispose(),this.M0=null);cf.a.Ia(this.wqf);this.$=null;cc.prototype.dispose.call(this)};c.prototype.fyi=function(){this.ZPd=!0};c.prototype.Xie=
function(){this.Fna||(this.Fna=Xb.a(this.$).Rf.OXa(3,"NetworkConnectionStateManager.ActivateDuringWorkSilentReopenPartialInteractivity"))};c.prototype.hei=function(){if(this.ZPd)return this.ZPd=!1,!0;var ic=this.H7>this.Ylf||this.$jd>this.Ylf&&10>this.H7;sa.ULS.sendTraceTag(537155223,0,50,"NetworkConnectionStateManager.IsBackToWorkSilentReopen: Inactivity duration: Time from last activity:{0}, Time gap between last two activities: {1}. return value:{2}",this.H7,this.$jd,ic);return ic};c.prototype.qej=
function(){kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5533387_ReportLongSilentReopenBackToWorkVeto")&&(this.M0=Vb.a.instance.create(function(){Pe.Health.instance.recordQosError(fd.a.iCj,[Tc.a.ljc],!0,!0,!1,!1,null)},6E3,"ReportLongSilentReopenBackToWorkVeto",void 0,!0))};c.prototype.izg=function(){var ic=this;this.Fna||this.y0?sa.ULS.sendTraceTag(542782155,0,10,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Trying to activate during-work partial interactivity when we are already in this partial interactivity or there is a running timer that's going to do it soon."):
this.y0=Vb.a.instance.create(function(){ic.$?ic.Fna?sa.ULS.sendTraceTag(537155221,0,15,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Tried to activate SilentReopenDuringWork PI when there is already an DuringWorkSilentReopen partial interactivity object"):Va.g(ic.$).isEditing?(ic.Cab||(Va.g(ic.$).$b.tm(ic.Af),sa.ULS.sendTraceTag(541893722,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Registered OnEditEnded while during-work silent reopen")),
ic.Dab=!0,sa.ULS.sendTraceTag(537155220,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Need to init during-work silent reopen partial interactivity but the user is during a cell edit. Registered to OnEditEnded event.")):ic.Xie():sa.ULS.sendTraceTag(537155222,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: EwaControl is null")},this.J3f,Ie.a.hBj,void 0,!0)};c.prototype.ppf=function(ic){this.o1c=this.zue(2,ic,!0);this.Sne()};c.prototype.Tkc=
function(ic,Jc){this.gWb=this.zue(ic,Jc,!1);this.Sne()};c.prototype.zue=function(ic,Jc,zd){zd=zd?this.o1c:this.gWb;return Jc?zd|ic:zd&~ic};c.prototype.cVd=function(){var ic=!!this.XNa,Jc=!!this.TRa,zd=!!this.Fna,sd=!!this.n3b;this.VBb&&!ic?this.hzg():!this.VBb&&ic&&this.vbh();!this.Vjc||Jc||zd?this.Vjc||(Jc?this.jFe():(zd||this.y0&&this.y0.Lp)&&this.kFe()):this.O0f&&this.qfa?this.fzg():!this.jLb||this.qfa||kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5658794_DontActivatePartialInteractivityIfTimerIsRunning")&&
this.y0||this.izg();this.jka&&!sd?this.X8f(!0):!this.jka&&sd&&this.X8f(!1)};c.prototype.hzg=function(){this.$?this.XNa?sa.ULS.sendTraceTag(537155215,0,15,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Tried to activate offline PI when there is already an offline partial interactivity object"):Va.g(this.$).isEditing?(this.Dab||(Va.g(this.$).$b.tm(this.Af),sa.ULS.sendTraceTag(537155217,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Registered OnEditEnded during offline mode")),
this.Cab=!0,sa.ULS.sendTraceTag(537155216,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Turned offline while user is editing a cell, registered to OnEditEnded event.")):this.$ie():sa.ULS.sendTraceTag(537155214,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: EwaControl is null")};c.prototype.$ie=function(){this.XNa||(this.XNa=Xb.a(this.$).Rf.OXa(5,"NetworkConnecStateManager.ActivateOfflinePartialInteractivity"))};c.prototype.vbh=function(){this.XNa&&
(cf.a.Ia(this.XNa),this.XNa=null)};c.prototype.jFe=function(){this.TRa&&(cf.a.Ia(this.TRa),this.TRa=null);kc.EwaSettings.isChangeGateEnabled("OfficeVSO:5533387_ReportLongSilentReopenBackToWorkVeto")&&this.M0&&this.M0.Lp&&this.M0.cancel();this.M0=null};c.prototype.kFe=function(){this.Fna&&(cf.a.Ia(this.Fna),this.Fna=null);this.y0&&(cf.a.Ia(this.y0),this.y0=null);this.Dab&&!this.Cab&&Va.g(this.$).$b.Nl(this.Af);this.Dab=!1};c.prototype.fzg=function(){this.TRa||(this.TRa=Xb.a(this.$).Rf.OXa(2,"NetworkConnectionStateManager.ActivateLongInactivitySilentReopenPartialInteractivity",
void 0,Da.a.instance.ga(2160)));this.qej()};c.prototype.X8f=function(ic){ic?(this.n3b=Xb.a(this.$).Rf.OXa(4,"NetworkConnectionStateManager.ConnectivityIssues"),this.R1i()):(cf.a.Ia(this.n3b),this.n3b=null)};c.prototype.R1i=function(){if(this.$&&this.$.oa){var ic=this.$.oa.xa.Pb();se.J(this.$.oa.xa,null,null,null,ic)}};c.prototype.xAc=function(){uc.a(this.$).qQ(wb.a.FOa).Eq(this.gzf);this.$.rl(this.Yc);this.trc=!1};c.prototype.Sne=function(){this.documentVisibilityObserver||sa.ULS.sendTraceTag(537155211,
0,15,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: Document visibility observer is null while it shouldn't be.");this.documentVisibilityObserver&&this.documentVisibilityObserver.Ni?this.Kzb||(this.documentVisibilityObserver.cZb(this.f9a),this.Kzb=!0,sa.ULS.sendTraceTag(541193954,0,50,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: tabbed out user, will update the partial interactivity state when the user will be back.")):this.cVd()};Mf.Object.defineProperties(c.prototype,
{igi:{configurable:!0,enumerable:!0,get:function(){return this.qfa}},VBb:{configurable:!0,enumerable:!0,get:function(){return!(this.gWb&1)}},Vjc:{configurable:!0,enumerable:!0,get:function(){return!(this.gWb&2)}},jka:{configurable:!0,enumerable:!0,get:function(){return!!(this.o1c&2)}}});Object(za.a)(c,"NetworkConnectionStateManager",ac.a,[944,3]);var bc=Ab.a;Rk(a,bc);a.prototype.create=function(){var ic=this;ke.TaskExtensions.Aa(bf.GetServiceTaskFactory.Ra(this.$.da,395,396,this.hb),function(Jc){var zd=
kc.EwaSettings.isChangeGateEnabled("OfficeVSO:6143820_MoveServiceRegistrationFromFAM")?Object(ub.c)(ic.$.da,395,function(){return new c(ic.$,Jc.result)}):ic.$.da.za(400)||new c(ic.$,Jc.result);ic.pb(zd)},this.$.la,3)};a.ka=function(ic){ic.da.Ga(401,new a(ic))};Object(za.a)(a,"NetworkConnectionStateManagerFactory",Ab.a,[]);var Mc=b(1454),rd=b(1359),Hd=b(1416);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.InsertPicture");Type.registerNamespace("_Ewa");Object(ta.a)();Object(Ua.a)();Object(pa.a)();
Object(Qa.a)();Object(Db.a)();Object(Zb.a)();Object(jb.a)();Object(Hd.a)();Type.registerNamespace("Common.App.InProductMessaging");ba.main();Type.registerNamespace("Common.App.FirstRunExperienceLauncher");ua.main();(function(){Kb.a.Fa(function(){Kb.a.Fa(X.ka)})})();(function(){Kb.a.Fa(function(){Kb.a.Fa(wa.ka)})})();Kb.a.Fa(B.ka);Kb.a.Fa(a.ka);Object(Mc.a)();Object(rd.a)()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.pi.js.map/aec7b06e3f813d939e616c754d1d93c1/EwaDS.pi.js.map