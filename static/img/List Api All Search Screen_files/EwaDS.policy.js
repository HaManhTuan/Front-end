(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[59],{1638:function(u,E,b){function a(hb){return Sb.call(this,hb)||this}function c(hb){this.$=hb}function d(hb){var Xb=Pe.call(this)||this;Xb.$=hb;Xb.Eb();return Xb}function e(hb,Xb,jc,Wc,fd){var Tc=cf.call(this)||this;Tc.statusBarManager=null;Tc.JXc=!1;Tc.Z9=null;Tc.zBc=!1;Tc.SMd=null;Tc.Gxa=null;Tc.KCd=!1;Tc.fo=!1;Tc.vp=null;Tc.Gce=null;Tc.wfa=null;Tc.zbe=null;Tc.JDa=null;Tc.RJe=function(){ba.ULS.sendTraceTag(537154520,306,
50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");var td=Tc.SMf(1);ba.ULS.sendTraceTag(537154519,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: {0}.",td)};Tc.oRd=function(td,Tb){Tb?(Tc.vp=Tb.title,Tc.Gce=Tb.vpc,Tc.wfa=Tb.buttonText,Tc.zbe=Tb.utf,Tc.aE.Tf(27,null),ba.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):ba.ULS.sendTraceTag(537154510,306,15,
"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};Tc.i3f=function(td,Tb){var Fa=Object(nb.a)(T,Tb);Fa?Fa.I2f?Tc.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)?(ba.ULS.sendTraceTag(537154508,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of {0}",Fa.errorType),Tc.aE.BAj(Fa.title,Fa.message,Fa.buttonText,function(Qb){Fa.qY&&(Tc.aE.cC(53)&&Tc.aE.removeEntry(53),Fa.qY(Qb))})):1===Fa.errorType?
(ba.ULS.sendTraceTag(537154507,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of File too large"),Tc.aE.Tf(48,null)):2===Fa.errorType?Tc.aE.Tf(49,null):3===Fa.errorType?Tc.aE.Tf(50,null):4===Fa.errorType?Tc.aE.Tf(51,null):5===Fa.errorType?Tc.aE.CAj(Fa.title,Fa.message,Fa.buttonText,function(Qb){Tc.aE.cC(52)&&Tc.aE.removeEntry(52);Fa.qY(Qb)}):Tc.aE.Tf(47,null):ba.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):
(ba.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),Tc.aE.Tf(47,null))};Tc.CXd=function(td,Tb){Tc.z6&&(ba.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),Tc.z6.vZf(),Tc.z6.PYf(),Tc.z6.cJf(),Tc.$.Cd&64&&(Tb.onSuccess&&Tc.Gxa?Tc.aKg():Tc.z6.M9f()));Tc.fa.qa("SupportsOfficeClientCoauthoring")&&(td=Tc.lr.un,Tc.JDa=td.AppliedPolicyId,"null"===Tc.labelId&&(Tc.JDa=""),Tc.zBc&&(td=td.PolicyLabelAssignmentMethod&&
Wa.e(td.PolicyLabelAssignmentMethod)===Wa.e("standard")?4:2,Tc.applyPolicyLabel(Tc.labelId,td,!0,Tc.SMd)));Tc.oQe();Tc.qz()};Tc.Gwf=function(){Tc.KCd=!0;Tc.oQe()};Tc.CBf=function(td,Tb){ba.ULS.sendTraceTag(42322116,306,50,"PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = {0}, ApplyLabelFlag = {1}",Ga.AFrameworkApplication.protectedFile,Tb.oP);Tc.applyPolicyLabel(Tb.upc,Tb.oP,!1,null)};Tc.IFi=function(td,Tb){Tc.JDa=Tb.upc;if(gd.a.Uq(td.Errors)){var Fa=
gd.a.laa(td.Errors,[2045508683]);0<Fa.length&&(td.Errors=gd.a.xF(td.Errors,[2045508683],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),Tc.$.ea.fp(td.Errors));Fa=gd.a.laa(td.Errors,[2046680228]);0<Fa.length&&(4===Tb.oP||1===Tb.oP)&&(td.Errors=gd.a.xF(td.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),Tc.$.ea.fp(td.Errors));Fa=td=null;for(var Qb=bk(Tc.lr.un.SensitivityLabels),cc=Qb.next();!cc.done;cc=Qb.next())cc=cc.value,Fd.a.equals(Tc.labelId,
cc.Id,!1)&&(td=cc),Fd.a.equals(Tb.SWf,cc.Id,!1)&&(Fa=cc);Qb={};Qb.ApplyLabelFlag=Tb.oP;td?(Qb.currentLabel="Set",Qb.currentLabelEnabled=td.Enabled,Qb.currentLabelName=td.Name?"Set":"NotSet",Qb.currentLabelParentId=td.ParentId?"Set":"NotSet"):Qb.currentLabel="NotSet";Fa?(Qb.serverLabel="Set",Qb.serverLabelEnabled=Fa.Enabled,Qb.serverLabelName=Fa.Name?"Set":"NotSet",Qb.serverLabelParentId=Fa.ParentId?"Set":"NotSet"):Qb.serverLabel="NotSet";ba.ULS.sendTraceTag(541638850,306,15,"PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : {0}",
JSON.stringify(Qb))}};Tc.aOg=function(td,Tb){if(!Tc.$.workbookContext.HasRoundTrippedHFPart)return!1;var Fa=Tc.lr.un;if(!Fa)return ba.ULS.sendTraceTag(537154502,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;var Qb=null;Fa=bk(Fa.SensitivityLabels);for(var cc=Fa.next();!cc.done;cc=Fa.next())cc=cc.value,Fd.a.equals(cc.Id,td,!1)&&(Qb=cc);return Qb&&Tc.R4h(Qb)?(ba.ULS.sendTraceTag(50341186,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),
Tc.nyj(Tb),!0):!1};Tc.pdi=function(){var td=!1;!Tc.$.ya.IsNewWorkbook||Tc.labelId&&Tc.labelId.length||(td=!0);ba.ULS.sendTraceTag(537154501,306,50,"PolicyManagerWrapper.IsANewFile: is this a new file : {0}",td);return td};Tc.Mnf=function(td,Tb){1===Tb.jpe?Tc.$.isEditMode?(ba.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),Tc.$.Ka.Kb(new ld.a(-723527778,0,Tc.$.Jc,10,null))):ba.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):
(Tc.Gxa=Tb.Gxa,Tc.$.ea.o2(Tc.vqe),Tc.$.Ieb(),ba.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),Tc.$.Ka.Kb(new ld.a(-8805455,0,Tc.$.Jc,10,null)))};Tc.Jke=function(td,Tb){Tb?(td=!!(Tc.$.Cd&64),ba.ULS.sendTraceTag(537154496,306,50,"AddMandatoryLabellingBusinessBar User has edit permission : {0}",td),td&&(Tc.$.Ieb(),Tc.aE.Izj(Tb.title,Tb.message,Tb.buttonText,function(Fa){Tb.qY(Fa)}))):ba.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};
Tc.iOf=function(){Tc.aE.cC(41)&&Tc.aE.removeEntry(41)};Tc.Y$f=function(td,Tb){Tb.wwj&&(ba.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),sc.TaskExtensions.Aa(Pb.GetServiceTaskFactory.Ra(Tc.$.da,55,56,0),function(Fa){Fa.result.G1c()},Tc.$.la,3))};Tc.vqe=function(){Tc.Gxa&&Tc.$.isEditMode?(Tc.$.ea.b0(Tc.vqe),Tc.r3a()):ba.ULS.sendTraceTag(537154467,306,15,"ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty {0} , edit mode : {1}.",
!Tc.Gxa,Tc.$.isEditMode)};Tc.lLj=function(){Tc.$.isEditMode?(Tc.$.ea.b0(Tc.lLj),Tc.r3a()):ba.ULS.sendTraceTag(537154466,306,15,"TriggerDefaultLabelingOnModeChanged is not expected in View-mode. Mode.")};Tc.Hja=function(){var td=Tc.$.ea.ho;td&&!Fd.a.equals(td.AppliedPolicyLabelId,Tc.labelId,!1)&&(ba.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),ba.ULS.shipAssertTag(537154463,306,Tc.$.isEditMode,
"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),Tc.fa.qa("SupportsOfficeClientCoauthoring")&&Tc.$.isEditMode&&(Tc.zBc=!0,Tc.SMd=td.AppliedPolicyLabelId),Tc.JDa=td.AppliedPolicyLabelId,Tc.r3a())};Tc.Umd=function(){var td=!0;if(!Tc.$.ea.amIAlone)for(var Tb=bk(Tc.$.ea.Bm),Fa=Tb.next();!Fa.done;Fa=Tb.next())if(!Fa.value.SupportsClientIsMipTrusted){td=!1;break}ba.ULS.sendTraceTag(537154462,306,50,
"PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : {0}",td);return td};Tc.Pxf=function(){ba.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");Tc.zBc=!0;Tc.r3a()};Tc.$=Wc;Tc.lr=hb;Tc.aE=jc;Tc.fa=fd;Tc.lr.Zme(Tc.oRd);Tc.z6=Xb;return Tc}function k(hb){return ke.call(this,hb,k.tQ(hb))||this}function l(hb,Xb,jc,Wc,fd){var Tc=Yd.call(this)||this;Tc.Znf=3;Tc.augmentationLoopManager=null;Tc.uA=null;Tc.nZa=!1;Tc.S9a=[];Tc.Bif=new Qd.a(ve.a.RJ());
Tc.XDd=0;Tc.bEd=null;Tc.Rqb=function(td,Tb){td=Object(Kd.a)(new Bc.a,{parentPath:["session","doc","security"],items:[Object(Kd.a)(new qd.a,{id:"clp",body:Object(Kd.a)(new v,{existingLabelPriority:Tb.existingLabelPriority,partialDocSITs:Tb.Kye,fullDocSITs:Tb.Jye})})]});Tc.S9a.push(td);Tc.Kxb()};Tc.lbg=function(td,Tb){td=Object(Kd.a)(new Jd.a,{parentPath:["session","doc","security"],items:[Object(Kd.a)(new qd.a,{id:"clp",body:Object(Kd.a)(new v,{existingLabelPriority:Tb.existingLabelPriority})})]});
Tc.S9a.push(td);Tc.Kxb()};Tc.mbg=function(td,Tb){td=Object(Kd.a)(new Jd.a,{parentPath:["session","doc","security"],items:[Object(Kd.a)(new qd.a,{id:"clp",body:Object(Kd.a)(new v,{partialDocSITs:Tb.Kye,fullDocSITs:Tb.Jye})})]});Tc.S9a.push(td);Tc.Kxb()};Tc.Z5=function(){ba.ULS.sendTraceTag(537154588,306,50,"AutoPolicyManager::OnApplicationModeChanged - isEditMode:{0}.",Tc.$.isEditMode);Tc.$.isEditMode?kd.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?Tc.Kxb():
Tc.S8e():(Tc.businessBar.removeEntry(40),Tc.businessBar.removeEntry(39),Tc.sbh())};Tc.V8a=function(){ba.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");Tc.hGe();Tc.augmentationLoopManager=null};Tc.Opi=function(td,Tb){var Fa,Qb,cc,bc,Mc;ba.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===Tb.operationType)ba.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");
else{var rd=td=null,Hd=null;if(Tc.Gld()){var ic=Tb.jJ;if(!ic){ba.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(Fa=ic.automatic)||void 0===Fa?0:Fa.id)td=ic.automatic.id;if(null===(Qb=ic.recommended)||void 0===Qb?0:Qb.id)rd=ic.recommended.id,ic.recommended.policyTip&&(Hd=ic.recommended.policyTip)}else{Fa=Tb.jJ;if(!Fa){ba.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");
return}if(null===(cc=null===(ic=Fa.automatic)||void 0===ic?void 0:ic.sensitivityLabel)||void 0===cc?0:cc.id)td=Fa.automatic.sensitivityLabel.id;if(null===(Mc=null===(bc=Fa.recommended)||void 0===bc?void 0:bc.sensitivityLabel)||void 0===Mc?0:Mc.id)rd=Fa.recommended.sensitivityLabel.id,Fa.recommended.sensitivityLabel.policyTip&&(Hd=Fa.recommended.sensitivityLabel.policyTip)}Tc.applyPolicyLabel(td,rd,Hd,1)}};Tc.Nri=function(td,Tb){ba.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");
3===Tb.operationType?ba.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):(td=Tb.jJ)?(td=td.classificationId,Tc.applyPolicyLabel(td,td,null,2)):ba.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};Tc.LNf=function(td,Tb){Tb?Tb.Jzb&&Tc.businessBar.cC(40)?(Tc.businessBar.removeEntry(40),ba.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):
!Tb.Jzb&&Tc.businessBar.cC(39)&&(Tc.businessBar.removeEntry(39),ba.ULS.sendTraceTag(537154561,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):ba.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};Tc.U1f=function(td,Tb){Tb?Tb.Jzb?(Tc.businessBar.tAj(Tb.title,Tb.message,Tb.buttonText,function(Fa){Tb.qY(Fa);Tc.businessBar.cC(40)&&Tc.businessBar.removeEntry(40)}),ba.ULS.sendTraceTag(537154531,
306,50,"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(Tc.businessBar.lyj(Tb.title,Tb.message,Tb.buttonText,function(Fa){Tb.qY(Fa);Tc.businessBar.cC(39)&&Tc.businessBar.removeEntry(39)}),ba.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):ba.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};Tc.JCd=
hb;Tc.policyManager=Xb;Tc.$=jc;Tc.fa=Wc;Tc.businessBar=fd;Tc.r8h();Tc.W6i();Tc.disposed=!1;return Tc}function n(){var hb=ad.call(this)||this;hb.classificationId=null;hb.H_=Object.assign(new Le.a,{T_:n.getTypeName(),B_:n.Nd()});return hb}function f(){var hb=Td.call(this)||this;hb.recommended=null;hb.automatic=null;hb.source=null;hb.H_=Object.assign(new Le.a,{T_:f.getTypeName(),B_:f.Nd()});return hb}function v(){var hb=r.call(this)||this;hb.existingLabelPriority=null;hb.H_=Object.assign(new Le.a,{T_:v.getTypeName(),
B_:v.Nd()});return hb}function r(){var hb=xe.call(this)||this;hb.partialDocSITs=null;hb.fullDocSITs=null;hb.H_=Object.assign(new Le.a,{T_:r.getTypeName(),B_:r.Nd()});return hb}function y(){var hb=rf.call(this)||this;hb.recommended=null;hb.automatic=null;hb.source=null;hb.H_=Object.assign(new Le.a,{T_:y.getTypeName(),B_:y.Nd()});return hb}function m(hb,Xb,jc,Wc,fd,Tc,td){td=hb.Na(1,void 0===td?null:td);td.tenantId=Xb;return se.g(hb,"GetPolicyApplicationMethod",td,jc,Wc,fd,Tc,4)}function w(hb,Xb,jc,
Wc,fd,Tc,td){td=hb.Na(1,void 0===td?null:td);td.tenantId=Xb;return se.g(hb,"GetPolicyLabelId",td,jc,Wc,fd,Tc,4)}function B(){this.YFa=this.annotationType=null;this.sLa=this.$E=!1}function A(){this.upc=this.SWf=null;this.oP=0}function z(){this.f1=this.Iqa=this.fb=this.Hg=null}function x(hb,Xb,jc,Wc,fd){Wc=void 0===Wc?0:Wc;fd=void 0===fd?null:fd;this.CGc=this.z4d=null;this.bra=this.pib=this.rib=0;this.j8="";this.EEa=this.uEc=this.M7d=this.Zoa=this.$Lc=null;this.o8d=!1;this.kCa=null;this.cJc=0;this.cVb=
this.GEa=this.oDa=this.bVb=null;this.$a=new ma.a;this.IKb=this.Hvb=this.BEa=null;this.PJc=!1;this.kBb=null;this.ib=hb;this.Og=Xb;this.ph=jc;this.eUb=Wc;this.un=new M;this.Ece=this.ib.Wa("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.OO=fd;this.jyb=hb.qa("WacApplyManualPolicyLabelIsEnabled");this.ufc=hb.qa("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=hb.qa("SupportsOfficeClientCoauthoring");this.Xli=!1;this.nrj=3E4;this.ae=Vb.a.instance;hb.qa("SupportsPolicies")&&
ib.a("MipSupportsPolicies");this.ufc&&this.supportsOfficeClientCoauthoring&&ib.a("MipSupportsOfficeClientCoauthoring")}function D(){}function I(hb,Xb,jc,Wc,fd,Tc,td,Tb,Fa,Qb,cc,bc,Mc,rd,Hd,ic,Jc,zd,sd,Pd,De){this.url=hb;this.cVj=Xb;this.body=jc;this.headers=Wc;this.Rcb=fd;this.priority=Tc;this.state=td;this.ufg=void 0===Tb?null:Tb;this.RN=void 0===Fa?null:Fa;this.vV=void 0===Qb?!1:Qb;this.q2i=void 0===cc?null:cc;this.Qmj=void 0===bc?null:bc;this.name=void 0===Mc?null:Mc;this.uFb=void 0===rd?null:
rd;this.Ead=void 0===Hd?!1:Hd;this.pEf=void 0===ic?null:ic;this.S8b=void 0===Jc?null:Jc;this.Xec=void 0===zd?null:zd;this.xbb=void 0===sd?null:sd;this.q6h=void 0===Pd?null:Pd;this.responseType=void 0===De?null:De}function F(hb){var Xb=Zb.call(this)||this;Xb.wwj=hb;return Xb}function G(hb){var Xb=Za.call(this)||this;Xb.$Jg=hb;return Xb}function T(hb,Xb,jc,Wc,fd,Tc,td){Wc=void 0===Wc?null:Wc;fd=void 0===fd?null:fd;Tc=void 0===Tc?null:Tc;td=void 0===td?null:td;var Tb=Aa.call(this)||this;Tb.errorType=
hb;Tb.$Jg=Xb;Tb.I2f=jc;Tb.title=Wc;Tb.message=fd;Tb.buttonText=Tc;Tb.qY=td;return Tb}function O(hb,Xb){var jc=Mb.call(this)||this;jc.upc=hb;jc.oP=Xb;return jc}function U(){return ub.call(this)||this}function J(hb,Xb){var jc=Ab.call(this)||this;jc.Xob=hb;jc.Jzb=Xb;return jc}function H(hb,Xb,jc,Wc){var fd=Kb.call(this)||this;fd.title=hb;fd.vpc=Xb;fd.buttonText=jc;fd.utf=Wc;return fd}function K(hb,Xb){var jc=Db.call(this)||this;jc.Gxa=hb;jc.jpe=Xb;return jc}function N(hb){hb=void 0===hb?!1:hb;var Xb=
Qa.call(this)||this;Xb.onSuccess=hb;return Xb}function M(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelId=null;this.AreLabelsAvailable=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.DefaultLabelId="";this.SensitivityLabels=
[];this.MandatoryLabelingEnforced=!1;this.CustomUrl=""}function C(){return pa.call(this)||this}function Q(hb){var Xb=Ua.call(this)||this;Xb.TZj=hb;return Xb}function P(hb,Xb,jc){var Wc=cb.call(this)||this;Wc.Kye=hb;Wc.Jye=Xb;Wc.existingLabelPriority=jc;return Wc}function ka(hb,Xb,jc,Wc,fd){var Tc=Na.call(this)||this;Tc.Xob=hb;Tc.title=Xb;Tc.message=jc;Tc.buttonText=Wc;Tc.qY=fd;return Tc}function R(hb,Xb,jc,Wc,fd,Tc){var td=Z.call(this)||this;td.Xob=hb;td.title=Xb;td.message=jc;td.buttonText=Wc;td.qY=
fd;td.Jzb=Tc;return td}function fa(hb,Xb,jc,Wc){this.mLc=this.nLc=null;this.m8d=this.EKc=this.XKc=this.Yib=this.M$d=this.GGc=!1;this.QUa=this.Sea=this.Lfa=this.cpa=this.ZVa=this.uu=this.e9=this.nh=null;this.AEc=0;this.l5d=this.UKc=this.LEc=null;this.La=hb;this.Re=Xb;this.ib=jc;this.Hg=Wc;this.Hjb={};this.Fce={};this.N$d={};this.jyb=jc.qa("WacApplyManualPolicyLabelIsEnabled");this.Hg.value.nne(Object(oa.a)(this,this.uEd,"processAutoSensitivityLabel"));this.Hg.value.MUc(Object(oa.a)(this,this.uEd,"processAutoSensitivityLabel"));
this.Hg.value.lZb(Object(oa.a)(this,this.bTi,"onUpdateLabelInfo"));Ga.AFrameworkApplication.ta&&Ga.AFrameworkApplication.ta.lFg(Object(oa.a)(this,this.A6i,"refreshDocumentPolicyLabelsOnModeChange"));jc.qa("SupportsPolicies")&&jc.Wa("AppliedPolicyId")&&(this.nLc=jc.Wa("IrmPolicyTitle"),this.mLc=jc.Wa("IrmPolicyDescription"));this.sOc=jc.qa("ProtectedFile");this.Akg=this.ib.kd("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6);this.Bkg=this.ib.kd("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}
function ca(hb,Xb,jc){var Wc=za.call(this,!1,!1,ca.mu)||this;Wc.$Vb=hb;Wc.ZVa=Xb;Wc.uD=jc;Wc.Rb=1;Wc.ye=ca.id;Wc.k7(1);Wc.k7(0);return Wc}function ea(){}function wa(){this.Vib=!!Ga.AFrameworkApplication.ta&&Ga.AFrameworkApplication.ta.Qa.Vu}function X(hb,Xb,jc){var Wc=ta.call(this,!1,!1,!0)||this;if(!hb||!jc)return ba.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs"),Wc;var fd={};fd=(fd.id="MandatoryLabellingDialog",fd);Wc.Smg=jc;Wc.OLc=Xb;if(!Ga.AFrameworkApplication.fa.qa("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||
Wc.OLc&&""!==Wc.OLc)Xb={},Xb=(Xb.href=Wc.OLc,Xb.target="_blank",Xb),jc={},fd.learnMoreLink=(jc.type="AppLinkProps",jc.id="mandatoryLabellingLearnMoreLink",jc.text=CommonUIStrings.l_LearnMore,jc.handler=Xb,jc.customTooltip=CommonUIStrings.L_LearnMoreTooltip,jc);Xb={};hb=(Xb.id="mandatoryLabellingFlyoutMenuSection",Xb.controls=hb,Xb);Xb={};Xb=(Xb.sections=[],Xb.shouldAutoOpen=!1,Xb);Array.add(Xb.sections,hb);hb={};fd.labelFlyout=(hb.type="AppFlyoutAnchorProps",hb.id="mandatoryLabellingFyout",hb.label=
"Pick a label",hb.hideLabel=!1,hb.hideChevron=!1,hb.hideIcon=!0,hb.menuDefinition=Xb,hb);hb={};hb=(hb.id="MandatoryLabellingDialog",hb.bodyControls=fd,hb);fd.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;fd.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;Wc.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(oa.a)(Wc,Wc.Rxi,"mandatoryLabellingDialogHandler"),hb);return Wc}function ja(hb,Xb){var jc=ia.call(this,
!1,!1,ja.mu)||this;jc.dqa=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];jc.nVb=null;jc.lVb=!1;jc.$Vb=hb;jc.uD=Xb;jc.Vf=jc.SPg();jc.Rb=1;jc.ye=ja.id;jc.mc(1,CommonUIStrings.l_DialogChange);jc.TK(1,!1);jc.k7(0);return jc}function va(){}function ua(hb,Xb){this.oP=hb;this.displayName=Xb}function Xa(hb,Xb,jc){jc=void 0===jc?null:jc;this.id=hb.Id;jc||(jc="");this.D5i=jc;this.sensitivityLabel=
hb}b.r(E);var aa=b(0),ba=b(14),oa=b(84),ra=b(1062),db=b(202);Object(aa.a)(Xa,"AutoPolicyLabelData",null,[]);Object(aa.a)(ua,"PolicyLabelRequestState",null,[]);var Ka=b(150),Ga=b(4),xa=b(158),da=b(13),qa=b(43),na=b(29);Mf.Object.defineProperties(va,{ird:{configurable:!0,enumerable:!0,get:function(){return va.npi}}});va.npi="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(aa.a)(va,"JustificationDialogHtml",null,[]);var ia=Ka.a;Rk(ja,ia);ja.prototype.eRd=function(){if(ja.mu)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(oa.a)(this,this.PKf,"reactJustificationDialogHandler"),this.n0e(this.lVb));else{for(var hb={},Xb=0;Xb<this.dqa.length;Xb++)hb[ja.dFd+Xb]=!1;hb[ja.RMb]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(oa.a)(this,this.mpi,"justificationDialogHandler"),hb);this.s7i();qa.a.addHandler($get(ja.RMb),
da.a.input,Object(oa.a)(this,this.GHj,"textAreaHandler"))}};ja.prototype.validate=function(){if(ja.mu)return this.peg(this.nVb);var hb=$get(ja.RMb);return hb.disabled?!0:this.peg(hb.value)};ja.prototype.peg=function(hb){var Xb=2>hb.length,jc=500<hb.length,Wc=RegExp("[{|}|;|\\\\]").test(hb);hb=""===na.a.Crc(hb);return!Xb&&!jc&&!Wc&&!hb};ja.prototype.mpi=function(hb,Xb){var jc="";if(1===hb)for(var Wc=0;Wc<this.dqa.length;Wc++)if(Xb[ja.dFd+Wc]){jc=Wc===this.dqa.length-1?Xb[ja.RMb]:this.dqa[Wc];break}this.uD(hb,
this.$Vb,jc)};ja.prototype.PKf=function(hb){var Xb="";1===hb&&this.nVb&&(Xb=this.nVb);this.uD(hb,this.$Vb,Xb)};ja.prototype.dNi=function(hb){this.nVb=hb;hb=this.validate();this.lVb!==hb&&(this.lVb=hb,this.kTa(CommonUIStrings.l_SensitivityJustificationTitle,Object(oa.a)(this,this.PKf,"reactJustificationDialogHandler"),this.n0e(this.lVb)))};ja.prototype.n0e=function(hb){var Xb={},jc={},Wc={},fd={};return fd.id=this.ye,fd.bodyControls=(jc.choiceGroupProps={},jc.textAreaProps=(Xb.placeholder=CommonUIStrings.l_SensitivityJustificationPlaceholder,
Xb),jc),fd.actionButtonProps=(Wc.label=CommonUIStrings.l_DialogChange,Wc.disabled=!hb,Wc),fd.infoMessage=CommonUIStrings.l_SensitivityJustificationMessage,fd.justificationIrrelevantLabel=CommonUIStrings.l_SensitivityJustificationNoLongerApplies,fd.justificationIncorrectLabel=CommonUIStrings.l_SensitivityJustificationIncorrect,fd.justificationOtherLabel=CommonUIStrings.l_SensitivityJustificationOther,fd.onJustificationUpdated=Object(oa.a)(this,this.dNi,"onJustificationUpdated"),fd};ja.prototype.GHj=
function(hb){hb.target&&this.TK(1,this.validate())};ja.prototype.SPg=function(){return Ka.a.No(ja.ird,Ga.AFrameworkApplication.FC,xa.getImageClass(ja.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.dqa[0],this.dqa[1],this.dqa[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)};ja.prototype.s7i=function(){for(var hb=document.getElementsByName(ja.Qri),Xb=0;Xb<hb.length;Xb++)qa.a.addHandler(hb[Xb],da.a.focus,Object(oa.a)(this,this.xJf,"radioButtonFocusHandler")),qa.a.addHandler(hb[Xb],
da.a.click,Object(oa.a)(this,this.xJf,"radioButtonFocusHandler"))};ja.prototype.xJf=function(hb){if(hb=hb.target){hb.checked=!0;var Xb=$get(ja.RMb);hb.id===ja.dFd+(this.dqa.length-1)?(Xb.disabled=!1,Sys.UI.DomElement.setVisible(Xb,!0),Xb.focus()):(Xb.disabled=!0,hb.focus());this.TK(1,this.validate())}};Mf.Object.defineProperties(ja,{mu:{configurable:!0,enumerable:!0,get:function(){return Ga.AFrameworkApplication.ta.Qa.Vu&&Ga.AFrameworkApplication.ta.Qa.Wod}}});ja.ird=va.ird;ja.Qri="ListRadioBox";
ja.dFd="radiobox";ja.RMb="txtJustification";ja.iconName="Info_32x32x32";ja.id="JustificationDialog";Object(aa.a)(ja,"JustificationDialog",Ka.a,[]);var ta=Ka.a;Rk(X,ta);X.prototype.Rxi=function(hb,Xb){1===hb&&Xb.selectedLabel&&(hb=Xb.selectedLabel,""!==hb&&this.Smg(hb))};Object(aa.a)(X,"MandatoryLabellingDialog",Ka.a,[]);wa.prototype.d7g=function(hb,Xb,jc){this.Vib&&new X(hb,Xb,jc)};Mf.Object.defineProperties(wa,{instance:{configurable:!0,enumerable:!0,get:function(){return wa.Ma||(wa.Ma=new wa)}}});
wa.Ma=null;Object(aa.a)(wa,"MandatoryLabellingDialogFactory",null,[988]);ea.DEj="sbProtectForm14";ea.FEj="SBStatusBarMarkAsReadOnly14";ea.ari="Info_16x16x32";ea.Ipb="QuickSearchCompletedToday_16x16x32";ea.DFd="CommonControlCheckboxCheck_16";ea.W8f="On";ea.visible="Visible";ea.KBh="ImageIsVisible";ea.OF="SourceControlId";ea.menuItemId="MenuItemId";ea.menu="Menu";ea.EVc="AppLockId";ea.value="Value";ea.mi="LabelText";ea.alt="Alt";ea.q8e="Image16by16";ea.b5a="Image16by16Class";ea.CEj="SBProtectForm_16";
ea.EEj="SBStatusBarMarkAsReadOnly_16";ea.icon="Icon";ea.iconColor="IconColor";ea.customTooltip="CustomTooltip";ea.S4i="MipTagDynamicFillWithOutline_20";ea.T4i="MipTagLockDynamicFillWithOutline_20";ea.R4i="MipTagErrorOutline_20";ea.U4i="MipTagQuestionOutline_20";ea.RVd="transparent";Object(aa.a)(ea,"PolicyConstants",null,[]);var za=Ka.a;Rk(ca,za);ca.prototype.BRd=function(){var hb={};hb=(hb.id="UserDefinedPermissionsDialog",hb);ca.mu&&this.initializeAndShow("Defined Permissions",Object(oa.a)(this,
this.XTj,"userDefinedPermissionsDialogHandler"),hb)};ca.prototype.XTj=function(hb){1!==hb&&this.uD(hb,this.$Vb,"",this.ZVa)};Mf.Object.defineProperties(ca,{mu:{configurable:!0,enumerable:!0,get:function(){return Ga.AFrameworkApplication.ta.Qa.Vu&&Ga.AFrameworkApplication.ta.Qa.Wod}}});ca.id="UserDefinedPermissionsDialog";Object(aa.a)(ca,"UserDefinedPermissionsDialog",Ka.a,[]);var sa=b(652),V=b(393),Ia=b(322),Ha=b(631),ob=b(99),ib=b(187),La=b(625),zb=b(622),Fb=b(167),Yb=b(463),kb=b(135),vb=b(88),Wa=
b(205),qb=b(343),yb=b(83),ec=b(107),Ob=b(25),Cb=b(58);fa.prototype.Bg=function(){this.La.Mb(Ob.a.KDf,ec.a.frame,Object(oa.a)(this,this.UHe,"documentLabelPaneHandler"));this.La.He(Ob.a.aab,ec.a.frame,Object(oa.a)(this,this.aab,"queryPolicyLabel"),96);this.La.Mb(Ob.a.LSa,ec.a.frame,Object(oa.a)(this,this.LSa,"toggleSensitivity"));this.La.Mb(Ob.a.Rya,ec.a.frame,Object(oa.a)(this,this.Rya,"populateSensitivityFlyout"));this.La.Mb(Ob.a.setSensitivity,ec.a.frame,Object(oa.a)(this,this.setSensitivity,"setSensitivity"));
this.La.He(Ob.a.bab,ec.a.frame,Object(oa.a)(this,this.bab,"querySensitivity"),96);this.La.Mb(Ob.a.G6,ec.a.frame,Object(oa.a)(this,this.G6,"querySensitivityToggleButton"));this.La.Mb(Ob.a.E6,ec.a.frame,Object(oa.a)(this,this.E6,"querySensitivitySubFlyout"));this.dmb(Ob.a.LSa)||this.La.dcb(Ob.a.LSa,4);this.dmb(Ob.a.Rya)||this.La.dcb(Ob.a.Rya,4);this.dmb(Ob.a.setSensitivity)||this.La.dcb(Ob.a.setSensitivity,4);this.dmb(Ob.a.G6)||this.La.dcb(Ob.a.G6,4);this.dmb(Ob.a.E6)||this.La.dcb(Ob.a.E6,4);this.Re.updateCommandUI();
Ga.AFrameworkApplication.fa&&Ga.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Fb.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&this.Hg.value.Uaj(Object(oa.a)(this,this.QMf,"registerActionsHandler"))};fa.prototype.QMf=function(){this.Bg()};fa.prototype.MNb=function(){this.La.fD(Ob.a.KDf,ec.a.frame,Object(oa.a)(this,this.UHe,"documentLabelPaneHandler"));this.La.fD(Ob.a.aab,
ec.a.frame,Object(oa.a)(this,this.aab,"queryPolicyLabel"));this.La.fD(Ob.a.LSa,ec.a.frame,Object(oa.a)(this,this.LSa,"toggleSensitivity"));this.La.fD(Ob.a.Rya,ec.a.frame,Object(oa.a)(this,this.Rya,"populateSensitivityFlyout"));this.La.fD(Ob.a.setSensitivity,ec.a.frame,Object(oa.a)(this,this.setSensitivity,"setSensitivity"));this.La.fD(Ob.a.bab,ec.a.frame,Object(oa.a)(this,this.bab,"querySensitivity"));this.La.fD(Ob.a.G6,ec.a.frame,Object(oa.a)(this,this.G6,"querySensitivityToggleButton"));this.La.fD(Ob.a.E6,
ec.a.frame,Object(oa.a)(this,this.E6,"querySensitivitySubFlyout"))};fa.prototype.LSa=function(){return 32};fa.prototype.GVe=function(hb){var Xb="mandatoryLabelling_"+hb.Id;this.N$d[Xb]=hb.Id;var jc={};return jc.type="AppToggleButtonProps",jc.id=Xb,jc.label=hb.DisplayName,jc.hideLabel=!1,jc.customTooltip=hb.Tooltip,jc};fa.prototype.AMa=function(){return this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)};fa.prototype.cRh=function(){var hb=[],Xb=this.e9,jc;for(jc in Xb){var Wc=
Xb[jc],fd=this.uu[jc];if(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",!1)){if(!fd||!fd.Enabled||fd.HasUserDefinedPermissions)continue}else if(!fd||!fd.Enabled)continue;if(Wc.count){var Tc={};Tc=(Tc.sections=[],Tc.shouldAutoOpen=!1,Tc);var td={};td=(td.id="mandatoryLabelling_flyoutMenuSection_"+fd.Id,td.controls=[],td);Wc=bk(Wc);for(var Tb=Wc.next();!Tb.done;Tb=Wc.next()){Tb=this.uu[Tb.value];if(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",
!1)){if(!Tb||!Tb.Enabled||Tb.HasUserDefinedPermissions)continue}else if(!Tb||!Tb.Enabled)continue;Array.add(td.controls,this.GVe(Tb))}Array.add(Tc.sections,td);td={};fd=(td.type="AppFlyoutAnchorProps",td.id="mandatoryLabelling_"+fd.Id,td.label=fd.DisplayName,td.hideLabel=!1,td.hideChevron=!1,td.hideIcon=!1,td.menuDefinition=Tc,td);Array.add(hb,fd)}else Array.add(hb,this.GVe(fd))}return hb};fa.prototype.Rya=function(hb,Xb,jc,Wc,fd){if(1===jc||!this.Hg.value.Qga(!0))return 32;fd.MenuItems=Object.assign(new La.a,
{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});Array.add(fd.MenuItems.MenuSectionList,this.Bc(!this.isReactRibbonEnabled()));this.nh.CustomUrl&&Array.add(fd.MenuItems.MenuSectionList,this.U6g(this.isReactRibbonEnabled()?this.nh.CustomUrl:na.a.af(this.nh.CustomUrl)));this.isReactRibbonEnabled()||(fd.PopulationXML=Ia.q(fd.MenuItems));return 32};fa.prototype.bab=function(hb,Xb,jc,Wc,fd){if(1===jc||!fd||!this.jyb)return 32;this.nh=this.Hg.value.un;if(this.Hg.value.Qga(!0)&&(fd[ea.visible]=
!0,ib.a("MipLabelsAvailable"),this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",!1)&&this.nh&&this.nh.AreLabelsAvailable&&(hb=yb.a.instance.Tb("Common.ISystemInitiatedFeedback")))){var Tc=fa.fh(this.nh.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";hb.execute(function(td){td.logActivity(Tc,null)})}return 32};fa.prototype.G6=function(hb,Xb,jc,Wc,fd){if(1===jc||!fd)return 32;var Tc,td;fd[ea.W8f]=!!(Tc=fd[ea.menuItemId])&&
!!(td=this.Hjb[Tc])&&td===this.nh.AppliedPolicyId;return 32};fa.prototype.E6=function(hb,Xb,jc,Wc,fd){if(1===jc||!fd)return 32;var Tc,td,Tb;hb=!!(Tc=fd[ea.OF])&&!!(td=this.Hjb[Tc])&&!!(Tb=this.e9[td])&&Tb.contains(this.nh.AppliedPolicyId);fd[ea.KBh]=hb;fd[ea.W8f]=hb;return 32};fa.prototype.setSensitivity=function(hb,Xb,jc,Wc,fd){return 1!==jc&&fd?this.mRa(this.Hjb[fd[ea.OF]],fd,2):32};fa.prototype.Ofc=function(){return!!Ga.AFrameworkApplication.ta&&1===Ga.AFrameworkApplication.ta.mode};fa.prototype.A6i=
function(){this.EKc&&!this.Ofc()&&(this.EKc=!1,this.Hg.value.z6i())};fa.prototype.M9f=function(){this.nh.DefaultLabelId&&this.nh.MandatoryLabelingEnforced?this.GGc||this.Ofc()?this.nh.AppliedPolicyId?this.U7c(""):(this.Hg.value.gli(this.Hg.value.kBb)||this.Ofc())&&this.nKe():this.$Xf():this.nh.DefaultLabelId?this.$Xf():this.nh.MandatoryLabelingEnforced&&(this.nh.AppliedPolicyId?this.U7c(""):this.nKe())};fa.prototype.Bdf=function(){return this.nh.MandatoryLabelingEnforced?this.nh&&this.nh.AreLabelsAvailable?
this.ib.qa("TestOverrideIsReactDialogEnabled")||this.Re&&this.Re.Qa&&this.Re.Qa.Vu?!0:(ba.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(ba.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),!1):(ba.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),!1)};fa.prototype.nKe=function(){var hb=this;!this.Bdf()||Ga.AFrameworkApplication.Y4||this.M$d||
(this.M$d=Ga.AFrameworkApplication.Y4=!0,ba.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.Hg.value.QJf("",1),this.Hg.value.ITc(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,function(){hb.Pxi()}))};fa.prototype.U7c=function(hb){this.Bdf()&&Ga.AFrameworkApplication.Y4&&(Ga.AFrameworkApplication.Y4=!1,ba.ULS.sendTraceTag(562837518,
306,50,"Mandatory labelling is escaped successfully."),this.Hg.value.IHd(),this.Hg.value.QJf(hb,2))};fa.prototype.Pxi=function(){wa.instance.d7g(this.cRh(),this.nh.CustomUrl,Object(oa.a)(this,this.Qxi,"mandatoryLabellingDialogCallback"))};fa.prototype.Qxi=function(hb){this.U7c(this.N$d[hb])};fa.prototype.hse=function(){return this.ib.qa("CoAuthForProtectedFilesEnabled")&&this.ib.qa("SupportsOfficeClientCoauthoring")&&this.ib.qa("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this.l5d&&this.l6a};
fa.prototype.mRa=function(hb,Xb,jc,Wc){var fd=this;Wc=void 0===Wc?null:Wc;this.Hg.value.z3i(jc);var Tc=32,td=!1,Tb=!0,Fa=2===jc||8===jc||16===jc,Qb=hb===this.nh.AppliedPolicyId;if(this.LEc&&this.LEc(hb,Fa))ba.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",jc),this.Re.updateCommandUI();else if(Xb&&ea.EVc in Xb&&this.Hg.value.Bqj(Xb[ea.EVc]),hb)if(this.Hg.value.Mff()||this.hse()&&this.XKc)ba.ULS.sendTraceTag(42796168,
306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",jc),this.Re.updateCommandUI(),Fa&&this.ZZb(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.ib.qa("HasDocumentEditRights"))if(this.Hg.value.aUg(hb))if(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",!1)&&!this.AMa()&&this.uu[hb]&&this.uu[hb].HasUserDefinedPermissions&&!Qb)ba.ULS.sendTraceTag(540608323,
306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",jc),1!==jc&&4!==jc&&this.gIg();else if(Fa&&this.nh.MandatoryLabelingEnforced&&Qb)ba.ULS.sendTraceTag(570972054,306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",jc),this.ZZb(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(Fa&&this.ib.qa("WacLabelingJustificationDialogIsEnabled")&&
this.nh.RequiredDowngradeJustification&&(Qb||this.uu[hb].RequiredDowngradeJustification)&&(this.AMa()?!this.m8d&&!Wc:!this.ZVa))return ba.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",jc),this.eRd(hb),Tc;if(this.AMa()&&this.uu[hb].HasUserDefinedPermissions&&!Qb)return ba.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",jc),this.BRd(hb,Wc),Tc;if(this.hse()&&!this.l5d())this.AEc<this.Akg?(ba.ULS.sendTraceTag(577356770,306,
50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.AEc,jc),this.XKc=!0,this.AEc++,Cb.Task.delay(this.Bkg).continueWith(function(){fd.XKc=!1;fd.mRa(hb,Xb,jc)})):(ba.ULS.sendTraceTag(577356771,306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",jc),td=1!==jc,Tb=!1,Tc=8);else{if(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.WacBlockParentLabelSetLabel",!1)&&this.Qji(hb)&&
(ba.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",jc),1===jc||8===jc||4===jc))return Tc;ba.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",jc);this.setPolicyLabel(Qb?"":hb,this.AMa()?Wc:this.ZVa,"",jc);return Tc}}else ba.ULS.sendTraceTag(42796169,306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",jc),this.Re.updateCommandUI(),
Fa&&this.ZZb(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else ba.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",jc),this.Re.updateCommandUI(),Fa&&this.ZZb(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);else ba.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",
jc),this.Re.updateCommandUI(),td=Fa,Tb=!1,Tc=8;this.Hg.value.rFd(0,jc,td,Tb);return Tc};fa.prototype.TYa=function(hb,Xb,jc,Wc){jc=void 0===jc?null:jc;Wc=void 0===Wc?!1:Wc;ob.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null);this.ib.qa("SupportsOfficeClientCoauthoring")&&this.ib.qa("CoAuthForProtectedFilesIsEnabled")?(this.Yib=!1,(this.nh=this.Hg.value.un)&&!this.nh.AppliedPolicyId?this.Yib=!0:this.nh&&this.nh.PolicyLabelAssignmentMethod&&(this.Yib=Wa.e(this.nh.PolicyLabelAssignmentMethod)===
Wa.e("standard"))):this.Yib=Wc;hb=fa.fh(hb)?null:this.uu[hb];(Xb=fa.fh(Xb)?null:this.uu[Xb])?this.Lfa=new Xa(Xb,!0,jc):(this.Hg.value.bda(29),this.Sea=null);hb?this.cpa=new Xa(hb,!1):this.QUa=null;this.uEd(null,null);return 32};fa.prototype.bKg=function(hb){""!==this.nh.AppliedPolicyId?this.Hg.value.rFd(4,16,!0):this.mRa(hb,null,16)};fa.prototype.PYf=function(){this.uu={};if(this.nh=this.Hg.value.un)for(var hb=bk(this.nh.SensitivityLabels),Xb=hb.next();!Xb.done;Xb=hb.next())Xb=Xb.value,this.uu[Xb.Id]=
Xb};fa.prototype.Qji=function(hb){if(this.e9&&hb in this.e9){hb=bk(this.e9[hb]);for(var Xb=hb.next();!Xb.done;Xb=hb.next())if((Xb=this.uu[Xb.value])&&Xb.Enabled)return!0}return!1};fa.prototype.vZf=function(){this.e9={};if(this.nh=this.Hg.value.un){for(var hb=bk(this.nh.SensitivityLabels),Xb=hb.next();!Xb.done;Xb=hb.next())Xb=Xb.value,Xb.ParentId||(this.e9[Xb.Id]=new db.a);hb=bk(this.nh.SensitivityLabels);for(Xb=hb.next();!Xb.done;Xb=hb.next())Xb=Xb.value,Xb.ParentId&&Xb.ParentId in this.e9&&this.e9[Xb.ParentId].add(Xb.Id)}};
fa.prototype.cJf=function(){if(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)){this.nh=this.Hg.value.un;var hb=this.jyb&&this.isReactRibbonEnabled()&&this.Hg.value.Qga();fa.YPa(hb)}else this.jyb&&this.isReactRibbonEnabled()?(this.nh=this.Hg.value.un,this.Hg.value.Qga()?(fa.YPa(!0),appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1))):fa.YPa(!1)):fa.YPa(!1)};fa.prototype.Y6i=function(hb){this.LEc=hb};fa.prototype.O7i=function(hb){this.UKc=
hb};fa.prototype.$Xf=function(){this.ib.qa("WacApplyDefaultPolicyLabelIsEnabled")&&(this.Ofc()?this.EKc=!0:this.GGc||(this.GGc=!0,(this.nh=this.Hg.value.un)&&this.nh.DefaultLabelId&&!this.nh.AppliedPolicyId&&(ba.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this.nh.DefaultLabelId),this.mRa(this.nh.DefaultLabelId,null,1))))};fa.prototype.uEd=function(){var hb=this;if(!this.Hg.value.Mff()){var Xb=this.uu[this.Hg.value.un.AppliedPolicyId];this.Yib&&this.cpa&&this.QUa!==
this.cpa.id&&(!Xb||Xb.Order<this.cpa.sensitivityLabel.Order)&&(Xb=this.mRa(this.cpa.id,{},4),32!==Xb?ba.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+Xb):(this.QUa=this.cpa.id,this.Sea&&(Xb=this.uu[this.Sea])&&Xb.Order<=this.cpa.sensitivityLabel.Order&&(this.Hg.value.bda(29),this.Sea=null)));Xb=this.uu[this.Hg.value.un.AppliedPolicyId];if(this.Lfa&&this.Sea!==this.Lfa.id&&(!Xb||Xb.Order<this.Lfa.sensitivityLabel.Order)){var jc=this.Lfa.id;
this.Hg.value.bda(29);this.Hg.value.zYb(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.Ned(this.Lfa.sensitivityLabel))+" "+this.Lfa.D5i,CommonUIStrings.l_PolicyLabelRecommendationButton,function(){hb.mRa(jc,{},8)});this.Sea=this.Lfa.id}this.Lfa=this.cpa=null}};fa.prototype.setPolicyLabel=function(hb,Xb,jc,Wc){Wc=void 0===Wc?2:Wc;this.AMa()?Xb&&(this.m8d=!0):this.ZVa=Xb;this.Hg.value.setPolicyLabel(hb);this.Re.updateCommandUI();jc=
new ua(Wc,this.Ned(this.uu[hb]));this.Hg.value.jOd(hb,this.AMa()?Xb:this.ZVa,jc)};fa.prototype.a2g=function(hb,Xb,jc,Wc){1===hb&&this.setPolicyLabel(Xb,Wc,jc)};fa.prototype.$1g=function(hb,Xb,jc){1===hb?this.AMa()?this.mRa(Xb,null,2,jc):this.setPolicyLabel(Xb===this.nh.AppliedPolicyId?"":Xb,jc,""):this.Re.updateCommandUI()};fa.prototype.eRd=function(hb){(new ja(hb,Object(oa.a)(this,this.$1g,"continueToSetPolicyLabelFromJustificationDialog"))).eRd()};fa.prototype.BRd=function(hb,Xb){(new ca(hb,Xb,
Object(oa.a)(this,this.a2g,"continueToSetPolicyLabelFromUDPDialog"))).BRd()};fa.prototype.ZZb=function(hb,Xb){hb=void 0===hb?"":hb;Xb=void 0===Xb?"":Xb;var jc=new kb.StandardDialog;jc.Pu=Ga.AFrameworkApplication.ryb;jc.Rb=0;jc.mc(1,CommonUIStrings.l_DialogClose);jc.XW(hb,Xb,null)};fa.prototype.cOg=function(hb){1===hb&&this.Hg.value.D3i()};fa.prototype.gIg=function(){var hb=new kb.StandardDialog;hb.Pu=Ga.AFrameworkApplication.ryb;hb.Rb=1;hb.mc(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);
hb.mc(0,CommonUIStrings.l_DialogClose);hb.XW(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(oa.a)(this,this.cOg,"blockUDPSetLabelHandler"))};fa.prototype.isReactRibbonEnabled=function(){return!!this.Re&&!!this.Re.Qa&&this.Re.Qa.vi};fa.prototype.ohc=function(){return this.Re&&this.Re.Qa?this.Re.Qa.ohc:!1};fa.prototype.UHe=function(){return 32};fa.prototype.aab=function(hb,Xb,jc,Wc,fd){if(1===jc)return 32;this.nh=this.Hg.value.un;
if(!this.nh||!fd)return 32;fd[ea.value]="";fd[ea.mi]="";fd[ea.alt]=null;fd[ea.q8e]=null;fd[ea.b5a]=null;fd[ea.customTooltip]="";fd[ea.visible]=!1;fd[ea.iconColor]="";jc=Xb=hb=fd[ea.icon]="";if(!this.nh.AreLabelsAvailable){if(!this.nLc)return 32;hb=this.nLc;jc=ea.RVd;this.mLc&&(Xb=this.mLc)}else if(this.nh.AppliedPolicyId){Wc=null;for(var Tc=bk(this.nh.SensitivityLabels),td=Tc.next();!td.done;td=Tc.next())if(td=td.value,td.Id.toLowerCase()===this.nh.AppliedPolicyId.toLowerCase()){Wc=td;break}Wc&&(hb=
this.Ned(Wc),Xb=Wc.Tooltip,this.sOc=Ga.AFrameworkApplication.protectedFile=Wc.IsEndpointProtectionEnabled,jc=this.CWe(Wc))}this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(hb?(fd[ea.value]=hb,fd[ea.mi]=hb,fd[ea.customTooltip]=Xb,this.YYf(jc,this.sOc,fd)):this.ib.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.ClpUseOutlineImageForNoLabel")?(fd[ea.iconColor]=ea.RVd,this.nh.MandatoryLabelingEnforced?(fd[ea.value]=fd[ea.mi]=HeaderStrings.SelectASensitivityLabel,
fd[ea.icon]=ea.R4i):(fd[ea.value]=fd[ea.mi]=HeaderStrings.NoSensitivityLabel,fd[ea.icon]=ea.U4i)):(fd[ea.iconColor]="#000000",this.nh.MandatoryLabelingEnforced?(fd[ea.value]=fd[ea.mi]=HeaderStrings.SelectASensitivityLabel,fd[ea.icon]="MipTagErrorDynamicColor_20"):(fd[ea.value]=fd[ea.mi]=HeaderStrings.NoSensitivityLabel,fd[ea.icon]="MipTagQuestionDynamicColor_20")),fd[ea.visible]=!0):hb&&(fd[ea.value]=hb,fd[ea.mi]=hb,this.ohc()?fd[ea.customTooltip]=Xb:fd[ea.alt]=Xb,this.YYf(jc,this.sOc,fd),fd[ea.visible]=
!0);return 32};fa.prototype.Ned=function(hb){return hb?this.uu?hb.ParentId&&this.uu[hb.ParentId]?this.uu[hb.ParentId].DisplayName+"\\"+hb.DisplayName:hb.DisplayName:(ba.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),hb.DisplayName):""};fa.prototype.YYf=function(hb,Xb,jc){this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(jc[ea.icon]=this.W1e(Xb),jc[ea.iconColor]=this.X1e(hb)):this.ohc()?jc[ea.icon]=Xb?ea.CEj:
ea.EEj:(jc[ea.q8e]=Ga.AFrameworkApplication.FC,jc[ea.b5a]=Xb?xa.getImageClass(ea.DEj):xa.getImageClass(ea.FEj))};fa.prototype.U6g=function(hb){var Xb=this.hU("LearnMoreSection",!0);hb=Object.assign(new V.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:hb,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:Ga.AFrameworkApplication.FC,Image16by16Class:xa.getImageClass(ea.ari),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});Array.add(Xb.ControlList,
hb);return Xb};fa.prototype.bEe=function(hb,Xb,jc){jc=void 0===jc?!1:jc;var Wc="Toggle_"+hb.Id;Wc="Sensitivity_"+Wc;var fd=hb.DisplayName,Tc=hb.Tooltip,td=hb.Id===this.nh.AppliedPolicyId,Tb=jc?na.a.af(Wc):Wc;this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(td=this.CWe(hb),Xb=Object.assign(new Yb.a,{Id:Tb,ExternalId:Tb,LabelText:jc?na.a.af(fd):fd,Command:"2935633379",MenuItemId:Tb,QueryCommand:"991261903",Visible:!0,Alt:jc?na.a.af(Tc):Tc,AriaLabel:vb.a.I_b,IconColor:this.X1e(td),
KeyTip:Xb}),Xb.ExternalImageId=this.W1e(hb.IsEndpointProtectionEnabled)):(Tb=Object.assign(new sa.a,{Id:Tb,ExternalId:Tb,LabelText:jc?na.a.af(fd):fd,Command:"2935633379",MenuItemId:Tb,QueryCommand:"991261903",CheckedImage:Ga.AFrameworkApplication.FC,Visible:!0,Alt:jc?na.a.af(Tc):Tc,IsChecked:td,AriaLabel:vb.a.I_b,KeyTip:Xb}),this.isReactRibbonEnabled()?(Tb.CheckedImageClass=xa.getImageClass(ea.DFd),Tb.ExternalImageId=ea.DFd):Tb.CheckedImageClass=xa.getImageClass(ea.Ipb),Xb=Tb);Tb=Wc;this.Hjb[Tb]=
hb.Id;this.Fce[hb.Id]=Tb;return Xb};fa.prototype.hU=function(hb,Xb){Xb=void 0===Xb?!1:Xb;return Object.assign(new zb.a,{Title:"",Id:hb,DisplayMode:ea.menu,ShowMenuSectionSeparator:Xb,ControlsId:"Ctrl_"+hb,ControlList:[]})};fa.prototype.T9g=function(hb,Xb,jc){hb=this.hU(hb+"Sub");var Wc=1;Xb=bk(Xb);for(var fd=Xb.next();!fd.done;fd=Xb.next())(fd=this.uu[fd.value])&&fd.Enabled&&(Array.add(hb.ControlList,this.bEe(fd,Wc.toString(),jc)),Wc++);return hb};fa.prototype.Bc=function(hb){hb=void 0===hb?!1:hb;
var Xb=this.hU("SensitivitySection"),jc=1,Wc=this.e9,fd;for(fd in Wc){var Tc=Wc[fd],td=this.uu[fd];if(td&&td.Enabled){if(Tc.count){var Tb="Sensitivity_"+td.Name,Fa=hb?na.a.af(Tb):Tb;Fa=Object.assign(new Ha.a,{Id:Fa,ExternalId:Fa,LabelText:hb?na.a.af(td.DisplayName):td.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new La.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:vb.a.I_b,KeyTip:jc.toString()});
this.isReactRibbonEnabled()?Fa.ExternalImageId=ea.DFd:(Fa.Image16by16=Ga.AFrameworkApplication.FC,Fa.Image16by16Class=xa.getImageClass(ea.Ipb));Array.add(Fa.Menu.MenuSectionList,this.T9g(Tb,Tc,hb));Array.add(Xb.ControlList,Fa);this.Hjb[Fa.Id]=td.Id;this.Fce[td.Id]=Fa.Id}else Array.add(Xb.ControlList,this.bEe(td,jc.toString(),hb));jc++}}return Xb};fa.prototype.dmb=function(hb){return!!this.La.Y3(hb)&&!!this.La.Y3(hb).flags&&!!this.La.Y3(hb).flags.length};fa.prototype.bTi=function(hb,Xb){Xb.onSuccess&&
this.uu&&(hb=this.uu[this.Hg.value.un.AppliedPolicyId])&&(this.Sea&&(Xb=this.uu[this.Sea])&&Xb.Order<=hb.Order&&(this.Hg.value.bda(29),this.Sea=null),this.QUa&&this.QUa!==hb.Id&&(this.Hg.value.bda(28),this.QUa=null))};fa.prototype.W1e=function(hb){return hb?ea.T4i:ea.S4i};fa.prototype.X1e=function(hb){return hb?hb:ea.RVd};fa.prototype.CWe=function(hb){if(hb.Color||!hb.ParentId)return hb.Color;var Xb=this.uu[hb.ParentId];return Xb?Xb.Color:hb.Color};fa.YPa=function(hb){Ga.AFrameworkApplication.fa&&
Ga.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(hb?(qb.a.yxd("ribbon","sensitivity"),qb.a.txd("ribbon","sensitivity")):qb.a.xxd("ribbon","sensitivity"));Ga.AFrameworkApplication.fa&&Ga.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Fb.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!hb))};fa.fh=function(hb){return hb&&hb.length?
!1:!0};Mf.Object.defineProperties(fa.prototype,{l6a:{configurable:!0,enumerable:!0,get:function(){return Ga.AFrameworkApplication.l6a||!!this.UKc&&this.UKc()}}});Object(aa.a)(fa,"PolicyActor",null,[951]);var ab=b(737),ya=b(616),ma=b(97),ha;(function(hb){hb[hb.unknown=0]="unknown";hb[hb.boot=1]="boot";hb[hb.refresh=2]="refresh";hb[hb.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(ha||(ha={}));Object(aa.b)("GetPolicyLabelsReason",ha);var Z=Sys.EventArgs;Rk(R,Z);Object(aa.a)(R,"AddAutoPolicyBusinessBarEntryEventArgs",
Sys.EventArgs,[]);var Na=Sys.EventArgs;Rk(ka,Na);Object(aa.a)(ka,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var eb;(function(hb){hb[hb.none=0]="none";hb[hb.reasonDefaultLabel=1]="reasonDefaultLabel";hb[hb.reasonManual=2]="reasonManual";hb[hb.reasonAutomatic=4]="reasonAutomatic";hb[hb.reasonRecommended=8]="reasonRecommended";hb[hb.reasonMandatory=16]="reasonMandatory"})(eb||(eb={}));Object(aa.b)("ApplyLabelFlags",eb);var cb=Sys.EventArgs;Rk(P,cb);Object(aa.a)(P,"AutoCLPSecurityNodesEventArgs",
Sys.EventArgs,[]);var Ua=Sys.EventArgs;Rk(Q,Ua);Object(aa.a)(Q,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);var pa=Sys.EventArgs;Rk(C,pa);Object(aa.a)(C,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);Object(aa.a)(M,"GetPolicyLabelsData",null,[]);var Qa=Sys.EventArgs;Rk(N,Qa);Object(aa.a)(N,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);var Db=Sys.EventArgs;Rk(K,Db);Object(aa.a)(K,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);var Kb=Sys.EventArgs;Rk(H,Kb);Object(aa.a)(H,"PolicyTipEventArgs",
Sys.EventArgs,[]);var Ab=Sys.EventArgs;Rk(J,Ab);Object(aa.a)(J,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);var ub=Sys.EventArgs;Rk(U,ub);Object(aa.a)(U,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Mb=Sys.EventArgs;Rk(O,Mb);Object(aa.a)(O,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);var Aa=Sys.EventArgs;Rk(T,Aa);Object(aa.a)(T,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);var Za=Sys.EventArgs;Rk(G,Za);Object(aa.a)(G,"SetPolicyLabelTriggeredEventArgs",
Sys.EventArgs,[]);var Zb=Sys.EventArgs;Rk(F,Zb);Object(aa.a)(F,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var jb=b(108),Vb=b(104),Ic=b(41),Rb=b(81),kc=b(39);Object(aa.a)(I,"ClientRequest",null,[]);var xb=b(496),Va=b(276);D.hpj=function(hb,Xb){if(!hb||!Xb||hb.count!==Xb.count)return!1;hb=bk(hb);for(var jc=hb.next();!jc.done;jc=hb.next())if(!Xb.contains(jc.value))return!1;return!0};D.toArray=function(hb){if(!hb)return null;var Xb=Array(hb.count),jc=0;hb=bk(hb);for(var Wc=hb.next();!Wc.done;Wc=
hb.next())Xb[jc]=Wc.value,jc++;return Xb};Object(aa.a)(D,"HashSetUtils",null,[]);var tb=b(293),fb=b(80),ac=b(190);x.prototype.Zme=function(hb){this.$a.addHandler("PolicyTipEvent",hb)};x.prototype.lZb=function(hb){this.$a.addHandler("LabelInfoUpdateEvent",hb)};x.prototype.Uaj=function(hb){this.$a.removeHandler("LabelInfoUpdateEvent",hb)};x.prototype.nne=function(hb){this.$a.addHandler("SetPolicyLabelEventKey",hb)};x.prototype.hcj=function(hb){this.$a.removeHandler("SetPolicyLabelEventKey",hb)};x.prototype.MUc=
function(hb){this.$a.addHandler("SetPolicyLabelFailureEventKey",hb)};x.prototype.gcj=function(hb){this.$a.removeHandler("SetPolicyLabelFailureEventKey",hb)};x.prototype.zEg=function(hb){this.$a.addHandler("GetPolicyLabelEventKey",hb)};x.prototype.yEg=function(hb){this.$a.addHandler("GetPolicyLabelFailureEventKey",hb)};x.prototype.wEg=function(hb){this.$a.addHandler("GetAutoPolicyLabelEventKey",hb);this.Kld&&(ba.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),
this.hFd(new Q(0)))};x.prototype.Aaj=function(hb){this.$a.removeHandler("GetAutoPolicyLabelEventKey",hb)};x.prototype.VDg=function(hb){this.$a.addHandler("CreateAutoCLPSecurityNodesEventKey",hb)};x.prototype.daj=function(hb){this.$a.removeHandler("CreateAutoCLPSecurityNodesEventKey",hb)};x.prototype.OGg=function(hb){this.$a.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",hb)};x.prototype.vcj=function(hb){this.$a.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",hb)};x.prototype.PGg=function(hb){this.$a.addHandler("UpdateAutoCLPSITNodesEventKey",
hb)};x.prototype.wcj=function(hb){this.$a.removeHandler("UpdateAutoCLPSITNodesEventKey",hb)};x.prototype.Jle=function(hb){this.$a.addHandler("AddAutoPolicyBusinessBarEntryEventKey",hb)};x.prototype.x$i=function(hb){this.$a.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",hb)};x.prototype.cne=function(hb){this.$a.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",hb)};x.prototype.Qbj=function(hb){this.$a.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",hb)};x.prototype.Kle=function(hb){this.$a.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",
hb)};x.prototype.z$i=function(hb){this.$a.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",hb)};x.prototype.dne=function(hb){this.$a.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",hb)};x.prototype.Rbj=function(hb){this.$a.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",hb)};x.prototype.gFg=function(hb){this.$a.addHandler("MandatoryLabellingAppHandlerEventKey",hb)};x.prototype.ebj=function(hb){this.$a.removeHandler("MandatoryLabellingAppHandlerEventKey",
hb)};x.prototype.LGg=function(hb){this.$a.addHandler("UDPLabelingAppHandlerEventKey",hb)};x.prototype.tcj=function(hb){this.$a.removeHandler("UDPLabelingAppHandlerEventKey",hb)};x.prototype.wWg=function(){return Ga.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsClpBlockedByAppSpecificScenarioEnabled",!1)?this.M7d?this.M7d():!1:!1};x.prototype.U6i=function(hb){this.uEc=hb};x.prototype.aw=function(){return(new Date).getTime()};x.prototype.Aac=function(){this.ph&&(this.bVb=
this.ph.sc("WebServiceCall","Call Get Policy Endpoint On Server"));var hb=tb.a.Qha(1,1);this.ib.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(hb=new I(this.R3a("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,hb),this.Og.send(hb).MGd(Object(oa.a)(this,this.Quf,"onDataLossPolicySuccessCallback"),Object(oa.a)(this,this.Puf,"onDataLossPolicyFailureCallback"))):this.Og.Yl(this.R3a("datalosspolicy"),1,null,null,!0,2,Object(oa.a)(this,
this.Quf,"onDataLossPolicySuccessCallback"),Object(oa.a)(this,this.Puf,"onDataLossPolicyFailureCallback"),null);this.rib++;ba.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.Ece,this.rib)};x.prototype.z6i=function(){this.Ocd(this.j8,2,this.Zoa)};x.prototype.Ocd=function(hb,Xb,jc,Wc){Xb=void 0===Xb?0:Xb;jc=void 0===jc?null:jc;Wc=void 0===Wc?!1:Wc;ob.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.Ycd(void 0,
Xb));this.Hvb=this.aw();var fd=this.R2c(Xb);this.zac(hb,fd,jc,Wc,Xb);this.mJd(!0)};x.prototype.Quf=function(hb){this.XFf();var Xb=this.rWd(hb);hb=Xb.data;Xb.returnValue&&(ba.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this.rib=0,this.ph&&(this.cVb=this.ph.sc("Task","Parse and Handle Get Policy Response")),this.$Vi(hb),this.cVb&&(this.cVb.stop(),this.cVb=null))};x.prototype.Puf=function(hb){this.XFf();this.rib<=this.eUb?this.Aac():(ba.ULS.sendTraceTag(25565154,
306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",hb?hb.data?hb.data.iQa:null:null),this.rib=0)};x.prototype.Mff=function(){return 0<this.bra};x.prototype.setPolicyLabel=function(hb){this.un.AppliedPolicyId=hb};x.prototype.jOd=function(hb,Xb,jc){jc=void 0===jc?null:jc;var Wc=this.y6g(jc);this.mrj(hb,Xb,Wc,jc)};x.prototype.EBf=function(hb){this.GEa&&(this.GEa.stop(),this.GEa=null);var Xb=this.d1e(hb);var jc=Xb.bWf;Xb=Xb.CZf;var Wc=hb.data.state,fd=Wc?Wc.oP:2,Tc=this.rWd(hb);
hb=Tc.data;Tc.returnValue?(ba.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",fd),this.bra=0,this.sWi(hb,jc,Xb,Wc)):this.OKd(fd)};x.prototype.z3i=function(hb){ob.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.Ycd(hb));this.IKb=this.aw();ba.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");this.$a.raiseEvent("SetPolicyLabelTriggeredEventKey",new G(hb))};x.prototype.vDi=function(){this.ufc&&this.supportsOfficeClientCoauthoring&&
this.tli&&this.BEa.zda(12,null,!0)};x.prototype.DBf=function(hb){this.GEa&&(this.GEa.stop(),this.GEa=null);var Xb=this.d1e(hb);var jc=Xb.bWf;Xb=Xb.CZf;this.bra<=this.eUb?this.jOd(jc,Xb):(jc=(jc=hb.data.state)?jc.oP:2,ba.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",hb?hb.data?hb.data.iQa:null:null,jc),this.kBb="WACServerConnectionFailed",this.bra=0,this.OKd(jc))};x.prototype.gli=function(hb){if(hb&&("LabelNotSupported"===hb||"LabelErrorRetryLater"===
hb||"CoherencyFailure"===hb||"LabelIdNotFound"===hb||"LabelDisabled"===hb))return ba.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",hb),!0;ba.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",hb);return!1};x.prototype.aUg=function(hb){if(!hb)return!1;for(var Xb=null,jc=null,Wc=bk(this.un.SensitivityLabels),fd=Wc.next();!fd.done;fd=Wc.next())fd=fd.value,fd.Id===hb&&(Xb=fd),fd.Id===this.j8&&(jc=fd);if(!Xb)return!1;if(this.ufc&&this.supportsOfficeClientCoauthoring){if(this.uEc&&
this.uEc()||this.Umd)return!0}else if(Ga.AFrameworkApplication.Py&&Ga.AFrameworkApplication.Py.vub||this.Zoa&&this.Zoa())return!0;return Xb.IsEndpointProtectionEnabled===(!!jc&&jc.IsEndpointProtectionEnabled)};x.prototype.zYb=function(hb,Xb,jc,Wc,fd){28===hb?this.zJf(new R(hb,Xb,jc,Wc,fd,!1)):this.zJf(new R(hb,Xb,jc,Wc,fd,!0))};x.prototype.bda=function(hb){28===hb?this.aKf(new J(hb,!1)):this.aKf(new J(hb,!0))};x.prototype.G2i=function(hb,Xb,jc){ba.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");
this.$a.raiseEvent("CreateAutoCLPSecurityNodesEventKey",new P(hb,Xb,jc))};x.prototype.E3i=function(hb){ba.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");this.$a.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new P(null,null,hb))};x.prototype.F3i=function(hb,Xb){ba.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.$a.raiseEvent("UpdateAutoCLPSITNodesEventKey",new P(hb,Xb,null))};x.prototype.QJf=function(hb,Xb){ba.ULS.sendTraceTag(572650527,
306,50,"Raising a mandatory labelling"+(1===Xb?"Reading":"Edit")+" switch event.");this.$a.raiseEvent("MandatoryLabellingAppHandlerEventKey",new K(hb,Xb))};x.prototype.ITc=function(hb,Xb,jc,Wc,fd){37===hb&&this.v2i(new ka(37,Xb,jc,Wc,fd))};x.prototype.IHd=function(){this.s3i(new U)};x.prototype.D3i=function(){ba.ULS.sendTraceTag(540608322,306,50,"Raising a UDP labeling event.");this.$a.raiseEvent("UDPLabelingAppHandlerEventKey",new F(!0))};x.prototype.Qga=function(hb){hb=void 0===hb?!1:hb;var Xb=
!!this.un&&this.un.AreLabelsAvailable&&!!this.un.SensitivityLabels&&0<this.un.SensitivityLabels.length&&Va.a.any(this.un.SensitivityLabels,function(jc){return!!jc&&jc.Enabled});Xb||hb||fa.YPa(!1);return Xb};x.prototype.Iwf=function(hb){this.oDa&&(this.oDa.stop(),this.oDa=null);this.mJd(!1);var Xb=this.rWd(hb);var jc=Xb.data;Xb.returnValue?(ba.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this.pib=0,jc=this.iWi(jc),hb=this.W_e(hb.data),ob.Health.instance.recordKpiSuccess("MipGetPolicyLabel",
this.H$b(void 0,hb,this.Hvb)),this.Hvb=null,hb=new Q(hb),this.U2i(hb),this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?jc&&this.jvj()?this.Kld?this.xPj():(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)||this.Rqb(),this.hFd(hb),this.PJc=!0):jc||this.xqc():!this.Kld&&jc&&this.ib.qa("WacApplyManualPolicyLabelIsEnabled")&&this.Gqe()?(this.hFd(hb),this.PJc=!0):jc||this.xqc()):this.xqc()};x.prototype.jvj=function(){if(!this.ib.qa("WacApplyManualPolicyLabelIsEnabled"))return ba.ULS.sendTraceTag(539877667,
306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.Gqe())return!1;if(""===this.j8)return ba.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),!0;if(this.kCa===this.cJc)return ba.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),!1;ba.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");
return!0};x.prototype.Rqb=function(){this.nbg();ba.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.EEa.count,this.kCa);var hb=D.toArray(this.EEa);this.G2i(hb,hb,this.kCa)};x.prototype.xPj=function(){var hb=this.EEa;this.nbg();D.hpj(hb,this.EEa)||(ba.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.EEa.count),hb=D.toArray(this.EEa),this.F3i(hb,hb));this.o8d&&(ba.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",
this.kCa),this.E3i(this.kCa))};x.prototype.nbg=function(){for(var hb=new ab.a(ya.a.Ik()),Xb=bk(this.un.SensitivityLabels),jc=Xb.next();!jc.done;jc=Xb.next())if((jc=jc.value)&&jc.AutoLabelingSensitiveTypeIds&&0<jc.AutoLabelingSensitiveTypeIds.length){jc=bk(jc.AutoLabelingSensitiveTypeIds);for(var Wc=jc.next();!Wc.done;Wc=jc.next())(Wc=Wc.value)&&hb.add(Wc)}this.EEa=hb};x.prototype.Hwf=function(hb){var Xb=this.W_e(hb.data);ob.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",
!1,!1,this.H$b(void 0,Xb,this.Hvb));this.Hvb=null;this.oDa&&(this.oDa.stop(),this.oDa=null);if(this.pib<=this.eUb){if(this.ib.qa("SendHostAttributionInfoForPolicyLabelEnabled")){var jc=hb.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in jc&&jc[tb.a.GLd]&&"HostAttributionInfo.ScenarioTypeParamName"in jc&&jc[tb.a.HLd]){hb.data.request.get_headers();hb.data.request.get_headers();hb=this.R2c(Xb);this.zac(this.j8,hb,this.Zoa,void 0,Xb);return}}this.Ocd(this.j8,Xb,this.Zoa)}else ba.ULS.sendTraceTag(34996494,
306,15,"Request to get label policy failed with error response: {0}.",hb?hb.data?hb.data.iQa:null:null),this.xqc(),this.pib=0,this.mJd(!1)};x.prototype.W_e=function(hb){return hb.state?hb.state:0};x.prototype.R3a=function(hb,Xb){Xb=void 0===Xb?!1:Xb;var jc=String.format("{0}{1}?action={2}&{3}",this.ib.Wa("PolicyHandlerWebServiceBase")||Ga.AFrameworkApplication.ta.Qa.IV,this.Ece,hb,Ga.AFrameworkApplication.Yi);"setpolicylabel"===hb&&Ga.AFrameworkApplication.Py&&Ga.AFrameworkApplication.Py.Zbf&&(jc=
Rb.a.wl(jc,"sl","1"));Xb&&(jc=Rb.a.wl(jc,"cbd","1"));return jc};x.prototype.d1e=function(hb){var Xb;var jc=Xb=null;hb&&hb.data&&hb.data.request&&hb.data.request.get_headers()&&(jc=hb.data.request.get_headers()[xb.a.cWf],Xb=hb.data.request.get_headers()[xb.a.DZf]);return{bWf:jc,CZf:Xb}};x.prototype.rWd=function(hb){hb=hb?hb.data?hb.data.Td:null:null;return hb&&hb.length&&!this.Uli(hb)?{returnValue:!0,data:hb}:(ba.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,
data:hb})};x.prototype.$Vi=function(hb){try{var Xb=Ic.b(hb)}catch(jc){ba.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(Xb)if(Xb.IsPolicyTipAvailable)switch(Xb.IsPolicyTipAvailable.toLowerCase()){case "false":ba.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");break;case "true":ba.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.CGc=Xb.NavigateUrl;this.fAj(Xb.GeneralText,
Object(oa.a)(this,this.mIi,"onDataLossPolicyOverrideButtonClick"));break;default:ba.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",Xb.IsPolicyTipAvailable)}else ba.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else ba.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")};x.prototype.sWi=function(hb,Xb,
jc,Wc){var fd=this,Tc=Wc?Wc.oP:2,td=0,Tb="",Fa;if(function(){var cc=Ic.d(hb);Fa=cc.Lt;return cc}().returnValue)if(Fa){Tb="Success";var Qb=this.R2c(3);if(Fa.IsSuccessful){ob.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.H$b(Tc,void 0,this.IKb));this.kBb=this.IKb=null;ba.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",Tc);2===Tc&&this.bda(29);this.jsj(Xb,Tc);this.vDi();this.bda(28);Wc&&4===Tc&&
this.zYb(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,Wc.displayName),CommonUIStrings.l_DialogOk,function(){});ib.a("MipAppliedLabels",void 0,void 0,[Object.assign(new fb.a,{name:"SetPolicyLabelApplyFlag",string:eb[Tc]})]);this.zac(Xb,Qb,this.Zoa,void 0,3);return}ba.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",
Tc,Fa.FailureReason);this.kBb=Fa.FailureReason;"FileTooLarge"===Fa.FailureReason?td=1:"LabelNotSupported"===Fa.FailureReason?td=2:"LabelDisabled"===Fa.FailureReason?td=3:"MinorVersionLimitExceeded"===Fa.FailureReason&&(td=5);this.Xli&&0<=Fa.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(Wc=new jb.a(2,1,this.nrj,function(){ba.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",fd.bra);fd.bra<=fd.eUb&&fd.jOd(Xb,
jc)}),this.ae.Dg(Wc));this.ufc&&this.supportsOfficeClientCoauthoring&&this.zac(this.un.AppliedPolicyId,Qb,this.Zoa,!0,3)}else Tb="setPolicyLabelData null.",ba.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",Tc);else Tb="TryDeserialize failed.",ba.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",Tc);this.OKd(Tc,td);Tc=this.H$b(Tc,void 0,this.IKb);this.IKb=
null;Tc.extendedProperties.set("SetPolicyLabelDataFailureReason",this.kBb);Tc.extendedProperties.set("SetPolicyLabelDataParseStatus",Tb.toString());ob.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,Tc)};x.prototype.OKd=function(hb,Xb){Xb=void 0===Xb?0:Xb;this.setPolicyLabel(this.j8);this.OJf(new N);this.rFd(Xb,hb,2===hb||8===hb||16===hb,!1)};x.prototype.jsj=function(hb,Xb){this.setPolicyLabel(this.j8=hb);if(""===hb)Ga.AFrameworkApplication.protectedFile=!1,Ga.AFrameworkApplication.enableMacrosForProtectedFile=
!1;else for(var jc=bk(this.un.SensitivityLabels),Wc=jc.next();!Wc.done;Wc=jc.next())if(Wc=Wc.value,Wc.Id===hb){Ga.AFrameworkApplication.protectedFile=Wc.IsEndpointProtectionEnabled;break}this.y3i(new O(hb,Xb))};x.prototype.qRj=function(){for(var hb=bk(this.un.SensitivityLabels),Xb=hb.next();!Xb.done;Xb=hb.next())(Xb=Xb.value)&&Xb.Enabled&&(Xb.Id===this.j8&&(this.o8d=this.kCa!==Xb.Order,this.kCa=Xb.Order),Xb.Order>this.cJc&&(this.cJc=Xb.Order))};x.prototype.iWi=function(hb){var Xb=Ic.d(hb);hb=Xb.Lt;
if(!Xb.returnValue)return ba.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!hb)return ba.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),!1;if(!hb.AreLabelsAvailable)return!1;this.un=hb;this.j8=hb.AppliedPolicyId;this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.qRj();this.Qga()&&ba.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");
this.OJf(new N(!0));return!0};x.prototype.Gqe=function(){if(!this.Qga())return ba.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(var hb=bk(this.un.SensitivityLabels),Xb=hb.next();!Xb.done;Xb=hb.next())if((Xb=Xb.value)&&Xb.AutoLabelingSensitiveTypeIds&&0<Xb.AutoLabelingSensitiveTypeIds.length)return!0;ba.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1};
x.prototype.OJf=function(hb){ba.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.$a.raiseEvent("LabelInfoUpdateEvent",hb)};x.prototype.U2i=function(hb){ba.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.$a.raiseEvent("GetPolicyLabelEventKey",hb)};x.prototype.xqc=function(){fa.YPa(!1);this.$a.raiseEvent("GetPolicyLabelFailureEventKey",new C)};x.prototype.hFd=function(hb){var Xb=this;this.OO&&this.OO.execute(function(jc){jc=[jc.isFeatureEnabled("MsoClpSpTwo",
!0),jc.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(jc).then(function(Wc){Va.a.any(Wc,function(fd){return fd})&&(ba.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),Xb.$a.raiseEvent("GetAutoPolicyLabelEventKey",hb),Xb.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&Xb.Rqb(),ib.a("MipAutoClassificationEnabled"));return null})})};x.prototype.Ycd=function(hb,Xb){hb=void 0===hb?null:hb;Xb=void 0===Xb?null:Xb;var jc=new Map;
jc.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=hb&&jc.set("ApplyLabelFlags",eb[hb]);null!=Xb&&jc.set("GetPolicyLabelsReason",ha[Xb]);return jc};x.prototype.H$b=function(hb,Xb,jc){hb=void 0===hb?null:hb;Xb=void 0===Xb?null:Xb;jc=void 0===jc?null:jc;var Wc=new ac.a;Wc.extendedProperties=this.Ycd(hb,Xb);null!=jc&&(Wc.durationMs=this.aw()-jc);return Wc};x.prototype.y3i=function(hb){ba.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.$a.raiseEvent("SetPolicyLabelEventKey",
hb)};x.prototype.zJf=function(hb){ba.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");hb&&hb.Jzb&&ib.a("MipRecommendations");this.$a.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",hb)};x.prototype.aKf=function(hb){ba.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.$a.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",hb)};x.prototype.v2i=function(hb){ba.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");
this.$a.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",hb)};x.prototype.s3i=function(hb){ba.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");this.$a.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",hb)};x.prototype.fAj=function(hb,Xb){Xb=void 0===Xb?null:Xb;ba.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.$a.raiseEvent("PolicyTipEvent",new H(CommonUIStrings.l_PolicyBusinessBarTitle,hb,CommonUIStrings.l_PolicyOverrideButton,
Xb))};x.prototype.rFd=function(hb,Xb,jc,Wc){var fd=this;ba.ULS.sendTraceTag(42074656,306,void 0===Wc||Wc?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",Xb);if(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)){Wc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;var Tc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,td=null,Tb=null;switch(hb){case 1:Wc=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;
Tc=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 2:Wc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;Tc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 3:Wc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;Tc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;break;case 4:Wc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;
Tc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;break;case 5:Wc=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,Tc=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,td=CommonUIStrings.l_LearnMore,Tb=function(){fd.EZf()}}hb=new T(hb,Xb,jc,Wc,Tc,td,Tb)}else hb=5===hb?new T(hb,Xb,jc,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,
CommonUIStrings.l_LearnMore,function(){fd.EZf()}):new T(hb,Xb,jc);this.$a.raiseEvent("SetPolicyLabelFailureEventKey",hb)};x.prototype.Bqj=function(hb){this.$Lc=hb};x.prototype.mIi=function(){this.CGc?(ba.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),kc.a.PU(this.CGc)):ba.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")};x.prototype.Uli=function(hb){if(!hb.startsWith("<")||-1===hb.indexOf("Error")&&-1===hb.indexOf("Unavailable"))return!1;
ba.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");return!0};x.prototype.XFf=function(){this.bVb&&(this.bVb.stop(),this.bVb=null)};x.prototype.FGh=function(hb){if(!hb)return"manual";switch(hb.oP){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";default:return"manual"}};
x.prototype.SHh=function(hb){if(!hb)return"privileged";hb=hb.oP;var Xb="privileged";if(4===hb||1===hb)Xb="standard";return Xb};x.prototype.zac=function(hb,Xb,jc,Wc,fd){jc=void 0===jc?null:jc;Wc=void 0===Wc?!1:Wc;fd=void 0===fd?0:fd;this.ib.qa("WacLabelingGetPolicyLabelsIsEnabled")&&(this.j8=hb,this.Zoa=jc,this.ph&&(this.oDa=this.ph.sc("WebServiceCall","Call Get Policy Endpoint On Server")),jc={},jc[xb.a.QJg]=hb,this.ib.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(hb=new I(this.R3a("getpolicylabels",
Wc),1,null,jc,!0,2,fd,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Xb),this.Og.send(hb).MGd(Object(oa.a)(this,this.Iwf,"onGetPolicyLabelsSuccessCallback"),Object(oa.a)(this,this.Hwf,"onGetPolicyLabelsFailureCallback"))):this.Og.Yl(this.R3a("getpolicylabels",Wc),1,null,jc,!0,2,Object(oa.a)(this,this.Iwf,"onGetPolicyLabelsSuccessCallback"),Object(oa.a)(this,this.Hwf,"onGetPolicyLabelsFailureCallback"),fd,void 0,void 0,void 0,void 0,"22"),this.pib++,ba.ULS.sendTraceTag(34996492,
306,50,"Policy label request sent to server. Policy call times: {0}",this.pib))};x.prototype.mrj=function(hb,Xb,jc,Wc){Wc=void 0===Wc?null:Wc;if(this.jyb){this.ph&&(this.GEa=this.ph.sc("WebServiceCall","Call Set Policy Endpoint On Server"));var fd={};fd[xb.a.cWf]=hb;Xb&&(fd[xb.a.DZf]=encodeURIComponent(Xb));this.$Lc&&(fd[xb.a.hJg]=this.$Lc);Wc?(fd[xb.a.AZf]=this.FGh(Wc),fd[xb.a.BZf]=this.SHh(Wc)):(fd[xb.a.AZf]="manual",fd[xb.a.BZf]="privileged");this.supportsOfficeClientCoauthoring&&this.un&&(fd[xb.a.bYi]=
this.un.PolicyLabelVersionToken);this.ib.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(hb=new I(this.R3a("setpolicylabel",!0),1,null,fd,!0,2,Wc,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,jc),this.Og.send(hb).MGd(Object(oa.a)(this,this.EBf,"onSetPolicyLabelSuccessCallback"),Object(oa.a)(this,this.DBf,"onSetPolicyLabelFailureCallback"))):this.Og.Yl(this.R3a("setpolicylabel",!0),1,null,fd,!0,2,Object(oa.a)(this,this.EBf,"onSetPolicyLabelSuccessCallback"),
Object(oa.a)(this,this.DBf,"onSetPolicyLabelFailureCallback"),Wc,void 0,void 0,void 0,void 0,"32");this.bra++;ba.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.bra)}else ba.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")};x.prototype.EZf=function(){var hb=new kb.StandardDialog,Xb=this.ib.Wa("BreadcrumbFolderUrl");Xb?(hb.Rb=11,hb.mc(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),
hb.mc(2,CommonUIStrings.l_DialogOk)):(hb.Rb=0,hb.mc(1,CommonUIStrings.l_DialogOk));hb.Cke(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");hb.H9i();hb.XW(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,function(jc){1===jc&&Xb&&kc.a.Ze(Xb,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})};
x.prototype.R2c=function(hb){switch(hb){case 1:return tb.a.Qha(1,1);case 2:return tb.a.Qha(7,1);case 3:return tb.a.Qha(8,1);default:return tb.a.Qha(7,0)}};x.prototype.y6g=function(hb){hb=void 0===hb?null:hb;if(!hb)return tb.a.Qha(8,0);switch(hb.oP){case 1:case 16:return tb.a.Qha(1,1);case 4:case 2:case 8:return tb.a.Qha(8,1);default:return tb.a.Qha(8,0)}};x.prototype.mJd=function(hb){this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)&&appChrome.api.setAsyncRequestStatus("sensitivity",
hb)};Mf.Object.defineProperties(x.prototype,{Kld:{configurable:!0,enumerable:!0,get:function(){return this.PJc}},Umd:{configurable:!0,enumerable:!0,get:function(){if(!this.z4d)return!1;for(var hb=bk(this.z4d.RZj()),Xb=hb.next();!Xb.done;Xb=hb.next())if(Xb=Xb.value,!Xb.Capabilities||!Xb.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}},tli:{configurable:!0,enumerable:!0,get:function(){return!!this.BEa}}});Object(aa.a)(x,"PolicyManager",null,[947]);var Ac=b(142),Rc=b(254);z.prototype.init=
function(){var hb=this;Ga.AFrameworkApplication.fa.qa("ShouldInitCommonPolicyPackage")&&(Ga.AFrameworkApplication.fa.qa("IsDataLossPreventionEnabledForUser")&&Ga.AFrameworkApplication.ta&&(this.Hg=this.fb.resolve("Common.App.Policy.Contracts.IPolicyManager"),this.Hg.Zme(Object(oa.a)(this,this.oRd,"showPolicyBusinessBar")),ba.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),Ac.a.get_instance().ak(6,function(){hb.Hg.Aac()})),Ga.AFrameworkApplication.fa.qa("WacLabelingPoliciesIsEnabled")&&
Ga.AFrameworkApplication.fa.qa("SupportsPolicies")?Ac.a.get_instance().ak(6,Object(oa.a)(this,this.zFi,"onAfterRibbonBehaviorAttached")):fa.YPa(!1))};z.prototype.dispose=function(){};z.prototype.Ph=function(hb){hb.register(947,"Common.App.Policy.Contracts.IPolicyManager").tc().Cc(function(){return new x(Ga.AFrameworkApplication.fa,Ga.AFrameworkApplication.qd,Ga.AFrameworkApplication.ta.pD,Ga.AFrameworkApplication.fa.kd("MaxGetPolicyRetries",1),hb.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),
Ga.AFrameworkApplication.ta.Qa.Cj)});hb.register(fa,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").tc().Cc(function(){return new fa(Ga.AFrameworkApplication.ub,Ga.AFrameworkApplication.ta,Ga.AFrameworkApplication.fa,hb.tKd("Common.App.Policy.Contracts.IPolicyManager"))});this.fb=hb};z.prototype.zFi=function(){this.f1=this.fb.mh("CommonUI.BusinessBar");this.Hg||(this.Hg=this.fb.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.Iqa=this.fb.resolve("Common.App.Policy.PolicyActor");
Ga.AFrameworkApplication.fa&&Ga.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Fb.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?this.Hg.lZb(Object(oa.a)(this.Iqa,this.Iqa.QMf,"registerActionsHandler")):this.Iqa.Bg();this.Hg.lZb(Object(oa.a)(this,this.CXd,"updateLabelInfo"));Ga.AFrameworkApplication.fa.qa("WacApplyManualPolicyLabelIsEnabled")&&(this.Hg.MUc(Object(oa.a)(this,
this.t3h,"handleSetPolicyLabelFailure")),this.Hg.Jle(Object(oa.a)(this,this.zYb,"addAutoPolicyBusinessBarEntry")),this.Hg.cne(Object(oa.a)(this,this.bda,"removeAutoPolicyBusinessBarEntry")),this.Hg.Kle(Object(oa.a)(this,this.ITc,"addMandatoryLabellingBusinessBarEntry")),this.Hg.dne(Object(oa.a)(this,this.IHd,"removeMandatoryLabellingBusinessBarEntry")))};z.prototype.CXd=function(){this.Iqa.vZf();this.Iqa.PYf();this.Iqa.cJf();var hb=this.Hg.wWg();Ga.AFrameworkApplication.fa.qa("HasDocumentEditRights")&&
!hb?this.Iqa.M9f():ba.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",Ga.AFrameworkApplication.fa.qa("HasDocumentEditRights"),hb);Ga.AFrameworkApplication.ta.updateCommandUI()};z.prototype.oRd=function(hb,Xb){this.U_e(Xb.title,Xb.vpc,38,Xb.utf,Xb.buttonText);ba.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")};z.prototype.t3h=
function(hb,Xb){if(Xb.I2f){hb=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;var jc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,Wc=null,fd=null;Ga.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)?(hb=Xb.title,jc=Xb.message,Wc=Xb.buttonText,fd=Xb.qY):1===Xb.errorType?(hb=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle,jc=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage):
2===Xb.errorType?(hb=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle,jc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage):Ga.AFrameworkApplication.fa.qa("ClpLabelDisabledErrorCodeIsEnabled")&&3===Xb.errorType?(hb=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle,jc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage):4===Xb.errorType?(hb=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle,
jc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage):5===Xb.errorType&&(hb=Xb.title,jc=Xb.message,Wc=Xb.buttonText,fd=Xb.qY);this.U_e(hb,jc,21,null,null,fd,Wc);ba.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user.")}};z.prototype.bda=function(){};z.prototype.zYb=function(hb,Xb){this.f1&&(this.Hg.bda(Xb.Xob),hb=new ra.a(Xb.title,Xb.message,null),hb.id=Xb.Xob,hb.closeable=!0,hb.image=3,hb.addButton(Xb.buttonText,Xb.qY,
Xb.buttonText,!0),this.f1.OD(hb,!1))};z.prototype.ITc=function(hb,Xb){this.f1&&(hb=new ra.a(Xb.title,Xb.message,null),hb.id=Xb.Xob,hb.closeable=!1,hb.image=3,hb.addButton(Xb.buttonText,Xb.qY,Xb.buttonText,!1),this.f1.OD(hb,!1))};z.prototype.IHd=function(){};z.prototype.U_e=function(hb,Xb,jc,Wc,fd,Tc,td){Wc=void 0===Wc?null:Wc;fd=void 0===fd?null:fd;Tc=void 0===Tc?null:Tc;td=void 0===td?null:td;hb=new ra.a(hb,Xb,null);hb.id=jc;hb.closeable=!0;Wc&&hb.$Ag(fd,Wc);Tc&&hb.addButton(td,Tc,td)};z.main=function(){Rc.a.instance.Qi(new z)};
Mf.Object.defineProperties(z.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.Policy"}}});Object(aa.a)(z,"PackageManager",null,[10,11]);var Fc=b(10),wb=b(615),uc=b(232),Pb=b(51),sc=b(37),nb=b(85),pc=b(38),Dc=b(327),oc=b(388),Gc=b(177),ld=b(91),gd=b(31),Cc=b(295),kd=b(1),Fd=b(22),rb=b(294);Object(aa.a)(A,"ApplyPolicyContextParameters",null,[]);var Kd=b(7),Qd=b(904),ve=b(626),Be=b(47),Ie=b(44);Object(aa.a)(B,"AnnotationActivationOptions",null,[]);var se=b(62),Se=b(935),
Le=b(909),rf=Se.a;Rk(y,rf);y.getTypeName=function(){return"AugLoop_SecurityClp_LabellingAnnotation"};y.Nd=function(){return["AugLoop_Core_Annotation"]};Object(aa.a)(y,"LabellingAnnotation",Se.a,[]);var af=b(930),xe=af.a;Rk(r,xe);r.getTypeName=function(){return"AugLoop_SecurityShared_SecurityShared"};r.Nd=function(){return[]};Object(aa.a)(r,"SecurityShared",af.a,[]);Rk(v,r);v.getTypeName=function(){return"AugLoop_SecurityShared_CLP"};v.Nd=function(){return["AugLoop_SecurityShared_SecurityShared"]};
Object(aa.a)(v,"CLP",r,[]);var Td=Se.a;Rk(f,Td);f.getTypeName=function(){return"AugLoop_Automatic_Clp_LabellingAnnotation"};f.Nd=function(){return["AugLoop_Core_Annotation"]};Object(aa.a)(f,"LabellingAnnotation",Se.a,[]);var Bc=b(1175),qd=b(1077),Jd=b(1177),ad=Se.a;Rk(n,ad);n.getTypeName=function(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"};n.Nd=function(){return["AugLoop_Core_Annotation"]};Object(aa.a)(n,"LinkedDataTypeAnnotation",Se.a,[]);var Yd=pc.a;Rk(l,Yd);l.prototype.dispose=function(){this.disposed||
(this.disposed=!0,this.cdh(),this.hGe(),this.JCd=this.policyManager=this.augmentationLoopManager=null,Yd.prototype.dispose.call(this))};l.prototype.TYa=function(hb,Xb,jc,Wc,fd){fd=void 0===fd?!1:fd;ba.ULS.sendTraceTag(537154642,306,50,"AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource {0} with AutoLabelPresent: {1}, RecommendedLabelPresent: {2}, isStandard: {3}.",Wc,!!hb,!!Xb,fd);this.dc?this.JCd&&(this.bUg(Xb,Wc)?(this.bEd=Xb,this.XDd=Wc,this.Bif.ia(Wc,Xb)):Xb=this.bEd,hb=this.JCd.TYa(hb,
Xb,jc,fd),ba.ULS.sendTraceTag(537154640,306,50,"AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned {0}.",hb)):ba.ULS.sendTraceTag(537154641,306,15,"AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.ea.dc)};l.prototype.bUg=function(hb,Xb){if(!this.policyManager.Qga())return ba.ULS.sendTraceTag(537154639,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),!1;var jc=this.policyManager.un;
var Wc=this.Bif.yc(this.XDd).value;var fd=null,Tc=null,td=null;jc=bk(jc.SensitivityLabels);for(var Tb=jc.next();!Tb.done;Tb=jc.next())Tb=Tb.value,Tb.Id===hb&&(fd=Tb),Tb.Id===Wc&&(Tc=Tb),Tb.Id===this.bEd&&(td=Tb);return Tc&&Tc.Id===hb?(ba.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.businessBar.cC(40)&&this.XDd!==Xb&&td&&(!fd||td.Order>=fd.Order)?(ba.ULS.sendTraceTag(537154637,
306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),!1):!0};l.prototype.Gld=function(){return kd.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)};l.prototype.W6i=function(){this.policyManager.Jle(this.U1f);this.policyManager.cne(this.LNf);this.$.ea.o2(this.Z5);this.Gld()&&(this.policyManager.VDg(this.Rqb),this.policyManager.OGg(this.lbg),this.policyManager.PGg(this.mbg))};
l.prototype.cdh=function(){this.businessBar.removeEntry(40);this.businessBar.removeEntry(39);this.policyManager.x$i(this.U1f);this.policyManager.Qbj(this.LNf);this.$.ea.b0(this.Z5);kd.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&(this.policyManager.daj(this.Rqb),this.policyManager.vcj(this.lbg),this.policyManager.wcj(this.mbg))};l.prototype.r8h=function(){this.uA=new Qd.a(ve.a.RJ());var hb=this.Gld()?y.getTypeName():f.getTypeName();this.uA.add(1,Object(Kd.a)(new B,
{annotationType:hb,YFa:this.Opi,$E:!1,sLa:!1}));this.uA.add(2,Object(Kd.a)(new B,{annotationType:n.getTypeName(),YFa:this.Nri,$E:!1,sLa:!1}))};l.prototype.n6f=function(){for(var hb=bk(this.S9a),Xb=hb.next();!Xb.done;Xb=hb.next())this.augmentationLoopManager.submitOperation(Xb.value);this.S9a=[]};l.prototype.R6i=function(hb){if(!this.uA.kb(hb))return ba.ULS.sendTraceTag(537154636,306,15,"AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource {0}.",hb),
!1;if(this.uA.na(hb).$E)return ba.ULS.sendTraceTag(537154635,306,15,"AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource {0}.",hb),!0;this.uA.na(hb).$E=!0;ba.ULS.sendTraceTag(537154634,306,50,"AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource {0}.",hb);if(!this.$.isEditMode)return ba.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;kd.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",
!1)?this.Kxb():this.S8e();return!0};l.prototype.S8e=function(){for(var hb=this,Xb=!1,jc=bk(this.uA),Wc=jc.next();!Wc.done&&!(Xb=Wc.value.value.$E||Xb);Wc=jc.next());Xb?this.augmentationLoopManager?(ba.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),this.ZXb()):this.nZa?ba.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):
(this.nZa=!0,Xb=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,ba.ULS.sendTraceTag(537154629,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in {0} milliseconds.",Xb),Be.a.instance.create(function(){hb.t8h()},Xb,Ie.a.bse,!0,!0)):ba.ULS.sendTraceTag(537154632,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")};l.prototype.Kxb=function(){var hb=this,Xb=0<this.S9a.length;if(!Xb)for(var jc=
bk(this.uA),Wc=jc.next();!Wc.done&&!(Xb=Wc.value.value.$E||Xb);Wc=jc.next());Xb?this.augmentationLoopManager?(ba.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.ZXb(),this.n6f()):this.nZa?ba.ULS.sendTraceTag(537154626,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):(this.nZa=!0,Xb=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,ba.ULS.sendTraceTag(537154625,
306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in {0} milliseconds.",Xb),Be.a.instance.create(function(){hb.u8h()},Xb,Ie.a.bse,!0,!0)):ba.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")};l.prototype.u8h=function(){var hb=this;sc.TaskExtensions.Aa(Pb.GetServiceTaskFactory.Ra(this.$.da,328,327,1),function(Xb){hb.augmentationLoopManager=Xb.result;hb.nZa=!1;hb.augmentationLoopManager?
(ba.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),hb.augmentationLoopManager.BYb(hb.V8a),hb.$.isEditMode?(hb.ZXb(),hb.n6f()):ba.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):ba.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.la,3)};l.prototype.t8h=function(){var hb=this;
sc.TaskExtensions.Aa(Pb.GetServiceTaskFactory.Ra(this.$.da,328,327,1),function(Xb){hb.augmentationLoopManager=Xb.result;hb.nZa=!1;hb.augmentationLoopManager?(ba.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),hb.augmentationLoopManager.BYb(hb.V8a),hb.$.isEditMode?hb.ZXb():ba.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):ba.ULS.sendTraceTag(537154593,306,
10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.la,3)};l.prototype.hGe=function(){for(var hb=bk(this.uA),Xb=hb.next();!Xb.done;Xb=hb.next())Xb=Xb.value,Xb.value.$E&&this.bdh(Xb.key)};l.prototype.bdh=function(hb){this.uA.na(hb).sLa&&this.hFe(hb);this.uA.na(hb).$E=!1;ba.ULS.sendTraceTag(537154591,306,50,"AutoPolicyManager::DeregisterAnnotation completed for LabellingSource {0}.",hb)};l.prototype.ZXb=function(){for(var hb=bk(this.uA),Xb=hb.next();!Xb.done;Xb=
hb.next())Xb=Xb.value,Xb.value.$E&&!Xb.value.sLa&&this.activateAnnotation(Xb.key)};l.prototype.activateAnnotation=function(hb){this.augmentationLoopManager.activateAnnotation(this.uA.na(hb).annotationType);this.augmentationLoopManager.dJ(this.uA.na(hb).annotationType,this.uA.na(hb).YFa);this.uA.na(hb).sLa=!0;ba.ULS.sendTraceTag(537154590,306,50,"AutoPolicyManager::ActivateAnnotation completed for LabellingSource {0}.",hb)};l.prototype.sbh=function(){for(var hb=bk(this.uA),Xb=hb.next();!Xb.done;Xb=
hb.next())Xb=Xb.value,Xb.value.sLa&&this.hFe(Xb.key)};l.prototype.hFe=function(hb){this.augmentationLoopManager.Cma(this.uA.na(hb).annotationType,this.uA.na(hb).YFa);this.uA.na(hb).sLa=!1;ba.ULS.sendTraceTag(537154589,306,50,"AutoPolicyManager::DeactivateAnnotation completed for LabellingSource {0}.",hb)};l.prototype.applyPolicyLabel=function(hb,Xb,jc,Wc){var fd=this;if(this.fa.qa("SupportsOfficeClientCoauthoring"))ba.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),
this.TYa(hb,Xb,jc,Wc);else{ba.ULS.sendTraceTag(537154578,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");var Tc=function(td){fd.TYa(hb,Xb,jc,Wc,0===td||1===td||4===td)};this.Ted(Tc,function(){Tc(2)},this.Znf)}};l.prototype.LWc=function(hb,Xb){var jc=this.x$f(hb);hb=jc.sensitivityLabel;var Wc=jc.aGa;if(!jc.returnValue)return ba.ULS.sendTraceTag(537154577,306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(Wc&&Wc.Order>=
hb.Order)return ba.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1;this.applyPolicyLabel(hb.Id,hb.Id,null,Xb);return!0};l.prototype.MWc=function(hb,Xb){var jc=this;Xb=!1;var Wc=null,fd=null;if(!function(){var Tb=jc.x$f(hb);Wc=Tb.sensitivityLabel;fd=Tb.aGa;return Tb}().returnValue)return ba.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),{returnValue:!1,N5a:Xb};if(fd&&
fd.ParentId&&Wc.ParentId&&fd.ParentId===Wc.ParentId)return ba.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,N5a:Xb};if(fd&&fd.Order>=Wc.Order)return ba.ULS.sendTraceTag(537154573,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,N5a:Xb};if(this.fa.qa("SupportsOfficeClientCoauthoring")){ba.ULS.sendTraceTag(537154572,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled.");var Tc=this.policyManager.un;Tc=!Tc.AppliedPolicyId||!Tc.PolicyLabelAssignmentMethod||Wa.e(Tc.PolicyLabelAssignmentMethod)===Wa.e("standard");this.Aqe(Wc.Id,Tc)}else{ba.ULS.sendTraceTag(537154571,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");var td=function(Tb){jc.Aqe(Wc.Id,0===Tb||1===Tb||4===Tb)};this.Ted(td,function(){td(2)},
this.Znf)}return{returnValue:!0,N5a:Xb}};l.prototype.Ted=function(hb,Xb,jc,Wc){var fd=this;Wc=void 0===Wc?0:Wc;if(this.dc){var Tc=this.$.oa.xa.Pb();m(this.$.oa.xa,this.$.ya.DocumentHostInfo.TenantId,function(td){fd.vTh(td,hb)},function(){fd.uTh(hb,Xb,jc,Wc)},null,null,Tc)}else ba.ULS.sendTraceTag(537154570,306,15,"AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.ea.dc)};l.prototype.vTh=function(hb,Xb){ba.ULS.sendTraceTag(537154569,
306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.dc?!hb||Cc.a(hb)?ba.ULS.sendTraceTag(537154567,306,15,hb?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):Xb(hb.Result):ba.ULS.sendTraceTag(537154568,306,50,"AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.ea.dc)};l.prototype.uTh=
function(hb,Xb,jc,Wc){ba.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");this.dc?Wc>=jc?(ba.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),Xb()):this.Ted(hb,Xb,jc,Wc+1):ba.ULS.sendTraceTag(537154565,306,50,"AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.ea.dc)};l.prototype.Aqe=
function(hb,Xb){Xb?this.TYa(hb,null,null,3,!0):this.TYa(null,hb,null,3,!1)};l.prototype.x$f=function(hb){var Xb;var jc=Xb=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:Xb,aGa:jc};if(!this.policyManager.Qga())return ba.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:Xb,aGa:jc};var Wc=this.policyManager.un;if(!Wc)return ba.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),
{returnValue:!1,sensitivityLabel:Xb,aGa:jc};if(Va.a.fh(Wc.SensitivityLabels))return ba.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),{returnValue:!1,sensitivityLabel:Xb,aGa:jc};var fd=Wc.AppliedPolicyId;hb=bk(hb);for(var Tc=hb.next();!Tc.done;Tc=hb.next()){Tc=Tc.value;for(var td=bk(Wc.SensitivityLabels),Tb=td.next();!Tb.done;Tb=td.next())Tb=Tb.value,Tb.Id===Tc&&(!Xb||Xb.Order<Tb.Order)&&(Xb=Tb),Tb.Id===
fd&&(jc=Tb)}return Xb?{returnValue:!0,sensitivityLabel:Xb,aGa:jc}:(ba.ULS.sendTraceTag(537154526,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),{returnValue:!1,sensitivityLabel:Xb,aGa:jc})};Mf.Object.defineProperties(l.prototype,{dc:{configurable:!0,enumerable:!0,get:function(){return!this.disposed&&this.$.ea.dc}}});Object(aa.a)(l,"AutoPolicyManager",pc.a,[3]);var pe=b(160),Wd=b(12),bf=b(15),ke=pe.ErrorDialog;Rk(k,ke);k.prototype.pn=function(){var hb=this;ke.prototype.pn.call(this);
if(this.error.Appearance&1&&this.$.Cd&2){var Xb=this.getButton(0);Wd.DOMElementExtensions.yNd(Xb.get_element(),bf.a.instance.ga(1296));this.jP(function(){0===hb.returnValue&&hb.$.Cd&2&&(ba.ULS.sendTraceTag(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),sc.TaskExtensions.Aa(Pb.GetServiceTaskFactory.Ra(hb.$.da,55,56,0),function(jc){jc.result.G1c()},hb.$.la,3))})}};k.tQ=function(hb){return hb.Cd&2?gd.a.Xc(3,1,0,1945,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):
gd.a.Xc(1,1,0,1946,0,-313914360,"SensitivityLabelBlockApplyLabel")};Object(aa.a)(k,"BlockSenitivityLabelActionDialog",pe.ErrorDialog,[]);var cf=pc.a;Rk(e,cf);e.prototype.initialize=function(){var hb=this;this.fa.qa("SupportsPolicies")?(this.JDa=this.fa.Wa("AppliedPolicyId"),this.z6.Bg(),this.$.da.Za(29,function(Xb){hb.statusBarManager=Xb;Xb.gJ(hb)}),this.qz(),Fd.a.fh(this.fa.Wa("HostUserId"))||this.cYi(),this.z6.Y6i(this.aOg),this.z6.O7i(this.pdi),this.lr.U6i(this.Umd),this.fo=kd.EwaSettings.getBooleanFeatureGate(Dc.a.kPa,
!1)):kd.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Fb.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!0));!Fd.a.fh(this.fa.Wa("HostUserId"))&&kd.EwaSettings.ma(170)&&this.$.ea.Jg.get(45)&&(ba.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.BMh())};e.prototype.gq=function(hb){this.addHandler("LabelInfoChangedKey",hb)};e.prototype.Eq=function(hb){this.removeHandler("LabelInfoChangedKey",
hb)};e.prototype.an=function(){return!0};e.prototype.Ir=function(hb,Xb){if("QueryPolicyLabel"!==hb)return!1;if(this.Bna())return Xb.Visible=!1,!0;Xb.Visible=!0;return 32===Ga.AFrameworkApplication.ub.$d(Ob.a.aab,2,Xb)};e.prototype.dispose=function(){this.statusBarManager&&(this.statusBarManager.wF(this),this.statusBarManager=null);this.z6.MNb();this.JXc=!1;this.lr.gcj(this.i3f);this.lr.hcj(this.CBf);this.$.ea.Bw(this.Hja);if(this.fa.qa("SupportsOfficeClientCoauthoring")){var hb=this.$.da.za(292);
hb&&hb.Vaj(this.Pxf)}this.lr.z$i(this.Jke);this.lr.Rbj(this.iOf);this.lr.ebj(this.Mnf);this.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",!1)&&this.lr.tcj(this.Y$f);kd.EwaSettings.ma(292)&&this.lr.Aaj(this.RJe);this.Z9&&(this.Z9.dispose(),this.Z9=null);cf.prototype.dispose.call(this)};e.prototype.LWc=function(hb,Xb){if(!this.fa.qa("SupportsPolicies"))return ba.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),
!1;if(!this.KCd)return ba.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(Va.a.fh(hb))return!1;this.Z9||this.mkd();return this.Z9.LWc(hb,Xb)};e.prototype.qz=function(){this.raiseEvent("LabelInfoChangedKey")};e.prototype.BMh=function(){var hb=this;kd.EwaSettings.isChangeGateEnabled("OfficeVSO:6000793_RibbonDisplayedDependencyInDataLossPolicyCall")?Ac.a.get_instance().ak(10,function(){hb.lr.Aac()}):this.lr.Aac()};e.prototype.cYi=function(){var hb=
this;Ac.a.get_instance().ak(10,function(){hb.lr.lZb(hb.CXd);hb.lr.zEg(hb.Gwf);hb.lr.yEg(hb.Gwf);hb.lr.MUc(hb.i3f);hb.lr.nne(hb.CBf);hb.$.ea.zu(hb.Hja);hb.lr.Kle(hb.Jke);hb.lr.dne(hb.iOf);hb.lr.gFg(hb.Mnf);hb.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",!1)&&hb.lr.LGg(hb.Y$f);if(hb.fa.qa("SupportsOfficeClientCoauthoring")){var Xb=hb.$.da.za(292);Xb&&Xb.YEg(hb.Pxf)}kd.EwaSettings.ma(292)&&(ba.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler"),
hb.lr.wEg(hb.RJe));hb.iyh()});this.$.tcb("sensitivity",!0)};e.prototype.iyh=function(){this.fa.qa("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.r3a():this.JHh(this.$.ya.DocumentHostInfo.TenantId)};e.prototype.mkd=function(){this.Z9=new l(this.z6,this.lr,this.$,this.fa,this.aE)};e.prototype.SMf=function(hb){if(!this.fa.qa("SupportsPolicies"))return ba.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),
!1;this.Z9||this.mkd();return this.Z9.R6i(hb)};e.prototype.MWc=function(hb,Xb){if(!this.fa.qa("SupportsPolicies"))return ba.ULS.sendTraceTag(537154517,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,N5a:!1};if(!this.KCd)return ba.ULS.sendTraceTag(537154516,306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),{returnValue:!1,N5a:!0};this.Z9||this.mkd();return this.Z9.MWc(hb,Xb)};e.prototype.JHh=
function(hb){var Xb=this;ba.ULS.sendTraceTag(537154514,306,50,"PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length {0}",hb.length);var jc=this.$.oa.xa.Pb();w(this.$.oa.xa,hb,function(Wc){Xb.GFj(Wc)},null,null,null,jc)};e.prototype.GFj=function(hb){ba.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");hb&&!Cc.a(hb)&&(this.JDa=hb.Result);this.r3a();this.labelId?ba.ULS.sendTraceTag(537154512,306,50,"PolicyManagerWrapper: Fetched LabelId length from custom.xml is {0}",
this.labelId.length):ba.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")};e.prototype.r3a=function(){this.lr.Ocd(this.labelId,void 0,void 0,!1)};e.prototype.oQe=function(){if(!this.JXc){this.$.hf();this.JXc=!0;this.aE.J4e();var hb={};hb.hasLabel=!!this.labelId&&0<this.labelId.length;hb.isProtectedFile=this.fa.qa("ProtectedFile");hb.SupportsPolicies=this.fa.qa("SupportsPolicies");hb.AreLabelsAvailableForDisplay=this.lr.Qga();hb.SupportsOfficeClientCoauthoring=this.fa.qa("SupportsOfficeClientCoauthoring");
hb.IsAnonymousUser=this.fa.qa("IsAnonymousUser");ba.ULS.sendTraceTag(51238051,306,50,"CLPUsage : {0}",JSON.stringify(hb))}};e.prototype.aKg=function(){this.z6.bKg(this.Gxa);this.Gxa=null};e.prototype.R4h=function(hb){hb=bk(hb.LabelActions);for(var Xb=hb.next();!Xb.done;Xb=hb.next())if(Fd.a.equals(Xb.value.Name,"ApplyWatermark",!1))return!0;return!1};e.prototype.nyj=function(hb){hb?(new k(this.$)).gf():ba.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")};
e.prototype.applyPolicyLabel=function(hb,Xb,jc,Wc){var fd=this,Tc=Ic.c(this.lr.un);if(void 0===hb||null===hb)hb="";var td=new A;td.upc=hb;td.SWf=Wc;td.oP=Xb;var Tb=this.$.oa.xa;oc.a(this.$.userOperationManager,function(Fa,Qb,cc){Qb=hb;var bc=fd.$.ya.DocumentHostInfo.TenantId;Fa=rb.b.call(null,fd.IFi,Fa);var Mc=Tb.Na(41,null);Mc.labelsInfoJson=Tc;Mc.appliedLabelId=Qb;Mc.tenantId=bc;Mc.applyLabelFlag=Xb;Mc.skipApplyOutcomes=jc;return se.g(Tb,"ApplyPolicyLabel",Mc,Fa,null,cc,td,0)},function(Fa){return new Gc.a(222,
0,Fa)},null);this.zBc=!1;this.SMd=null};e.prototype.Bna=function(){var hb=this.$.da.za(478);return this.fo&&hb?hb.fo():!1};Mf.Object.defineProperties(e.prototype,{title:{configurable:!0,enumerable:!0,get:function(){return this.vp}},vpc:{configurable:!0,enumerable:!0,get:function(){return this.Gce}},linkText:{configurable:!0,enumerable:!0,get:function(){return this.wfa}},zNi:{configurable:!0,enumerable:!0,get:function(){return this.zbe}},labelId:{configurable:!0,enumerable:!0,get:function(){return this.JDa}}});
Object(aa.a)(e,"PolicyManagerWrapper",pc.a,[472,303,999]);var Pe=uc.a;Rk(d,Pe);d.prototype.create=function(){var hb=this,Xb=Pb.GetServiceTaskFactory.Ra(this.$.da,5,4,this.hb),jc=Ga.AFrameworkApplication.qd,Wc=Ga.AFrameworkApplication.fa;sc.TaskExtensions.Aa(Xb,function(){try{var fd=new wb.a(function(){return new x(Wc,jc,Ga.AFrameworkApplication.ta.pD,hb.$.ya.MaxGetPolicyRetries,yb.a.instance.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))}),Tc=new wb.a(function(){return new fa(Ga.AFrameworkApplication.ub,
Ga.AFrameworkApplication.ta,Ga.AFrameworkApplication.fa,fd)}),td=hb.$.da.za(274);td||(td=new e(fd.value,Tc.value,Xb.result,hb.$,Ga.AFrameworkApplication.fa),kd.EwaSettings.isChangeGateEnabled("OfficeVSO:6143820_MoveServiceRegistrationFromFAM")&&hb.$.da.Ga(274,td),td.initialize());hb.pb(td)}catch(Tb){throw ba.ULS.sendTraceTag(537154525,306,10,"PolicyManager was not created successfully [Exception: {0}]",Tb.toString()),Tb;}},this.la,3)};d.ka=function(hb){hb.da.Ga(275,new d(hb))};Object(aa.a)(d,"PolicyManagerFactory",
uc.a,[]);var nc=b(905),Da=b(186);c.prototype.Lc=function(){return!1};c.prototype.executeCommand=function(hb,Xb,jc){switch(Xb.command){case Ob.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||(jc[ea.EVc]=this.$.workbookContext.ExclusiveLockId),hb=Ga.AFrameworkApplication.ub.$d(Ob.a.setSensitivity,2,jc),Cb.Task.Ua(32===hb);case Ob.a.E6:return hb=Ga.AFrameworkApplication.ub.$d(Ob.a.E6,2,jc),Cb.Task.Ua(32===hb);case Ob.a.G6:return hb=Ga.AFrameworkApplication.ub.$d(Ob.a.G6,2,jc),Cb.Task.Ua(32===
hb);default:return Da.a(Xb.command)}};c.prototype.zc=function(hb,Xb){switch(Xb.command){case Ob.a.setSensitivity:case Ob.a.E6:case Ob.a.G6:return!0;default:return!1}};c.prototype.Qc=function(hb,Xb,jc){switch(Xb){case "PopulateSensitivityFlyout":return 32===Ga.AFrameworkApplication.ub.$d(Ob.a.Rya,2,jc);default:return!1}};Object(aa.a)(c,"SensitivityCommandHandler",null,[429]);var Sb=nc.a;Rk(a,Sb);a.prototype.Ad=function(){this.jd([new c(this.$)])};a.ka=function(hb){nc.a.Qd(316,new a(hb))};Object(aa.a)(a,
"SensitivityCommandHandlerFactory",nc.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.Policy.Contracts");Type.registerNamespace("Common.App.Policy");z.main();(function(){Fc.a.Fa(function(hb){d.ka(hb);a.ka(hb)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.policy.js.map/defd6898b3cc0068b9c9f4ec81767ec4/EwaDS.policy.js.map