(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[16],{1053:function(u,E,b){function a(ea){var wa=this;ea=void 0===ea?null:ea;this.wS=0;this.PO=null;this.rug=0;var X=ka.a.me();this.Mpg=this.Ndh(ea).then(function(ja){return ja?wa.v8h():(w.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",wa.Mu(),Math.floor(ka.a.me()-X)),ja=P.a.Cr(),void 0!==ja&&null!==ja&&(ja.set("AuthLibrary",wa.Mu()),ja=Object.assign(new fa.a,
{durationMs:Math.floor(ka.a.me()-X),extendedProperties:ja}),Q.Health.instance.recordKpiFailure(a.kpiName,"StrategyPickFailed",!1,!0,ja)),Promise.resolve(1))}).then(function(ja){return 0!==ja?Promise.resolve(ja):wa.$ri()})}function c(ea){this.JOc=ea;this.kXa="UnsupportedAuthTokenStrategy Reason="+A.a[this.JOc]}function d(){this.xs=null;this.SSb=0;this.Ajb=this.zXa=this.xEc=this.yDa=this.IL=this.phe=null;this.vv=new C.a(null,null);this.vXb=D.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",
!1);this.kXa="SharedAuthTokenStrategy "+(this.vXb?"BrowserAuth 1.20210701.2/MSAL 2.11.0":"BrowserAuth 1.20210426.1/MSAL 2.11.0");this.TX=I.a.wuj;this.qfe=I.a.vuj;this.J4d=I.a.enableConsoleLogging;this.lng=D.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.bwg=D.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.vXb);this.Lqa={};this.Xpg=new l(1500)}function e(ea,wa,X,ja,va,ua,Xa){var aa=
M.call(this,!1,!1,!0)||this;aa.k1=null;aa.Y3d=null;aa.TX=ea;aa.Itg=X;aa.vv=ja;aa.Cxg=va;aa.yDa=ua;aa.xs=document.createElement("iframe");aa.xs.id="SharedAuthInteractiveFrame";aa.xs.setAttribute("name","SharedAuthInteractiveFrame");aa.xs.setAttribute("title","SharedAuthInteractiveFrame");aa.xs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");aa.xs.style.border="0";aa.xs.style.height="48px";aa.xs.style.width="190px";$addHandler(aa.xs,"error",Object(T.a)(aa,aa.pRi,"onSharedAuthFrameError"));
ea=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",aa.TX,wa,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",D.AFrameworkApplication.userType);Xa&&(ea+="&vnext=1");aa.xs.src=ea;aa.Tmg=new Promise(function(ba){aa.Y3d=ba});aa.Z3d=!1;return aa}function k(){this.correlationId=this.resolve=null}function l(ea){ea=void 0===ea?0:ea;this.IB=0;this.pkb=!1;this.rm=new U.a;this._timeout=ea}function n(){this.reject=this.resolve=null;this.startTime=0;this.LIf=this.mse=
null}function f(){this.qie=null;var ea=D.AFrameworkApplication.fa.Wa(D.AFrameworkApplication.gea),wa=D.AFrameworkApplication.fa.Wa(D.AFrameworkApplication.aag);this.kXa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",ea&&""!==ea?ea:"Unspecified",wa&&""!==wa?wa:"Unspecified")}function v(ea,wa,X,ja,va){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=ea;this.scope=wa;this.silentLogin=X;this.options=ja;this.correlationId=
va}function r(){}function y(ea){this.esg=ea}function m(){}b.r(E);u=b(0);var w=b(14),B=b(903),A=b(1130),z;(function(ea){ea[ea.external=0]="external";ea[ea.msa=1]="msa";ea[ea.aad=2]="aad"})(z||(z={}));Object(u.b)("AuthorityType",z);Object(u.a)(m,"OAuthResult",null,[]);y.prototype.initialize=function(){return Promise.resolve(0)};y.prototype.ujc=function(){return Promise.resolve(0)};y.prototype.xO=function(){w.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new m,
{IsSuccess:!0,Token:this.esg}))};y.prototype.gAc=function(){return Promise.resolve(Object.assign(new m,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};y.prototype.Hyc=function(){return!1};y.prototype.Wvb=function(){return"MockAuthTokenStrategy"};Object(u.a)(y,"MockAuthTokenStrategy",null,[839]);var x=b(1155);r.get=function(ea,wa,X){if(!X)return ea;var ja=0;return Promise.race([ea,new Promise(function(va){ja=
window.setTimeout(function(){va(wa)},X)})]).then(function(va){window.clearTimeout(ja);return Promise.resolve(va)}).catch(function(){window.clearTimeout(ja);return Promise.resolve(wa)})};Object(u.a)(r,"PromiseWithTimeout",null,[]);var D=b(4),I=b(943);Object(u.a)(v,"TokenRequestParameters",null,[858]);var F=b(27),G=b(83);f.prototype.initialize=function(){var ea=this;return new Promise(function(wa){G.a.instance.Tb("Common.App.WopiIdentity.IWopiIdentity").execute(function(X){ea.qie=X;wa(0)})})};f.prototype.li=
function(ea){for(var wa=!1,X=ea.toLocaleUpperCase(),ja=bk(["HTTPS:","API:"]),va=ja.next();!va.done;va=ja.next())if(X.startsWith(va.value)){wa=!0;break}return wa||this.Nhi(ea)?ea+"/.default":ea};f.prototype.Nhi=function(ea){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(ea)};f.prototype.ujc=function(){return Promise.resolve(0)};f.prototype.xO=function(ea,wa,X,ja,va,ua,Xa){if(F.a.Wwa){va=I.a.$Vj;if(!va)return wa=Object.assign(new m,{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",
ErrorMessage:"No app list was found."}),Promise.resolve(wa);if(!Array.contains(va,ea))return wa=Object.assign(new m,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+ea}),Promise.resolve(wa)}ea=this.li(X);X=new v(X,ea,!ja,null,D.AFrameworkApplication.userSessionId);return this.qie.getAccessToken(X,wa,Xa).then(function(aa){return Object.assign(new m,{IsSuccess:!0,Token:aa.accessToken})},function(aa){return Object.assign(new m,{IsSuccess:!1,ErrorCode:aa})})};f.prototype.gAc=
function(){return Promise.resolve(Object.assign(new m,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};f.prototype.Hyc=function(){return!1};f.prototype.Wvb=function(){return this.kXa};Object(u.a)(f,"ParentFrameTokenStrategy",null,[839]);var T=b(84),O=b(1062),U=b(202);Object(u.a)(n,"PromiseWrapper",null,[]);l.prototype.enqueue=function(ea){var wa=this;return new Promise(function(X,ja){wa.rm.add(Object.assign(new n,
{LIf:ea,resolve:X,reject:ja}));wa.process()})};l.prototype.process=function(){var ea=this;if(this.pkb||this.IB===this.rm.count)return!1;var wa=this.rm.na(this.IB++);try{this.pkb=!0,wa.LIf().then(function(X){ea.pkb=!1;ea.d1c(wa,X,null,!0)}).catch(function(X){ea.pkb=!1;ea.d1c(wa,null,X,!1)})}catch(X){this.pkb=!1,this.d1c(wa,null,X,!1)}return!0};l.prototype.d1c=function(ea,wa,X,ja){var va=this;ja?0<this._timeout?window.setTimeout(function(){ea.resolve(wa);va.process()},this._timeout):(ea.resolve(wa),
va.process()):0<this._timeout?window.setTimeout(function(){ea.reject(X);va.process()},this._timeout):(ea.reject(X),va.process())};Object(u.a)(l,"PromiseQueue",null,[]);Object(u.a)(k,"ResolveWithCorrelation",null,[]);var J=b(85),H=b(150),K=b(1030),N=b(170),M=H.a;Rk(e,M);e.prototype.Vwc=function(){var ea={};ea=(ea.promptMessage=this.Itg,ea.errorText=CommonUIStrings.l_InternalError,ea.rtl=D.AFrameworkApplication.isRtl,ea.frameLoaded=!1,ea.createFrame=Object(T.a)(this,this.c6g,"createFrame"),ea.resolveDialogStyles=
this.Y3d,ea);var wa={};this.k1=(wa.id="SharedAuthConsentDialog",wa.bodyControls=ea,wa);this.Rb=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(T.a)(this,this.uuj,"sharedAuthConsentDialogHandler"),this.k1)};e.prototype.uBc=function(ea,wa,X){ea=void 0===ea?!1:ea;wa=void 0===wa?!1:wa;X=void 0===X?5:X;this.k1&&this.k1.bodyControls&&(ea!==Object(J.a)(Object,this.k1.bodyControls).frameLoaded&&(Object(J.a)(Object,this.k1.bodyControls).frameLoaded=ea),wa!==Object(J.a)(Object,this.k1.bodyControls).frameLoadSuccess&&
(Object(J.a)(Object,this.k1.bodyControls).frameLoadSuccess=wa),X!==this.k1.dialogButtonsOption&&(this.k1.dialogButtonsOption=null,this.Rb=X),this.update(this.k1))};e.prototype.GAj=function(ea,wa){var X=new K.a(N.a.yuj),ja={};ea=(ja.signInLabel=CommonUIStrings.l_SignIn,ja.cancelLabel=CommonUIStrings.l_DialogCancel,ja.rtl=D.AFrameworkApplication.isRtl,ja.messageCorrelationId=ea,ja.dialogStyles=wa,ja);X.Values=ea;this.vv.TQa(X,this.xs.contentWindow,this.TX)};e.prototype.FTe=function(){this.uBc(!0,!1,
6)};e.prototype.pRi=function(){this.FTe()};e.prototype.c6g=function(){return this.xs};e.prototype.uuj=function(ea){0===ea&&(this.Cxg.reject(Object.assign(new m,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.yDa(null))};Mf.Object.defineProperties(e.prototype,{Z_f:{configurable:!0,enumerable:!0,get:function(){return this.xs}},Aeh:{configurable:!0,enumerable:!0,get:function(){var ea=this;return this.Tmg.then(function(wa){ea.Z3d=!0;return wa})}},Beh:{configurable:!0,
enumerable:!0,get:function(){return this.Z3d}}});Object(u.a)(e,"SharedAuthConsentDialog",H.a,[859]);var C=b(1442),Q=b(99),P=b(136),ka=b(39),R=b(178),fa=b(190);d.prototype.Wvb=function(){return this.kXa};d.prototype.initialize=function(){var ea=b(1053).OAuthManager;if("loadFrame"in this.Lqa)return this.Lqa.loadFrame.mse;if(!this.TX)return Q.Health.instance.recordKpiFailure(ea.kpiName,"SharedAuthFrameOriginNotSet",!1,!1,null),w.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),
Promise.reject(1);ea=this.nyc("loadFrame");this.SSb=ka.a.me();var wa=this.TX+this.qfe+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+D.AFrameworkApplication.userSessionId+"&WacUserType="+D.AFrameworkApplication.userType;this.vXb&&(wa+="&vnext=1");this.xs=document.createElement("iframe");this.c$h(this.xs);this.xs.style.cssText="height:0;width:0;display:none;";this.xs.id="SharedAuthFrame";this.xs.setAttribute("name","SharedAuthFrame");this.xs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");
this.xs.setAttribute("title","SharedAuthFrame");this.xs.src=wa;document.body.appendChild(this.xs);wa=ka.a.me()-this.SSb;w.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",wa,this.xs.src);return ea};d.prototype.ujc=function(ea){this.xEc=ea;var wa=new K.a(N.a.b0f);wa.Values=this.Pre(ea);ea=this.nyc("initFrame");this.vv.TQa(wa,this.xs.contentWindow,this.TX);w.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");
return ea};d.prototype.xO=function(ea,wa,X,ja,va,ua){var Xa=this,aa=new K.a(N.a.zuj),ba=this.z0e();aa.Values=this.v$f(ea,wa,X,ja,va,ua,ba);ea=this.nyc(ba);ja&&D.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.Xpg.enqueue(function(){return new Promise(function(oa){Xa.FMj(ua,aa,oa,ba)})}):(this.vv.TQa(aa,this.xs.contentWindow,this.TX),w.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",
wa));return ea};d.prototype.FMj=function(ea,wa,X,ja){var va=this.Lqa[ja];va&&(this.zXa=wa,this.yDa=Object.assign(new k,{resolve:X,correlationId:ja}),this.IL=new e(this.TX,this.qfe,ea,this.vv,va,X,this.vXb),this.IL.Vwc())};d.prototype.z0e=function(){return R.a.create().toString()};d.prototype.v$f=function(ea,wa,X,ja,va,ua,Xa){var aa={};aa.appName=ea;aa.appId=wa;aa.target=X;aa.withPopup=ja;aa.claims=va;aa.promptMessage=ua;aa.messageCorrelationId=Xa;return aa};d.prototype.c$h=function(ea){$addHandler(ea,
"load",Object(T.a)(this,this.rMi,"onIFrameLoaded"));$addHandler(ea,"error",Object(T.a)(this,this.Tmc,"onIFrameError"));this.vv.rFa(this.TX);this.vv.Tn(N.a.e0f);this.vv.Ml(N.a.e0f,Object(T.a)(this,this.HQi,"onScriptLoaded"));this.vv.Tn(N.a.d0f);this.vv.Ml(N.a.d0f,Object(T.a)(this,this.GQi,"onScriptInitialized"));this.vv.Tn(N.a.$_f);this.vv.Ml(N.a.$_f,Object(T.a)(this,this.SLi,"onGetTokenResponse"));this.vv.Tn(N.a.f0f);this.vv.Ml(N.a.f0f,Object(T.a)(this,this.INi,"onLoginResponse"));this.vv.Tn(N.a.c0f);
this.vv.Ml(N.a.c0f,Object(T.a)(this,this.MMi,"onInteractiveFlowReady"));this.vv.Tn(N.a.a0f);this.vv.Ml(N.a.a0f,Object(T.a)(this,this.jMi,"onHideDialog"));this.vv.Tn(N.a.Y_f);this.vv.Ml(N.a.Y_f,Object(T.a)(this,this.lHi,"onCloseDialog"))};d.prototype.nyc=function(ea){var wa=new n;wa.startTime=ka.a.me();var X=new Promise(function(ja,va){wa.resolve=ja;wa.reject=va});wa.mse=X;this.Lqa[ea]=wa;return X};d.prototype.rMi=function(){var ea=ka.a.me()-this.SSb;w.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",
ea)};d.prototype.Tmc=function(ea){var wa=b(1053).OAuthManager,X=ka.a.me()-this.SSb,ja=Object.assign(new fa.a,{durationMs:X});Q.Health.instance.recordKpiFailure(wa.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,ja);w.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",X,this.J4d?JSON.stringify(ea):"")};d.prototype.HQi=function(ea){var wa=b(1053).OAuthManager,X=this.Lqa.loadFrame,ja=ka.a.me()-X.startTime,va=ea.Values.AuthLibrary.toString();ea=ea.Values.Success.toString();
w.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",ea,va,ja);va&&(this.kXa="SharedAuthTokenStrategy "+va);va=Boolean.parse(ea);va||(ea=P.a.Cr(),void 0!==ea&&null!==ea&&(ea.set("AuthLibrary",this.Wvb()),ja=Object.assign(new fa.a,{durationMs:ja,extendedProperties:ea}),Q.Health.instance.recordKpiFailure(wa.kpiName,"SharedAuthStrategyInitFailed",!1,!0,ja)));X.resolve(va?0:1)};d.prototype.GQi=function(ea){var wa=this;if(ea.Values.interactive&&
this.zXa&&this.zXa.Values.messageCorrelationId){var X=this.zXa.Values.messageCorrelationId.toString();if(ea.Values.interactive&&this.IL){this.IL.Aeh.then(function(va){wa.vv.TQa(wa.zXa,wa.IL.Z_f.contentWindow,wa.TX);wa.IL.GAj(X,va);wa.IL.uBc(!0,!0);wa.zXa=null});return}}ea=this.Lqa.initFrame;var ja=ka.a.me()-ea.startTime;w.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",ja);ea.resolve(0)};d.prototype.SLi=function(ea){if(ea.Values.messageCorrelationId&&ea.Values.messageCorrelationId.toString()){var wa=
ea.Values.messageCorrelationId.toString(),X=this.Lqa[wa];if(X){var ja=ka.a.me()-X.startTime;w.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",ja);ea.Values.isSuccess&&ea.Values.isSuccess?X.resolve(ea.Values.response):X.reject(ea.Values.response);this.K$f(wa)}else w.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else w.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")};
d.prototype.MMi=function(){if(this.IL.Beh)this.IL.FTe();else if(this.xEc&&this.IL){var ea=new K.a(N.a.b0f);ea.Values=this.Pre(this.xEc,!0);this.vv.TQa(ea,this.IL.Z_f.contentWindow,this.TX)}};d.prototype.jMi=function(){this.IL&&this.IL.hxb()};d.prototype.lHi=function(ea){ea.Values.cancelled&&ea.Values.cancelled&&ea.Values.messageCorrelationId&&this.K$f(ea.Values.messageCorrelationId.toString());this.IL&&this.IL.hide()};d.prototype.Pre=function(ea,wa){wa=void 0===wa?!1:wa;var X={};X.appIds=this.CHh();
X.upn=ea.loginHint;X.authority=ea.authority;X.authorityType=Object(B.a)(z,ea.authorityType);X.tenantId=ea.tenantId;X.correlationId=D.AFrameworkApplication.userSessionId;X.enableConsoleLogging=this.J4d;X.enablePopupFlash=this.lng;X.skipUpnCheck=this.bwg;X.interactive=wa;return X};d.prototype.CHh=function(){var ea=[],wa=I.a.FVc,X;for(X in wa)Array.add(ea,wa[X]);return ea};d.prototype.gAc=function(ea,wa,X,ja,va,ua){var Xa=new K.a(N.a.xuj),aa=this.z0e();Xa.Values=this.v$f(ea,wa,X,ja,va,ua,aa);this.phe=
Xa;ea=this.nyc(aa);w.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",wa);this.pyj();return ea};d.prototype.Hyc=function(){return!0};d.prototype.pyj=function(){var ea=this;this.Ajb||(this.Ajb=new O.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Ajb.id=16,this.Ajb.Rdf=!1,this.Ajb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,function(){w.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");
ea.vv.TQa(ea.phe,ea.xs.contentWindow,ea.TX)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),w.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))};d.prototype.INi=function(ea){if(ea.Values.messageCorrelationId&&ea.Values.messageCorrelationId.toString()){var wa=this.Lqa[ea.Values.messageCorrelationId.toString()];if(wa){var X=ka.a.me()-wa.startTime;w.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",
X);ea.Values.isSuccess&&ea.Values.isSuccess?wa.resolve(ea.Values.response):wa.reject(ea.Values.response)}else w.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else w.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")};d.prototype.K$f=function(ea){this.yDa&&this.yDa.correlationId===ea&&(this.yDa.resolve(null),this.yDa=null)};Object(u.a)(d,"SharedAuthTokenStrategy",
null,[839]);c.prototype.initialize=function(){return Promise.resolve(0)};c.prototype.ujc=function(){return Promise.resolve(0)};c.prototype.xO=function(){return Promise.resolve(Object.assign(new m,{IsSuccess:!1,ErrorCode:A.a[this.JOc],ErrorMessage:"Unable to get a token. Reason: ["+A.a[this.JOc]+"]"}))};c.prototype.gAc=function(){return Promise.resolve(Object.assign(new m,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};
c.prototype.Hyc=function(){return!1};c.prototype.Wvb=function(){return this.kXa};Object(u.a)(c,"UnsupportedAuthTokenStrategy",null,[839]);var ca=b(931);b.d(E,"OAuthManager",function(){return a});a.prototype.Odh=function(){var ea=I.a.pAi;ea&&0<ea.length?(this.wS=1,this.PO=new y(ea)):D.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||D.AFrameworkApplication.fa.qa("IsO365CommercialHost")?D.AFrameworkApplication.fa.qa("IsAnonymousUser")?(this.wS=2,this.PO=new c(this.wS)):(ea=x.a.getAuthContext().loginHint)&&
ea.length?I.a.lxb?(this.wS=1,this.PO=new f):(this.wS=1,this.PO=new d):(this.wS=3,this.PO=new c(this.wS)):(this.wS=4,this.PO=new c(this.wS))};a.prototype.Mu=function(){return this.PO?this.PO.Wvb()||"Unknown":"None"};a.prototype.Ndh=function(ea){var wa=this;ea=void 0===ea?null:ea;w.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");var X=ka.a.me();return D.AFrameworkApplication.fa.xdd().then(function(ja){ja?(wa.Odh(),ea&&(wa.PO=ea),w.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",
I.a.clientVersion,I.a.appVersion,I.a.Lgh,wa.Mu(),Math.floor(ka.a.me()-X))):w.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(ka.a.me()-X));return Promise.resolve(ja)},function(){w.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(ka.a.me()-X));return Promise.resolve(!1)})};
a.prototype.v8h=function(){var ea=this;w.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.Mu());var wa=ka.a.me();return r.get(this.PO.initialize(),2,I.a.KEd).then(function(X){if(0===X)w.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",ea.Mu(),Math.floor(ka.a.me()-wa));else if(1===X){w.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",ea.Mu(),Math.floor(ka.a.me()-wa));var ja=P.a.Cr();void 0!==
ja&&null!==ja&&(ja.set("AuthLibrary",ea.Mu()),ja=Object.assign(new fa.a,{durationMs:Math.floor(ka.a.me()-wa),extendedProperties:ja}),Q.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitFailed",!1,!0,ja))}else 2===X&&(w.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",ea.Mu(),Math.floor(ka.a.me()-wa)),ja=P.a.Cr(),void 0!==ja&&null!==ja&&(ja.set("AuthLibrary",ea.Mu()),ja=Object.assign(new fa.a,{durationMs:Math.floor(ka.a.me()-
wa),extendedProperties:ja}),Q.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitTimedOut",!1,!0,ja)));return Promise.resolve(X)},function(){w.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",ea.Mu(),Math.floor(ka.a.me()-wa));return Promise.resolve(1)})};a.prototype.$ri=function(){var ea=this;w.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.Mu());var wa=ka.a.me();return r.get(this.PO.ujc(x.a.getAuthContext()),2,I.a.KEd).then(function(X){if(0===
X)w.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",ea.Mu(),Math.floor(ka.a.me()-wa));else if(1===X){w.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",ea.Mu(),Math.floor(ka.a.me()-wa));var ja=P.a.Cr();void 0!==ja&&null!==ja&&(ja.set("AuthLibrary",ea.Mu()),ja=Object.assign(new fa.a,{durationMs:Math.floor(ka.a.me()-wa),extendedProperties:ja}),Q.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadFailed",!1,!0,
ja))}else 2===X&&(w.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",ea.Mu(),Math.floor(ka.a.me()-wa)),ja=P.a.Cr(),void 0!==ja&&null!==ja&&(ja.set("AuthLibrary",ea.Mu()),ja=Object.assign(new fa.a,{durationMs:Math.floor(ka.a.me()-wa),extendedProperties:ja}),Q.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadTimedOut",!1,!0,ja)));return Promise.resolve(X)},function(){w.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",
ea.Mu(),Math.floor(ka.a.me()-wa));return Promise.resolve(1)})};a.prototype.xO=function(ea,wa,X){return this.eAc(ea,wa,!1,null,"",void 0===X?null:X)};a.prototype.w$f=function(ea,wa,X,ja,va){return this.eAc(ea,wa,!0,X,ja,void 0===va?null:va)};a.prototype.eAc=function(ea,wa,X,ja,va,ua,Xa){Xa=void 0===Xa?0:Xa;Xa+=1;w.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",ea,this.AQa(ea,wa),this.Mu(),Xa);var aa=P.a.Cr();void 0!==aa&&
null!==aa&&(aa.set("AuthLibrary",this.Mu()),aa.set("AppName",ea),aa.set("Target",this.AQa(ea,wa)),Q.Health.instance.recordKpiUsage(a.kpiName,0,"WacOAuthFC",aa));if(!I.a.isEnabled){var ba;return this.etd((ba=new m,ba.IsSuccess=!1,ba.Token=null,ba.ErrorCode="NotEnabled",ba.ErrorMessage="OAuthManager is disabled.",ba),ea)}var oa=I.a.FVc[ea];if(void 0===oa||null===oa){w.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",
ea);var ra;return this.etd((ra=new m,ra.IsSuccess=!1,ra.Token=null,ra.ErrorCode="DisallowedApp",ra.ErrorMessage="Disallowed appName: "+ea,ra),ea)}var db=ka.a.me(),Ka=this;aa=this.Mpg.then(function(qa){return Ka.jdi(ea,oa,wa,X,ja,va,ua,qa)});ba=X?0:I.a.KEd;var Ga;ra=(Ga=new m,Ga.IsSuccess=!1,Ga.Token=null,Ga.ErrorCode="authTokenStrategy_timeout",Ga.ErrorMessage="Auth Strategy timed out after ["+ba+"] ms when fetching token",Ga);var xa=this,da=this;return r.get(aa,ra,ba).then(function(qa){return Xa<=
a.Wyi&&(qa.ErrorCode===a.H8f||qa.ErrorCode===a.gFj)?(w.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",Xa,Math.floor(ka.a.me()-db)),xa.eAc(ea,wa,X,ja,va,ua,Xa)):qa.ErrorCode===a.phf&&!X&&(w.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",Xa,a.UJe),a.Sjh&&xa.PO.Hyc()&&xa.PO.gAc(ea,oa,wa,X,ja,va).then(function(na){return Promise.resolve(xa.Mjc(na,ea,wa,oa,db))}).catch(function(){var na,
ia=(na=new m,na.IsSuccess=!1,na.Token=null,na.ErrorCode="authTokenStrategy_failure",na.ErrorMessage="LoginPopup failed, GetToken could not be called",na);return Promise.resolve(xa.Mjc(ia,ea,wa,oa,db))}),a.UJe)?xa.eAc(ea,wa,!0,ja,va,ua,Xa):Promise.resolve(xa.Mjc(qa,ea,wa,oa,db))}).catch(function(){var qa,na=(qa=new m,qa.IsSuccess=!1,qa.Token=null,qa.ErrorCode="authTokenStrategy_failure",qa.ErrorMessage="Auth Strategy failed with an unknown error",qa);return Promise.resolve(da.Mjc(na,ea,wa,oa,db))})};
a.prototype.jdi=function(ea,wa,X,ja,va,ua,Xa,aa){var ba=this;return 1===aa||2===aa?this.etd(Object.assign(new m,{IsSuccess:!1,Token:null,ErrorCode:1===aa?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),ea):this.PO.xO(ea,wa,X,ja,va,ua,Xa).then(function(oa){return Promise.resolve(ba.Vqf(oa,!0,ea))}).catch(function(oa){return Promise.resolve(ba.Vqf(oa,!1,ea))})};a.prototype.Mjc=function(ea,wa,X,ja,va){var ua={};va=ka.a.me()-va;ua.IsSuccess=ea.IsSuccess;ua.ErrorCode=
ea.IsSuccess?"Success":ea.ErrorCode||"";ua.ErrorMessage=ea.IsSuccess?"Success":this.AQa(wa,ea.ErrorMessage||"");ua.Target=this.AQa(wa,X||"");ua.TimeInMS=Math.floor(va);ua.AuthLibrary=this.Mu();ua.AppName=wa;ua.AuthorityType=Object(B.a)(z,x.a.N$b());ua.UserType=this.JZh(x.a.getAuthContext());ua.IsAuthSupportedInSession=A.a[this.wS];ua.RequestCount=++this.rug;ua.AppId=ja;w.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(ua));ea.IsSuccess||(X=P.a.Cr(),void 0!==X&&null!==X&&(X.set("AppName",wa),X.set("AuthLibrary",
this.Mu()),X.set("ErrorCode",ea.ErrorCode),X.set("ErrorMessage",this.AQa(wa,ea.ErrorMessage)),wa=Object.assign(new fa.a,{durationMs:va,extendedProperties:X}),Q.Health.instance.recordKpiFailure(a.kpiName,"TryGetTokenFailure",!1,!0,wa)));return ea};a.prototype.etd=function(ea,wa){w.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",wa,this.AQa(wa,ea.ErrorMessage));var X=P.a.Cr();void 0!==X&&null!==X&&(X.set("AppName",wa),X.set("AuthLibrary",
this.Mu()),X.set("ErrorCode",ea.ErrorCode),X.set("ErrorMessage",this.AQa(wa,ea.ErrorMessage)),wa=Object.assign(new fa.a,{extendedProperties:X}),Q.Health.instance.recordKpiFailure(a.kpiName,"FailureBeforeGetToken",!1,!0,wa));return Promise.resolve(ea)};a.prototype.scf=function(ea){return ea===ca.a.rzc};a.prototype.AQa=function(ea,wa){return this.scf(ea)&&wa?"REDACTED":wa};a.prototype.JZh=function(ea){return D.AFrameworkApplication.fa.qa("IsAnonymousUser")?"anonymous":!ea.loginHint||1>ea.loginHint.length?
"empty":-1<ea.loginHint.indexOf("guest#")?"guest":-1<ea.loginHint.indexOf("ext#")?"external":0>ea.upn.indexOf("@")?"no-at":"supported"};a.prototype.w5a=function(){return 1===this.wS};a.prototype.Vqf=function(ea,wa,X){var ja=null,va=null,ua=null,Xa=null;ea?ea.ErrorCode||ea.ErrorMessage?(va=ea.ErrorCode?ea.ErrorCode:a.bQe,ua=ea.ErrorMessage?ea.ErrorMessage:"No message"):ea.Token?wa?ja=ea.Token:(va=a.Q8i,ua="A rejected promise returned a token."):(va=a.bQe,ua=JSON.stringify(ea)):(va=a.SCi,ua="No result came from Auth Token Strategy");
ea&&ea.Telemetry&&!this.scf(X)&&(Xa=ea.Telemetry,w.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(Xa)));if(va===a.BAi||va===a.UJj)va=a.H8f,ua="Auth Library Timed Out";va===a.lMg&&-1<ua.indexOf(a.tyg)&&(va=a.phf);if(va||ua)ja=null;return Object.assign(new m,{IsSuccess:!!ja,Token:ja,ErrorCode:va,ErrorMessage:ua,Telemetry:Xa})};Mf.Object.defineProperties(a,{UJe:{configurable:!0,enumerable:!0,get:function(){return D.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",
!1)}},Sjh:{configurable:!0,enumerable:!0,get:function(){return D.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",!1)}}});a.UJj="token_renewal_error";a.bQe="Exception";a.SCi="NoResult";a.Q8i="RejectToken";a.BAi="monitor_window_timeout";a.H8f="Timeout";a.gFj="authTokenStrategy_timeout";a.lMg="login_required";a.tyg="AADSTS50058";a.phf="Cookies Disabled";a.kpiName="OAuthManager";a.Wyi=2;Object(u.a)(a,"OAuthManager",null,[775])},1130:function(u,E,b){b.d(E,
"a",function(){return a});u=b(0);var a;(function(c){c[c.unknown=0]="unknown";c[c.supported=1]="supported";c[c.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";c[c.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";c[c.hostUnsupported=4]="hostUnsupported"})(a||(a={}));Object(u.b)("SupportStatus",a)},1415:function(u,E,b){function a(){Type.registerNamespace("Common.App.LivePersonaUtils");c.main()}function c(){}function d(r){this.yUb=r}function e(){}u=b(0);var k=b(1155),l=b(4);Object(u.a)(e,
"LokiTokenResult",null,[]);d.prototype.fed=function(){var r=this,y=this.VQh();return y?d.ood?new Promise(function(m,w){r.yUb.continueWith(function(){r.yUb.zh||r.yUb.Xf?w(Error.create("Error downloading auth library")):r.yUb.result.xO("Loki",y).then(function(B){B=l.AFrameworkApplication.fa.qa("ForceLokiFallbackToACLPTokenIsEnabled")?r.YQh():B.IsSuccess&&B.Token?Object.assign(new e,{isSuccess:!0,token:B.Token,errorMessage:null}):Object.assign(new e,{isSuccess:!1,token:null,errorMessage:JSON.stringify(B)});
m(B);return B})})}):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",k.a.LVe())}))};d.prototype.YQh=function(){var r=l.AFrameworkApplication.fa.Wa("LokiUserDataSignature")||"";return Object.assign(new e,{isSuccess:!0,token:r,errorMessage:null})};d.prototype.VQh=
function(){var r=null,y=k.a.N$b();2===y?r=l.AFrameworkApplication.fa.Wa("LokiAADAppId"):1===y&&(r=l.AFrameworkApplication.fa.Wa("LokiMSAAppId"));return r};Mf.Object.defineProperties(d,{ood:{configurable:!0,enumerable:!0,get:function(){return l.AFrameworkApplication.fa.qa("IsO365CommercialHost")||l.AFrameworkApplication.fa.qa("IsO365ConsumerHost")}}});Object(u.a)(d,"LokiTokenManager",null,[962]);var n=b(254),f=b(83),v=b(567);c.prototype.init=function(){f.a.instance.resolve("Common.ILokiTokenManager")};
c.prototype.dispose=function(){};c.prototype.Ph=function(r){r.register(d,"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").tc().Cc(function(){return new d(v.a.Jq(r.Tb("Common.App.OAuth.IOAuthManager")))})};c.main=function(){n.a.instance.Qi(new c)};Mf.Object.defineProperties(c.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.LivePersonaUtils"}}});Object(u.a)(c,"LivePersonaUtilsPackage",null,[10,11]);b.d(E,"a",function(){return a})},1451:function(u,
E,b){function a(){Type.registerNamespace("Common.App.OAuth");c.main()}function c(){}u=b(0);var d=b(14),e=b(1053),k=b(1130),l=b(4),n=b(99),f=b(943),v=b(254),r=b(39),y=b(27),m=b(83),w=b(190);c.prototype.Ph=function(B){B.register(775,"Common.App.OAuth.IOAuthManager").tc().Cc(function(){return new e.OAuthManager})};c.prototype.init=function(){var B=m.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.pNj(B)};c.prototype.pNj=function(B){var A=l.AFrameworkApplication.fa.Wa("FileSource");if(l.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||
l.AFrameworkApplication.fa.qa("IsO365CommercialHost")||"WopiTest"===A){var z=f.a.EDh,x=f.a.authority;if(void 0!==z&&null!==z&&z.length&&void 0!==x&&null!==x&&x.length){var D=k.a[B.wS],I=y.a.pGa,F=B.Mu();try{var G=new Map;void 0!==G&&null!==G?(G.set("SupportStatus",D),G.set("Browser",I),G.set("AuthStrategy",F)):G=null}catch(O){G=null}n.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",G);var T=r.a.me();B.xO("Core",z).then(function(O){var U=Math.floor(r.a.me()-T);D=k.a[B.wS];I=
y.a.pGa;F=B.Mu();d.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',U,O.IsSuccess,D,O.ErrorCode,A,I,F);G&&(G.set("SupportStatus",D),G.set("Browser",I),G.set("AuthStrategy",F));U=Object.assign(new w.a,{durationMs:U,extendedProperties:G});O.IsSuccess?n.Health.instance.recordKpiSuccess("WacCorePFT",U):n.Health.instance.recordKpiFailure("WacCorePFT",
O.ErrorCode,!1,!1,U)}).catch(function(O){var U=Math.floor(r.a.me()-T);U=Object.assign(new w.a,{durationMs:U,extendedProperties:G});n.Health.instance.recordKpiFailure("WacCorePFT","UNEXPECTED CATCH: "+O.toString(),!1,!1,U)})}}};c.prototype.dispose=function(){};c.main=function(){v.a.instance.Qi(new c)};Mf.Object.defineProperties(c.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.OAuth.OAuthPackage"}}});Object(u.a)(c,"OAuthPackage",null,[10,11]);b.d(E,"a",function(){return a})},
1452:function(u,E,b){function a(){e.a.Fa(function(m){c.ka(m)})}function c(m){var w=y.call(this)||this;w.$=m;w.Eb();return w}function d(m){this.oAuthManager=m}var e=b(10);u=b(0);var k=b(83),l=b(232),n=b(7),f=b(14),v=b(1024);d.prototype.xO=function(m,w){return this.oAuthManager?this.oAuthManager.xO(m,w).then(function(B){B.IsSuccess||f.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+B.ErrorMessage+" Error code: "+B.ErrorCode+" App name: "+m);return Object(n.a)(new v.a,{IsSuccess:B.IsSuccess,
Token:B.Token,ErrorCode:B.ErrorCode,ErrorMessage:B.ErrorMessage})}):(f.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object(n.a)(new v.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))};d.prototype.w5a=function(){return this.oAuthManager?this.oAuthManager.w5a():null};Object(u.a)(d,"OAuthManagerWrapper",null,[772]);var r=b(911),y=l.a;Rk(c,y);c.prototype.create=function(){this.pb(Object(r.a)(this.$.da,
349,function(){return new d(k.a.instance.resolve("Common.App.OAuth.IOAuthManager"))}))};c.ka=function(m){m.da.Ga(350,new c(m))};Object(u.a)(c,"OAuthManagerFactory",l.a,[]);b.d(E,"a",function(){return a})},1664:function(u,E,b){b.r(E);u=b(1451);E=b(1415);b=b(1452);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Object(u.a)();Object(E.a)();Object(b.a)()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.oauth.js.map/91540d8cccb7effa518fc9449125dec2/EwaDS.oauth.js.map